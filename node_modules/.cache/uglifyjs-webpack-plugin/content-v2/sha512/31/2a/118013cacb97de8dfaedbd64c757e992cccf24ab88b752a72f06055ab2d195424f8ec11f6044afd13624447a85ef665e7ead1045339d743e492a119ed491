{"code":"(wx.webpackJsonp=wx.webpackJsonp||[]).push([[51],{\"119\":function(e,t,n){\"use strict\";n.r(t);var o=n(44),r=n.n(o);for(var i in o)\"default\"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);t.default=r.a},\"199\":function(e,t,n){e.exports=n.p+\"pages/golive/golive.wxml\"},\"349\":function(e,t,n){\"use strict\";n.r(t);n(350);var o=n(119);for(var r in o)\"default\"!==r&&function(e){n.d(t,e,function(){return o[e]})}(r)},\"350\":function(e,t,n){\"use strict\";n(199)},\"351\":function(e,t,n){e.exports={\"liveMes\":\"index-module__liveMes___3Pfrp\",\"product_lay\":\"index-module__product_lay___3aAZG\",\"allNum\":\"index-module__allNum___R9tde\",\"maskFixed\":\"index-module__maskFixed___10ZWZ\",\"shop\":\"index-module__shop___1t7eH\",\"logoImg\":\"index-module__logoImg___1cwrh\",\"goodlist_style\":\"index-module__goodlist_style___enzfW\",\"logoImg_img\":\"index-module__logoImg_img___2F9Wk\",\"rightShare\":\"index-module__rightShare___RzlaS\",\"right_share_img\":\"index-module__right_share_img___sOl2j\",\"inputMes\":\"index-module__inputMes___3xaIU\",\"send_Item\":\"index-module__send_Item___3umli\",\"headTop\":\"index-module__headTop___K6JXu\",\"headleft\":\"index-module__headleft___1KxUZ\",\"head_mes\":\"index-module__head_mes___1w9iz\",\"headRight\":\"index-module__headRight___3kOVX\",\"topImg\":\"index-module__topImg___3gstj\",\"topImg_img\":\"index-module__topImg_img___rzA50\",\"botImg\":\"index-module__botImg___2JzEh\",\"lefthead\":\"index-module__lefthead___3WYgB\",\"headInnerImg\":\"index-module__headInnerImg___XzHnA\",\"righthead\":\"index-module__righthead___3aMHy\",\"topText\":\"index-module__topText___3RfiH\",\"botText\":\"index-module__botText___1Sxr6\",\"goodsList\":\"index-module__goodsList___1AdGe\",\"live_list_Img\":\"index-module__live_list_Img___3BHxS\",\"live_img\":\"index-module__live_img___2NLGk\",\"evegoods\":\"index-module__evegoods___Chb9H\",\"recom_mes\":\"index-module__recom_mes___2jr5d\",\"leftHeadImg\":\"index-module__leftHeadImg___1m-m2\",\"left_img_head\":\"index-module__left_img_head___39iYN\",\"rightHeadImg\":\"index-module__rightHeadImg___3fBpX\",\"topHeadImg\":\"index-module__topHeadImg___3cHHd\",\"botHeadImg\":\"index-module__botHeadImg___5rEqj\",\"barrageMes\":\"index-module__barrageMes___2V6o2\",\"noticeMes\":\"index-module__noticeMes___32iVO\",\"newnoticeMes\":\"index-module__newnoticeMes___21kI-\",\"textName\":\"index-module__textName___2RUyA\",\"textInner\":\"index-module__textInner___XKWjQ\",\"anchor\":\"index-module__anchor___1jQ70\",\"ancher\":\"index-module__ancher___12RG0\",\"eveInner\":\"index-module__eveInner___NY827\",\"leftInner\":\"index-module__leftInner___3bWEG\",\"leftInner_Img\":\"index-module__leftInner_Img___1I6t3\",\"RightInner\":\"index-module__RightInner___1T6q_\",\"priceInner\":\"index-module__priceInner___tyBPg\",\"titleInner\":\"index-module__titleInner___1AdgM\",\"priLogo\":\"index-module__priLogo___36HX1\",\"priStyle\":\"index-module__priStyle___2H9yB\",\"botStyle\":\"index-module__botStyle___bjkbP\",\"pointstyle\":\"index-module__pointstyle___3OPek\",\"point\":\"index-module__point___2qOkj\",\"editorMes\":\"index-module__editorMes___3HIOC\",\"delItem\":\"index-module__delItem___2IRtp\",\"downItem\":\"index-module__downItem___1H4Qx\",\"ediItem\":\"index-module__ediItem___2kfka\",\"sharePrice\":\"index-module__sharePrice___2OZKE\",\"twoButton\":\"index-module__twoButton___3A3r9\",\"shareButton\":\"index-module__shareButton___3cmof\",\"getButton\":\"index-module__getButton___rbojD\",\"shareImgMes\":\"index-module__shareImgMes___VwMhs\",\"liveStyle\":\"index-module__liveStyle___31bZz\",\"liveLeft\":\"index-module__liveLeft___8elfz\",\"liveRight\":\"index-module__liveRight___JbDme\",\"topHead\":\"index-module__topHead___3TWQe\",\"botHead\":\"index-module__botHead___10rla\",\"eveImg\":\"index-module__eveImg___ormCS\",\"openLive\":\"index-module__openLive___h5dPk\",\"play_Item_style\":\"index-module__play_Item_style___7R7j_\",\"live_end_style\":\"index-module__live_end_style___1Ykgt\",\"live_start_mes\":\"index-module__live_start_mes___2IVic\",\"center_text\":\"index-module__center_text___2B8rx\",\"top_text\":\"index-module__top_text___3U0gx\",\"top_bottom_text\":\"index-module__top_bottom_text___27vjS\",\"icon_back\":\"index-module__icon_back____UH5j\",\"left_back_mes\":\"index-module__left_back_mes___4FVJ9\",\"cancalItem\":\"index-module__cancalItem___1mNBm\",\"cancalBtn\":\"index-module__cancalBtn___31c8h\",\"gray\":\"index-module__gray___2bB_E\",\"chat_container\":\"index-module__chat_container___Mcu06\",\"chat_popup\":\"index-module__chat_popup___bEhHi\",\"chat_body\":\"index-module__chat_body___r2cjf\",\"input_inner\":\"index-module__input_inner___ng46S\",\"chat_text\":\"index-module__chat_text___2FHw3\",\"share_popup\":\"index-module__share_popup___2gHc2\",\"share_title\":\"index-module__share_title___3oymw\"}},\"352\":function(e,t,n){(function(Ci){e.exports=function(){var y=\"2.4.1\",v={\"SDK_READY\":\"sdkStateReady\",\"SDK_NOT_READY\":\"sdkStateNotReady\",\"SDK_DESTROY\":\"sdkDestroy\",\"MESSAGE_RECEIVED\":\"onMessageReceived\",\"MESSAGE_REVOKED\":\"onMessageRevoked\",\"CONVERSATION_LIST_UPDATED\":\"onConversationListUpdated\",\"GROUP_LIST_UPDATED\":\"onGroupListUpdated\",\"GROUP_SYSTEM_NOTICE_RECEIVED\":\"receiveGroupSystemNotice\",\"PROFILE_UPDATED\":\"onProfileUpdated\",\"BLACKLIST_UPDATED\":\"blacklistUpdated\",\"KICKED_OUT\":\"kickedOut\",\"ERROR\":\"error\"},S={\"MSG_TEXT\":\"TIMTextElem\",\"MSG_IMAGE\":\"TIMImageElem\",\"MSG_SOUND\":\"TIMSoundElem\",\"MSG_AUDIO\":\"TIMSoundElem\",\"MSG_FILE\":\"TIMFileElem\",\"MSG_FACE\":\"TIMFaceElem\",\"MSG_VIDEO\":\"TIMVideoFileElem\",\"MSG_GEO\":\"TIMLocationElem\",\"MSG_GRP_TIP\":\"TIMGroupTipElem\",\"MSG_GRP_SYS_NOTICE\":\"TIMGroupSystemNoticeElem\",\"MSG_CUSTOM\":\"TIMCustomElem\",\"CONV_C2C\":\"C2C\",\"CONV_GROUP\":\"GROUP\",\"CONV_SYSTEM\":\"@TIM#SYSTEM\",\"GRP_PRIVATE\":\"Private\",\"GRP_PUBLIC\":\"Public\",\"GRP_CHATROOM\":\"ChatRoom\",\"GRP_AVCHATROOM\":\"AVChatRoom\",\"GRP_MBR_ROLE_OWNER\":\"Owner\",\"GRP_MBR_ROLE_ADMIN\":\"Admin\",\"GRP_MBR_ROLE_MEMBER\":\"Member\",\"GRP_TIP_MBR_JOIN\":1,\"GRP_TIP_MBR_QUIT\":2,\"GRP_TIP_MBR_KICKED_OUT\":3,\"GRP_TIP_MBR_SET_ADMIN\":4,\"GRP_TIP_MBR_CANCELED_ADMIN\":5,\"GRP_TIP_GRP_PROFILE_UPDATED\":6,\"GRP_TIP_MBR_PROFILE_UPDATED\":7,\"MSG_REMIND_ACPT_AND_NOTE\":\"AcceptAndNotify\",\"MSG_REMIND_ACPT_NOT_NOTE\":\"AcceptNotNotify\",\"MSG_REMIND_DISCARD\":\"Discard\",\"GENDER_UNKNOWN\":\"Gender_Type_Unknown\",\"GENDER_FEMALE\":\"Gender_Type_Female\",\"GENDER_MALE\":\"Gender_Type_Male\",\"KICKED_OUT_MULT_ACCOUNT\":\"mutipleAccount\",\"KICKED_OUT_MULT_DEVICE\":\"mutipleDevice\",\"KICKED_OUT_USERSIG_EXPIRED\":\"userSigExpired\",\"ALLOW_TYPE_ALLOW_ANY\":\"AllowType_Type_AllowAny\",\"ALLOW_TYPE_NEED_CONFIRM\":\"AllowType_Type_NeedConfirm\",\"ALLOW_TYPE_DENY_ANY\":\"AllowType_Type_DenyAny\",\"FORBID_TYPE_NONE\":\"AdminForbid_Type_None\",\"FORBID_TYPE_SEND_OUT\":\"AdminForbid_Type_SendOut\",\"JOIN_OPTIONS_FREE_ACCESS\":\"FreeAccess\",\"JOIN_OPTIONS_NEED_PERMISSION\":\"NeedPermission\",\"JOIN_OPTIONS_DISABLE_APPLY\":\"DisableApply\",\"JOIN_STATUS_SUCCESS\":\"JoinedSuccess\",\"JOIN_STATUS_ALREADY_IN_GROUP\":\"AlreadyInGroup\",\"JOIN_STATUS_WAIT_APPROVAL\":\"WaitAdminApproval\",\"GRP_PROFILE_OWNER_ID\":\"ownerID\",\"GRP_PROFILE_CREATE_TIME\":\"createTime\",\"GRP_PROFILE_LAST_INFO_TIME\":\"lastInfoTime\",\"GRP_PROFILE_MEMBER_NUM\":\"memberNum\",\"GRP_PROFILE_MAX_MEMBER_NUM\":\"maxMemberNum\",\"GRP_PROFILE_JOIN_OPTION\":\"joinOption\",\"GRP_PROFILE_INTRODUCTION\":\"introduction\",\"GRP_PROFILE_NOTIFICATION\":\"notification\"};function r(e){return(r=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,\"value\"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function s(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{\"value\":n,\"enumerable\":!0,\"configurable\":!0,\"writable\":!0}):e[t]=n,e}function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(n,!0).forEach(function(e){a(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function l(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=Object.create(t&&t.prototype,{\"constructor\":{\"value\":e,\"writable\":!0,\"configurable\":!0}}),t&&h(e,t)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t,n){return(f=function(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var o=[null];o.push.apply(o,t);var r=new(Function.bind.apply(e,o));return n&&h(r,n.prototype),r}).apply(null,arguments)}function g(e){var n=\"function\"==typeof Map?new Map:void 0;return(g=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf(\"[native code]\")))return e;var t;if(\"function\"!=typeof e)throw new TypeError(\"Super expression must either be null or a function\");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,r)}function r(){return f(e,arguments,p(this).constructor)}return r.prototype=Object.create(e.prototype,{\"constructor\":{\"value\":r,\"enumerable\":!1,\"writable\":!0,\"configurable\":!0}}),h(r,e)})(e)}function _(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}function d(e,t){return!t||\"object\"!=typeof t&&\"function\"!=typeof t?_(e):t}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==a.return||a.return()}finally{if(r)throw i}}return n}(e,t)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}()}function E(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance\")}()}var C=function(){function e(){o(this,e),this.cache=[],this.options=null}return s(e,[{\"key\":\"use\",\"value\":function(e){if(\"function\"!=typeof e)throw\"middleware must be a function\";return this.cache.push(e),this}},{\"key\":\"next\",\"value\":function(e){if(this.middlewares&&this.middlewares.length>0)return this.middlewares.shift().call(this,this.options,this.next.bind(this))}},{\"key\":\"run\",\"value\":function(e){return this.middlewares=this.cache.map(function(e){return e}),this.options=e,this.next()}}]),e}(),T=\"undefined\"!=typeof globalThis?globalThis:\"undefined\"!=typeof window?window:\"undefined\"!=typeof Ci?Ci:\"undefined\"!=typeof self?self:{};function I(e,t){return e(t={\"exports\":{}},t.exports),t.exports}var M,O,D,N=I(function(e,t){var r,i,n,s,a,u,c,l,o,p,h,_,d,f,g,m,y,E,v,I;e.exports=(r=\"function\"==typeof Promise,i=\"object\"==typeof self?self:T,n=\"undefined\"!=typeof Symbol,s=\"undefined\"!=typeof Map,a=\"undefined\"!=typeof Set,u=\"undefined\"!=typeof WeakMap,c=\"undefined\"!=typeof WeakSet,l=\"undefined\"!=typeof DataView,o=n&&void 0!==Symbol.iterator,p=n&&void 0!==Symbol.toStringTag,h=a&&\"function\"==typeof Set.prototype.entries,_=s&&\"function\"==typeof Map.prototype.entries,d=h&&Object.getPrototypeOf((new Set).entries()),f=_&&Object.getPrototypeOf((new Map).entries()),g=o&&\"function\"==typeof Array.prototype[Symbol.iterator],m=g&&Object.getPrototypeOf([][Symbol.iterator]()),y=o&&\"function\"==typeof String.prototype[Symbol.iterator],E=y&&Object.getPrototypeOf(\"\"[Symbol.iterator]()),v=8,I=-1,function(e){var t=typeof e;if(\"object\"!==t)return t;if(null===e)return\"null\";if(e===i)return\"global\";if(Array.isArray(e)&&(!1===p||!(Symbol.toStringTag in e)))return\"Array\";if(\"object\"==typeof window&&null!==window){if(\"object\"==typeof window.location&&e===window.location)return\"Location\";if(\"object\"==typeof window.document&&e===window.document)return\"Document\";if(\"object\"==typeof window.navigator){if(\"object\"==typeof window.navigator.mimeTypes&&e===window.navigator.mimeTypes)return\"MimeTypeArray\";if(\"object\"==typeof window.navigator.plugins&&e===window.navigator.plugins)return\"PluginArray\"}if((\"function\"==typeof window.HTMLElement||\"object\"==typeof window.HTMLElement)&&e instanceof window.HTMLElement){if(\"BLOCKQUOTE\"===e.tagName)return\"HTMLQuoteElement\";if(\"TD\"===e.tagName)return\"HTMLTableDataCellElement\";if(\"TH\"===e.tagName)return\"HTMLTableHeaderCellElement\"}}var n=p&&e[Symbol.toStringTag];if(\"string\"==typeof n)return n;var o=Object.getPrototypeOf(e);return o===RegExp.prototype?\"RegExp\":o===Date.prototype?\"Date\":r&&o===Promise.prototype?\"Promise\":a&&o===Set.prototype?\"Set\":s&&o===Map.prototype?\"Map\":c&&o===WeakSet.prototype?\"WeakSet\":u&&o===WeakMap.prototype?\"WeakMap\":l&&o===DataView.prototype?\"DataView\":s&&o===f?\"Map Iterator\":a&&o===d?\"Set Iterator\":g&&o===m?\"Array Iterator\":y&&o===E?\"String Iterator\":null===o?\"Object\":Object.prototype.toString.call(e).slice(v,I)})}),A=\"undefined\"!=typeof window,L=\"undefined\"!=typeof wx&&\"function\"==typeof wx.getSystemInfoSync&&\"function\"==typeof wx.canIUse,R=A&&window.navigator&&window.navigator.userAgent||\"\",G=/AppleWebKit\\/([\\d.]+)/i.exec(R),P=(G&&parseFloat(G.pop()),/iPad/i.test(R)),k=(/iPhone/i.test(R),/iPod/i.test(R),(M=R.match(/OS (\\d+)_/i))&&M[1]&&M[1],/Android/i.test(R)),w=function(){var e=R.match(/Android (\\d+)(?:\\.(\\d+))?(?:\\.(\\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(e[1]+\".\"+e[2]):t||null}(),b,U=!(k&&/webkit/i.test(R),/Firefox/i.test(R),/Edge/i.test(R))&&/Chrome/i.test(R),x=(function(){var e=R.match(/Chrome\\/(\\d+)/);e&&e[1]&&parseFloat(e[1])}(),/MSIE/.test(R)),F=(/MSIE\\s8\\.0/.test(R),function(){var e=/MSIE\\s(\\d+)\\.\\d/.exec(R),t=e&&parseFloat(e[1]);return!t&&/Trident\\/7.0/i.test(R)&&/rv:11.0/.test(R)&&(t=11),t}()),q=(/Safari/i.test(R),/TBS\\/\\d+/i.test(R)),V=(function(){var e=R.match(/TBS\\/(\\d+)/i);if(e&&e[1])e[1]}(),!q&&/MQQBrowser\\/\\d+/i.test(R),!q&&/ QQBrowser\\/\\d+/i.test(R),/(micromessenger|webbrowser)/i.test(R)),K=(/Windows/i.test(R),/MAC OS X/i.test(R),/MicroMessenger/i.test(R),\"undefined\"!=typeof Ci?Ci:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{});O=\"undefined\"!=typeof console?console:void 0!==K&&K.console?K.console:\"undefined\"!=typeof window&&window.console?window.console:{};for(var H=function(){},B=[\"assert\",\"clear\",\"count\",\"debug\",\"dir\",\"dirxml\",\"error\",\"exception\",\"group\",\"groupCollapsed\",\"groupEnd\",\"info\",\"log\",\"markTimeline\",\"profile\",\"profileEnd\",\"table\",\"time\",\"timeEnd\",\"timeStamp\",\"trace\",\"warn\"],Y=B.length;Y--;)D=B[Y],console[D]||(O[D]=H);O.methods=B;var j=O,$=0,z=function(){if(L){var e=wx.getSystemInfoSync().SDKVersion;if(void 0===e||void 0===wx.getLogManager)return!1;if(function(e,t){e=e.split(\".\"),t=t.split(\".\");var n=Math.max(e.length,t.length);for(;e.length<n;)e.push(\"0\");for(;t.length<n;)t.push(\"0\");for(var o=0;o<n;o++){var r=parseInt(e[o]),i=parseInt(t[o]);if(r>i)return 1;if(r<i)return-1}return 0}(e,\"2.1.0\")>=0)return wx.getLogManager().log(\"I can use wx log. SDKVersion=\"+e),!0}return!1}(),X=new Map;function W(){var e=new Date;return\"TIM \"+e.toLocaleTimeString(\"en-US\",{\"hour12\":!1})+\".\"+function(e){var t;switch(e.toString().length){case 1:t=\"00\"+e;break;case 2:t=\"0\"+e;break;default:t=e}return t}(e.getMilliseconds())+\":\"}var J={\"_data\":[],\"_length\":0,\"_visible\":!1,\"arguments2String\":function(e){var t;if(1===e.length)t=W()+e[0];else{t=W();for(var n=0,o=e.length;n<o;n++)ae(e[n])?ce(e[n])?t+=fe(e[n]):t+=JSON.stringify(e[n]):t+=e[n],t+=\" \"}return t},\"debug\":function(){if($<=-1){var e=this.arguments2String(arguments);J.record(e,\"debug\"),j.debug(e),z&&wx.getLogManager().debug(e)}},\"log\":function(){if($<=0){var e=this.arguments2String(arguments);J.record(e,\"log\"),j.log(e),z&&wx.getLogManager().log(e)}},\"info\":function(){if($<=1){var e=this.arguments2String(arguments);J.record(e,\"info\"),j.info(e),z&&wx.getLogManager().info(e)}},\"warn\":function(){if($<=2){var e=this.arguments2String(arguments);J.record(e,\"warn\"),j.warn(e),z&&wx.getLogManager().warn(e)}},\"error\":function(){if($<=3){var e=this.arguments2String(arguments);J.record(e,\"error\"),j.error(e),z&&wx.getLogManager().warn(e)}},\"time\":function(e){X.set(e,_e.now())},\"timeEnd\":function(e){if(X.has(e)){var t=_e.now()-X.get(e);return X.delete(e),t}return j.warn(\"未找到对应label: \".concat(e,\", 请在调用 logger.timeEnd 前，调用 logger.time\")),0},\"setLevel\":function(e){e<4&&j.log(W()+\"set level from \"+$+\" to \"+e),$=e},\"record\":function(e,t){z||(1100===J._length&&(J._data.splice(0,100),J._length=1e3),J._length++,J._data.push(\"\".concat(e,\" [\").concat(t,\"] \\n\")))},\"getLog\":function(){return J._data}},Q=function(e){return\"map\"===le(e)},Z=function(e){return\"set\"===le(e)},ee=function(e){return\"file\"===le(e)},te=function(e){return null!==e&&(\"number\"==typeof e&&!isNaN(e-0)||\"object\"===r(e)&&e.constructor===Number)},ne=function(e){return\"string\"==typeof e},oe=function(e){return null!==e&&\"object\"===r(e)},re=function(e){if(\"object\"!==r(e)||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var n=t;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n},ie=function(e){return\"function\"==typeof Array.isArray?Array.isArray(e):\"array\"===le(e)},se=function(e){return void 0===e},ae=function(e){return ie(e)||oe(e)},ue=function(e){return\"function\"==typeof e},ce=function(e){return e instanceof Error},le=function(e){return Object.prototype.toString.call(e).match(/^\\[object (.*)\\]$/)[1].toLowerCase()},pe=function(e){if(\"string\"!=typeof e)return!1;var t=e[0];return!/[^a-zA-Z0-9]/.test(t)},he=0;Date.now||(Date.now=function(){return(new Date).getTime()});var _e={\"now\":function(){0===he&&(he=Date.now()-1);var e=Date.now()-he;return e>4294967295?(he+=4294967295,Date.now()-he):e},\"utc\":function(){return Math.round(Date.now()/1e3)}},de=function e(t,n,o,r){if(!ae(t)||!ae(n))return 0;for(var i,s=0,a=Object.keys(n),u=0,c=a.length;u<c;u++)if(i=a[u],!(se(n[i])||o&&o.includes(i)))if(ae(t[i])&&ae(n[i]))s+=e(t[i],n[i],o,r);else{if(r&&r.includes(n[i]))continue;t[i]!==n[i]&&(t[i]=n[i],s+=1)}return s},fe=function(e){return JSON.stringify(e,[\"message\",\"code\"])},ge=function(){var e=new Date,t=e.toISOString(),n=e.getTimezoneOffset()/60,o=\"\";return o=n<0?n>-10?\"+0\"+Math.abs(100*n):\"+\"+Math.abs(100*n):n>=10?\"-\"+100*n:\"-0\"+100*n,t.replace(\"Z\",o)},me=function(e){if(0===e.length)return 0;for(var t=0,n=0,o=\"undefined\"!=typeof document&&void 0!==document.characterSet?document.characterSet:\"UTF-8\";void 0!==e[t];)n+=e[t++].charCodeAt[t]<=255?1:!1===o?3:2;return n},ye=function(e){var t=e||99999999;return Math.round(Math.random()*t)},Ee=\"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\",ve=Ee.length,Ie=function(e,t){for(var n in e)if(e[n]===t)return!0;return!1},Ce={},Te=function(){if(L)return\"https:\";var e=window.location.protocol;return[\"http:\",\"https:\"].indexOf(e)<0&&(e=\"http:\"),e},Me=function(e){return-1===e.indexOf(\"http://\")||-1===e.indexOf(\"https://\")?\"https://\"+e:e.replace(/https|http/,\"https\")};function Se(r,e){ie(r)&&ie(e)?e.forEach(function(e){var t=e.key,n=e.value,o=r.find(function(e){return e.key===t});o?o.value=n:r.push({\"key\":t,\"value\":n})}):J.warn(\"updateCustomField target 或 source 不是数组，忽略此次更新。\")}var De=function(e){return e===S.GRP_PUBLIC},Re=function(e){return e===S.GRP_AVCHATROOM},Ge=function(e){return ne(e)&&e===S.CONV_SYSTEM};function Oe(t,n){var o={};return Object.keys(t).forEach(function(e){o[e]=n(t[e],e)}),o}var Pe=Object.prototype.hasOwnProperty;function Ne(e){if(null==e)return!0;if(\"boolean\"==typeof e)return!1;if(\"number\"==typeof e)return 0===e;if(\"string\"==typeof e)return 0===e.length;if(\"function\"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return\"\"===e.message;if(re(e)){for(var t in e)if(Pe.call(e,t))return!1;return!0}return!!(Q(e)||Z(e)||ee(e))&&0===e.size}function Ae(n,o,r){if(void 0===o)return!0;var i=!0;if(\"object\"===N(o).toLowerCase())Object.keys(o).forEach(function(e){var t=1===n.length?n[0][e]:void 0;i=!!Le(t,o[e],r,e)&&i});else if(\"array\"===N(o).toLowerCase())for(var e=0;e<o.length;e++)i=!!Le(n[e],o[e],r,o[e].name)&&i;if(i)return i;throw new Error(\"Params validate failed.\")}function Le(e,t,n,o){if(void 0===t)return!0;var r=!0;return t.required&&Ne(e)&&(j.error(\"TIM [\".concat(n,'] Missing required params: \"').concat(o,'\".')),r=!1),Ne(e)||N(e).toLowerCase()===t.type.toLowerCase()||(j.error(\"TIM [\".concat(n,'] Invalid params: type check failed for \"').concat(o,'\".Expected ').concat(t.type,\".\")),r=!1),t.validator&&!t.validator(e)&&(j.error(\"TIM [\".concat(n,\"] Invalid params: custom validator check failed for params.\")),r=!1),r}var ke={\"SUCCESS\":\"JoinedSuccess\",\"WAIT_APPROVAL\":\"WaitAdminApproval\"},we={\"COMMON\":{\"SUCCESS\":\"OK\",\"FAIL\":\"FAIL\"},\"REQUEST\":{\"SUCCESS\":0},\"ACCESS_LAYER\":{\"PRODUCTION\":0,\"TEST\":1},\"LOGIN\":{\"IS_LOGIN\":1,\"IS_NOT_LOGIN\":0},\"SYNC_MESSAGE\":{\"SYNCHRONIZATION_START\":0,\"SYNCHRONIZING\":1,\"SYNCHRONIZED\":2},\"MESSAGE_STATUS\":{\"UNSEND\":\"unSend\",\"SUCCESS\":\"success\",\"FAIL\":\"fail\"},\"GET_HISTORY_MESSAGE_STATUS\":{\"C2C_IS_FINISHED\":1,\"C2C_IS_NOT_FINISHED\":0,\"GROUP_IS_FINISHED\":1,\"GROUP_IS_NOT_FINISHED\":0},\"ACCOUNT_STATUS\":{\"SIGN_IN\":!0,\"SIGN_OUT\":!1},\"CHANNEL_STATUS\":{\"ONLINE\":!0,\"OFFLINE\":!1},\"JOIN_GROUP_STATUS\":ke,\"UPLOAD\":{\"FINISHED\":1,\"UPLOADING\":0},\"PAGING_CONVERSATION\":{\"NOT_START\":\"notStart\",\"PENDING\":\"pengding\",\"RESOLVED\":\"resolved\",\"REJECTED\":\"rejected\"}},be=function(){function e(t){o(this,e),this.type=S.MSG_TEXT,this.content={\"text\":t.text||\"\"}}return s(e,[{\"key\":\"setText\",\"value\":function(e){this.content.text=e}},{\"key\":\"sendable\",\"value\":function(){return 0!==this.content.text.length}}]),e}(),Ue={\"JSON\":{\"TYPE\":{\"C2C\":{\"NOTICE\":1,\"COMMON\":9,\"EVENT\":10},\"GROUP\":{\"COMMON\":3,\"TIP\":4,\"SYSTEM\":5,\"TIP2\":6},\"FRIEND\":{\"NOTICE\":7},\"PROFILE\":{\"NOTICE\":8}},\"SUBTYPE\":{\"C2C\":{\"COMMON\":0,\"READED\":92,\"KICKEDOUT\":96},\"GROUP\":{\"COMMON\":0,\"LOVEMESSAGE\":1,\"TIP\":2,\"REDPACKET\":3}},\"OPTIONS\":{\"GROUP\":{\"JOIN\":1,\"QUIT\":2,\"KICK\":3,\"SET_ADMIN\":4,\"CANCEL_ADMIN\":5,\"MODIFY_GROUP_INFO\":6,\"MODIFY_MEMBER_INFO\":7}}},\"PROTOBUF\":{},\"IMAGE_TYPES\":{\"ORIGIN\":1,\"LARGE\":2,\"SMALL\":3},\"IMAGE_FORMAT\":{\"JPG\":1,\"JPEG\":1,\"GIF\":2,\"PNG\":3,\"BMP\":4,\"UNKNOWN\":255}},xe=1,Fe=2,qe=3,Ve=4,Ke=5,He=7,Be=8,Ye=9,je=10,$e=15,We=255,ze=2,Xe=0,Je=1,Qe={\"NICK\":\"Tag_Profile_IM_Nick\",\"GENDER\":\"Tag_Profile_IM_Gender\",\"BIRTHDAY\":\"Tag_Profile_IM_BirthDay\",\"LOCATION\":\"Tag_Profile_IM_Location\",\"SELFSIGNATURE\":\"Tag_Profile_IM_SelfSignature\",\"ALLOWTYPE\":\"Tag_Profile_IM_AllowType\",\"LANGUAGE\":\"Tag_Profile_IM_Language\",\"AVATAR\":\"Tag_Profile_IM_Image\",\"MESSAGESETTINGS\":\"Tag_Profile_IM_MsgSettings\",\"ADMINFORBIDTYPE\":\"Tag_Profile_IM_AdminForbidType\",\"LEVEL\":\"Tag_Profile_IM_Level\",\"ROLE\":\"Tag_Profile_IM_Role\"},Ze={\"UNKNOWN\":\"Gender_Type_Unknown\",\"FEMALE\":\"Gender_Type_Female\",\"MALE\":\"Gender_Type_Male\"},et={\"NONE\":\"AdminForbid_Type_None\",\"SEND_OUT\":\"AdminForbid_Type_SendOut\"},tt={\"NEED_CONFIRM\":\"AllowType_Type_NeedConfirm\",\"ALLOW_ANY\":\"AllowType_Type_AllowAny\",\"DENY_ANY\":\"AllowType_Type_DenyAny\"},nt=function(){function e(t){o(this,e),this._imageMemoryURL=\"\",this._file=t.file,L?this.createImageDataASURLInWXMiniApp(t.file):this.createImageDataASURLInWeb(t.file),this._initImageInfoModel(),this.type=S.MSG_IMAGE,this._percent=0,this.content={\"imageFormat\":Ue.IMAGE_FORMAT[t.imageFormat]||Ue.IMAGE_FORMAT.UNKNOWN,\"uuid\":t.uuid,\"imageInfoArray\":[]},this.initImageInfoArray(t.imageInfoArray),this._defaultImage=\"http://imgcache.qq.com/open/qcloud/video/act/webim-images/default.jpg\",this._autoFixUrl()}return s(e,[{\"key\":\"_initImageInfoModel\",\"value\":function(){var t=this;this._ImageInfoModel=function(e){this.instanceID=ye(9999999),this.sizeType=e.type||0,this.size=e.size||0,this.width=e.width||0,this.height=e.height||0,this.imageUrl=e.url||\"\",this.url=e.url||t._imageMemoryURL||t._defaultImage},this._ImageInfoModel.prototype={\"setSizeType\":function(e){this.sizeType=e},\"setImageUrl\":function(e){e&&(this.imageUrl=e)},\"getImageUrl\":function(){return this.imageUrl}}}},{\"key\":\"initImageInfoArray\",\"value\":function(e){for(var t=2,n=null,o=null;t>=0;)o=void 0===e||void 0===e[t]?{\"type\":0,\"size\":0,\"width\":0,\"height\":0,\"url\":\"\"}:e[t],(n=new this._ImageInfoModel(o)).setSizeType(t+1),this.addImageInfo(n),t--}},{\"key\":\"updateImageInfoArray\",\"value\":function(e){for(var t,n=this.content.imageInfoArray.length,o=0;o<n;o++)t=this.content.imageInfoArray[o],e.size&&(t.size=e.size),e.url&&t.setImageUrl(e.url),e.width&&(t.width=e.width),e.height&&(t.height=e.height)}},{\"key\":\"_autoFixUrl\",\"value\":function(){for(var e=this.content.imageInfoArray.length,t=\"\",n=\"\",o=[\"http\",\"https\"],r=null,i=0;i<e;i++)this.content.imageInfoArray[i].url&&\"\"!==(r=this.content.imageInfoArray[i]).imageUrl&&(n=r.imageUrl.slice(0,r.imageUrl.indexOf(\"://\")+1),t=r.imageUrl.slice(r.imageUrl.indexOf(\"://\")+1),o.indexOf(n)<0&&(n=\"https:\"),this.content.imageInfoArray[i].setImageUrl([n,t].join(\"\")))}},{\"key\":\"updatePercent\",\"value\":function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{\"key\":\"updateImageFormat\",\"value\":function(e){this.content.imageFormat=e}},{\"key\":\"createImageDataASURLInWeb\",\"value\":function(e){void 0!==e&&e.files.length>0&&(this._imageMemoryURL=window.URL.createObjectURL(e.files[0]))}},{\"key\":\"createImageDataASURLInWXMiniApp\",\"value\":function(e){e&&e.url&&(this._imageMemoryURL=e.url)}},{\"key\":\"replaceImageInfo\",\"value\":function(e,t){this.content.imageInfoArray[t]instanceof this._ImageInfoModel||(this.content.imageInfoArray[t]=e)}},{\"key\":\"addImageInfo\",\"value\":function(e){this.content.imageInfoArray.length>=3||this.content.imageInfoArray.push(e)}},{\"key\":\"sendable\",\"value\":function(){return 0!==this.content.imageInfoArray.length&&(\"\"!==this.content.imageInfoArray[0].imageUrl&&0!==this.content.imageInfoArray[0].size)}}]),e}(),ot=function(){function e(t){o(this,e),this.type=S.MSG_FACE,this.content=t||null}return s(e,[{\"key\":\"sendable\",\"value\":function(){return null!==this.content}}]),e}(),rt=function(){function e(t){o(this,e),this.type=S.MSG_AUDIO,this._percent=0,this.content={\"downloadFlag\":2,\"second\":t.second,\"size\":t.size,\"url\":t.url,\"remoteAudioUrl\":\"\",\"uuid\":t.uuid}}return s(e,[{\"key\":\"updatePercent\",\"value\":function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{\"key\":\"updateAudioUrl\",\"value\":function(e){this.content.remoteAudioUrl=e}},{\"key\":\"sendable\",\"value\":function(){return\"\"!==this.content.remoteAudioUrl}}]),e}(),it={\"from\":!0,\"groupID\":!0,\"groupName\":!0,\"to\":!0},st=function(){function e(t){o(this,e),this.type=S.MSG_GRP_TIP,this.content={},this._initContent(t)}return s(e,[{\"key\":\"_initContent\",\"value\":function(t){var n=this;Object.keys(t).forEach(function(e){switch(e){case\"remarkInfo\":break;case\"groupProfile\":n.content.groupProfile={},n._initGroupProfile(t[e]);break;case\"operatorInfo\":case\"memberInfoList\":break;case\"msgMemberInfo\":n.content.memberList=t[e],Object.defineProperty(n.content,\"msgMemberInfo\",{\"get\":function(){return J.warn(\"!!! 禁言的群提示消息中的 payload.msgMemberInfo 属性即将废弃，请使用 payload.memberList 属性替代。 \\n\",\"msgMemberInfo 中的 shutupTime 属性对应更改为 memberList 中的 muteTime 属性，表示禁言时长。 \\n\",\"参考：群提示消息 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/Message.html#.GroupTipPayload\"),n.content.memberList.map(function(e){return{\"userID\":e.userID,\"shutupTime\":e.muteTime}})}});break;default:n.content[e]=t[e]}}),this.content.userIDList||(this.content.userIDList=[this.content.operatorID])}},{\"key\":\"_initGroupProfile\",\"value\":function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];it[o]&&(this.content.groupProfile[o]=e[o])}}}]),e}(),at={\"from\":!0,\"groupID\":!0,\"name\":!0,\"to\":!0},ut=function(){function e(t){o(this,e),this.type=S.MSG_GRP_SYS_NOTICE,this.content={},this._initContent(t)}return s(e,[{\"key\":\"_initContent\",\"value\":function(t){var n=this;Object.keys(t).forEach(function(e){switch(e){case\"memberInfoList\":break;case\"remarkInfo\":n.content.handleMessage=t[e];break;case\"groupProfile\":n.content.groupProfile={},n._initGroupProfile(t[e]);break;default:n.content[e]=t[e]}})}},{\"key\":\"_initGroupProfile\",\"value\":function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];at[o]&&(this.content.groupProfile[o]=e[o])}}}]),e}(),ct={\"70001\":\"UserSig 已过期，请重新生成。建议 UserSig 有效期设置不小于24小时。\",\"70002\":\"UserSig 长度为0，请检查传入的 UserSig 是否正确。\",\"70003\":\"UserSig 非法，请使用官网提供的 API 重新生成 UserSig(https://cloud.tencent.com/document/product/269/32688)。\",\"70005\":\"UserSig 非法，请使用官网提供的 API 重新生成 UserSig(https://cloud.tencent.com/document/product/269/32688)。\",\"70009\":\"UserSig 验证失败，可能因为生成 UserSig 时混用了其他 SDKAppID 的私钥或密钥导致，请使用对应 SDKAppID 下的私钥或密钥重新生成 UserSig(https://cloud.tencent.com/document/product/269/32688)。\",\"70013\":\"请求中的 UserID 与生成 UserSig 时使用的 UserID 不匹配，您可以在即时通信 IM 控制台的【开发辅助工具(https://console.cloud.tencent.com/im-detail/tool-usersig)】页面校验 UserSig。\",\"70014\":\"请求中的 SDKAppID 与生成 UserSig 时使用的 SDKAppID 不匹配，您可以在即时通信 IM 控制台的【开发辅助工具(https://console.cloud.tencent.com/im-detail/tool-usersig)】页面校验 UserSig。\",\"70016\":\"密钥不存在，UserSig 验证失败，请在即时通信 IM 控制台获取密钥(https://cloud.tencent.com/document/product/269/32578#.E8.8E.B7.E5.8F.96.E5.AF.86.E9.92.A5)。\",\"70020\":\"SDKAppID 未找到，请在即时通信 IM 控制台确认应用信息。\",\"70050\":\"UserSig 验证次数过于频繁。请检查 UserSig 是否正确，并于1分钟后重新验证。您可以在即时通信 IM 控制台的【开发辅助工具(https://console.cloud.tencent.com/im-detail/tool-usersig)】页面校验 UserSig。\",\"70051\":\"帐号被拉入黑名单。\",\"70052\":\"UserSig 已经失效，请重新生成，再次尝试。\",\"70107\":\"因安全原因被限制登录，请不要频繁登录。\",\"70169\":\"请求的用户帐号不存在。\",\"70114\":\"服务端内部超时，请稍后重试。\",\"70202\":\"服务端内部超时，请稍后重试。\",\"70206\":\"请求中批量数量不合法。\",\"70402\":\"参数非法，请检查必填字段是否填充，或者字段的填充是否满足协议要求。\",\"70403\":\"请求失败，需要 App 管理员权限。\",\"70398\":\"帐号数超限。如需创建多于100个帐号，请将应用升级为专业版，具体操作指引请参见购买指引(https://cloud.tencent.com/document/product/269/32458)。\",\"70500\":\"服务端内部错误，请稍后重试。\",\"71000\":\"删除帐号失败。仅支持删除体验版帐号，您当前应用为专业版，暂不支持帐号删除。\",\"20001\":\"请求包非法。\",\"20002\":\"UserSig 或 A2 失效。\",\"20003\":\"消息发送方或接收方 UserID 无效或不存在，请检查 UserID 是否已导入即时通信 IM。\",\"20004\":\"网络异常，请重试。\",\"20005\":\"服务端内部错误，请重试。\",\"20006\":\"触发发送单聊消息之前回调，App 后台返回禁止下发该消息。\",\"20007\":\"发送单聊消息，被对方拉黑，禁止发送。消息发送状态默认展示为失败，您可以登录控制台修改该场景下的消息发送状态展示结果，具体操作请参见消息保留设置(https://cloud.tencent.com/document/product/269/38656)。\",\"20009\":\"消息发送双方互相不是好友，禁止发送（配置单聊消息校验好友关系才会出现）。\",\"20010\":\"发送单聊消息，自己不是对方的好友（单向关系），禁止发送。\",\"20011\":\"发送单聊消息，对方不是自己的好友（单向关系），禁止发送。\",\"20012\":\"发送方被禁言，该条消息被禁止发送。\",\"20016\":\"消息撤回超过了时间限制（默认2分钟）。\",\"20018\":\"删除漫游内部错误。\",\"90001\":\"JSON 格式解析失败，请检查请求包是否符合 JSON 规范。\",\"90002\":\"JSON 格式请求包中 MsgBody 不符合消息格式描述，或者 MsgBody 不是 Array 类型，请参考 TIMMsgElement 对象的定义(https://cloud.tencent.com/document/product/269/2720#.E6.B6.88.E6.81.AF.E5.85.83.E7.B4.A0-timmsgelement)。\",\"90003\":\"JSON 格式请求包体中缺少 To_Account 字段或者 To_Account 帐号不存在。\",\"90005\":\"JSON 格式请求包体中缺少 MsgRandom 字段或者 MsgRandom 字段不是 Integer 类型。\",\"90006\":\"JSON 格式请求包体中缺少 MsgTimeStamp 字段或者 MsgTimeStamp 字段不是 Integer 类型。\",\"90007\":\"JSON 格式请求包体中 MsgBody 类型不是 Array 类型，请将其修改为 Array 类型。\",\"90008\":\"JSON 格式请求包体中缺少 From_Account 字段或者 From_Account 帐号不存在。\",\"90009\":\"请求需要 App 管理员权限。\",\"90010\":\"JSON 格式请求包不符合消息格式描述，请参考 TIMMsgElement 对象的定义(https://cloud.tencent.com/document/product/269/2720#.E6.B6.88.E6.81.AF.E5.85.83.E7.B4.A0-timmsgelement)。\",\"90011\":\"批量发消息目标帐号超过500，请减少 To_Account 中目标帐号数量。\",\"90012\":\"To_Account 没有注册或不存在，请确认 To_Account 是否导入即时通信 IM 或者是否拼写错误。\",\"90026\":\"消息离线存储时间错误（最多不能超过7天）。\",\"90031\":\"JSON 格式请求包体中 SyncOtherMachine 字段不是 Integer 类型。\",\"90044\":\"JSON 格式请求包体中 MsgLifeTime 字段不是 Integer 类型。\",\"90048\":\"请求的用户帐号不存在。\",\"90054\":\"撤回请求中的 MsgKey 不合法。\",\"90994\":\"服务内部错误，请重试。\",\"90995\":\"服务内部错误，请重试。\",\"91000\":\"服务内部错误，请重试。\",\"90992\":\"服务内部错误，请重试；如果所有请求都返回该错误码，且 App 配置了第三方回调，请检查 App 服务端是否正常向即时通信 IM 后台服务端返回回调结果。\",\"93000\":\"JSON 数据包超长，消息包体请不要超过8k。\",\"91101\":\"Web 端长轮询被踢（Web 端同时在线实例个数超出限制）。\",\"10002\":\"服务端内部错误，请重试。\",\"10003\":\"请求中的接口名称错误，请核对接口名称并重试。\",\"10004\":\"参数非法，请根据错误描述检查请求是否正确。\",\"10005\":\"请求包体中携带的帐号数量过多。\",\"10006\":\"操作频率限制，请尝试降低调用的频率。\",\"10007\":\"操作权限不足，例如 Public 群组中普通成员尝试执行踢人操作，但只有 App 管理员才有权限。\",\"10008\":\"请求非法，可能是请求中携带的签名信息验证不正确，请再次尝试。\",\"10009\":\"该群不允许群主主动退出。\",\"10010\":\"群组不存在，或者曾经存在过，但是目前已经被解散。\",\"10011\":\"解析 JSON 包体失败，请检查包体的格式是否符合 JSON 格式。\",\"10012\":\"发起操作的 UserID 非法，请检查发起操作的用户 UserID 是否填写正确。\",\"10013\":\"被邀请加入的用户已经是群成员。\",\"10014\":\"群已满员，无法将请求中的用户加入群组，如果是批量加人，可以尝试减少加入用户的数量。\",\"10015\":\"群组 ID 非法，请检查群组 ID 是否填写正确。\",\"10016\":\"App 后台通过第三方回调拒绝本次操作。\",\"10017\":\"因被禁言而不能发送消息，请检查发送者是否被设置禁言。\",\"10018\":\"应答包长度超过最大包长（1MB），请求的内容过多，请尝试减少单次请求的数据量。\",\"10019\":\"请求的用户帐号不存在。\",\"10021\":\"群组 ID 已被使用，请选择其他的群组 ID。\",\"10023\":\"发消息的频率超限，请延长两次发消息时间的间隔。\",\"10024\":\"此邀请或者申请请求已经被处理。\",\"10025\":\"群组 ID 已被使用，并且操作者为群主，可以直接使用。\",\"10026\":\"该 SDKAppID 请求的命令字已被禁用。\",\"10030\":\"请求撤回的消息不存在。\",\"10031\":\"消息撤回超过了时间限制（默认2分钟）。\",\"10032\":\"请求撤回的消息不支持撤回操作。\",\"10033\":\"群组类型不支持消息撤回操作。\",\"10034\":\"该消息类型不支持删除操作。\",\"10035\":\"音视频聊天室和在线成员广播大群不支持删除消息。\",\"10036\":\"音视频聊天室创建数量超过了限制，请参考价格说明(https://cloud.tencent.com/document/product/269/11673)购买预付费套餐“IM音视频聊天室”。\",\"10037\":\"单个用户可创建和加入的群组数量超过了限制，请参考价格说明(https://cloud.tencent.com/document/product/269/11673)购买或升级预付费套餐“单人可创建与加入群组数”。\",\"10038\":\"群成员数量超过限制，请参考价格说明(https://cloud.tencent.com/document/product/269/11673)购买或升级预付费套餐“扩展群人数上限”。\",\"10041\":\"该应用（SDKAppID）已配置不支持群消息撤回。\"},lt=function(e){function t(e){var n;return o(this,t),(n=d(this,p(t).call(this))).code=e.code,n.message=ct[e.code]||e.message,n.data=e.data||{},n}return l(t,g(Error)),t}(),pt={\"NO_SDKAPPID\":2e3,\"NO_ACCOUNT_TYPE\":2001,\"NO_IDENTIFIER\":2002,\"NO_USERSIG\":2003,\"NO_SDK_INSTANCE\":2004,\"REQ_GET_ACCESS_LAYER_FAILED\":2020,\"REQ_LOGIN_FAILED\":2021,\"NO_TINYID\":2022,\"NO_A2KEY\":2023,\"NOT_LOGGED_IN\":2024,\"COS_UNDETECTED\":2040,\"MESSAGE_SEND_FAIL\":2100,\"MESSAGE_UNKNOW_ROMA_LIST_END_FLAG_FIELD\":2101,\"MESSAGE_ELEMENT_METHOD_UNDEFINED\":2102,\"MESSAGE_LIST_CONSTRUCTOR_NEED_OPTIONS\":2103,\"MESSAGE_PARAMETER_MISSING_TO_ACCOUNT\":2104,\"MESSAGE_SEND_NEED_MESSAGE_INSTANCE\":2105,\"MESSAGE_SEND_INVALID_CONVERSATION_TYPE\":2106,\"MESSAGE_RESEND_FILE_UNSUPPORTED\":2107,\"MESSAGE_FILE_IS_EMPTY\":2108,\"MESSAGE_ONPROGRESS_FUNCTION_ERROR\":2109,\"MESSAGE_REVOKE_FAIL\":2110,\"MESSAGE_IMAGE_UPLOAD_FAIL\":2250,\"MESSAGE_IMAGE_SELECT_FILE_FIRST\":2251,\"MESSAGE_IMAGE_TYPES_LIMIT\":2252,\"MESSAGE_IMAGE_SIZE_LIMIT\":2253,\"MESSAGE_AUDIO_UPLOAD_FAIL\":2300,\"MESSAGE_AUDIO_SIZE_LIMIT\":2301,\"MESSAGE_VIDEO_UPLOAD_FAIL\":2350,\"MESSAGE_VIDEO_SIZE_LIMIT\":2351,\"MESSAGE_VIDEO_TYPES_LIMIT\":2352,\"MESSAGE_FILE_UPLOAD_FAIL\":2400,\"MESSAGE_FILE_SELECT_FILE_FIRST\":2401,\"MESSAGE_FILE_SIZE_LIMIT\":2402,\"MESSAGE_FILE_URL_IS_EMPTY\":2403,\"CONVERSATION_NOT_FOUND\":2500,\"USER_OR_GROUP_NOT_FOUND\":2501,\"CONVERSATION_UN_RECORDED_TYPE\":2502,\"ILLEGAL_GROUP_TYPE\":2600,\"CANNOT_JOIN_PRIVATE\":2601,\"CANNOT_CHANGE_OWNER_IN_AVCHATROOM\":2620,\"CANNOT_CHANGE_OWNER_TO_SELF\":2621,\"CANNOT_DISMISS_PRIVATE\":2622,\"JOIN_GROUP_FAIL\":2660,\"CANNOT_ADD_MEMBER_IN_AVCHATROOM\":2661,\"CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN\":2662,\"CANNOT_KICK_MEMBER_IN_AVCHATROOM\":2680,\"NOT_OWNER\":2681,\"CANNOT_SET_MEMBER_ROLE_IN_PRIVATE_AND_AVCHATROOM\":2682,\"INVALID_MEMBER_ROLE\":2683,\"CANNOT_SET_SELF_MEMBER_ROLE\":2684,\"CANNOT_MUTE_SELF\":2685,\"DEL_FRIEND_INVALID_PARAM\":2700,\"UPDATE_PROFILE_INVALID_PARAM\":2721,\"UPDATE_PROFILE_NO_KEY\":2722,\"ADD_BLACKLIST_INVALID_PARAM\":2740,\"DEL_BLACKLIST_INVALID_PARAM\":2741,\"CANNOT_ADD_SELF_TO_BLACKLIST\":2742,\"NETWORK_ERROR\":2800,\"NETWORK_TIMEOUT\":2801,\"NETWORK_BASE_OPTIONS_NO_URL\":2802,\"NETWORK_UNDEFINED_SERVER_NAME\":2803,\"NETWORK_PACKAGE_UNDEFINED\":2804,\"NO_NETWORK\":2805,\"SOCKET_NOT_SUPPORTED\":2850,\"CONVERTOR_IRREGULAR_PARAMS\":2900,\"NOTICE_RUNLOOP_UNEXPECTED_CONDITION\":2901,\"NOTICE_RUNLOOP_OFFSET_LOST\":2902,\"UNCAUGHT_ERROR\":2903,\"GET_LONGPOLL_ID_FAILED\":2904,\"SDK_IS_NOT_READY\":2999,\"SSO_LOG_MODEL_INIT_ERROR\":3e3,\"LONG_POLL_KICK_OUT\":91101,\"MESSAGE_A2KEY_EXPIRED\":20002,\"ACCOUNT_A2KEY_EXPIRED\":70001,\"LONG_POLL_API_PARAM_ERROR\":90001},ht={\"NO_SDKAPPID\":\"无 SDKAppID\",\"NO_ACCOUNT_TYPE\":\"无 accountType\",\"NO_IDENTIFIER\":\"无 userID\",\"NO_USERSIG\":\"无 usersig\",\"NO_SDK_INSTANCE\":\"无 SDK 实例\",\"REQ_GET_ACCESS_LAYER_FAILED\":\"获取沙箱请求失败\",\"REQ_LOGIN_FAILED\":\"登录请求失败\",\"NO_TINYID\":\"无tinyid\",\"NO_A2KEY\":\"无a2key\",\"NOT_LOGGED_IN\":\"未登录\",\"COS_UNDETECTED\":\"未检测到 COS 上传插件\",\"MESSAGE_SEND_FAIL\":\"消息发送失败\",\"MESSAGE_UNKNOW_ROMA_LIST_END_FLAG_FIELD\":\"未知的漫游消息结束字段\",\"MESSAGE_ELEMENT_METHOD_UNDEFINED\":\"消息元素未创建，因为方法未定义\",\"MESSAGE_LIST_CONSTRUCTOR_NEED_OPTIONS\":\"MessageController.constructor() 需要参数 options\",\"MESSAGE_PARAMETER_MISSING_TO_ACCOUNT\":\"需要 toAccount 参数\",\"MESSAGE_SEND_NEED_MESSAGE_INSTANCE\":\"需要 Message 的实例\",\"MESSAGE_SEND_INVALID_CONVERSATION_TYPE\":'Message.conversationType 只能为 \"C2C\"或\"GROUP\" ',\"MESSAGE_RESEND_FILE_UNSUPPORTED\":\"文件类消息不能使用 SDK.resendMessage() 函数重发\",\"MESSAGE_FILE_IS_EMPTY\":\"无法发送空文件\",\"MESSAGE_ONPROGRESS_FUNCTION_ERROR\":\"回调函数运行时遇到错误，请检查接入侧代码\",\"MESSAGE_REVOKE_FAIL\":\"消息撤回失败\",\"MESSAGE_IMAGE_UPLOAD_FAIL\":\"图片上传失败\",\"MESSAGE_IMAGE_SELECT_FILE_FIRST\":\"请先选择一个图片\",\"MESSAGE_IMAGE_TYPES_LIMIT\":\"只允许上传 jpg png jpeg gif 格式的图片\",\"MESSAGE_IMAGE_SIZE_LIMIT\":\"图片大小超过20M，无法发送\",\"MESSAGE_AUDIO_UPLOAD_FAIL\":\"语音上传失败\",\"MESSAGE_AUDIO_SIZE_LIMIT\":\"语音大小大于20M，无法发送\",\"MESSAGE_VIDEO_UPLOAD_FAIL\":\"视频上传失败\",\"MESSAGE_VIDEO_SIZE_LIMIT\":\"视频大小超过20M，无法发送\",\"MESSAGE_VIDEO_TYPES_LIMIT\":\"只允许上传 mp4 格式的视频\",\"MESSAGE_FILE_UPLOAD_FAIL\":\"文件上传失败\",\"MESSAGE_FILE_SELECT_FILE_FIRST\":\"请先选择一个文件\",\"MESSAGE_FILE_SIZE_LIMIT\":\"文件大小超过100M，无法发送 \",\"MESSAGE_FILE_URL_IS_EMPTY\":\"缺少必要的参数文件 URL\",\"CONVERSATION_NOT_FOUND\":\"没有找到相应的会话，请检查传入参数\",\"USER_OR_GROUP_NOT_FOUND\":\"没有找到相应的用户或群组，请检查传入参数\",\"CONVERSATION_UN_RECORDED_TYPE\":\"未记录的会话类型\",\"ILLEGAL_GROUP_TYPE\":\"非法的群类型，请检查传入参数\",\"CANNOT_JOIN_PRIVATE\":\"不能加入 Private 类型的群组\",\"CANNOT_CHANGE_OWNER_IN_AVCHATROOM\":\"AVChatRoom 类型的群组不能转让群主\",\"CANNOT_CHANGE_OWNER_TO_SELF\":\"不能把群主转让给自己\",\"CANNOT_DISMISS_PRIVATE\":\"不能解散 Private 类型的群组\",\"JOIN_GROUP_FAIL\":\"加群失败，请检查传入参数或重试\",\"CANNOT_ADD_MEMBER_IN_AVCHATROOM\":\"AVChatRoom 类型的群不支持邀请群成员\",\"CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN\":\"非 AVChatRoom 类型的群组不允许匿名加群，请先登录后再加群\",\"CANNOT_KICK_MEMBER_IN_AVCHATROOM\":\"不能在 AVChatRoom 类型的群组踢人\",\"NOT_OWNER\":\"你不是群主，只有群主才有权限操作\",\"CANNOT_SET_MEMBER_ROLE_IN_PRIVATE_AND_AVCHATROOM\":\"不能在 Private / AVChatRoom 类型的群中设置群成员身份\",\"INVALID_MEMBER_ROLE\":\"不合法的群成员身份，请检查传入参数\",\"CANNOT_SET_SELF_MEMBER_ROLE\":\"不能设置自己的群成员身份，请检查传入参数\",\"CANNOT_MUTE_SELF\":\"不能将自己禁言，请检查传入参数\",\"DEL_FRIEND_INVALID_PARAM\":\"传入 deleteFriend 接口的参数无效\",\"UPDATE_PROFILE_INVALID_PARAM\":\"传入 updateMyProfile 接口的参数无效\",\"UPDATE_PROFILE_NO_KEY\":\"updateMyProfile 无标配资料字段或自定义资料字段\",\"ADD_BLACKLIST_INVALID_PARAM\":\"传入 addToBlacklist 接口的参数无效\",\"DEL_BLACKLIST_INVALID_PARAM\":\"传入 removeFromBlacklist 接口的参数无效\",\"CANNOT_ADD_SELF_TO_BLACKLIST\":\"不能拉黑自己\",\"NETWORK_ERROR\":\"网络错误\",\"NETWORK_TIMEOUT\":\"请求超时\",\"NETWORK_BASE_OPTIONS_NO_URL\":\"网络层初始化错误，缺少 URL 参数\",\"NETWORK_UNDEFINED_SERVER_NAME\":\"打包错误，未定义的 serverName\",\"NETWORK_PACKAGE_UNDEFINED\":\"未定义的 packageConfig\",\"NO_NETWORK\":\"未连接到网络\",\"SOCKET_NOT_SUPPORTED\":\"当前浏览器不支持 WebSocket\",\"CONVERTOR_IRREGULAR_PARAMS\":\"不规范的参数名称\",\"NOTICE_RUNLOOP_UNEXPECTED_CONDITION\":\"意料外的通知条件\",\"NOTICE_RUNLOOP_OFFSET_LOST\":\"_syncOffset 丢失\",\"GET_LONGPOLL_ID_FAILED\":\"获取 longpolling id 失败\",\"UNCAUGHT_ERROR\":\"未经明确定义的错误\",\"SDK_IS_NOT_READY\":\"接口需要 SDK 处于 ready 状态后才能调用\",\"LONG_POLL_KICK_OUT\":\"检测到多个 web 实例登录，消息通道下线\",\"SSO_LOG_MODEL_INIT_ERROR\":\"SSOLogData 数据模型初始化错误\",\"MESSAGE_A2KEY_EXPIRED\":\"消息错误码：UserSig 或 A2 失效。\",\"ACCOUNT_A2KEY_EXPIRED\":\"帐号错误码：UserSig 已过期，请重新生成。建议 UserSig 有效期设置不小于24小时。\",\"LONG_POLL_API_PARAM_ERROR\":\"longPoll API parameters error\"},_t=[\"jpg\",\"jpeg\",\"gif\",\"png\"],dt=[\"mp4\"],ft=function(){function e(t){o(this,e);var n=this._check(t);if(n instanceof lt)throw n;this.type=S.MSG_FILE,this._percent=0;var r=this._getFileInfo(t);this.content={\"downloadFlag\":2,\"fileUrl\":t.url||\"\",\"uuid\":t.uuid,\"fileName\":r.name||\"\",\"fileSize\":r.size||0}}return s(e,[{\"key\":\"_getFileInfo\",\"value\":function(e){if(e.fileName&&e.fileSize)return{\"size\":e.fileSize,\"name\":e.fileName};if(L)return{};var t=e.file.files[0];return{\"size\":t.size,\"name\":t.name,\"type\":t.type.slice(t.type.lastIndexOf(\"/\")+1).toLowerCase()}}},{\"key\":\"updatePercent\",\"value\":function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{\"key\":\"updateFileUrl\",\"value\":function(e){this.content.fileUrl=e}},{\"key\":\"_check\",\"value\":function(e){if(e.size>104857600)return new lt({\"code\":pt.MESSAGE_FILE_SIZE_LIMIT,\"message\":\"\".concat(ht.MESSAGE_FILE_SIZE_LIMIT,\": \").concat(104857600,\" bytes\")})}},{\"key\":\"sendable\",\"value\":function(){return\"\"!==this.content.fileUrl&&(\"\"!==this.content.fileName&&0!==this.content.fileSize)}}]),e}(),gt=function(){function e(t){o(this,e),this.type=S.MSG_CUSTOM,this.content={\"data\":t.data||\"\",\"description\":t.description||\"\",\"extension\":t.extension||\"\"}}return s(e,[{\"key\":\"setData\",\"value\":function(e){return this.content.data=e,this}},{\"key\":\"setDescription\",\"value\":function(e){return this.content.description=e,this}},{\"key\":\"setExtension\",\"value\":function(e){return this.content.extension=e,this}},{\"key\":\"sendable\",\"value\":function(){return 0!==this.content.data.length||0!==this.content.description.length||0!==this.content.extension.length}}]),e}(),mt=function(){function e(t){o(this,e),this.type=S.MSG_VIDEO,this._percent=0,this.content={\"remoteVideoUrl\":t.remoteVideoUrl,\"videoFormat\":t.videoFormat,\"videoSecond\":parseInt(t.videoSecond,10),\"videoSize\":t.videoSize,\"videoUrl\":t.videoUrl,\"videoDownloadFlag\":2,\"videoUUID\":t.videoUUID,\"thumbUUID\":t.thumbUUID,\"thumbFormat\":t.thumbFormat,\"thumbWidth\":t.thumbWidth,\"thumbHeight\":t.thumbHeight,\"thumbSize\":t.thumbSize,\"thumbDownloadFlag\":2,\"thumbUrl\":t.thumbUrl}}return s(e,[{\"key\":\"updatePercent\",\"value\":function(e){this._percent=e,this._percent>1&&(this._percent=1)}},{\"key\":\"updateVideoUrl\",\"value\":function(e){e&&(this.content.remoteVideoUrl=e)}},{\"key\":\"sendable\",\"value\":function(){return\"\"!==this.content.remoteVideoUrl}}]),e}(),yt=function e(t){o(this,e),this.type=S.MSG_GEO,this.content=t},Et=function(){function e(t){o(this,e),this.ID=\"\",this.conversationID=t.conversationID||null,this.conversationType=t.conversationType||S.CONV_C2C,this.conversationSubType=t.conversationSubType,this.time=t.time||Math.ceil(Date.now()/1e3),this.sequence=t.sequence||0,this.clientSequence=t.clientSequence||t.sequence||0,this.random=t.random||ye(),this.messagePriority=t.messagePriority||0,this._elements=[],this.isPlaceMessage=t.isPlaceMessage||0,this.isRevoked=2===t.isPlaceMessage||8===t.msgFlagBits,this.geo={},this.from=t.from||null,this.to=t.to||null,this.flow=\"\",this.isSystemMessage=t.isSystemMessage||!1,this.protocol=t.protocol||\"JSON\",this.isResend=!1,this.isRead=!1,this.status=t.status||we.MESSAGE_STATUS.SUCCESS,this.reInitialize(t.currentUser),this.extractGroupInfo(t.groupProfile||null)}return s(e,[{\"key\":\"getElements\",\"value\":function(){return this._elements}},{\"key\":\"extractGroupInfo\",\"value\":function(e){if(null!==e){var t=e.messageFromAccountExtraInformation;this.nick=\"\",\"string\"==typeof e.fromAccountNick&&(this.nick=e.fromAccountNick),this.avatar=\"\",\"string\"==typeof e.fromAccountHeadurl&&(this.avatar=e.fromAccountHeadurl),this.nameCard=\"\",\"object\"===r(t)&&t.hasOwnProperty(\"nameCard\")&&(this.nameCard=t.nameCard)}}},{\"key\":\"_initProxy\",\"value\":function(){this.payload=this._elements[0].content,this.type=this._elements[0].type}},{\"key\":\"reInitialize\",\"value\":function(e){e&&(this.status=this.from?we.MESSAGE_STATUS.SUCCESS:we.MESSAGE_STATUS.UNSEND,!this.from&&(this.from=e)),this._initFlow(e),this._initielizeSequence(e),this._concactConversationID(e),this.generateMessageID(e)}},{\"key\":\"isSendable\",\"value\":function(){return 0!==this._elements.length&&(\"function\"!=typeof this._elements[0].sendable?(J.warn(\"\".concat(this._elements[0].type,' need \"boolean : sendable()\" method')),!1):this._elements[0].sendable())}},{\"key\":\"_initTo\",\"value\":function(e){this.conversationType===S.CONV_GROUP&&(this.to=e.groupID)}},{\"key\":\"_initielizeSequence\",\"value\":function(e){0===this.clientSequence&&e&&(this.clientSequence=function(e){if(!e)return J.error(\"autoincrementIndex(string: key) need key parameter\"),!1;if(void 0===Ce[e]){var t=new Date,n=\"3\".concat(t.getHours()).slice(-2),o=\"0\".concat(t.getMinutes()).slice(-2),r=\"0\".concat(t.getSeconds()).slice(-2);Ce[e]=parseInt([n,o,r,\"0001\"].join(\"\")),n=null,o=null,r=null,J.warn(\"utils.autoincrementIndex() create new sequence : \".concat(e,\" = \").concat(Ce[e]))}return Ce[e]++}(e)),0===this.sequence&&this.conversationType===S.CONV_C2C&&(this.sequence=this.clientSequence)}},{\"key\":\"generateMessageID\",\"value\":function(e){var t=e===this.from?1:0,n=this.sequence>0?this.sequence:this.clientSequence;this.ID=\"\".concat(this.conversationID,\"-\").concat(n,\"-\").concat(this.random,\"-\").concat(t)}},{\"key\":\"_initFlow\",\"value\":function(e){\"\"!==e&&(e===this.from?(this.flow=\"out\",this.isRead=!0):this.flow=\"in\")}},{\"key\":\"_concactConversationID\",\"value\":function(e){var t=this.to,n=\"\",o=this.conversationType;o!==S.CONV_SYSTEM?(n=o===S.CONV_C2C?e===this.from?t:this.from:this.to,this.conversationID=\"\".concat(o).concat(n)):this.conversationID=S.CONV_SYSTEM}},{\"key\":\"isElement\",\"value\":function(e){return e instanceof be||e instanceof nt||e instanceof ot||e instanceof rt||e instanceof ft||e instanceof mt||e instanceof st||e instanceof ut||e instanceof gt||e instanceof yt}},{\"key\":\"setElement\",\"value\":function(e){var t=this;if(this.isElement(e))return this._elements=[e],void this._initProxy();var n=function(e){switch(e.type){case S.MSG_TEXT:t.setTextElement(e.content);break;case S.MSG_IMAGE:t.setImageElement(e.content);break;case S.MSG_AUDIO:t.setAudioElement(e.content);break;case S.MSG_FILE:t.setFileElement(e.content);break;case S.MSG_VIDEO:t.setVideoElement(e.content);break;case S.MSG_CUSTOM:t.setCustomElement(e.content);break;case S.MSG_GEO:t.setGEOElement(e.content);break;case S.MSG_GRP_TIP:t.setGroupTipElement(e.content);break;case S.MSG_GRP_SYS_NOTICE:t.setGroupSystemNoticeElement(e.content);break;case S.MSG_FACE:t.setFaceElement(e.content);break;default:J.warn(e.type,e.content,\"no operation......\")}};if(Array.isArray(e))for(var o=0;o<e.length;o++)n(e[o]);else n(e);this._initProxy()}},{\"key\":\"setTextElement\",\"value\":function(e){var t=\"string\"==typeof e?e:e.text,n=new be({\"text\":t});this._elements.push(n)}},{\"key\":\"setImageElement\",\"value\":function(e){var t=new nt(e);this._elements.push(t)}},{\"key\":\"setAudioElement\",\"value\":function(e){var t=new rt(e);this._elements.push(t)}},{\"key\":\"setFileElement\",\"value\":function(e){var t=new ft(e);this._elements.push(t)}},{\"key\":\"setVideoElement\",\"value\":function(e){var t=new mt(e);this._elements.push(t)}},{\"key\":\"setGEOElement\",\"value\":function(e){var t=new yt(e);this._elements.push(t)}},{\"key\":\"setCustomElement\",\"value\":function(e){var t=new gt(e);this._elements.push(t)}},{\"key\":\"setGroupTipElement\",\"value\":function(e){var t=new st(e);this._elements.push(t)}},{\"key\":\"setGroupSystemNoticeElement\",\"value\":function(e){var t=new ut(e);this._elements.push(t)}},{\"key\":\"setFaceElement\",\"value\":function(e){var t=new ot(e);this._elements.push(t)}},{\"key\":\"setIsRead\",\"value\":function(e){this.isRead=e}},{\"key\":\"elements\",\"get\":function(){return J.warn(\"！！！Message 实例的 elements 属性即将废弃，请尽快修改。使用 type 和 payload 属性处理单条消息，兼容组合消息使用 _elements 属性！！！\"),this._elements}}]),e}(),vt={\"login\":{\"userID\":{\"type\":\"String\",\"required\":!0},\"userSig\":{\"type\":\"String\",\"required\":!0}},\"addToBlacklist\":{\"userIDList\":{\"type\":\"Array\",\"required\":!0}},\"mutilParam\":[{\"name\":\"paramName\",\"type\":\"Number\",\"required\":!0},{\"name\":\"paramName\",\"type\":\"String\",\"required\":!0}],\"on\":[{\"name\":\"eventName\",\"type\":\"String\",\"validator\":function(e){return\"string\"==typeof e&&0!==e.length||(console.warn(\"on 接口的 eventName 参数必须是 String 类型，且不能为空。\"),!1)}},{\"name\":\"handler\",\"type\":\"Function\",\"validator\":function(e){return\"function\"!=typeof e?(console.warn(\"on 接口的 handler 参数必须是 Function 类型。\"),!1):(\"\"===e.name&&console.warn(\"on 接口的 handler 参数推荐使用具名函数。具名函数可以使用 off 接口取消订阅，匿名函数无法取消订阅。\"),!0)}}],\"once\":[{\"name\":\"eventName\",\"type\":\"String\",\"validator\":function(e){return\"string\"==typeof e&&0!==e.length||(console.warn(\"once 接口的 eventName 参数必须是 String 类型，且不能为空。\"),!1)}},{\"name\":\"handler\",\"type\":\"Function\",\"validator\":function(e){return\"function\"!=typeof e?(console.warn(\"once 接口的 handler 参数必须是 Function 类型。\"),!1):(\"\"===e.name&&console.warn(\"once 接口的 handler 参数推荐使用具名函数。\"),!0)}}],\"off\":[{\"name\":\"eventName\",\"type\":\"String\",\"validator\":function(e){return\"string\"==typeof e&&0!==e.length||(console.warn(\"off 接口的 eventName 参数必须是 String 类型，且不能为空。\"),!1)}},{\"name\":\"handler\",\"type\":\"Function\",\"validator\":function(e){return\"function\"!=typeof e?(console.warn(\"off 接口的 handler 参数必须是 Function 类型。\"),!1):(\"\"===e.name&&console.warn(\"off 接口的 handler 参数为匿名函数，无法取消订阅。\"),!0)}}],\"sendMessage\":[{\"name\":\"message\",\"type\":\"Object\",\"required\":!0}],\"getMessageList\":{\"conversationID\":{\"type\":\"String\",\"required\":!0},\"nextReqMessageID\":{\"type\":\"String\"},\"count\":{\"type\":\"Number\",\"validator\":function(e){return!(!se(e)&&!/^[1-9][0-9]*$/.test(e))||(console.warn(\"getMessageList 接口的 count 参数必须为正整数\"),!1)}}},\"getConversationProfile\":[{\"name\":\"conversationID\",\"type\":\"String\",\"required\":!0,\"validator\":function(e){return!!e&&(!!(ne(t=e)&&t.slice(0,3)===S.CONV_C2C||function(e){return ne(e)&&e.slice(0,5)===S.CONV_GROUP}(e)||Ge(e))||(console.warn(\"非法的会话 ID:\".concat(e,\"。会话 ID 组成方式：\\n      C2C + userID（单聊）\\n      GROUP + groupID（群聊）\\n      @TIM#SYSTEM（系统通知会话）\")),!1));var t}}],\"deleteConversation\":[{\"name\":\"conversationID\",\"type\":\"String\",\"required\":!0}],\"getGroupList\":{\"groupProfileFilter\":{\"type\":\"Array\"}},\"getGroupProfile\":{\"groupID\":{\"type\":\"String\",\"required\":!0},\"groupCustomFieldFilter\":{\"type\":\"Array\"},\"memberCustomFieldFilter\":{\"type\":\"Array\"}},\"getGroupProfileAdvance\":{\"groupIDList\":{\"type\":\"Array\",\"required\":!0}},\"createGroup\":{\"name\":{\"type\":\"String\",\"required\":!0}},\"joinGroup\":{\"groupID\":{\"type\":\"String\",\"required\":!0},\"type\":{\"type\":\"String\"},\"applyMessage\":{\"type\":\"String\"}},\"quitGroup\":[{\"name\":\"groupID\",\"type\":\"String\",\"required\":!0}],\"handleApplication\":{\"message\":{\"type\":\"Object\",\"required\":!0},\"handleAction\":{\"type\":\"String\",\"required\":!0},\"handleMessage\":{\"type\":\"String\"}},\"changeGroupOwner\":{\"groupID\":{\"type\":\"String\",\"required\":!0},\"newOwnerID\":{\"type\":\"String\",\"required\":!0}},\"updateGroupProfile\":{\"groupID\":{\"type\":\"String\",\"required\":!0}},\"dismissGroup\":[{\"name\":\"groupID\",\"type\":\"String\",\"required\":!0}],\"searchGroupByID\":[{\"name\":\"groupID\",\"type\":\"String\",\"required\":!0}],\"getGroupMemberList\":{\"groupID\":{\"type\":\"String\",\"required\":!0},\"offset\":{\"type\":\"Number\"},\"count\":{\"type\":\"Number\"}},\"getGroupMemberProfile\":{\"groupID\":{\"type\":\"String\",\"required\":!0},\"userIDList\":{\"type\":\"Array\",\"required\":!0},\"memberCustomFieldFilter\":{\"type\":\"Array\"}},\"addGroupMemeber\":{\"groupID\":{\"type\":\"String\",\"required\":!0},\"userIDList\":{\"type\":\"Array\",\"required\":!0}},\"setGroupMemberRole\":{\"groupID\":{\"type\":\"String\",\"required\":!0},\"userID\":{\"type\":\"String\",\"required\":!0},\"role\":{\"type\":\"String\",\"required\":!0}},\"setGroupMemberMuteTime\":{\"groupID\":{\"type\":\"String\",\"required\":!0},\"userID\":{\"type\":\"String\",\"required\":!0},\"muteTime\":{\"type\":\"Number\",\"validator\":function(e){return e>=0}}},\"setGroupMemberNameCard\":{\"groupID\":{\"type\":\"String\",\"required\":!0},\"userID\":{\"type\":\"String\"},\"nameCard\":{\"type\":\"String\",\"required\":!0,\"validator\":function(e){return!0!==/^\\s+$/.test(e)}}},\"setMessageRemindType\":{\"groupID\":{\"type\":\"String\",\"required\":!0},\"messageRemindType\":{\"type\":\"String\",\"required\":!0}},\"setGroupMemberCustomField\":{\"groupID\":{\"type\":\"String\",\"required\":!0},\"userID\":{\"type\":\"String\"},\"memberCustomField\":{\"type\":\"Array\",\"required\":!0}},\"deleteGroupMember\":{\"groupID\":{\"type\":\"String\",\"required\":!0}},\"createTextMessage\":{\"to\":{\"type\":\"String\",\"required\":!0},\"conversationType\":{\"type\":\"String\",\"required\":!0},\"payload\":{\"type\":\"Object\",\"required\":!0,\"validator\":function(e){return ne(e.text)?0!==e.text.length||(console.warn(\"createTextMessage 消息内容不能为空。请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#createTextMessage\"),!1):(console.warn(\"createTextMessage payload.text 类型必须为字符串。请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#createTextMessage\"),!1)}}},\"createCustomMessage\":{\"to\":{\"type\":\"String\",\"required\":!0},\"conversationType\":{\"type\":\"String\",\"required\":!0},\"payload\":{\"type\":\"Object\",\"required\":!0}},\"createImageMessage\":{\"to\":{\"type\":\"String\",\"required\":!0},\"conversationType\":{\"type\":\"String\",\"required\":!0},\"payload\":{\"type\":\"Object\",\"required\":!0,\"validator\":function(e){if(se(e.file))return console.warn(\"createImageMessage payload.file 不能为 undefined。请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#createImageMessage\"),!1;if(A){if(!(e.file instanceof HTMLInputElement||ee(e.file)))return console.warn(\"createImageMessage payload.file 的类型必须是 HTMLInputElement 或 File。请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#createImageMessage\"),!1;if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return console.warn(\"createImageMessage 您没有选择文件，无法发送。请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#createImageMessage\"),!1}return!0},\"onProgress\":{\"type\":\"Function\",\"required\":!1,\"validator\":function(e){return se(e)&&console.warn(\"createImageMessage 没有 onProgress 回调，您将无法获取图片上传进度。请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#createImageMessage\"),!0}}}},\"createAudioMessage\":{\"to\":{\"type\":\"String\",\"required\":!0},\"conversationType\":{\"type\":\"String\",\"required\":!0},\"payload\":{\"type\":\"Object\",\"required\":!0},\"onProgress\":{\"type\":\"Function\",\"required\":!1,\"validator\":function(e){return se(e)&&console.warn(\"createAudioMessage 没有 onProgress 回调，您将无法获取音频上传进度。请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#createAudioMessage\"),!0}}},\"createVideoMessage\":{\"to\":{\"type\":\"String\",\"required\":!0},\"conversationType\":{\"type\":\"String\",\"required\":!0},\"payload\":{\"type\":\"Object\",\"required\":!0},\"onProgress\":{\"type\":\"Function\",\"required\":!1,\"validator\":function(e){return se(e)&&console.warn(\"createVideoMessage 没有 onProgress 回调，您将无法获取视频上传进度。请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#createVideoMessage\"),!0}}},\"createFaceMessage\":{\"to\":{\"type\":\"String\",\"required\":!0},\"conversationType\":{\"type\":\"String\",\"required\":!0},\"payload\":{\"type\":\"Object\",\"required\":!0,\"validator\":function(e){return!!re(e)&&(te(e.index)?!!ne(e.data)||(console.warn(\"createFaceMessage payload.data 类型必须为 String！\"),!1):(console.warn(\"createFaceMessage payload.index 类型必须为 Number！\"),!1))}}},\"createFileMessage\":{\"to\":{\"type\":\"String\",\"required\":!0},\"conversationType\":{\"type\":\"String\",\"required\":!0},\"payload\":{\"type\":\"Object\",\"required\":!0,\"validator\":function(e){if(se(e.file))return console.warn(\"createFileMessage payload.file 不能为 undefined。请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#createFileMessage\"),!1;if(A){if(!(e.file instanceof HTMLInputElement||ee(e.file)))return console.warn(\"createFileMessage payload.file 的类型必须是 HTMLInputElement 或 File。请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#createFileMessage\"),!1;if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return console.warn(\"createFileMessage 您没有选择文件，无法发送。请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#createFileMessage\"),!1}return!0}},\"onProgress\":{\"type\":\"Function\",\"required\":!1,\"validator\":function(e){return se(e)&&console.warn(\"createFileMessage 没有 onProgress 回调，您将无法获取文件上传进度。请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#createFileMessage\"),!0}}},\"revokeMessage\":[{\"name\":\"message\",\"type\":\"Object\",\"required\":!0,\"validator\":function(e){return e instanceof Et?e.conversationType===S.CONV_SYSTEM?(console.warn(\"revokeMessage 不能撤回系统会话消息，只能撤回单聊消息或群消息\"),!1):!0!==e.isRevoked||(console.warn(\"revokeMessage 消息已经被撤回，请勿重复操作\"),!1):(console.warn(\"revokeMessage 参数 message 必须为 Message(https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/Message.html) 实例。\"),!1)}}],\"getUserProfile\":{\"userIDList\":{\"type\":\"Array\",\"validator\":function(e){return ie(e)?(0===e.length&&console.warn(\"getUserProfile userIDList 不能为空数组，请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#getUserProfile\"),!0):(console.warn(\"getUserProfile userIDList 必须为数组，请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#getUserProfile\"),!1)}}},\"updateMyProfile\":{\"profileCustomField\":{\"type\":\"Array\",\"validator\":function(e){return!!se(e)||(!!ie(e)||(console.warn(\"updateMyProfile profileCustomField 必须为数组，请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#updateMyProfile\"),!1))}}}},It={\"login\":\"login\",\"logout\":\"logout\",\"on\":\"on\",\"once\":\"once\",\"off\":\"off\",\"setLogLevel\":\"setLogLevel\",\"downloadLog\":\"downloadLog\",\"registerPlugin\":\"registerPlugin\",\"destroy\":\"destroy\",\"createTextMessage\":\"createTextMessage\",\"createImageMessage\":\"createImageMessage\",\"createAudioMessage\":\"createAudioMessage\",\"createVideoMessage\":\"createVideoMessage\",\"createCustomMessage\":\"createCustomMessage\",\"createFaceMessage\":\"createFaceMessage\",\"createFileMessage\":\"createFileMessage\",\"sendMessage\":\"sendMessage\",\"resendMessage\":\"resendMessage\",\"getMessageList\":\"getMessageList\",\"setMessageRead\":\"setMessageRead\",\"revokeMessage\":\"revokeMessage\",\"getConversationList\":\"getConversationList\",\"getConversationProfile\":\"getConversationProfile\",\"deleteConversation\":\"deleteConversation\",\"getGroupList\":\"getGroupList\",\"getGroupProfile\":\"getGroupProfile\",\"createGroup\":\"createGroup\",\"joinGroup\":\"joinGroup\",\"updateGroupProfile\":\"updateGroupProfile\",\"quitGroup\":\"quitGroup\",\"dismissGroup\":\"dismissGroup\",\"changeGroupOwner\":\"changeGroupOwner\",\"searchGroupByID\":\"searchGroupByID\",\"setMessageRemindType\":\"setMessageRemindType\",\"handleGroupApplication\":\"handleGroupApplication\",\"getGroupMemberProfile\":\"getGroupMemberProfile\",\"getGroupMemberList\":\"getGroupMemberList\",\"addGroupMember\":\"addGroupMember\",\"deleteGroupMember\":\"deleteGroupMember\",\"setGroupMemberNameCard\":\"setGroupMemberNameCard\",\"setGroupMemberMuteTime\":\"setGroupMemberMuteTime\",\"setGroupMemberRole\":\"setGroupMemberRole\",\"setGroupMemberCustomField\":\"setGroupMemberCustomField\",\"getMyProfile\":\"getMyProfile\",\"getUserProfile\":\"getUserProfile\",\"updateMyProfile\":\"updateMyProfile\",\"getBlacklist\":\"getBlacklist\",\"addToBlacklist\":\"addToBlacklist\",\"removeFromBlacklist\":\"removeFromBlacklist\",\"getFriendList\":\"getFriendList\"},St=\"1.7.3\",Ct=\"537048168\",Tt=\"10\",Mt=\"protobuf\",Ot=\"json\",Nt={\"HOST\":{\"TYPE\":3,\"ACCESS_LAYER_TYPES\":{\"SANDBOX\":1,\"TEST\":2,\"PRODUCTION\":3},\"CURRENT\":{\"COMMON\":\"https://webim.tim.qq.com\",\"PIC\":\"https://pic.tim.qq.com\",\"COS\":\"https://yun.tim.qq.com\"},\"PRODUCTION\":{\"COMMON\":\"https://webim.tim.qq.com\",\"PIC\":\"https://pic.tim.qq.com\",\"COS\":\"https://yun.tim.qq.com\"},\"SANDBOX\":{\"COMMON\":\"https://events.tim.qq.com\",\"PIC\":\"https://pic.tim.qq.com\",\"COS\":\"https://yun.tim.qq.com\"},\"TEST\":{\"COMMON\":\"https://test.tim.qq.com\",\"PIC\":\"https://pic.tim.qq.com\",\"COS\":\"https://yun.tim.qq.com\"},\"setCurrent\":function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;switch(e){case this.ACCESS_LAYER_TYPES.SANDBOX:this.CURRENT=this.SANDBOX,this.TYPE=this.ACCESS_LAYER_TYPES.SANDBOX;break;case this.ACCESS_LAYER_TYPES.TEST:this.CURRENT=this.TEST,this.TYPE=this.ACCESS_LAYER_TYPES.TEST;break;default:this.CURRENT=this.PRODUCTION,this.TYPE=this.ACCESS_LAYER_TYPES.PRODUCTION}}},\"NAME\":{\"OPEN_IM\":\"openim\",\"GROUP\":\"group_open_http_svc\",\"FRIEND\":\"sns\",\"PROFILE\":\"profile\",\"RECENT_CONTACT\":\"recentcontact\",\"PIC\":\"openpic\",\"BIG_GROUP_NO_AUTH\":\"group_open_http_noauth_svc\",\"BIG_GROUP_LONG_POLLING_NO_AUTH\":\"group_open_long_polling_http_noauth_svc\",\"IM_OPEN_STAT\":\"imopenstat\",\"WEB_IM\":\"webim\",\"IM_COS_SIGN\":\"im_cos_sign_svr\"},\"CMD\":{\"ACCESS_LAYER\":\"accesslayer\",\"LOGIN\":\"login\",\"LOGOUT_LONG_POLL\":\"longpollinglogout\",\"LOGOUT_ALL\":\"logout\",\"PORTRAIT_GET\":\"portrait_get_all\",\"PORTRAIT_SET\":\"portrait_set\",\"GET_LONG_POLL_ID\":\"getlongpollingid\",\"LONG_POLL\":\"longpolling\",\"AVCHATROOM_LONG_POLL\":\"get_msg\",\"FRIEND_ADD\":\"friend_add\",\"FRIEND_GET_ALL\":\"friend_get_all\",\"FRIEND_DELETE\":\"friend_delete\",\"RESPONSE_PENDENCY\":\"friend_response\",\"GET_PENDENCY\":\"pendency_get\",\"DELETE_PENDENCY\":\"pendency_delete\",\"GET_GROUP_PENDENCY\":\"get_pendency\",\"GET_BLACKLIST\":\"black_list_get\",\"ADD_BLACKLIST\":\"black_list_add\",\"DELETE_BLACKLIST\":\"black_list_delete\",\"CREATE_GROUP\":\"create_group\",\"GET_JOINED_GROUPS\":\"get_joined_group_list\",\"SEND_MESSAGE\":\"sendmsg\",\"REVOKE_C2C_MESSAGE\":\"msgwithdraw\",\"SEND_GROUP_MESSAGE\":\"send_group_msg\",\"REVOKE_GROUP_MESSAGE\":\"group_msg_recall\",\"GET_GROUP_INFO\":\"get_group_info\",\"GET_GROUP_MEMBER_INFO\":\"get_specified_group_member_info\",\"GET_GROUP_MEMBER_LIST\":\"get_group_member_info\",\"QUIT_GROUP\":\"quit_group\",\"CHANGE_GROUP_OWNER\":\"change_group_owner\",\"DESTROY_GROUP\":\"destroy_group\",\"ADD_GROUP_MEMBER\":\"add_group_member\",\"DELETE_GROUP_MEMBER\":\"delete_group_member\",\"SEARCH_GROUP_BY_ID\":\"get_group_public_info\",\"APPLY_JOIN_GROUP\":\"apply_join_group\",\"HANDLE_APPLY_JOIN_GROUP\":\"handle_apply_join_group\",\"MODIFY_GROUP_INFO\":\"modify_group_base_info\",\"MODIFY_GROUP_MEMBER_INFO\":\"modify_group_member_info\",\"DELETE_GROUP_SYSTEM_MESSAGE\":\"deletemsg\",\"GET_CONVERSATION_LIST\":\"get\",\"PAGING_GET_CONVERSATION_LIST\":\"page_get\",\"DELETE_CONVERSATION\":\"delete\",\"GET_MESSAGES\":\"getmsg\",\"GET_C2C_ROAM_MESSAGES\":\"getroammsg\",\"GET_GROUP_ROAM_MESSAGES\":\"group_msg_get\",\"SET_C2C_MESSAGE_READ\":\"msgreaded\",\"SET_GROUP_MESSAGE_READ\":\"msg_read_report\",\"FILE_READ_AND_WRITE_AUTHKEY\":\"authkey\",\"FILE_UPLOAD\":\"pic_up\",\"COS_SIGN\":\"cos\",\"TIM_WEB_REPORT\":\"tim_web_report\",\"BIG_DATA_HALLWAY_AUTH_KEY\":\"authkey\"},\"CHANNEL\":{\"SOCKET\":1,\"XHR\":2,\"AUTO\":0},\"NAME_VERSION\":{\"openim\":\"v4\",\"group_open_http_svc\":\"v4\",\"sns\":\"v4\",\"profile\":\"v4\",\"recentcontact\":\"v4\",\"openpic\":\"v4\",\"group_open_http_noauth_svc\":\"v1\",\"group_open_long_polling_http_noauth_svc\":\"v1\",\"imopenstat\":\"v4\",\"im_cos_sign_svr\":\"v4\",\"webim\":\"v4\"}};Nt.HOST.setCurrent(Nt.HOST.ACCESS_LAYER_TYPES.PRODUCTION);var Rt={\"request\":{\"toAccount\":\"To_Account\",\"fromAccount\":\"From_Account\",\"to\":\"To_Account\",\"from\":\"From_Account\",\"groupID\":\"GroupId\",\"avatar\":\"FaceUrl\"},\"response\":{\"GroupId\":\"groupID\",\"Member_Account\":\"userID\",\"MsgList\":\"messageList\",\"SyncFlag\":\"syncFlag\",\"To_Account\":\"to\",\"From_Account\":\"from\",\"MsgSeq\":\"sequence\",\"MsgRandom\":\"random\",\"MsgTimeStamp\":\"time\",\"MsgContent\":\"content\",\"MsgBody\":\"elements\",\"GroupWithdrawInfoArray\":\"revokedInfos\",\"WithdrawC2cMsgNotify\":\"c2cMessageRevokedNotify\",\"C2cWithdrawInfoArray\":\"revokedInfos\",\"MsgRand\":\"random\",\"MsgType\":\"type\",\"MsgShow\":\"messageShow\",\"NextMsgSeq\":\"nextMessageSeq\",\"FaceUrl\":\"avatar\",\"ProfileDataMod\":\"profileModify\",\"Profile_Account\":\"userID\",\"ValueBytes\":\"value\",\"ValueNum\":\"value\",\"NoticeSeq\":\"noticeSequence\",\"NotifySeq\":\"notifySequence\",\"MsgFrom_AccountExtraInfo\":\"messageFromAccountExtraInformation\",\"Operator_Account\":\"operatorID\",\"OpType\":\"operationType\",\"ReportType\":\"operationType\",\"UserId\":\"userID\",\"User_Account\":\"userID\",\"List_Account\":\"userIDList\",\"MsgOperatorMemberExtraInfo\":\"operatorInfo\",\"MsgMemberExtraInfo\":\"memberInfoList\",\"ImageUrl\":\"avatar\",\"NickName\":\"nick\",\"MsgGroupNewInfo\":\"newGroupProfile\",\"Owner_Account\":\"ownerID\",\"GroupName\":\"name\",\"GroupFaceUrl\":\"avatar\",\"GroupIntroduction\":\"introduction\",\"GroupNotification\":\"notification\",\"GroupApplyJoinOption\":\"joinOption\",\"MsgKey\":\"messageKey\",\"GroupInfo\":\"groupProfile\",\"ShutupTime\":\"muteTime\",\"Desc\":\"description\",\"Ext\":\"extension\"},\"ignoreKeyWord\":[\"C2C\",\"ID\",\"USP\"]},Pt={\"CONTEXT_UPDATED\":\"_contextWasUpdated\",\"CONTEXT_RESET\":\"_contextWasReset\",\"CONTEXT_A2KEY_AND_TINYID_UPDATED\":\"_a2KeyAndTinyIDUpdated\",\"RUNNING_STATE_CHANGE\":\"_runningStateChange\",\"SYNC_MESSAGE_C2C_START\":\"_noticeSynchronizationStart\",\"SYNC_MESSAGE_C2C_PROCESSING\":\"_noticeIsSynchronizing\",\"SYNC_MESSAGE_C2C_FINISHED\":\"_noticeIsSynchronized\",\"SYNC_MESSAGE_GROUP_SYSTEM_NOTICE_FINISHED\":\"_groupSystemNoticeSyncFinished\",\"MESSAGE_SENT\":\"_messageSent\",\"MESSAGE_C2C_SEND_SUCCESS\":\"_sendC2CMessageSuccess\",\"MESSAGE_C2C_SEND_FAIL\":\"_sendC2CMessageFail\",\"MESSAGE_SYNC_PROCESSING\":\"_syncMessageProcessing\",\"MESSAGE_SYNC_FINISHED\":\"_syncMessageFinished\",\"MESSAGE_C2C_INSTANT_RECEIVED\":\"_receiveInstantMessage\",\"MESSAGE_C2C_RECEIVE_ROAMING_SUCCESS\":\"_receiveC2CRoamingMessageSuccess\",\"MESSAGE_C2C_RECEIVE_ROAMING_FAIL\":\"_receiveC2CRoamingMessageFail\",\"MESSAGE_GROUP_SEND_SUCCESS\":\"_sendGroupMessageSuccess\",\"MESSAGE_GROUP_SEND_FAIL\":\"_sendGroupMessageFail\",\"MESSAGE_GROUP_RECEIVE_ROAMING_SUCCESS\":\"_receiveGroupRoamingMessageSuccess\",\"MESSAGE_GROUP_RECEIVE_ROAMING_FAIL\":\"_receiveGroupRoamingMessageFail\",\"MESSAGE_GROUP_INSTANT_RECEIVED\":\"_receiveGroupInstantMessage\",\"MESSAGE_GROUP_SYSTEM_NOTICE_RECEIVED\":\"_receveGroupSystemNotice\",\"MESSAGE_REVOKED\":\"_messageRevoked\",\"NOTICE_LONGPOLL_GETID_SUCCESS\":\"_getLongPollIDSuccess\",\"NOTICE_LONGPOLL_GETID_FAIL\":\"_getLongPollIDFail\",\"NOTICE_LONGPOLL_START\":\"_longPollStart\",\"NOTICE_LONGPOLL_IN_POLLING\":\"_longPollInPolling\",\"NOTICE_LONGPOLL_REQUEST_ARRIVED\":\"_longPollInArrived\",\"NOTICE_LONGPOLL_REQUEST_NOT_ARRIVED\":\"_longPollNotArrived\",\"NOTICE_LONGPOLL_REQUEST_ERROR\":\"_longPollError\",\"NOTICE_LONGPOLL_JITTER\":\"_longPollJitter\",\"NOTICE_LONGPOLL_SOON_RECONNECT\":\"_longPollSoonReconnect\",\"NOTICE_LONGPOLL_LONG_RECONNECT\":\"_longPollLongReconnect\",\"NOTICE_LONGPOLL_DISCONNECT\":\"_longpollChannelDisconnect\",\"NOTICE_LONGPOLL_STOPPED\":\"_longPollStopped\",\"NOTICE_LONGPOLL_KICKED_OUT\":\"_longPollKickedOut\",\"NOTICE_LONGPOLL_MUTIPLE_DEVICE_KICKED_OUT\":\"_longPollMitipuleDeviceKickedOut\",\"NOTICE_LONGPOLL_NEW_C2C_NOTICE\":\"_longPollGetNewC2CNotice\",\"NOTICE_LONGPOLL_NEW_C2C_MESSAGES\":\"_longPollGetNewC2CMessages\",\"NOTICE_LONGPOLL_NEW_GROUP_MESSAGES\":\"_longPollGetNewGroupMessages\",\"NOTICE_LONGPOLL_NEW_GROUP_TIPS\":\"_longPollGetNewGroupTips\",\"NOTICE_LONGPOLL_NEW_GROUP_NOTICE\":\"_longPollGetNewGroupNotice\",\"NOTICE_LONGPOLL_NEW_FRIEND_MESSAGES\":\"_longPollGetNewFriendMessages\",\"NOTICE_LONGPOLL_SEQUENCE_UPDATE\":\"_longPollNoticeSequenceUpdate\",\"NOTICE_LONGPOLL_PROFILE_MODIFIED\":\"_longPollProfileModified\",\"NOTICE_LONGPOLL_RECEIVE_SYSTEM_ORDERS\":\"_longPollNoticeReceiveSystemOrders\",\"NOTICE_LONGPOLL_RESTART\":\"_longpollRestart\",\"NOTICE_LONGPOLL_GROUP_MESSAGE_REVOKED\":\" _longpollGroupMessageRevoked\",\"NOTICE_LONGPOLL_C2C_MESSAGE_REVOKED\":\"_longpollC2CMessageRevoked\",\"APPLY_ADD_FRIEND_SUCCESS\":\"_addFriendApplySendSucess\",\"APPLY_ADD_FRIEND_FAIL\":\"_addFriendApplySendFail\",\"APPLY_GET_PENDENCY_SUCCESS\":\"_applyGetPendenciesSucess\",\"APPLY_GET_PENDENCY_FAIL\":\"_applyGetPendenciesFail\",\"APPLY_DELETE_SUCCESS\":\"_applyDeletedSucess\",\"APPLY_DELETE_FAIL\":\"_applyDeletedFail\",\"GROUP_CREATE_SUCCESS\":\"_createGroupSuccess\",\"GROUP_CREATE_FAIL\":\"_createGroupFail\",\"GROUP_LIST_UPDATED\":\"_onGroupListUpdated\",\"SIGN_LOGIN_CHANGE\":\"_loginStatusChange\",\"SIGN_LOGIN\":\"_login\",\"SIGN_LOGIN_SUCCESS\":\"_loginSuccess\",\"SIGN_LOGIN_FAIL\":\"_loginFail\",\"SIGN_LOGININFO_UPDATED\":\"_signLoginInfoUpdated\",\"SIGN_LOGOUT_EXECUTING\":\"_signLogoutExcuting\",\"SIGN_LOGOUT_SUCCESS\":\"_logoutSuccess\",\"SIGN_GET_ACCESS_LAYER_CHANGE\":\"_getAccessLayerStatusChange\",\"SIGN_GET_ACCESS_LAYER_SUCCESS\":\"_getAccessLayerSuccess\",\"SIGN_GET_ACCESS_LAYER_FAIL\":\"_getAccessLayerFail\",\"SIGN_A2KEY_EXPIRED\":\"_a2keyExpired\",\"ERROR_DETECTED\":\"_errorHasBeenDetected\",\"CONVERSATION_LIST_UPDATED\":\"_onConversationListUpdated\",\"CONVERSATION_LIST_PROFILE_UPDATED\":\"_onConversationListProfileUpdated\",\"CONVERSATION_DELETED\":\"_conversationDeleted\",\"PROFILE_UPDATED\":\"onProfileUpdated\",\"FRIEND_GET_SUCCESS\":\"_getFriendsSuccess\",\"FRIEND_GET_FAIL\":\"_getFriendsFail\",\"FRIEND_DELETE_SUCCESS\":\"_deleteFriendSuccess\",\"FRIEND_DELETE_FAIL\":\"_deleteFriendFail\",\"BLACKLIST_ADD_SUCCESS\":\"_addBlacklistSuccess\",\"BLACKLIST_ADD_FAIL\":\"_addBlacklistFail\",\"BLACKLIST_GET_SUCCESS\":\"_getBlacklistSuccess\",\"BLACKLIST_GET_FAIL\":\"_getBlacklistFail\",\"AVCHATROOM_OPTIONS_UPDATED\":\"_AVChatRoomOptionsUpdated\",\"AVCHATROOM_JOIN_SUCCESS\":\"joinAVChatRoomSuccess\",\"SDK_MEMORY_STATUS_UPDATE\":\"_sdkMemoryStatusUpdate\",\"SDK_READY\":\"_sdkStateReady\"};function Dt(e,t){if(\"string\"!=typeof e&&!Array.isArray(e))throw new TypeError(\"Expected the input to be `string | string[]`\");t=Object.assign({\"pascalCase\":!1},t);var n;return 0===(e=Array.isArray(e)?e.map(function(e){return e.trim()}).filter(function(e){return e.length}).join(\"-\"):e.trim()).length?\"\":1===e.length?t.pascalCase?e.toUpperCase():e.toLowerCase():(e!==e.toLowerCase()&&(e=kt(e)),e=e.replace(/^[_.\\- ]+/,\"\").toLowerCase().replace(/[_.\\- ]+(\\w|$)/g,function(e,t){return t.toUpperCase()}).replace(/\\d+(\\w|$)/g,function(e){return e.toUpperCase()}),n=e,t.pascalCase?n.charAt(0).toUpperCase()+n.slice(1):n)}var kt=function(e){for(var t=!1,n=!1,o=!1,r=0;r<e.length;r++){var i=e[r];t&&/[a-zA-Z]/.test(i)&&i.toUpperCase()===i?(e=e.slice(0,r)+\"-\"+e.slice(r),t=!1,o=n,n=!0,r++):n&&o&&/[a-zA-Z]/.test(i)&&i.toLowerCase()===i?(e=e.slice(0,r-1)+\"-\"+e.slice(r-1),o=n,n=!1,t=!0):(t=i.toLowerCase()===i&&i.toUpperCase()!==i,o=n,n=i.toUpperCase()===i&&i.toLowerCase()!==i)}return e};function At(t,n,o){var u=[],l=0,r=function e(t,i){if(++l>10)return l--,t;if(ie(t)){var n=t.map(function(t){return oe(t)?e(t,i):t});return l--,n}if(oe(t)){var o=(r=t,s=function(e,t){if(!pe(t))return!1;if((r=t)!==Dt(r)){for(var n=!0,o=0;o<Rt.ignoreKeyWord.length;o++)if(t.includes(Rt.ignoreKeyWord[o])){n=!1;break}n&&u.push(t)}var r;return se(i[t])?function(e){return e[0].toUpperCase()+Dt(e).slice(1)}(t):i[t]},a=Object.create(null),Object.keys(r).forEach(function(e){var t=s(r[e],e);t&&(a[t]=r[e])}),a);return o=Oe(o,function(t,n){return ie(t)||oe(t)?e(t,i):t}),l--,o}var r,s,a}(t,n=c({},Rt.request,{},n));return u.length>0&&o.innerEmitter.emit(Pt.ERROR_DETECTED,{\"code\":pt.CONVERTOR_IRREGULAR_PARAMS,\"message\":ht.CONVERTOR_IRREGULAR_PARAMS}),r}function Lt(e,n){if(n=c({},Rt.response,{},n),ie(e))return e.map(function(e){return oe(e)?Lt(e,n):e});if(oe(e)){var t=(o=e,r=function(e,t){return se(n[t])?Dt(t):n[t]},i={},Object.keys(o).forEach(function(e){i[r(o[e],e)]=o[e]}),i);return t=Oe(t,function(e){return ie(e)||oe(e)?Lt(e,n):e})}var o,r,i}var wt=function(){function e(t,n){var r=this;if(o(this,e),void 0===n)throw new lt({\"code\":pt.NO_SDK_INSTANCE,\"message\":ht.NO_SDK_INSTANCE});this.tim=n,this.method=t.method||\"POST\",this._initializeServerMap(),this._initializeURL(t),this._initializeRequestData(t),this.callback=function(e){return Lt(e=t.decode(e),r._getResponseMap(t))}}return s(e,[{\"key\":\"_initializeServerMap\",\"value\":function(){this._serverMap=Object.create(null);var e=\"\";for(var t in Nt.NAME)if(Object.prototype.hasOwnProperty.call(Nt.NAME,t))switch(e=Nt.NAME[t]){case Nt.NAME.PIC:this._serverMap[e]=Nt.HOST.CURRENT.PIC;break;case Nt.NAME.IM_COS_SIGN:this._serverMap[e]=Nt.HOST.CURRENT.COS;break;default:this._serverMap[e]=Nt.HOST.CURRENT.COMMON}}},{\"key\":\"_getHost\",\"value\":function(e){if(void 0!==this._serverMap[e])return this._serverMap[e];throw new lt({\"code\":pt.NETWORK_UNDEFINED_SERVER_NAME,\"message\":ht.NETWORK_UNDEFINED_SERVER_NAME})}},{\"key\":\"_initializeURL\",\"value\":function(e){var t=e.serverName,n=e.cmd,o=this._getHost(t),r=\"\".concat(o,\"/\").concat(Nt.NAME_VERSION[t],\"/\").concat(t,\"/\").concat(n);r+=\"?\".concat(this._getQueryString(e.queryString)),this.url=r}},{\"key\":\"getUrl\",\"value\":function(){return this.url.replace(/&reqtime=(\\d+)/,\"&reqtime=\".concat(Math.ceil(+new Date/1e3)))}},{\"key\":\"_initializeRequestData\",\"value\":function(e){var t,n=e.requestData;t=this._requestDataCleaner(n),this.requestData=e.encode(t)}},{\"key\":\"_requestDataCleaner\",\"value\":function(e){var t=Array.isArray(e)?[]:Object.create(null);for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&pe(n)&&null!==e[n]&&(\"object\"!==r(e[n])?t[n]=e[n]:t[n]=this._requestDataCleaner.bind(this)(e[n]));return t}},{\"key\":\"_getQueryString\",\"value\":function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(\"function\"!=typeof e[n]?t.push(\"\".concat(n,\"=\").concat(e[n])):t.push(\"\".concat(n,\"=\").concat(e[n]())));return t.join(\"&\")}},{\"key\":\"_getResponseMap\",\"value\":function(e){if(e.keyMaps&&e.keyMaps.response&&Object.keys(e.keyMaps.response).length>0)return e.keyMaps.response}}]),e}();function Gt(e){this.mixin(e)}Gt.mixin=function(e){var t=e.prototype||e;t._isReady=!1,t.ready=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e)return this._isReady?void(t?e.call(this):setTimeout(e,1)):(this._readyQueue=this._readyQueue||[],void this._readyQueue.push(e))},t.triggerReady=function(){var t=this;this._isReady=!0,setTimeout(function(){var e=t._readyQueue;t._readyQueue=[],e&&e.length>0&&e.forEach(function(e){e.call(this)},t)},1)},t.resetReady=function(){this._isReady=!1,this._readyQueue=[]},t.isReady=function(){return this._isReady}};var bt=function(){function e(t){if(o(this,e),!1==!!t)throw new lt({\"code\":pt.NO_SDK_INSTANCE,\"message\":ht.NO_SDK_INSTANCE});Gt.mixin(this),this.tim=t,this.innerEmitter=t.innerEmitter,this.connectionController=t.connectionController,this.packageConfig=t.packageConfig,this.packageConfig.update(t)}return s(e,[{\"key\":\"isLoggedIn\",\"value\":function(){return this.tim.context.login===we.LOGIN.IS_LOGIN}},{\"key\":\"createPackage\",\"value\":function(e){var t=this.packageConfig.get(e);return!!t&&new wt(t,this.tim)}},{\"key\":\"reset\",\"value\":function(){J.warn([\"method: IMController.reset() method must be implemented\"].join())}},{\"key\":\"probeNetwork\",\"value\":function(){return this.tim.netMonitor.probe()}},{\"key\":\"getNetworkType\",\"value\":function(){return this.tim.netMonitor.getNetworkType()}},{\"key\":\"destroy\",\"value\":function(){J.warn(\"destory\")}},{\"key\":\"getPlatform\",\"value\":function(){var e=\"web\";return V?e=\"wechat\":L&&(e=\"wxmp\"),e}}]),e}(),Ut=function(){function e(t,n){o(this,e),this.data=t,this.tim=n,this.defaultData={},Object.assign(this.defaultData,t),this.initGetterAndSetter()}return s(e,[{\"key\":\"initGetterAndSetter\",\"value\":function(){var n=this,o=this.tim,e=function(t,e){Object.defineProperty(n,t,{\"enumerable\":!0,\"configurable\":!0,\"get\":function(){return n.data[t]},\"set\":function(e){n.data[t]=e,n.onChange.bind(n)(o.context,t,e)}})};for(var t in n.data)Object.prototype.hasOwnProperty.call(n.data,t)&&e(t,n.data[t])}},{\"key\":\"onChange\",\"value\":function(e,t,n){this.tim.innerEmitter.emit(Pt.CONTEXT_UPDATED,{\"data\":{\"context\":e,\"key\":t,\"value\":n}})}},{\"key\":\"reset\",\"value\":function(){for(var e in this.data)Object.prototype.hasOwnProperty.call(this.data,e)&&(this.data[e]=this.defaultData.hasOwnProperty(e)?this.defaultData[e]:null);this.tim.innerEmitter.emit(Pt.CONTEXT_RESET,{\"data\":this.tim.context})}}]),e}(),xt=function(e){function t(e){var n;return o(this,t),(n=d(this,p(t).call(this,e)))._initContext(),n._initListener(),n}return l(t,bt),s(t,[{\"key\":\"reset\",\"value\":function(){this.tim.context.reset()}},{\"key\":\"_initListener\",\"value\":function(){this.tim.innerEmitter.on(Pt.SIGN_LOGIN_SUCCESS,this._updateA2KeyAndTinyID,this)}},{\"key\":\"_updateA2KeyAndTinyID\",\"value\":function(e){var t=e.data,n=t.a2Key,o=t.tinyID;this.set(\"a2Key\",n),this.set(\"tinyID\",o),this.tim.innerEmitter.emit(Pt.CONTEXT_A2KEY_AND_TINYID_UPDATED,{\"data\":{\"context\":this.tim.context}}),this.triggerReady()}},{\"key\":\"get\",\"value\":function(e){return this.tim.context[e]}},{\"key\":\"set\",\"value\":function(e,t){this.tim.context[e]=t}},{\"key\":\"_initContext\",\"value\":function(){var e=this.tim.loginInfo;this.tim.context=new Ut({\"login\":we.LOGIN.IS_NOT_LOGIN,\"SDKAppID\":e.SDKAppID,\"appIDAt3rd\":null,\"accountType\":e.accountType,\"identifier\":e.identifier,\"tinyID\":null,\"identifierNick\":e.identifierNick,\"userSig\":e.userSig,\"a2Key\":null,\"contentType\":\"json\",\"apn\":1},this.tim),this.tim.innerEmitter.on(Pt.CONTEXT_UPDATED,this._onContextMemberChange.bind(this))}},{\"key\":\"_onContextMemberChange\",\"value\":function(e){var t=e.data,n=t.key,o=t.value;switch(n){case\"tinyID\":o.length<=0?this.tim.context.login=we.LOGIN.IS_NOT_LOGIN:this.tim.context.login=null!==this.tim.context.a2Key?we.LOGIN.IS_LOGIN:we.LOGIN.IS_NOT_LOGIN;break;case\"a2Key\":o.length<=0?this.tim.context.login=we.LOGIN.IS_NOT_LOGIN:this.tim.context.login=null!==this.tim.context.tinyID?we.LOGIN.IS_LOGIN:we.LOGIN.IS_NOT_LOGIN}}}]),t}(),Ft=function e(t){o(this,e),this.code=0,this.data=t||{}},qt=null,Vt=function(e){qt=e},Kt=function(e){return e instanceof Ft?(J.warn(\"IMPromise.resolve 此函数会自动用options创建IMResponse实例，调用侧不需创建，建议修改！\"),Promise.resolve(e)):Promise.resolve(new Ft(e))},Ht=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e instanceof lt)return t&&null!==qt&&qt.emit(v.ERROR,e),Promise.reject(e);if(e instanceof Error){var n=new lt({\"code\":pt.UNCAUGHT_ERROR,\"message\":e.message});return t&&null!==qt&&qt.emit(v.ERROR,n),Promise.reject(n)}if(se(e)||se(e.code)||se(e.message))J.error(\"IMPromise.reject 必须指定code(错误码)和message(错误信息)!!!\");else{if(te(e.code)&&ne(e.message)){var o=new lt(e);return t&&null!==qt&&qt.emit(v.ERROR,o),Promise.reject(o)}J.error(\"IMPromise.reject code(错误码)必须为数字，message(错误信息)必须为字符串!!!\")}},Bt={\"SDK_READY\":\"sdkReady\",\"LOGIN\":\"login\",\"LONG_POLLING\":\"longpolling\",\"LONG_POLLING_AV\":\"longpollingAV\",\"SEND_MESSAGE\":\"sendMessage\",\"INIT_CONVERSATION_LIST\":\"initConversationList\",\"INIT_GROUP_LIST\":\"initGroupList\",\"UPLOAD\":\"upload\"},Yt=function(){function e(){o(this,e),this.SDKAppID=\"\",this.version=\"\",this.tinyID=\"\",this.userID=\"\",this.platform=\"\",this.method=\"\",this.time=\"\",this.startts=0,this.endts=0,this.timespan=0,this.codeint=0,this.message=\"\",this.text=\"\",this.msgType=\"\",this.networkType=\"\",this.platform=\"\",this._sentFlag=!1}return s(e,[{\"key\":\"setCommonInfo\",\"value\":function(e,t,n,o,r){this.SDKAppID=\"\".concat(e),this.version=\"\".concat(t),this.tinyID=n,this.userID=o,this.platform=r,this.time=ge(),this.startts&&this.endts&&!this.timespan&&(this.timespan=Math.abs(this.endts-this.startts))}},{\"key\":\"setMethod\",\"value\":function(e){return this.method=e,this}},{\"key\":\"setStart\",\"value\":function(){this.startts=Date.now()}},{\"key\":\"setEnd\",\"value\":function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._sentFlag||(this.endts=Date.now(),t?(this._sentFlag=!0,this._eventStatController.pushIn(this)):setTimeout(function(){e._sentFlag=!0,e._eventStatController.pushIn(e)},0))}},{\"key\":\"setError\",\"value\":function(e,t,n){return e instanceof Error?this._sentFlag?this:(this.setNetworkType(n),t?(e.code&&this.setCode(e.code),e.message&&this.setMessage(e.message)):(this.setCode(pt.NO_NETWORK),this.setMessage(ht.NO_NETWORK)),this):(J.warn(\"SSOLogData.setError value not instanceof Error, please check!\"),this)}},{\"key\":\"setCode\",\"value\":function(e){return se(e)||this._sentFlag?this:(te(e)?this.codeint=e:J.warn(\"SSOLogData.setCode value not a number, please check!\"),this)}},{\"key\":\"setMessage\",\"value\":function(e){return se(e)||this._sentFlag?this:ne(e)?(this.message=e,this):this}},{\"key\":\"setText\",\"value\":function(e){return te(e)?this.text=e.toString():ne(e)&&(this.text=e),this}},{\"key\":\"setMessageType\",\"value\":function(e){return this.msgType=e,this}},{\"key\":\"setNetworkType\",\"value\":function(e){return this.networkType=e,this}}],[{\"key\":\"bindController\",\"value\":function(t){e.prototype._eventStatController=t}}]),e}(),jt={\"SDK_CONSTRUCT\":\"sdkConstruct\",\"SDK_READY\":\"sdkReady\",\"ACCESS_LAYER\":\"accessLayer\",\"LOGIN\":\"login\",\"CREATE_TEXT_MESSAGE\":\"createTextMessage\",\"CREATE_IMAGE_MESSAGE\":\"createImageMessage\",\"CREATE_AUDIO_MESSAGE\":\"createAudioMessage\",\"CREATE_VIDEO_MESSAGE\":\"createVideoMessage\",\"CREATE_FILE_MESSAGE\":\"createFileMessage\",\"CREATE_CUSTOM_MESSAGE\":\"createCustomMessage\",\"UPLOAD\":\"upload\",\"SEND_MESSAGE\":\"sendMessage\",\"GET_MESSAGE_LIST\":\"getMessageList\",\"REVOKE_MESSAGE\":\"revokeMessage\",\"GET_CONVERSATION_LIST\":\"getConversationList\",\"GET_CONVERSATION_LIST_IN_STORAGE\":\"getConversationListInStorage\",\"SYNC_CONVERSATION_LIST\":\"syncConversationList\",\"CREATE_GROUP\":\"createGroup\",\"APPLY_JOIN_GROUP\":\"applyJoinGroup\",\"QUIT_GROUP\":\"quitGroup\",\"CHANGE_GROUP_OWNER\":\"changeGroupOwner\",\"DISMISS_GROUP\":\"dismissGroup\",\"UPDATE_GROUP_PROFILE\":\"updateGroupProfile\",\"GET_GROUP_LIST\":\"getGroupList\",\"GET_GROUP_LIST_IN_STORAGE\":\"getGroupListInStorage\",\"SET_GROUPMEMBER_MUTE_TIME\":\"setGroupMemberMuteTime\",\"SET_GROUPMEMBER_NAME_CARD\":\"setGroupMemberNameCard\",\"SET_GROUPMEMBER_ROLE\":\"setGroupMemberRole\",\"SET_GROUPMEMBER_CUSTOM_FIELD\":\"setGroupMemberCustomField\",\"SYNC_MESSAGE\":\"syncMessage\",\"GET_LONGPOLL_ID\":\"getLongPollID\",\"LONG_POLLING_ERROR\":\"longPollingError\",\"LONG_POLLING_AV_ERROR\":\"longPollingAVError\",\"GET_USER_PROFILE\":\"getUserProfile\",\"GET_BLACKLIST\":\"getBlacklist\",\"MP_HIDE_TO_SHOW\":\"mpHideToShow\"},Jt=function(e){function r(e){var t;return o(this,r),(t=d(this,p(r).call(this,e)))._initializeListener(),t}return l(r,bt),s(r,[{\"key\":\"login\",\"value\":function(e){if(this._isLogin()){var t=\"您已经登录账号\".concat(e.identifier,\"！如需切换账号登录，请先调用 logout 接口登出，再调用 login 接口登录。\");return J.warn(t),Kt(new Ft({\"actionStatus\":\"OK\",\"errorCode\":0,\"errorInfo\":t}))}J.log(\"SignController.login userID=\",e.identifier),J.time(Bt.LOGIN);var n=this._checkLoginInfo(e);return Ne(n)?(this.tim.context.identifier=e.identifier,this.tim.context.userSig=e.userSig,this.tim.context.SDKAppID=e.SDKAppID,this.tim.context.accountType=e.accountType,this.tim.context.identifier&&this.tim.context.userSig?(this.tim.innerEmitter.emit(Pt.SIGN_LOGIN),this._accessLayer()):void 0):Ht(n)}},{\"key\":\"_isLogin\",\"value\":function(){return!!this.tim.context.a2Key}},{\"key\":\"_isLoginCurrentUser\",\"value\":function(e){return this.tim.context.identifier===e}},{\"key\":\"_initializeListener\",\"value\":function(){this.innerEmitter.on(Pt.NOTICE_LONGPOLL_KICKED_OUT,this._onKickedOut,this),this.innerEmitter.on(Pt.NOTICE_LONGPOLL_MUTIPLE_DEVICE_KICKED_OUT,this._onMultipleDeviceKickedOut,this),this.innerEmitter.on(Pt.SIGN_A2KEY_EXPIRED,this._onUserSigExpired,this)}},{\"key\":\"_accessLayer\",\"value\":function(){var o=this,r=new Yt;r.setMethod(jt.ACCESS_LAYER).setStart(),J.log(\"SignController._accessLayer.\");var e=this.createPackage({\"name\":\"accessLayer\",\"action\":\"query\"});return this.tim.connectionController.request(e).then(function(e){return r.setCode(0).setNetworkType(o.getNetworkType()).setText(e.data.webImAccessLayer).setEnd(),J.log(\"SignController._accessLayer ok. webImAccessLayer=\",e.data.webImAccessLayer),1===e.data.webImAccessLayer&&Nt.HOST.setCurrent(e.data.webImAccessLayer),o._login()}).catch(function(n){return o.probeNetwork().then(function(e,t){r.setError(n,e,t).setEnd(!0),o.tim.eventStatController.reportAtOnce()}),J.error(\"SignController._accessLayer error:\",n),Ht(n)})}},{\"key\":\"_login\",\"value\":function(){var o=this,r=new Yt;r.setMethod(jt.LOGIN).setStart();var e=this.createPackage({\"name\":\"login\",\"action\":\"query\"});return this.connectionController.request(e).then(function(e){var t=null;if(!e.data.tinyID)throw t=new lt({\"code\":pt.NO_TINYID,\"message\":ht.NO_TINYID}),r.setError(t,!0,o.getNetworkType()).setEnd(),t;if(!e.data.a2Key)throw t=new lt({\"code\":pt.NO_A2KEY,\"message\":ht.NO_A2KEY}),r.setError(t,!0,o.getNetworkType()).setEnd(),t;return r.setCode(0).setNetworkType(o.getNetworkType()).setText(\"\".concat(o.tim.loginInfo.identifier)).setEnd(),J.log(\"SignController.login ok. userID=\".concat(o.tim.loginInfo.identifier,\" loginCost=\").concat(J.timeEnd(Bt.LOGIN),\"ms\")),o.tim.innerEmitter.emit(Pt.SIGN_LOGIN_SUCCESS,{\"data\":{\"a2Key\":e.data.a2Key,\"tinyID\":e.data.tinyID}}),Kt(e.data)}).catch(function(n){return o.probeNetwork().then(function(e,t){r.setError(n,e,t).setEnd(!0)}),J.error(\"SignController.login error:\",n),Ht(n)})}},{\"key\":\"logout\",\"value\":function(){return J.info(\"SignController.logout\"),this.tim.innerEmitter.emit(Pt.SIGN_LOGOUT_EXECUTING),this._logout(Je).then(this._emitLogoutSuccess.bind(this)).catch(this._emitLogoutSuccess.bind(this))}},{\"key\":\"_logout\",\"value\":function(e){var t=this.tim.notificationController,n=e===Xe?\"logout\":\"longPollLogout\",o=e===Xe?{\"name\":n,\"action\":\"query\"}:{\"name\":n,\"action\":\"query\",\"param\":{\"longPollID\":t.getLongPollID()}},r=this.createPackage(o);return this.connectionController.request(r).catch(function(e){return J.error(\"SignController._logout error:\",e),Ht(e)})}},{\"key\":\"_checkLoginInfo\",\"value\":function(e){var t=0,n=\"\";return null===e.SDKAppID?(t=pt.NO_SDKAPPID,n=ht.NO_SDKAPPID):null===e.accountType?(t=pt.NO_ACCOUNT_TYPE,n=ht.NO_ACCOUNT_TYPE):null===e.identifier?(t=pt.NO_IDENTIFIER,n=ht.NO_IDENTIFIER):null===e.userSig&&(t=pt.NO_USERSIG,n=ht.NO_USERSIG),Ne(t)||Ne(n)?{}:{\"code\":t,\"message\":n}}},{\"key\":\"_emitLogoutSuccess\",\"value\":function(){return this.tim.innerEmitter.emit(Pt.SIGN_LOGOUT_SUCCESS),Kt({})}},{\"key\":\"_onKickedOut\",\"value\":function(){var e=this;J.warn(\"SignController._onKickedOut kicked out. userID=\".concat(this.tim.loginInfo.identifier)),this.tim.logout().then(function(){e.tim.outerEmitter.emit(v.KICKED_OUT,{\"type\":S.KICKED_OUT_MULT_ACCOUNT})})}},{\"key\":\"_onMultipleDeviceKickedOut\",\"value\":function(){var e=this;J.warn(\"SignController._onMultipleDeviceKickedOut kicked out. userID=\".concat(this.tim.loginInfo.identifier)),this.tim.logout().then(function(){e.tim.outerEmitter.emit(v.KICKED_OUT,{\"type\":S.KICKED_OUT_MULT_DEVICE})})}},{\"key\":\"_onUserSigExpired\",\"value\":function(){J.warn(\"SignController._onUserSigExpired: userSig 签名过期被踢下线\"),this.tim.outerEmitter.emit(v.KICKED_OUT,{\"type\":S.KICKED_OUT_USERSIG_EXPIRED}),this.tim.resetSDK()}},{\"key\":\"reset\",\"value\":function(){J.info(\"SignController.reset\")}}]),r}(),Zt=function(n,o){return function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];return n.apply(o,e)}},tn=Object.prototype.toString;function Wt(e){return\"[object Array]\"===tn.call(e)}function $t(e){return null!==e&&\"object\"==typeof e}function zt(e){return\"[object Function]\"===tn.call(e)}function Xt(e,t){if(null!=e)if(\"object\"!=typeof e&&(e=[e]),Wt(e))for(var n=0,o=e.length;n<o;n++)t.call(null,e[n],n,e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.call(null,e[r],r,e)}var nn={\"isArray\":Wt,\"isArrayBuffer\":function(e){return\"[object ArrayBuffer]\"===tn.call(e)},\"isBuffer\":function(e){return null!=e&&null!=e.constructor&&\"function\"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},\"isFormData\":function(e){return\"undefined\"!=typeof FormData&&e instanceof FormData},\"isArrayBufferView\":function(e){return\"undefined\"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},\"isString\":function(e){return\"string\"==typeof e},\"isNumber\":function(e){return\"number\"==typeof e},\"isObject\":$t,\"isUndefined\":function(e){return void 0===e},\"isDate\":function(e){return\"[object Date]\"===tn.call(e)},\"isFile\":function(e){return\"[object File]\"===tn.call(e)},\"isBlob\":function(e){return\"[object Blob]\"===tn.call(e)},\"isFunction\":zt,\"isStream\":function(e){return $t(e)&&zt(e.pipe)},\"isURLSearchParams\":function(e){return\"undefined\"!=typeof URLSearchParams&&e instanceof URLSearchParams},\"isStandardBrowserEnv\":function(){return(\"undefined\"==typeof navigator||\"ReactNative\"!==navigator.product&&\"NativeScript\"!==navigator.product&&\"NS\"!==navigator.product)&&(\"undefined\"!=typeof window&&\"undefined\"!=typeof document)},\"forEach\":Xt,\"merge\":function e(){var o={};function n(t,n){\"object\"==typeof o[n]&&\"object\"==typeof t?o[n]=e(o[n],t):o[n]=t}for(var t=0,r=arguments.length;t<r;t++)Xt(arguments[t],n);return o},\"deepMerge\":function e(){var o={};function n(t,n){\"object\"==typeof o[n]&&\"object\"==typeof t?o[n]=e(o[n],t):o[n]=\"object\"==typeof t?e({},t):t}for(var t=0,r=arguments.length;t<r;t++)Xt(arguments[t],n);return o},\"extend\":function(n,e,o){return Xt(e,function(e,t){n[t]=o&&\"function\"==typeof e?Zt(e,o):e}),n},\"trim\":function(e){return e.replace(/^\\s*/,\"\").replace(/\\s*$/,\"\")}};function Qt(e){return encodeURIComponent(e).replace(/%40/gi,\"@\").replace(/%3A/gi,\":\").replace(/%24/g,\"$\").replace(/%2C/gi,\",\").replace(/%20/g,\"+\").replace(/%5B/gi,\"[\").replace(/%5D/gi,\"]\")}var rn=function(e,t,n){if(!t)return e;var o;if(n)o=n(t);else if(nn.isURLSearchParams(t))o=t.toString();else{var r=[];nn.forEach(t,function(e,t){null!=e&&(nn.isArray(e)?t+=\"[]\":e=[e],nn.forEach(e,function(e){nn.isDate(e)?e=e.toISOString():nn.isObject(e)&&(e=JSON.stringify(e)),r.push(Qt(t)+\"=\"+Qt(e))}))}),o=r.join(\"&\")}if(o){var i=e.indexOf(\"#\");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf(\"?\")?\"?\":\"&\")+o}return e};function en(){this.handlers=[]}en.prototype.use=function(e,t){return this.handlers.push({\"fulfilled\":e,\"rejected\":t}),this.handlers.length-1},en.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},en.prototype.forEach=function(t){nn.forEach(this.handlers,function(e){null!==e&&t(e)})};var an=en,un=function(t,n,e){return nn.forEach(e,function(e){t=e(t,n)}),t},ln=function(e){return!(!e||!e.__CANCEL__)};function on(){throw new Error(\"setTimeout has not been defined\")}function sn(){throw new Error(\"clearTimeout has not been defined\")}var pn=on,hn=sn;function cn(t){if(pn===setTimeout)return setTimeout(t,0);if((pn===on||!pn)&&setTimeout)return pn=setTimeout,setTimeout(t,0);try{return pn(t,0)}catch(e){try{return pn.call(null,t,0)}catch(e){return pn.call(this,t,0)}}}\"function\"==typeof K.setTimeout&&(pn=setTimeout),\"function\"==typeof K.clearTimeout&&(hn=clearTimeout);var fn,yn=[],En=!1,vn=-1;function gn(){En&&fn&&(En=!1,fn.length?yn=fn.concat(yn):vn=-1,yn.length&&_n())}function _n(){if(!En){var e=cn(gn);En=!0;for(var t=yn.length;t;){for(fn=yn,yn=[];++vn<t;)fn&&fn[vn].run();vn=-1,t=yn.length}fn=null,En=!1,function(t){if(hn===clearTimeout)return clearTimeout(t);if((hn===sn||!hn)&&clearTimeout)return hn=clearTimeout,clearTimeout(t);try{hn(t)}catch(e){try{return hn.call(null,t)}catch(e){return hn.call(this,t)}}}(e)}}function dn(e,t){this.fun=e,this.array=t}function mn(){}dn.prototype.run=function(){this.fun.apply(null,this.array)};var In=mn,Sn=mn,Cn=mn,Tn=mn,Mn=mn,On=mn,Dn=mn,Nn=K.performance||{},An=Nn.now||Nn.mozNow||Nn.msNow||Nn.oNow||Nn.webkitNow||function(){return(new Date).getTime()},Ln=new Date,Rn={\"nextTick\":function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];yn.push(new dn(e,t)),1!==yn.length||En||cn(_n)},\"title\":\"browser\",\"browser\":!0,\"env\":{},\"argv\":[],\"version\":\"\",\"versions\":{},\"on\":In,\"addListener\":Sn,\"once\":Cn,\"off\":Tn,\"removeListener\":Mn,\"removeAllListeners\":On,\"emit\":Dn,\"binding\":function(e){throw new Error(\"process.binding is not supported\")},\"cwd\":function(){return\"/\"},\"chdir\":function(e){throw new Error(\"process.chdir is not supported\")},\"umask\":function(){return 0},\"hrtime\":function(e){var t=.001*An.call(Nn),n=Math.floor(t),o=Math.floor(t%1*1e9);return e&&(n-=e[0],(o-=e[1])<0&&(n--,o+=1e9)),[n,o]},\"platform\":\"browser\",\"release\":{},\"config\":{},\"uptime\":function(){return(new Date-Ln)/1e3}},Gn=function(n,o){nn.forEach(n,function(e,t){t!==o&&t.toUpperCase()===o.toUpperCase()&&(n[o]=e,delete n[t])})},Pn=function(e,t,n,o,r){return function(e,t,n,o,r){return e.config=t,n&&(e.code=n),e.request=o,e.response=r,e.isAxiosError=!0,e.toJSON=function(){return{\"message\":this.message,\"name\":this.name,\"description\":this.description,\"number\":this.number,\"fileName\":this.fileName,\"lineNumber\":this.lineNumber,\"columnNumber\":this.columnNumber,\"stack\":this.stack,\"config\":this.config,\"code\":this.code}},e}(new Error(e),t,n,o,r)},kn=[\"age\",\"authorization\",\"content-length\",\"content-type\",\"etag\",\"expires\",\"from\",\"host\",\"if-modified-since\",\"if-unmodified-since\",\"last-modified\",\"location\",\"max-forwards\",\"proxy-authorization\",\"referer\",\"retry-after\",\"user-agent\"],wn=nn.isStandardBrowserEnv()?function(){var n,o=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement(\"a\");function r(e){var t=e;return o&&(i.setAttribute(\"href\",t),t=i.href),i.setAttribute(\"href\",t),{\"href\":i.href,\"protocol\":i.protocol?i.protocol.replace(/:$/,\"\"):\"\",\"host\":i.host,\"search\":i.search?i.search.replace(/^\\?/,\"\"):\"\",\"hash\":i.hash?i.hash.replace(/^#/,\"\"):\"\",\"hostname\":i.hostname,\"port\":i.port,\"pathname\":\"/\"===i.pathname.charAt(0)?i.pathname:\"/\"+i.pathname}}return n=r(window.location.href),function(e){var t=nn.isString(e)?r(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0},Un=nn.isStandardBrowserEnv()?{\"write\":function(e,t,n,o,r,i){var s=[];s.push(e+\"=\"+encodeURIComponent(t)),nn.isNumber(n)&&s.push(\"expires=\"+new Date(n).toGMTString()),nn.isString(o)&&s.push(\"path=\"+o),nn.isString(r)&&s.push(\"domain=\"+r),!0===i&&s.push(\"secure\"),document.cookie=s.join(\"; \")},\"read\":function(e){var t=document.cookie.match(new RegExp(\"(^|;\\\\s*)(\"+e+\")=([^;]*)\"));return t?decodeURIComponent(t[3]):null},\"remove\":function(e){this.write(e,\"\",Date.now()-864e5)}}:{\"write\":function(){},\"read\":function(){return null},\"remove\":function(){}},Fn=function(l){return new Promise(function(a,u){var n=l.data,o=l.headers;nn.isFormData(n)&&delete o[\"Content-Type\"];var c=new XMLHttpRequest;if(l.auth){var e=l.auth.username||\"\",t=l.auth.password||\"\";o.Authorization=\"Basic \"+btoa(e+\":\"+t)}if(c.open(l.method.toUpperCase(),rn(l.url,l.params,l.paramsSerializer),!0),c.timeout=l.timeout,c.onreadystatechange=function(){if(c&&4===c.readyState&&(0!==c.status||c.responseURL&&0===c.responseURL.indexOf(\"file:\"))){var e,t,n,o,r,i=\"getAllResponseHeaders\"in c?(e=c.getAllResponseHeaders(),r={},e?(nn.forEach(e.split(\"\\n\"),function(e){if(o=e.indexOf(\":\"),t=nn.trim(e.substr(0,o)).toLowerCase(),n=nn.trim(e.substr(o+1)),t){if(r[t]&&kn.indexOf(t)>=0)return;r[t]=\"set-cookie\"===t?(r[t]?r[t]:[]).concat([n]):r[t]?r[t]+\", \"+n:n}}),r):r):null,s={\"data\":l.responseType&&\"text\"!==l.responseType?c.response:c.responseText,\"status\":c.status,\"statusText\":c.statusText,\"headers\":i,\"config\":l,\"request\":c};!function(e,t,n){var o=n.config.validateStatus;!o||o(n.status)?e(n):t(Pn(\"Request failed with status code \"+n.status,n.config,null,n.request,n))}(a,u,s),c=null}},c.onabort=function(){c&&(u(Pn(\"Request aborted\",l,\"ECONNABORTED\",c)),c=null)},c.onerror=function(){u(Pn(\"Network Error\",l,null,c)),c=null},c.ontimeout=function(){u(Pn(\"timeout of \"+l.timeout+\"ms exceeded\",l,\"ECONNABORTED\",c)),c=null},nn.isStandardBrowserEnv()){var r=Un,i=(l.withCredentials||wn(l.url))&&l.xsrfCookieName?r.read(l.xsrfCookieName):void 0;i&&(o[l.xsrfHeaderName]=i)}if(\"setRequestHeader\"in c&&nn.forEach(o,function(e,t){void 0===n&&\"content-type\"===t.toLowerCase()?delete o[t]:c.setRequestHeader(t,e)}),l.withCredentials&&(c.withCredentials=!0),l.responseType)try{c.responseType=l.responseType}catch(e){if(\"json\"!==l.responseType)throw e}\"function\"==typeof l.onDownloadProgress&&c.addEventListener(\"progress\",l.onDownloadProgress),\"function\"==typeof l.onUploadProgress&&c.upload&&c.upload.addEventListener(\"progress\",l.onUploadProgress),l.cancelToken&&l.cancelToken.promise.then(function(e){c&&(c.abort(),u(e),c=null)}),void 0===n&&(n=null),c.send(n)})},qn={\"Content-Type\":\"application/x-www-form-urlencoded\"};function bn(e,t){!nn.isUndefined(e)&&nn.isUndefined(e[\"Content-Type\"])&&(e[\"Content-Type\"]=t)}var Vn,Kn={\"adapter\":(void 0!==Rn&&\"[object process]\"===Object.prototype.toString.call(Rn)?Vn=Fn:\"undefined\"!=typeof XMLHttpRequest&&(Vn=Fn),Vn),\"transformRequest\":[function(e,t){return Gn(t,\"Accept\"),Gn(t,\"Content-Type\"),nn.isFormData(e)||nn.isArrayBuffer(e)||nn.isBuffer(e)||nn.isStream(e)||nn.isFile(e)||nn.isBlob(e)?e:nn.isArrayBufferView(e)?e.buffer:nn.isURLSearchParams(e)?(bn(t,\"application/x-www-form-urlencoded;charset=utf-8\"),e.toString()):nn.isObject(e)?(bn(t,\"application/json;charset=utf-8\"),JSON.stringify(e)):e}],\"transformResponse\":[function(e){if(\"string\"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],\"timeout\":0,\"xsrfCookieName\":\"XSRF-TOKEN\",\"xsrfHeaderName\":\"X-XSRF-TOKEN\",\"maxContentLength\":-1,\"validateStatus\":function(e){return e>=200&&e<300},\"headers\":{\"common\":{\"Accept\":\"application/json, text/plain, */*\"}}};nn.forEach([\"delete\",\"get\",\"head\"],function(e){Kn.headers[e]={}}),nn.forEach([\"post\",\"put\",\"patch\"],function(e){Kn.headers[e]=nn.merge(qn)});var Bn=Kn;function xn(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var jn=function(t){var e,n,o;return xn(t),t.baseURL&&(o=t.url,!/^([a-z][a-z\\d\\+\\-\\.]*:)?\\/\\//i.test(o))&&(t.url=(e=t.baseURL,(n=t.url)?e.replace(/\\/+$/,\"\")+\"/\"+n.replace(/^\\/+/,\"\"):e)),t.headers=t.headers||{},t.data=un(t.data,t.headers,t.transformRequest),t.headers=nn.merge(t.headers.common||{},t.headers[t.method]||{},t.headers||{}),nn.forEach([\"delete\",\"get\",\"head\",\"post\",\"put\",\"patch\",\"common\"],function(e){delete t.headers[e]}),(t.adapter||Bn.adapter)(t).then(function(e){return xn(t),e.data=un(e.data,e.headers,t.transformResponse),e},function(e){return ln(e)||(xn(t),e&&e.response&&(e.response.data=un(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)})},$n=function(t,n){n=n||{};var o={};return nn.forEach([\"url\",\"method\",\"params\",\"data\"],function(e){void 0!==n[e]&&(o[e]=n[e])}),nn.forEach([\"headers\",\"auth\",\"proxy\"],function(e){nn.isObject(n[e])?o[e]=nn.deepMerge(t[e],n[e]):void 0!==n[e]?o[e]=n[e]:nn.isObject(t[e])?o[e]=nn.deepMerge(t[e]):void 0!==t[e]&&(o[e]=t[e])}),nn.forEach([\"baseURL\",\"transformRequest\",\"transformResponse\",\"paramsSerializer\",\"timeout\",\"withCredentials\",\"adapter\",\"responseType\",\"xsrfCookieName\",\"xsrfHeaderName\",\"onUploadProgress\",\"onDownloadProgress\",\"maxContentLength\",\"validateStatus\",\"maxRedirects\",\"httpAgent\",\"httpsAgent\",\"cancelToken\",\"socketPath\"],function(e){void 0!==n[e]?o[e]=n[e]:void 0!==t[e]&&(o[e]=t[e])}),o};function Hn(e){this.defaults=e,this.interceptors={\"request\":new an,\"response\":new an}}Hn.prototype.request=function(e){\"string\"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=$n(this.defaults,e)).method=e.method?e.method.toLowerCase():\"get\";var t=[jn,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)n=n.then(t.shift(),t.shift());return n},Hn.prototype.getUri=function(e){return e=$n(this.defaults,e),rn(e.url,e.params,e.paramsSerializer).replace(/^\\?/,\"\")},nn.forEach([\"delete\",\"get\",\"head\",\"options\"],function(n){Hn.prototype[n]=function(e,t){return this.request(nn.merge(t||{},{\"method\":n,\"url\":e}))}}),nn.forEach([\"post\",\"put\",\"patch\"],function(o){Hn.prototype[o]=function(e,t,n){return this.request(nn.merge(n||{},{\"method\":o,\"url\":e,\"data\":t}))}});var Xn=Hn;function Yn(e){this.message=e}Yn.prototype.toString=function(){return\"Cancel\"+(this.message?\": \"+this.message:\"\")},Yn.prototype.__CANCEL__=!0;var Jn=Yn;function Wn(e){if(\"function\"!=typeof e)throw new TypeError(\"executor must be a function.\");var t;this.promise=new Promise(function(e){t=e});var n=this;e(function(e){n.reason||(n.reason=new Jn(e),t(n.reason))})}Wn.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Wn.source=function(){var t;return{\"token\":new Wn(function(e){t=e}),\"cancel\":t}};var Qn=Wn;function zn(e){var t=new Xn(e),n=Zt(Xn.prototype.request,t);return nn.extend(n,Xn.prototype,t),nn.extend(n,t),n}var Zn=zn(Bn);Zn.Axios=Xn,Zn.create=function(e){return zn($n(Zn.defaults,e))},Zn.Cancel=Jn,Zn.CancelToken=Qn,Zn.isCancel=ln,Zn.all=function(e){return Promise.all(e)},Zn.spread=function(t){return function(e){return t.apply(null,e)}};var eo=Zn,to=Zn;eo.default=to;var no=eo,oo=no.create({\"timeout\":6e3,\"headers\":{\"Content-Type\":\"application/x-www-form-urlencoded;charset=UTF-8\"}});oo.interceptors.response.use(function(e){var t=e.data,n=t.error_code,o=t.ErrorCode;return te(n)&&(o=n),o!==we.REQUEST.SUCCESS&&(e.data.ErrorCode=Number(o)),e},function(e){return\"Network Error\"===e.message&&(!0===oo.defaults.withCredentials&&J.warn(\"Network Error, try to close `IMAxios.defaults.withCredentials` to false. (IMAxios.js)\"),oo.defaults.withCredentials=!1),Promise.reject(e)});var ro=function(){function e(){o(this,e)}return s(e,[{\"key\":\"request\",\"value\":function(e){console.warn(\"请注意： ConnectionBase.request() 方法必须被派生类重写:\"),console.log(\"参数如下：\\n    * @param {String} options.url string 是 开发者服务器接口地址\\n    * @param {*} options.data - string/object/ArrayBuffer 否 请求的参数\\n    * @param {Object} options.header - Object 否 设置请求的 header，\\n    * @param {String} options.method - string GET 否 HTTP 请求方法\\n    * @param {String} options.dataType - string json 否 返回的数据格式\\n    * @param {String} options.responseType - string text 否 响应的数据类型\\n    * @param {Boolean} isRetry - string text false 是否为重试的请求\\n   \")}},{\"key\":\"_checkOptions\",\"value\":function(e){if(!1==!!e.url)throw new lt({\"code\":pt.NETWORK_BASE_OPTIONS_NO_URL,\"message\":ht.NETWORK_BASE_OPTIONS_NO_URL})}},{\"key\":\"_initOptions\",\"value\":function(e){e.method=[\"POST\",\"GET\",\"PUT\",\"DELETE\",\"OPTION\"].indexOf(e.method)>=0?e.method:\"POST\",e.dataType=e.dataType||\"json\",e.responseType=e.responseType||\"json\"}}]),e}(),io=function(e){function t(){var e;return o(this,t),(e=d(this,p(t).call(this))).retry=2,e}return l(t,ro),s(t,[{\"key\":\"request\",\"value\":function(e){return this._checkOptions(e),this._initOptions(e),this._requestWithRetry({\"url\":e.url,\"data\":e.data,\"method\":e.method})}},{\"key\":\"_requestWithRetry\",\"value\":function(t){var n=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return oo(t).catch(function(e){return n.retry&&o<n.retry?n._requestWithRetry(t,++o):Ht(new lt({\"code\":e.code||\"\",\"message\":e.message||\"\"}))})}}]),t}(),so=[],ao=[],uo=\"undefined\"!=typeof Uint8Array?Uint8Array:Array,co=!1;function ar(){co=!0;for(var e=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",t=0,n=e.length;t<n;++t)so[t]=e[t],ao[e.charCodeAt(t)]=t;ao[\"-\".charCodeAt(0)]=62,ao[\"_\".charCodeAt(0)]=63}function ur(e,t,n){for(var o,r,i=[],s=t;s<n;s+=3)o=(e[s]<<16)+(e[s+1]<<8)+e[s+2],i.push(so[(r=o)>>18&63]+so[r>>12&63]+so[r>>6&63]+so[63&r]);return i.join(\"\")}function cr(e){var t;co||ar();for(var n=e.length,o=n%3,r=\"\",i=[],s=0,a=n-o;s<a;s+=16383)i.push(ur(e,s,s+16383>a?a:s+16383));return 1===o?(t=e[n-1],r+=so[t>>2],r+=so[t<<4&63],r+=\"==\"):2===o&&(t=(e[n-2]<<8)+e[n-1],r+=so[t>>10],r+=so[t>>4&63],r+=so[t<<2&63],r+=\"=\"),i.push(r),i.join(\"\")}function lr(e,t,n,o,r){var i,s,a=8*r-o-1,u=(1<<a)-1,c=u>>1,l=-7,p=n?r-1:0,h=n?-1:1,_=e[t+p];for(p+=h,i=_&(1<<-l)-1,_>>=-l,l+=a;l>0;i=256*i+e[t+p],p+=h,l-=8);for(s=i&(1<<-l)-1,i>>=-l,l+=o;l>0;s=256*s+e[t+p],p+=h,l-=8);if(0===i)i=1-c;else{if(i===u)return s?NaN:Infinity*(_?-1:1);s+=Math.pow(2,o),i-=c}return(_?-1:1)*s*Math.pow(2,i-o)}function pr(e,t,n,o,r,i){var s,a,u,c=8*i-r-1,l=(1<<c)-1,p=l>>1,h=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,_=o?0:i-1,d=o?1:-1,f=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||Infinity===t?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+p>=1?h/u:h*Math.pow(2,1-p))*u>=2&&(s++,u/=2),s+p>=l?(a=0,s=l):s+p>=1?(a=(t*u-1)*Math.pow(2,r),s+=p):(a=t*Math.pow(2,p-1)*Math.pow(2,r),s=0));r>=8;e[n+_]=255&a,_+=d,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;e[n+_]=255&s,_+=d,s/=256,c-=8);e[n+_-d]|=128*f}var lo={}.toString,po=Array.isArray||function(e){return\"[object Array]\"==lo.call(e)};function gr(){return dr.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function _r(e,t){if(gr()<t)throw new RangeError(\"Invalid typed array length\");return dr.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=dr.prototype:(null===e&&(e=new dr(t)),e.length=t),e}function dr(e,t,n){if(!(dr.TYPED_ARRAY_SUPPORT||this instanceof dr))return new dr(e,t,n);if(\"number\"==typeof e){if(\"string\"==typeof t)throw new Error(\"If encoding is specified then the first argument must be a string\");return yr(this,e)}return mr(this,e,t,n)}function mr(e,t,n,o){if(\"number\"==typeof t)throw new TypeError('\"value\" argument must not be a number');return\"undefined\"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,o){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError(\"'offset' is out of bounds\");if(t.byteLength<n+(o||0))throw new RangeError(\"'length' is out of bounds\");t=void 0===n&&void 0===o?new Uint8Array(t):void 0===o?new Uint8Array(t,n):new Uint8Array(t,n,o);dr.TYPED_ARRAY_SUPPORT?(e=t).__proto__=dr.prototype:e=vr(e,t);return e}(e,t,n,o):\"string\"==typeof t?function(e,t,n){\"string\"==typeof n&&\"\"!==n||(n=\"utf8\");if(!dr.isEncoding(n))throw new TypeError('\"encoding\" must be a valid string encoding');var o=0|Cr(t,n),r=(e=_r(e,o)).write(t,n);r!==o&&(e=e.slice(0,r));return e}(e,t,n):function(e,t){if(Sr(t)){var n=0|Ir(t.length);return 0===(e=_r(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if(\"undefined\"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||\"length\"in t)return\"number\"!=typeof t.length||(o=t.length)!=o?_r(e,0):vr(e,t);if(\"Buffer\"===t.type&&po(t.data))return vr(e,t.data)}var o;throw new TypeError(\"First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.\")}(e,t)}function Er(e){if(\"number\"!=typeof e)throw new TypeError('\"size\" argument must be a number');if(e<0)throw new RangeError('\"size\" argument must not be negative')}function yr(e,t){if(Er(t),e=_r(e,t<0?0:0|Ir(t)),!dr.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function vr(e,t){var n=t.length<0?0:0|Ir(t.length);e=_r(e,n);for(var o=0;o<n;o+=1)e[o]=255&t[o];return e}function Ir(e){if(e>=gr())throw new RangeError(\"Attempt to allocate Buffer larger than maximum size: 0x\"+gr().toString(16)+\" bytes\");return 0|e}function Sr(e){return!(null==e||!e._isBuffer)}function Cr(e,t){if(Sr(e))return e.length;if(\"undefined\"!=typeof ArrayBuffer&&\"function\"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;\"string\"!=typeof e&&(e=\"\"+e);var n=e.length;if(0===n)return 0;for(var o=!1;;)switch(t){case\"ascii\":case\"latin1\":case\"binary\":return n;case\"utf8\":case\"utf-8\":case void 0:return Xr(e).length;case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return 2*n;case\"hex\":return n>>>1;case\"base64\":return Jr(e).length;default:if(o)return Xr(e).length;t=(\"\"+t).toLowerCase(),o=!0}}function Tr(e,t,n){var o=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return\"\";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return\"\";if((n>>>=0)<=(t>>>=0))return\"\";for(e||(e=\"utf8\");;)switch(e){case\"hex\":return qr(this,t,n);case\"utf8\":case\"utf-8\":return wr(this,t,n);case\"ascii\":return Ur(this,t,n);case\"latin1\":case\"binary\":return Fr(this,t,n);case\"base64\":return kr(this,t,n);case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return xr(this,t,n);default:if(o)throw new TypeError(\"Unknown encoding: \"+e);e=(e+\"\").toLowerCase(),o=!0}}function Mr(e,t,n){var o=e[t];e[t]=e[n],e[n]=o}function Or(e,t,n,o,r){if(0===e.length)return-1;if(\"string\"==typeof n?(o=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if(\"string\"==typeof t&&(t=dr.from(t,o)),Sr(t))return 0===t.length?-1:Dr(e,t,n,o,r);if(\"number\"==typeof t)return t&=255,dr.TYPED_ARRAY_SUPPORT&&\"function\"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):Dr(e,[t],n,o,r);throw new TypeError(\"val must be string, number or Buffer\")}function Dr(e,t,n,o,r){var i,s=1,a=e.length,u=t.length;if(void 0!==o&&(\"ucs2\"===(o=String(o).toLowerCase())||\"ucs-2\"===o||\"utf16le\"===o||\"utf-16le\"===o)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,n/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(r){var l=-1;for(i=n;i<a;i++)if(c(e,i)===c(t,-1===l?0:i-l)){if(-1===l&&(l=i),i-l+1===u)return l*s}else-1!==l&&(i-=i-l),l=-1}else for(n+u>a&&(n=a-u),i=n;i>=0;i--){for(var p=!0,h=0;h<u;h++)if(c(e,i+h)!==c(t,h)){p=!1;break}if(p)return i}return-1}function Nr(e,t,n,o){n=Number(n)||0;var r=e.length-n;o?(o=Number(o))>r&&(o=r):o=r;var i=t.length;if(i%2!=0)throw new TypeError(\"Invalid hex string\");o>i/2&&(o=i/2);for(var s=0;s<o;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function Ar(e,t,n,o){return Qr(Xr(t,e.length-n),e,n,o)}function Lr(e,t,n,o){return Qr(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,o)}function Rr(e,t,n,o){return Lr(e,t,n,o)}function Gr(e,t,n,o){return Qr(Jr(t),e,n,o)}function Pr(e,t,n,o){return Qr(function(e,t){for(var n,o,r,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),o=n>>8,r=n%256,i.push(r),i.push(o);return i}(t,e.length-n),e,n,o)}function kr(e,t,n){return 0===t&&n===e.length?cr(e):cr(e.slice(t,n))}function wr(e,t,n){n=Math.min(e.length,n);for(var o=[],r=t;r<n;){var i,s,a,u,c=e[r],l=null,p=c>239?4:c>223?3:c>191?2:1;if(r+p<=n)switch(p){case 1:c<128&&(l=c);break;case 2:128==(192&(i=e[r+1]))&&(u=(31&c)<<6|63&i)>127&&(l=u);break;case 3:i=e[r+1],s=e[r+2],128==(192&i)&&128==(192&s)&&(u=(15&c)<<12|(63&i)<<6|63&s)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:i=e[r+1],s=e[r+2],a=e[r+3],128==(192&i)&&128==(192&s)&&128==(192&a)&&(u=(15&c)<<18|(63&i)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,p=1):l>65535&&(l-=65536,o.push(l>>>10&1023|55296),l=56320|1023&l),o.push(l),r+=p}return function(e){var t=e.length;if(t<=ho)return String.fromCharCode.apply(String,e);var n=\"\",o=0;for(;o<t;)n+=String.fromCharCode.apply(String,e.slice(o,o+=ho));return n}(o)}dr.TYPED_ARRAY_SUPPORT=void 0===K.TYPED_ARRAY_SUPPORT||K.TYPED_ARRAY_SUPPORT,dr.poolSize=8192,dr._augment=function(e){return e.__proto__=dr.prototype,e},dr.from=function(e,t,n){return mr(null,e,t,n)},dr.TYPED_ARRAY_SUPPORT&&(dr.prototype.__proto__=Uint8Array.prototype,dr.__proto__=Uint8Array),dr.alloc=function(e,t,n){return function(e,t,n,o){return Er(t),t<=0?_r(e,t):void 0!==n?\"string\"==typeof o?_r(e,t).fill(n,o):_r(e,t).fill(n):_r(e,t)}(null,e,t,n)},dr.allocUnsafe=function(e){return yr(null,e)},dr.allocUnsafeSlow=function(e){return yr(null,e)},dr.isBuffer=function(e){return null!=e&&(!!e._isBuffer||Zr(e)||function(e){return\"function\"==typeof e.readFloatLE&&\"function\"==typeof e.slice&&Zr(e.slice(0,0))}(e))},dr.compare=function(e,t){if(!Sr(e)||!Sr(t))throw new TypeError(\"Arguments must be Buffers\");if(e===t)return 0;for(var n=e.length,o=t.length,r=0,i=Math.min(n,o);r<i;++r)if(e[r]!==t[r]){n=e[r],o=t[r];break}return n<o?-1:o<n?1:0},dr.isEncoding=function(e){switch(String(e).toLowerCase()){case\"hex\":case\"utf8\":case\"utf-8\":case\"ascii\":case\"latin1\":case\"binary\":case\"base64\":case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return!0;default:return!1}},dr.concat=function(e,t){if(!po(e))throw new TypeError('\"list\" argument must be an Array of Buffers');if(0===e.length)return dr.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var o=dr.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var i=e[n];if(!Sr(i))throw new TypeError('\"list\" argument must be an Array of Buffers');i.copy(o,r),r+=i.length}return o},dr.byteLength=Cr,dr.prototype._isBuffer=!0,dr.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError(\"Buffer size must be a multiple of 16-bits\");for(var t=0;t<e;t+=2)Mr(this,t,t+1);return this},dr.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError(\"Buffer size must be a multiple of 32-bits\");for(var t=0;t<e;t+=4)Mr(this,t,t+3),Mr(this,t+1,t+2);return this},dr.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError(\"Buffer size must be a multiple of 64-bits\");for(var t=0;t<e;t+=8)Mr(this,t,t+7),Mr(this,t+1,t+6),Mr(this,t+2,t+5),Mr(this,t+3,t+4);return this},dr.prototype.toString=function(){var e=0|this.length;return 0===e?\"\":0===arguments.length?wr(this,0,e):Tr.apply(this,arguments)},dr.prototype.equals=function(e){if(!Sr(e))throw new TypeError(\"Argument must be a Buffer\");return this===e||0===dr.compare(this,e)},dr.prototype.inspect=function(){var e=\"\";return this.length>0&&(e=this.toString(\"hex\",0,50).match(/.{2}/g).join(\" \"),this.length>50&&(e+=\" ... \")),\"<Buffer \"+e+\">\"},dr.prototype.compare=function(e,t,n,o,r){if(!Sr(e))throw new TypeError(\"Argument must be a Buffer\");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===o&&(o=0),void 0===r&&(r=this.length),t<0||n>e.length||o<0||r>this.length)throw new RangeError(\"out of range index\");if(o>=r&&t>=n)return 0;if(o>=r)return-1;if(t>=n)return 1;if(this===e)return 0;for(var i=(r>>>=0)-(o>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(i,s),u=this.slice(o,r),c=e.slice(t,n),l=0;l<a;++l)if(u[l]!==c[l]){i=u[l],s=c[l];break}return i<s?-1:s<i?1:0},dr.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},dr.prototype.indexOf=function(e,t,n){return Or(this,e,t,n,!0)},dr.prototype.lastIndexOf=function(e,t,n){return Or(this,e,t,n,!1)},dr.prototype.write=function(e,t,n,o){if(void 0===t)o=\"utf8\",n=this.length,t=0;else if(void 0===n&&\"string\"==typeof t)o=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error(\"Buffer.write(string, encoding, offset[, length]) is no longer supported\");t|=0,isFinite(n)?(n|=0,void 0===o&&(o=\"utf8\")):(o=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError(\"Attempt to write outside buffer bounds\");o||(o=\"utf8\");for(var i=!1;;)switch(o){case\"hex\":return Nr(this,e,t,n);case\"utf8\":case\"utf-8\":return Ar(this,e,t,n);case\"ascii\":return Lr(this,e,t,n);case\"latin1\":case\"binary\":return Rr(this,e,t,n);case\"base64\":return Gr(this,e,t,n);case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return Pr(this,e,t,n);default:if(i)throw new TypeError(\"Unknown encoding: \"+o);o=(\"\"+o).toLowerCase(),i=!0}},dr.prototype.toJSON=function(){return{\"type\":\"Buffer\",\"data\":Array.prototype.slice.call(this._arr||this,0)}};var ho=4096;function Ur(e,t,n){var o=\"\";n=Math.min(e.length,n);for(var r=t;r<n;++r)o+=String.fromCharCode(127&e[r]);return o}function Fr(e,t,n){var o=\"\";n=Math.min(e.length,n);for(var r=t;r<n;++r)o+=String.fromCharCode(e[r]);return o}function qr(e,t,n){var o=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>o)&&(n=o);for(var r=\"\",i=t;i<n;++i)r+=zr(e[i]);return r}function xr(e,t,n){for(var o=e.slice(t,n),r=\"\",i=0;i<o.length;i+=2)r+=String.fromCharCode(o[i]+256*o[i+1]);return r}function Vr(e,t,n){if(e%1!=0||e<0)throw new RangeError(\"offset is not uint\");if(e+t>n)throw new RangeError(\"Trying to access beyond buffer length\")}function Kr(e,t,n,o,r,i){if(!Sr(e))throw new TypeError('\"buffer\" argument must be a Buffer instance');if(t>r||t<i)throw new RangeError('\"value\" argument is out of bounds');if(n+o>e.length)throw new RangeError(\"Index out of range\")}function Hr(e,t,n,o){t<0&&(t=65535+t+1);for(var r=0,i=Math.min(e.length-n,2);r<i;++r)e[n+r]=(t&255<<8*(o?r:1-r))>>>8*(o?r:1-r)}function Br(e,t,n,o){t<0&&(t=4294967295+t+1);for(var r=0,i=Math.min(e.length-n,4);r<i;++r)e[n+r]=t>>>8*(o?r:3-r)&255}function Yr(e,t,n,o,r,i){if(n+o>e.length)throw new RangeError(\"Index out of range\");if(n<0)throw new RangeError(\"Index out of range\")}function jr(e,t,n,o,r){return r||Yr(e,0,n,4),pr(e,t,n,o,23,4),n+4}function Wr(e,t,n,o,r){return r||Yr(e,0,n,8),pr(e,t,n,o,52,8),n+8}dr.prototype.slice=function(e,t){var n,o=this.length;if((e=~~e)<0?(e+=o)<0&&(e=0):e>o&&(e=o),(t=void 0===t?o:~~t)<0?(t+=o)<0&&(t=0):t>o&&(t=o),t<e&&(t=e),dr.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=dr.prototype;else{var r=t-e;n=new dr(r,void 0);for(var i=0;i<r;++i)n[i]=this[i+e]}return n},dr.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||Vr(e,t,this.length);for(var o=this[e],r=1,i=0;++i<t&&(r*=256);)o+=this[e+i]*r;return o},dr.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||Vr(e,t,this.length);for(var o=this[e+--t],r=1;t>0&&(r*=256);)o+=this[e+--t]*r;return o},dr.prototype.readUInt8=function(e,t){return t||Vr(e,1,this.length),this[e]},dr.prototype.readUInt16LE=function(e,t){return t||Vr(e,2,this.length),this[e]|this[e+1]<<8},dr.prototype.readUInt16BE=function(e,t){return t||Vr(e,2,this.length),this[e]<<8|this[e+1]},dr.prototype.readUInt32LE=function(e,t){return t||Vr(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},dr.prototype.readUInt32BE=function(e,t){return t||Vr(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},dr.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||Vr(e,t,this.length);for(var o=this[e],r=1,i=0;++i<t&&(r*=256);)o+=this[e+i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*t)),o},dr.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||Vr(e,t,this.length);for(var o=t,r=1,i=this[e+--o];o>0&&(r*=256);)i+=this[e+--o]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},dr.prototype.readInt8=function(e,t){return t||Vr(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},dr.prototype.readInt16LE=function(e,t){t||Vr(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},dr.prototype.readInt16BE=function(e,t){t||Vr(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},dr.prototype.readInt32LE=function(e,t){return t||Vr(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},dr.prototype.readInt32BE=function(e,t){return t||Vr(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},dr.prototype.readFloatLE=function(e,t){return t||Vr(e,4,this.length),lr(this,e,!0,23,4)},dr.prototype.readFloatBE=function(e,t){return t||Vr(e,4,this.length),lr(this,e,!1,23,4)},dr.prototype.readDoubleLE=function(e,t){return t||Vr(e,8,this.length),lr(this,e,!0,52,8)},dr.prototype.readDoubleBE=function(e,t){return t||Vr(e,8,this.length),lr(this,e,!1,52,8)},dr.prototype.writeUIntLE=function(e,t,n,o){(e=+e,t|=0,n|=0,o)||Kr(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,i=0;for(this[t]=255&e;++i<n&&(r*=256);)this[t+i]=e/r&255;return t+n},dr.prototype.writeUIntBE=function(e,t,n,o){(e=+e,t|=0,n|=0,o)||Kr(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,i=1;for(this[t+r]=255&e;--r>=0&&(i*=256);)this[t+r]=e/i&255;return t+n},dr.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||Kr(this,e,t,1,255,0),dr.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},dr.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||Kr(this,e,t,2,65535,0),dr.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Hr(this,e,t,!0),t+2},dr.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||Kr(this,e,t,2,65535,0),dr.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Hr(this,e,t,!1),t+2},dr.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||Kr(this,e,t,4,4294967295,0),dr.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):Br(this,e,t,!0),t+4},dr.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||Kr(this,e,t,4,4294967295,0),dr.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Br(this,e,t,!1),t+4},dr.prototype.writeIntLE=function(e,t,n,o){if(e=+e,t|=0,!o){var r=Math.pow(2,8*n-1);Kr(this,e,t,n,r-1,-r)}var i=0,s=1,a=0;for(this[t]=255&e;++i<n&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},dr.prototype.writeIntBE=function(e,t,n,o){if(e=+e,t|=0,!o){var r=Math.pow(2,8*n-1);Kr(this,e,t,n,r-1,-r)}var i=n-1,s=1,a=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},dr.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||Kr(this,e,t,1,127,-128),dr.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},dr.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||Kr(this,e,t,2,32767,-32768),dr.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Hr(this,e,t,!0),t+2},dr.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||Kr(this,e,t,2,32767,-32768),dr.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Hr(this,e,t,!1),t+2},dr.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||Kr(this,e,t,4,2147483647,-2147483648),dr.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Br(this,e,t,!0),t+4},dr.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||Kr(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),dr.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Br(this,e,t,!1),t+4},dr.prototype.writeFloatLE=function(e,t,n){return jr(this,e,t,!0,n)},dr.prototype.writeFloatBE=function(e,t,n){return jr(this,e,t,!1,n)},dr.prototype.writeDoubleLE=function(e,t,n){return Wr(this,e,t,!0,n)},dr.prototype.writeDoubleBE=function(e,t,n){return Wr(this,e,t,!1,n)},dr.prototype.copy=function(e,t,n,o){if(n||(n=0),o||0===o||(o=this.length),t>=e.length&&(t=e.length),t||(t=0),o>0&&o<n&&(o=n),o===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError(\"targetStart out of bounds\");if(n<0||n>=this.length)throw new RangeError(\"sourceStart out of bounds\");if(o<0)throw new RangeError(\"sourceEnd out of bounds\");o>this.length&&(o=this.length),e.length-t<o-n&&(o=e.length-t+n);var r,i=o-n;if(this===e&&n<t&&t<o)for(r=i-1;r>=0;--r)e[r+t]=this[r+n];else if(i<1e3||!dr.TYPED_ARRAY_SUPPORT)for(r=0;r<i;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+i),t);return i},dr.prototype.fill=function(e,t,n,o){if(\"string\"==typeof e){if(\"string\"==typeof t?(o=t,t=0,n=this.length):\"string\"==typeof n&&(o=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==o&&\"string\"!=typeof o)throw new TypeError(\"encoding must be a string\");if(\"string\"==typeof o&&!dr.isEncoding(o))throw new TypeError(\"Unknown encoding: \"+o)}else\"number\"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError(\"Out of range index\");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),\"number\"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var s=Sr(e)?e:Xr(new dr(e,o).toString()),a=s.length;for(i=0;i<n-t;++i)this[i+t]=s[i%a]}return this};var _o=/[^+\\/0-9A-Za-z-_]/g;function zr(e){return e<16?\"0\"+e.toString(16):e.toString(16)}function Xr(e,t){var n;t=t||Infinity;for(var o=e.length,r=null,i=[],s=0;s<o;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===o){(t-=3)>-1&&i.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&i.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error(\"Invalid code point\");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function Jr(e){return function(e){var t,n,o,r,i,s;co||ar();var a=e.length;if(a%4>0)throw new Error(\"Invalid string. Length must be a multiple of 4\");i=\"=\"===e[a-2]?2:\"=\"===e[a-1]?1:0,s=new uo(3*a/4-i),o=i>0?a-4:a;var u=0;for(t=0,n=0;t<o;t+=4,n+=3)r=ao[e.charCodeAt(t)]<<18|ao[e.charCodeAt(t+1)]<<12|ao[e.charCodeAt(t+2)]<<6|ao[e.charCodeAt(t+3)],s[u++]=r>>16&255,s[u++]=r>>8&255,s[u++]=255&r;return 2===i?(r=ao[e.charCodeAt(t)]<<2|ao[e.charCodeAt(t+1)]>>4,s[u++]=255&r):1===i&&(r=ao[e.charCodeAt(t)]<<10|ao[e.charCodeAt(t+1)]<<4|ao[e.charCodeAt(t+2)]>>2,s[u++]=r>>8&255,s[u++]=255&r),s}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\\s+|\\s+$/g,\"\")}(e).replace(_o,\"\")).length<2)return\"\";for(;e.length%4!=0;)e+=\"=\";return e}(e))}function Qr(e,t,n,o){for(var r=0;r<o&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function Zr(e){return!!e.constructor&&\"function\"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var fo=function(e){function t(){var e;return o(this,t),(e=d(this,p(t).call(this))).retry=2,e._request=e.promisify(wx.request),e}return l(t,ro),s(t,[{\"key\":\"request\",\"value\":function(e){return this._checkOptions(e),this._initOptions(e),e=c({},e,{\"responseType\":\"text\"}),this._requestWithRetry(e)}},{\"key\":\"_requestWithRetry\",\"value\":function(t){var n=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._request(t).then(this._handleResolve).catch(function(e){if(ne(e.errMsg)){if(e.errMsg.includes(\"abort\"))return Kt({});if(e.errMsg.includes(\"timeout\"))return n.retry>0&&o<n.retry?n._requestWithRetry(t,++o):Ht(new lt({\"code\":pt.NETWORK_TIMEOUT,\"message\":e.errMsg}));if(e.errMsg.includes(\"fail\"))return n.retry>0&&o<n.retry?n._requestWithRetry(t,++o):Ht(new lt({\"code\":pt.NETWORK_ERROR,\"message\":e.errMsg}))}return Ht(new lt(c({\"code\":pt.UNCAUGHT_ERROR,\"message\":e.message},e)))})}},{\"key\":\"_handleResolve\",\"value\":function(e){var t=e.data,n=t.error_code,o=t.ErrorCode;return\"number\"==typeof n&&(o=n),o!==we.REQUEST.SUCCESS&&(e.data.ErrorCode=Number(\"\".concat(o))),e}},{\"key\":\"promisify\",\"value\":function(r){return function(o){return new Promise(function(e,t){var n=r(Object.assign({},o,{\"success\":e,\"fail\":t}));o.updateAbort&&o.updateAbort(function(){n&&ue(n.abort)&&n.abort()})})}}}]),t}(),go=function(){function e(){o(this,e),this.request=0,this.success=0,this.fail=0,this.reportRate=10,this.requestTimeCost=[]}return s(e,[{\"key\":\"report\",\"value\":function(){if(1!==this.request){if(this.request%this.reportRate!=0)return null;var e=this.avgRequestTime(),t=\"runLoop reports: success=\".concat(this.success,\",fail=\").concat(this.fail,\",total=\").concat(this.request,\",avg=\").concat(e,\",cur=\").concat(this.requestTimeCost[this.requestTimeCost.length-1],\",max=\").concat(Math.max.apply(null,this.requestTimeCost),\",min=\").concat(Math.min.apply(null,this.requestTimeCost));J.log(t)}}},{\"key\":\"setRequestTime\",\"value\":function(e,t){var n=Math.abs(t-e);100===this.requestTimeCost.length&&this.requestTimeCost.shift(),this.requestTimeCost.push(n)}},{\"key\":\"avgRequestTime\",\"value\":function(){for(var e,t=this.requestTimeCost.length,n=0,o=0;o<t;o++)n+=this.requestTimeCost[o];return e=n/t,Math.round(100*e)/100}}]),e}(),mo=no.CancelToken,yo=function(){function e(t){o(this,e),this._initializeOptions(t),this._initializeMembers(),this.status=new go}return s(e,[{\"key\":\"destructor\",\"value\":function(){clearTimeout(this._seedID);var e=this._index();for(var t in this)Object.prototype.hasOwnProperty.call(this,t)&&(this[t]=null);return e}},{\"key\":\"setIndex\",\"value\":function(e){this._index=e}},{\"key\":\"getIndex\",\"value\":function(){return this._index}},{\"key\":\"isRunning\",\"value\":function(){return!this._stoped}},{\"key\":\"_initializeOptions\",\"value\":function(e){this.options=e}},{\"key\":\"_initializeMembers\",\"value\":function(){this._index=-1,this._seedID=0,this._requestStatus=!1,this._stoped=!1,this._intervalTime=0,this._intervalIncreaseStep=1e3,this._intervalDecreaseStep=1e3,this._intervalTimeMax=5e3,this._protectTimeout=3e3,this._getNoticeSeq=this.options.getNoticeSeq,this._retryCount=0,this._responseTime=Date.now(),this._responseTimeThreshold=2e3,this.requestor=oo,this.abort=null}},{\"key\":\"start\",\"value\":function(){0===this._seedID?(this._stoped=!1,this._send()):J.log('XHRRunLoop.start(), XHRRunLoop is running now, if you want to restart runLoop , please run \"stop()\" first.')}},{\"key\":\"_reset\",\"value\":function(){J.log(\"XHRRunLoop._reset(), reset long poll _intervalTime\",this._intervalTime),this.stop(),this.start()}},{\"key\":\"_intervalTimeIncrease\",\"value\":function(){this._intervalTime!==this._responseTimeThreshold&&(this._intervalTime<this._responseTimeThreshold&&(this._intervalTime+=this._intervalIncreaseStep),this._intervalTime>this._responseTimeThreshold&&(this._intervalTime=this._responseTimeThreshold))}},{\"key\":\"_intervalTimeDecrease\",\"value\":function(){0!==this._intervalTime&&(this._intervalTime>0&&(this._intervalTime-=this._intervalDecreaseStep),this._intervalTime<0&&(this._intervalTime=0))}},{\"key\":\"_intervalTimeAdjustment\",\"value\":function(){var e=Date.now();100*Math.floor((e-this._responseTime)/100)<=this._responseTimeThreshold?this._intervalTimeIncrease():this._intervalTimeDecrease(),this._responseTime=e}},{\"key\":\"_intervalTimeAdjustmentBaseOnResponseData\",\"value\":function(e){e.ErrorCode===we.REQUEST.SUCCESS?this._intervalTimeDecrease():this._intervalTimeIncrease()}},{\"key\":\"_send\",\"value\":function(){var t=this;if(!0!==this._requestStatus){this._requestStatus=!0,this.status.request++,\"function\"==typeof this.options.before&&this.options.before(this.options.pack.requestData);var n=Date.now(),o=0;this.requestor.request({\"url\":this.options.pack.getUrl(),\"data\":this.options.pack.requestData,\"method\":this.options.pack.method,\"cancelToken\":new mo(function(e){t.abort=e})}).then(function(e){if(t._intervalTimeAdjustmentBaseOnResponseData.bind(t)(e.data),t._retryCount>0&&(t._retryCount=0),t.status.success++,o=Date.now(),t.status.setRequestTime(n,o),e.data.timecost=o-n,\"function\"==typeof t.options.success)try{t.options.success({\"pack\":t.options.pack,\"error\":!1,\"data\":t.options.pack.callback(e.data)})}catch(e){J.warn(\"XHRRunLoop._send(), error:\",e)}t._requestStatus=!1,!1===t._stoped&&(t._seedID=setTimeout(t._send.bind(t),t._intervalTime)),t.status.report()}).catch(function(e){if(t.status.fail++,t._retryCount++,t._intervalTimeAdjustment.bind(t)(),!1===t._stoped&&(t._seedID=setTimeout(t._send.bind(t),t._intervalTime)),t._requestStatus=!1,\"function\"==typeof t.options.fail&&void 0!==e.request)try{t.options.fail({\"pack\":t.options.pack,\"error\":e,\"data\":!1})}catch(e){J.warn(\"XHRRunLoop._send(), fail callback error:\"),J.error(e)}o=Date.now(),t.status.setRequestTime(n,o),t.status.report()})}}},{\"key\":\"stop\",\"value\":function(){this._clearAllTimeOut(),this._stoped=!0}},{\"key\":\"_clearAllTimeOut\",\"value\":function(){clearTimeout(this._seedID),this._seedID=0}}]),e}(),Eo=function(){function e(t){o(this,e),this._initializeOptions(t),this._initializeMembers(),this.status=new go}return s(e,[{\"key\":\"destructor\",\"value\":function(){clearTimeout(this._seedID);var e=this._index();for(var t in this)Object.prototype.hasOwnProperty.call(this,t)&&(this[t]=null);return e}},{\"key\":\"setIndex\",\"value\":function(e){this._index=e}},{\"key\":\"isRunning\",\"value\":function(){return!this._stoped}},{\"key\":\"getIndex\",\"value\":function(){return this._index}},{\"key\":\"_initializeOptions\",\"value\":function(e){this.options=e}},{\"key\":\"_initializeMembers\",\"value\":function(){this._index=-1,this._seedID=0,this._requestStatus=!1,this._stoped=!1,this._intervalTime=0,this._intervalIncreaseStep=1e3,this._intervalDecreaseStep=1e3,this._intervalTimeMax=5e3,this._protectTimeout=3e3,this._getNoticeSeq=this.options.getNoticeSeq,this._retryCount=0,this._responseTime=Date.now(),this._responseTimeThreshold=2e3,this.requestor=new fo,this.abort=null}},{\"key\":\"start\",\"value\":function(){0===this._seedID?(this._stoped=!1,this._send()):J.log('WXRunLoop.start(): WXRunLoop is running now, if you want to restart runLoop , please run \"stop()\" first.')}},{\"key\":\"_reset\",\"value\":function(){J.log(\"WXRunLoop.reset(), long poll _intervalMaxRate\",this._intervalMaxRate),this.stop(),this.start()}},{\"key\":\"_intervalTimeIncrease\",\"value\":function(){this._intervalTime!==this._responseTimeThreshold&&(this._intervalTime<this._responseTimeThreshold&&(this._intervalTime+=this._intervalIncreaseStep),this._intervalTime>this._responseTimeThreshold&&(this._intervalTime=this._responseTimeThreshold))}},{\"key\":\"_intervalTimeDecrease\",\"value\":function(){0!==this._intervalTime&&(this._intervalTime>0&&(this._intervalTime-=this._intervalDecreaseStep),this._intervalTime<0&&(this._intervalTime=0))}},{\"key\":\"_intervalTimeAdjustment\",\"value\":function(){var e=Date.now();100*Math.floor((e-this._responseTime)/100)<=this._responseTimeThreshold?this._intervalTimeIncrease():this._intervalTimeDecrease(),this._responseTime=e}},{\"key\":\"_intervalTimeAdjustmentBaseOnResponseData\",\"value\":function(e){e.ErrorCode===we.REQUEST.SUCCESS?this._intervalTimeDecrease():this._intervalTimeIncrease()}},{\"key\":\"_send\",\"value\":function(){var t=this;if(!0!==this._requestStatus){var n=this;this._requestStatus=!0,this.status.request++,\"function\"==typeof this.options.before&&this.options.before(n.options.pack.requestData);var o=Date.now(),r=0;this.requestor.request({\"url\":n.options.pack.getUrl(),\"data\":n.options.pack.requestData,\"method\":n.options.pack.method,\"updateAbort\":function(e){t.abort=e}}).then(function(e){if(n._intervalTimeAdjustmentBaseOnResponseData.bind(t)(e.data),n._retryCount>0&&(n._retryCount=0),t.status.success++,r=Date.now(),t.status.setRequestTime(o,r),e.data.timecost=r-o,\"function\"==typeof n.options.success)try{t.options.success({\"pack\":t.options.pack,\"error\":!1,\"data\":t.options.pack.callback(e.data)})}catch(e){J.warn(\"WXRunLoop._send(), error:\",e)}n._requestStatus=!1,!1===n._stoped&&(n._seedID=setTimeout(n._send.bind(n),n._intervalTime)),t.status.report()}).catch(function(e){if(t.status.fail++,n._retryCount++,n._intervalTimeAdjustment.bind(t)(),!1===n._stoped&&(n._seedID=setTimeout(n._send.bind(n),n._intervalTime)),n._requestStatus=!1,\"function\"==typeof n.options.fail)try{t.options.fail({\"pack\":t.options.pack,\"error\":e,\"data\":!1})}catch(e){J.warn(\"WXRunLoop._send(), fail callback error:\"),J.error(e)}r=Date.now(),t.status.setRequestTime(o,r),t.status.report()})}}},{\"key\":\"stop\",\"value\":function(){this._clearAllTimeOut(),this._stoped=!0}},{\"key\":\"_clearAllTimeOut\",\"value\":function(){clearTimeout(this._seedID),this._seedID=0}}]),e}(),vo=function(e){function t(e){var n;return o(this,t),(n=d(this,p(t).call(this,e))).context=e.context,n.httpConnection=n._getHttpconnection(),n.keepAliveConnections=[],n}return l(t,bt),s(t,[{\"key\":\"initializeListener\",\"value\":function(){this.tim.innerEmitter.on(Pt.SIGN_LOGOUT_EXECUTING,this._stopAllRunLoop,this)}},{\"key\":\"request\",\"value\":function(t){var e={\"url\":t.url,\"data\":t.requestData,\"method\":t.method,\"callback\":t.callback};return this.httpConnection.request(e).then(function(e){return e.data=t.callback(e.data),e.data.errorCode!==we.REQUEST.SUCCESS?Ht(new lt({\"code\":e.data.errorCode,\"message\":e.data.errorInfo})):e})}},{\"key\":\"createRunLoop\",\"value\":function(e){var t=this.createKeepAliveConnection(e);return t.setIndex(this.keepAliveConnections.push(t)-1),t}},{\"key\":\"stopRunLoop\",\"value\":function(e){e.stop()}},{\"key\":\"_stopAllRunLoop\",\"value\":function(){for(var e=this.keepAliveConnections.length,t=0;t<e;t++)this.keepAliveConnections[t].stop()}},{\"key\":\"destroyRunLoop\",\"value\":function(e){e.stop();var t=e.destructor();this.keepAliveConnections.slice(t,1)}},{\"key\":\"startRunLoopExclusive\",\"value\":function(e){for(var t=e.getIndex(),n=0;n<this.keepAliveConnections.length;n++)n!==t&&this.keepAliveConnections[n].stop();e.start()}},{\"key\":\"_getHttpconnection\",\"value\":function(){return L?new fo:new io}},{\"key\":\"createKeepAliveConnection\",\"value\":function(e){return L?new Eo(e):this.tim.options.runLoopNetType===ze?new yo(e):(this.tim.options.runLoopNetType,\"function\"==typeof window.WebSocket&&window.WebSocket.prototype.send,new yo(e))}},{\"key\":\"clearAll\",\"value\":function(){this.conn.cancelAll()}},{\"key\":\"reset\",\"value\":function(){this.keepAliveConnections=[]}}]),t}(),Io=function(){function e(t){o(this,e),this.tim=t,this.tim.innerEmitter.on(Pt.ERROR_DETECTED,this._onErrorDetected,this)}return s(e,[{\"key\":\"_onErrorDetected\",\"value\":function(e){e.code?J.warn(\"Oops! code:\".concat(e.code,\" message:\").concat(e.message)):J.warn(\"Oops! message:\".concat(e.message,\" stack:\").concat(e.stack)),this.tim.outerEmitter.emit(v.ERROR,e)}}]),e}(),So=function(){function e(t){var n=this;o(this,e),Ne(t)||(this.userID=t.userID||\"\",this.nick=t.nick||\"\",this.gender=t.gender||\"\",this.birthday=t.birthday||0,this.location=t.location||\"\",this.selfSignature=t.selfSignature||\"\",this.allowType=t.allowType||S.ALLOW_TYPE_ALLOW_ANY,this.language=t.language||0,this.avatar=t.avatar||\"\",this.messageSettings=t.messageSettings||0,this.adminForbidType=t.adminForbidType||S.FORBID_TYPE_NONE,this.level=t.level||0,this.role=t.role||0,this.lastUpdatedTime=0,this.profileCustomField=[],Ne(t.profileCustomField)||t.profileCustomField.forEach(function(e){n.profileCustomField.push({\"key\":e.key,\"value\":e.value})}))}return s(e,[{\"key\":\"validate\",\"value\":function(e){var t=!0,n=\"\";if(Ne(e))return{\"valid\":!1,\"tips\":\"empty options\"};if(e.profileCustomField)for(var o=e.profileCustomField.length,r=null,i=0;i<o;i++){if(r=e.profileCustomField[i],!ne(r.key)||-1===r.key.indexOf(\"Tag_Profile_Custom\"))return{\"valid\":!1,\"tips\":\"自定义资料字段的前缀必须是 Tag_Profile_Custom\"};if(!ne(r.value))return{\"valid\":!1,\"tips\":\"自定义资料字段的 value 必须是字符串\"}}for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(\"profileCustomField\"===s)continue;if(Ne(e[s])&&!ne(e[s])&&!te(e[s])){n=\"key:\"+s+\", invalid value:\"+e[s],t=!1;continue}switch(s){case\"nick\":ne(e[s])||(n=\"nick should be a string\",t=!1),me(e[s])>500&&(n=\"nick name limited: must less than or equal to \".concat(500,\" bytes, current size: \").concat(me(e[s]),\" bytes\"),t=!1);break;case\"gender\":Ie(Ze,e.gender)||(n=\"key:gender, invalid value:\"+e.gender,t=!1);break;case\"birthday\":te(e.birthday)||(n=\"birthday should be a number\",t=!1);break;case\"location\":ne(e.location)||(n=\"location should be a string\",t=!1);break;case\"selfSignature\":ne(e.selfSignature)||(n=\"selfSignature should be a string\",t=!1);break;case\"allowType\":Ie(tt,e.allowType)||(n=\"key:allowType, invalid value:\"+e.allowType,t=!1);break;case\"language\":te(e.language)||(n=\"language should be a number\",t=!1);break;case\"avatar\":ne(e.avatar)||(n=\"avatar should be a string\",t=!1);break;case\"messageSettings\":0!==e.messageSettings&&1!==e.messageSettings&&(n=\"messageSettings should be 0 or 1\",t=!1);break;case\"adminForbidType\":Ie(et,e.adminForbidType)||(n=\"key:adminForbidType, invalid value:\"+e.adminForbidType,t=!1);break;case\"level\":te(e.level)||(n=\"level should be a number\",t=!1);break;case\"role\":te(e.role)||(n=\"role should be a number\",t=!1);break;default:n=\"unknown key:\"+s+\"  \"+e[s],t=!1}}return{\"valid\":t,\"tips\":n}}}]),e}(),Co=function(){function e(t){o(this,e),this.uc=t,this.TAG=\"profile\",this.Actions={\"Q\":\"query\",\"U\":\"update\"},this.accountProfileMap=new Map,this.expirationTime=864e5}return s(e,[{\"key\":\"setExpirationTime\",\"value\":function(e){this.expirationTime=e}},{\"key\":\"getUserProfile\",\"value\":function(e){var o=this,t=this.uc.tim.connectionController,n=e.userIDList;e.fromAccount=this.uc.getMyAccount(),n.length>100&&(J.warn(\"ProfileHandler.getUserProfile 获取用户资料人数不能超过100人\"),n.length=100);for(var r,i=[],s=[],a=0,u=n.length;a<u;a++)r=n[a],this.uc.isMyFriend(r)&&this._containsAccount(r)?s.push(this._getProfileFromMap(r)):i.push(r);if(0===i.length)return Kt(s);e.toAccount=i;var c=e.bFromGetMyProfile||!1,l=[];e.toAccount.forEach(function(e){l.push({\"toAccount\":e,\"standardSequence\":0,\"customSequence\":0})}),e.userItem=l;var p=new Yt;p.setMethod(jt.GET_USER_PROFILE).setStart();var h=this.uc.makeCapsule(this.TAG,this.Actions.Q,e);return t.request(h).then(function(e){p.setCode(0).setNetworkType(o.uc.getNetworkType()).setText(e.data.userProfileItem.length).setEnd(),J.info(\"ProfileHandler.getUserProfile ok\");var t=o._handleResponse(e).concat(s);return c?(o.uc.onGotMyProfile(),new Ft(t[0])):new Ft(t)}).catch(function(n){return o.uc.probeNetwork().then(function(e,t){p.setError(n,e,t).setEnd()}),J.error(\"ProfileHandler.getUserProfile error:\",n),Ht(n)})}},{\"key\":\"getMyProfile\",\"value\":function(){var e=this.uc.getMyAccount();if(J.log(\"ProfileHandler.getMyProfile myAccount=\"+e),this._fillMap(),this._containsAccount(e)){var t=this._getProfileFromMap(e);return J.debug(\"ProfileHandler.getMyProfile from cache, myProfile:\"+JSON.stringify(t)),this.uc.onGotMyProfile(),Kt(t)}return this.getUserProfile({\"fromAccount\":e,\"userIDList\":[e],\"bFromGetMyProfile\":!0})}},{\"key\":\"_handleResponse\",\"value\":function(e){for(var t,n,o=_e.now(),r=e.data.userProfileItem,i=[],s=0,a=r.length;s<a;s++)\"@TLS#NOT_FOUND\"!==r[s].to&&\"\"!==r[s].to&&(t=r[s].to,n=this._updateMap(t,this._getLatestProfileFromResponse(t,r[s].profileItem)),i.push(n));return J.log(\"ProfileHandler._handleResponse cost \"+(_e.now()-o)+\" ms\"),i}},{\"key\":\"_getLatestProfileFromResponse\",\"value\":function(e,t){var n={};if(n.userID=e,n.profileCustomField=[],!Ne(t))for(var o=0,r=t.length;o<r;o++)if(t[o].tag.indexOf(\"Tag_Profile_Custom\")>-1)n.profileCustomField.push({\"key\":t[o].tag,\"value\":t[o].value});else switch(t[o].tag){case Qe.NICK:n.nick=t[o].value;break;case Qe.GENDER:n.gender=t[o].value;break;case Qe.BIRTHDAY:n.birthday=t[o].value;break;case Qe.LOCATION:n.location=t[o].value;break;case Qe.SELFSIGNATURE:n.selfSignature=t[o].value;break;case Qe.ALLOWTYPE:n.allowType=t[o].value;break;case Qe.LANGUAGE:n.language=t[o].value;break;case Qe.AVATAR:n.avatar=t[o].value;break;case Qe.MESSAGESETTINGS:n.messageSettings=t[o].value;break;case Qe.ADMINFORBIDTYPE:n.adminForbidType=t[o].value;break;case Qe.LEVEL:n.level=t[o].value;break;case Qe.ROLE:n.role=t[o].value;break;default:J.warn(\"ProfileHandler._handleResponse unkown tag->\",t[o].tag,t[o].value)}return n}},{\"key\":\"updateMyProfile\",\"value\":function(n){var o=this,e=this.uc.tim,t=e.connectionController,r=e.outerEmitter,i=(new So).validate(n);if(!i.valid)return J.error(\"ProfileHandler.updateMyProfile info:\".concat(i.tips,\"，请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#updateMyProfile\")),Ht({\"code\":pt.UPDATE_PROFILE_INVALID_PARAM,\"message\":ht.UPDATE_PROFILE_INVALID_PARAM});var s=[];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(\"profileCustomField\"===a?n.profileCustomField.forEach(function(e){s.push({\"tag\":e.key,\"value\":e.value})}):s.push({\"tag\":Qe[a.toUpperCase()],\"value\":n[a]}));if(0===s.length)return J.error(\"ProfileHandler.updateMyProfile info:\".concat(ht.UPDATE_PROFILE_NO_KEY,\"，请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#updateMyProfile\")),Ht({\"code\":pt.UPDATE_PROFILE_NO_KEY,\"message\":ht.UPDATE_PROFILE_NO_KEY});var u=this.uc.makeCapsule(this.TAG,this.Actions.U,{\"fromAccount\":this.uc.getMyAccount(),\"profileItem\":s});return t.request(u).then(function(e){J.info(\"ProfileHandler.updateMyProfile ok\");var t=o._updateMap(o.uc.getMyAccount(),n);return r.emit(v.PROFILE_UPDATED,[t]),Kt(t)}).catch(function(e){return J.error(\"ProfileHandler.updateMyProfile error:\",e),Ht(e)})}},{\"key\":\"onProfileModified\",\"value\":function(e){var t=e.data;if(!Ne(t)){var n,o,r=t.length;J.info(\"ProfileHandler.onProfileModified length=\"+r);for(var i=[],s=0;s<r;s++)n=t[s].userID,o=this._updateMap(n,this._getLatestProfileFromResponse(n,t[s].profileList)),i.push(o);var a=this.uc.tim,u=a.innerEmitter,c=a.outerEmitter;u.emit(Pt.PROFILE_UPDATED,{\"data\":i}),c.emit(v.PROFILE_UPDATED,i)}}},{\"key\":\"_fillMap\",\"value\":function(){if(0===this.accountProfileMap.size){for(var e=this._getCachedProfiles(),t=Date.now(),n=0,o=e.length;n<o;n++)t-e[n].lastUpdatedTime<this.expirationTime&&this.accountProfileMap.set(e[n].userID,e[n]);J.log(\"ProfileHandler._fillMap from chache, map.size=\"+this.accountProfileMap.size)}}},{\"key\":\"_updateMap\",\"value\":function(e,t){var n,o=Date.now();return this._containsAccount(e)?(n=this._getProfileFromMap(e),t.profileCustomField&&Se(n.profileCustomField,t.profileCustomField),de(n,t,[\"profileCustomField\"]),n.lastUpdatedTime=o):(n=new So(t),(this.uc.isMyFriend(e)||e===this.uc.getMyAccount())&&(n.lastUpdatedTime=o,this.accountProfileMap.set(e,n))),this._flushMap(e===this.uc.getMyAccount()),n}},{\"key\":\"_flushMap\",\"value\":function(e){var t=E(this.accountProfileMap.values()),n=this.uc.tim.storage;J.debug(\"ProfileHandler._flushMap length=\".concat(t.length,\" flushAtOnce=\").concat(e)),n.setItem(this.TAG,t,e)}},{\"key\":\"_containsAccount\",\"value\":function(e){return this.accountProfileMap.has(e)}},{\"key\":\"_getProfileFromMap\",\"value\":function(e){return this.accountProfileMap.get(e)}},{\"key\":\"_getCachedProfiles\",\"value\":function(){var e=this.uc.tim.storage.getItem(this.TAG);return Ne(e)?[]:e}},{\"key\":\"onConversationsProfileUpdated\",\"value\":function(e){for(var t,n,o,r=[],i=0,s=e.length;i<s;i++)n=(t=e[i]).userID,this.uc.isMyFriend(n)&&(this._containsAccount(n)?(o=this._getProfileFromMap(n),de(o,t)>0&&r.push(n)):r.push(t.userID));0!==r.length&&(J.info(\"ProfileHandler.onConversationsProfileUpdated toAccount:\",r),this.getUserProfile({\"userIDList\":r}))}},{\"key\":\"reset\",\"value\":function(){this._flushMap(!0),this.accountProfileMap.clear()}}]),e}(),To=function(){function e(t){o(this,e),this.options=t?t.options:{\"enablePointer\":!0},this.pointsList={},this.reportText={},this.maxNameLen=0,this.gapChar=\"-\",this.log=console.log,this.currentTask=\"\"}return s(e,[{\"key\":\"newTask\",\"value\":function(e){!1!==this.options.enablePointer&&(e||(e=[\"task\",this._timeFormat()].join(\"-\")),this.pointsList[e]=[],this.currentTask=e,console.log(\"Pointer new Task : \".concat(this.currentTask)))}},{\"key\":\"deleteTask\",\"value\":function(e){!1!==this.options.enablePointer&&(e||(e=this.currentTask),this.pointsList[e].length=0,delete this.pointsList[e])}},{\"key\":\"dot\",\"value\":function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"\",t=arguments.length>1?arguments[1]:void 0;if(!1!==this.options.enablePointer){t=t||this.currentTask;var n=+new Date;this.maxNameLen=this.maxNameLen<e.length?e.length:this.maxNameLen,this.flen=this.maxNameLen+10,this.pointsList[t].push({\"pointerName\":e,\"time\":n})}}},{\"key\":\"_analisys\",\"value\":function(e){if(!1!==this.options.enablePointer){e=e||this.currentTask;for(var t=this.pointsList[e],n=t.length,o=[],r=[],i=0;i<n;i++)0!==i&&(r=this._analisysTowPoints(t[i-1],t[i]),o.push(r.join(\"\")));return r=this._analisysTowPoints(t[0],t[n-1],!0),o.push(r.join(\"\")),o.join(\"\")}}},{\"key\":\"_analisysTowPoints\",\"value\":function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!1!==this.options.enablePointer){var o=this.flen,r=t.time-e.time,i=r.toString(),s=e.pointerName+this.gapChar.repeat(o-e.pointerName.length),a=t.pointerName+this.gapChar.repeat(o-t.pointerName.length),u=this.gapChar.repeat(4-i.length)+i,c=n?[\"%c\",s,a,u,\"ms\\n%c\"]:[s,a,u,\"ms\\n\"];return c}}},{\"key\":\"report\",\"value\":function(e){if(!1!==this.options.enablePointer){e=e||this.currentTask;var t=this._analisys(e);this.pointsList=[];var n=this._timeFormat(),o=\"Pointer[\".concat(e,\"(\").concat(n,\")]\"),r=4*this.maxNameLen,i=(r-o.length)/2;console.log([\"-\".repeat(i),o,\"-\".repeat(i)].join(\"\")),console.log(\"%c\"+t,\"color:#66a\",\"color:red\",\"color:#66a\"),console.log(\"-\".repeat(r))}}},{\"key\":\"_timeFormat\",\"value\":function(){var e=new Date,t=this.zeroFix(e.getMonth()+1,2),n=this.zeroFix(e.getDate(),2);return\"\".concat(t,\"-\").concat(n,\" \").concat(e.getHours(),\":\").concat(e.getSeconds(),\":\").concat(e.getMinutes(),\"~\").concat(e.getMilliseconds())}},{\"key\":\"zeroFix\",\"value\":function(e,t){return(\"000000000\"+e).slice(-t)}},{\"key\":\"reportAll\",\"value\":function(){if(!1!==this.options.enablePointer)for(var e in this.pointsList)Object.prototype.hasOwnProperty.call(this.pointsList,e)&&this.eport(e)}}]),e}(),Mo=function e(t,n){o(this,e),this.userID=t;var r={};if(r.userID=t,!Ne(n))for(var i=0,s=n.length;i<s;i++)switch(n[i].tag){case Qe.NICK:r.nick=n[i].value;break;case Qe.GENDER:r.gender=n[i].value;break;case Qe.BIRTHDAY:r.birthday=n[i].value;break;case Qe.LOCATION:r.location=n[i].value;break;case Qe.SELFSIGNATURE:r.selfSignature=n[i].value;break;case Qe.ALLOWTYPE:r.allowType=n[i].value;break;case Qe.LANGUAGE:r.language=n[i].value;break;case Qe.AVATAR:r.avatar=n[i].value;break;case Qe.MESSAGESETTINGS:r.messageSettings=n[i].value;break;case Qe.ADMINFORBIDTYPE:r.adminForbidType=n[i].value;break;case Qe.LEVEL:r.level=n[i].value;break;case Qe.ROLE:r.role=n[i].value;break;default:J.debug(\"snsProfileItem unkown tag->\",n[i].tag)}this.profile=new So(r)},Oo=function(){function e(t){o(this,e),this.uc=t,this.TAG=\"friend\",this.Actions={\"G\":\"get\",\"D\":\"delete\"},this.friends=new Map,this.pointer=new To}return s(e,[{\"key\":\"isMyFriend\",\"value\":function(e){var t=this.friends.has(e);return t||J.debug(\"FriendHandler.isMyFriend \"+e+\" is not my friend\"),t}},{\"key\":\"_transformFriendList\",\"value\":function(e){if(!Ne(e)&&!Ne(e.infoItem)){J.info(\"FriendHandler._transformFriendList friendNum=\"+e.friendNum);for(var t,n,o=e.infoItem,r=0,i=o.length;r<i;r++)n=o[r].infoAccount,t=new Mo(n,o[r].snsProfileItem),this.friends.set(n,t)}}},{\"key\":\"_friends2map\",\"value\":function(e){var t=new Map;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.set(n,e[n]);return t}},{\"key\":\"getFriendList\",\"value\":function(){var n=this,e=this.uc.tim.connectionController,t={};t.fromAccount=this.uc.getMyAccount(),J.info(\"FriendHandler.getFriendList myAccount=\"+t.fromAccount);var o=this.uc.makeCapsule(this.TAG,this.Actions.G,t);return e.request(o).then(function(e){J.info(\"FriendHandler.getFriendList ok\"),n._transformFriendList(e.data);var t=E(n.friends.values());return Kt(t)}).catch(function(e){return J.error(\"FriendHandler.getFriendList error:\",JSON.stringify(e)),Ht(e)})}},{\"key\":\"deleteFriend\",\"value\":function(e){if(!Array.isArray(e.toAccount))return J.error(\"FriendHandler.deleteFriend options.toAccount 必需是数组\"),Ht({\"code\":pt.DEL_FRIEND_INVALID_PARAM,\"message\":ht.DEL_FRIEND_INVALID_PARAM});e.toAccount.length>1e3&&(J.warn(\"FriendHandler.deleteFriend 删除好友人数不能超过1000人\"),e.toAccount.length=1e3);var t=this.uc.tim.connectionController,n=this.uc.makeCapsule(this.TAG,this.Actions.D,e);return t.request(n).then(function(e){return J.info(\"FriendHandler.deleteFriend ok\"),Kt()}).catch(function(e){return J.error(\"FriendHandler.deleteFriend error:\",e),Ht(e)})}}]),e}(),Do=function e(t){o(this,e),Ne||(this.userID=t.userID||\"\",this.timeStamp=t.timeStamp||0)},No=function(){function e(t){o(this,e),this.uc=t,this.TAG=\"blacklist\",this.Actions={\"G\":\"get\",\"C\":\"create\",\"D\":\"delete\"},this.blacklistMap=new Map,this.startIndex=0,this.maxLimited=100,this.curruentSequence=0}return s(e,[{\"key\":\"getBlacklist\",\"value\":function(){var o=this,e=this.uc.tim.connectionController,t={};t.fromAccount=this.uc.getMyAccount(),t.maxLimited=this.maxLimited,t.startIndex=0,t.lastSequence=this.curruentSequence;var r=new Yt;r.setMethod(jt.GET_BLACKLIST).setStart();var n=this.uc.makeCapsule(this.TAG,this.Actions.G,t);return e.request(n).then(function(e){var t=Ne(e.data.blackListItem)?0:e.data.blackListItem.length;return r.setCode(0).setNetworkType(o.uc.getNetworkType()).setText(t).setEnd(),J.info(\"BlacklistHandler.getBlacklist ok\"),o.curruentSequence=e.data.curruentSequence,o._handleResponse(e.data.blackListItem,!0),o._onBlacklistUpdated()}).catch(function(n){return o.uc.probeNetwork().then(function(e,t){r.setError(n,e,t).setEnd()}),J.error(\"BlacklistHandler.getBlacklist error:\",n),Ht(n)})}},{\"key\":\"addBlacklist\",\"value\":function(e){var t=this;if(!ie(e.userIDList))return J.error(\"BlacklistHandler.addBlacklist options.userIDList 必需是数组\"),Ht({\"code\":pt.ADD_BLACKLIST_INVALID_PARAM,\"message\":ht.ADD_BLACKLIST_INVALID_PARAM});var n=this.uc.tim.loginInfo.identifier;if(1===e.userIDList.length&&e.userIDList[0]===n)return J.error(\"BlacklistHandler.addBlacklist 不能把自己拉黑\"),Ht({\"code\":pt.CANNOT_ADD_SELF_TO_BLACKLIST,\"message\":ht.CANNOT_ADD_SELF_TO_BLACKLIST});e.userIDList.includes(n)&&(e.userIDList=e.userIDList.filter(function(e){return e!==n}),J.warn(\"BlacklistHandler.addBlacklist 不能把自己拉黑，已过滤\"));var o=this.uc.tim.connectionController;e.fromAccount=this.uc.getMyAccount(),e.toAccount=e.userIDList;var r=this.uc.makeCapsule(this.TAG,this.Actions.C,e);return o.request(r).then(function(e){return J.info(\"BlacklistHandler.addBlacklist ok\"),t._handleResponse(e.data.resultItem,!0),t._onBlacklistUpdated()}).catch(function(e){return J.error(\"BlacklistHandler.addBlacklist error:\",e),Ht(e)})}},{\"key\":\"_handleResponse\",\"value\":function(e,t){if(!Ne(e))for(var n,o,r,i=0,s=e.length;i<s;i++)o=e[i].to,r=e[i].resultCode,(se(r)||0===r)&&(t?((n=this.blacklistMap.has(o)?this.blacklistMap.get(o):new Do).userID=o,!Ne(e[i].addBlackTimeStamp)&&(n.timeStamp=e[i].addBlackTimeStamp),this.blacklistMap.set(o,n)):this.blacklistMap.has(o)&&(n=this.blacklistMap.get(o),this.blacklistMap.delete(o)));J.log(\"BlacklistHandler._handleResponse total=\"+this.blacklistMap.size+\" bAdd=\"+t)}},{\"key\":\"deleteBlacklist\",\"value\":function(e){var t=this;if(!ie(e.userIDList))return J.error(\"BlacklistHandler.deleteBlacklist options.userIDList 必需是数组\"),Ht({\"code\":pt.DEL_BLACKLIST_INVALID_PARAM,\"message\":ht.DEL_BLACKLIST_INVALID_PARAM});var n=this.uc.tim.connectionController;e.fromAccount=this.uc.getMyAccount(),e.toAccount=e.userIDList;var o=this.uc.makeCapsule(this.TAG,this.Actions.D,e);return n.request(o).then(function(e){return J.info(\"BlacklistHandler.deleteBlacklist ok\"),t._handleResponse(e.data.resultItem,!1),t._onBlacklistUpdated()}).catch(function(e){return J.error(\"BlacklistHandler.deleteBlacklist error:\",e),Ht(e)})}},{\"key\":\"_onBlacklistUpdated\",\"value\":function(){var e=this.uc.tim.outerEmitter,t=E(this.blacklistMap.keys());return e.emit(v.BLACKLIST_UPDATED,t),Kt(t)}},{\"key\":\"handleBlackListDelAccount\",\"value\":function(e){for(var t,n=[],o=0,r=e.length;o<r;o++)t=e[o],this.blacklistMap.has(t)&&(this.blacklistMap.delete(t),n.push(t));n.length>0&&(J.log(\"BlacklistHandler.handleBlackListDelAccount delCount=\"+n.length+\" : \"+n.join(\",\")),this.tim.outerEmitter.emit(v.BLACKLIST_UPDATED,E(this.blacklistMap.keys())))}},{\"key\":\"handleBlackListAddAccount\",\"value\":function(e){for(var t,n=[],o=0,r=e.length;o<r;o++)t=e[o],this.blacklistMap.has(t)||(this.blacklistMap.set(t,new Do({\"userID\":t})),n.push(t));n.length>0&&(J.log(\"BlacklistHandler.handleBlackListAddAccount addCount=\"+n.length+\" : \"+n.join(\",\")),this.tim.outerEmitter.emit(v.BLACKLIST_UPDATED,E(this.blacklistMap.keys())))}},{\"key\":\"reset\",\"value\":function(){this.blacklistMap.clear(),this.startIndex=0,this.maxLimited=100,this.curruentSequence=0}}]),e}(),Ao=function(){function e(t){o(this,e),this.uc=t,this.TAG=\"applyC2C\",this.Actions={\"C\":\"create\",\"G\":\"get\",\"D\":\"delete\",\"U\":\"update\"}}return s(e,[{\"key\":\"applyAddFriend\",\"value\":function(e){var t=this,n=this.uc.tim.connectionController,o=this.uc.makeCapsule(this.TAG,this.Actions.C,e),r=n.request(o);return r.then(function(e){t.uc.isActionSuccessful(\"applyAddFriend\",t.Actions.C,e)}).catch(function(e){}),r}},{\"key\":\"getPendency\",\"value\":function(e){var t=this,n=this.tim.connectionController,o=this.uc.makeCapsule(this.TAG,this.Actions.G,e),r=n.request(o);return r.then(function(e){t.uc.isActionSuccessful(\"getPendency\",t.Actions.G,e)}).catch(function(e){}),r}},{\"key\":\"deletePendency\",\"value\":function(e){var t=this,n=this.tim.connectionController,o=this.uc.makeCapsule(this.TAG,this.Actions.D,e),r=n.request(o);return r.then(function(e){t.uc.isActionSuccessful(\"deletePendency\",t.Actions.D,e)}).catch(function(e){}),r}},{\"key\":\"replyPendency\",\"value\":function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.tim.connectionController,o=this.uc.makeCapsule(this.TAG,this.Actions.U,e),r=n.request(o);return r.then(function(e){t.uc.isActionSuccessful(\"replyPendency\",t.Actions.U,e)}).catch(function(e){}),r}}]),e}(),Lo=function(e){function t(e){var n;return o(this,t),(n=d(this,p(t).call(this,e))).profileHandler=new Co(_(n)),n.friendHandler=new Oo(_(n)),n.blacklistHandler=new No(_(n)),n.applyC2CHandler=new Ao(_(n)),n._initializeListener(),n}return l(t,bt),s(t,[{\"key\":\"_initializeListener\",\"value\":function(e){var t=this.tim.innerEmitter;t.on(Pt.CONTEXT_A2KEY_AND_TINYID_UPDATED,this.onContextUpdated,this),t.on(Pt.NOTICE_LONGPOLL_PROFILE_MODIFIED,this.onProfileModified,this),t.on(Pt.NOTICE_LONGPOLL_NEW_FRIEND_MESSAGES,this.onNewFriendMessages,this),t.on(Pt.CONVERSATION_LIST_PROFILE_UPDATED,this.onConversationsProfileUpdated,this)}},{\"key\":\"onContextUpdated\",\"value\":function(e){var t=e.data.context;!1!=!!t.a2Key&&!1!=!!t.tinyID&&(this.profileHandler.getMyProfile(),this.friendHandler.getFriendList(),this.blacklistHandler.getBlacklist())}},{\"key\":\"onGotMyProfile\",\"value\":function(){this.triggerReady()}},{\"key\":\"onProfileModified\",\"value\":function(e){this.profileHandler.onProfileModified(e)}},{\"key\":\"onNewFriendMessages\",\"value\":function(e){J.debug(\"onNewFriendMessages\",JSON.stringify(e.data)),Ne(e.data.blackListDelAccount)||this.blacklistHandler.handleBlackListDelAccount(e.data.blackListDelAccount),Ne(e.data.blackListAddAccount)||this.blacklistHandler.handleBlackListAddAccount(e.data.blackListAddAccount)}},{\"key\":\"onConversationsProfileUpdated\",\"value\":function(e){this.profileHandler.onConversationsProfileUpdated(e.data)}},{\"key\":\"getMyAccount\",\"value\":function(){return this.tim.context.identifier}},{\"key\":\"isMyFriend\",\"value\":function(e){return this.friendHandler.isMyFriend(e)}},{\"key\":\"makeCapsule\",\"value\":function(e,t,n){return this.createPackage({\"name\":e,\"action\":t,\"param\":n})}},{\"key\":\"getMyProfile\",\"value\":function(){return this.profileHandler.getMyProfile()}},{\"key\":\"getUserProfile\",\"value\":function(e){return this.profileHandler.getUserProfile(e)}},{\"key\":\"updateMyProfile\",\"value\":function(e){return this.profileHandler.updateMyProfile(e)}},{\"key\":\"getFriendList\",\"value\":function(){return this.friendHandler.getFriendList()}},{\"key\":\"deleteFriend\",\"value\":function(e){return this.friendHandler.deleteFriend(e)}},{\"key\":\"getBlacklist\",\"value\":function(){return this.blacklistHandler.getBlacklist()}},{\"key\":\"addBlacklist\",\"value\":function(e){return this.blacklistHandler.addBlacklist(e)}},{\"key\":\"deleteBlacklist\",\"value\":function(e){return this.blacklistHandler.deleteBlacklist(e)}},{\"key\":\"applyAddFriend\",\"value\":function(e){return this.applyC2CHandler.applyAddFriend(e)}},{\"key\":\"getPendency\",\"value\":function(e){return this.applyC2CHandler.getPendency(e)}},{\"key\":\"deletePendency\",\"value\":function(e){return this.applyC2CHandler.deletePendency(e)}},{\"key\":\"replyPendency\",\"value\":function(e){return this.applyC2CHandler.replyPendency(e)}},{\"key\":\"reset\",\"value\":function(){J.info(\"UserController.reset\"),this.resetReady(),this.profileHandler.reset(),this.blacklistHandler.reset(),this.checkTimes=0}}]),t}(),Ro=[\"groupID\",\"name\",\"avatar\",\"type\",\"introduction\",\"notification\",\"ownerID\",\"selfInfo\",\"createTime\",\"infoSequence\",\"lastInfoTime\",\"lastMessage\",\"nextMessageSeq\",\"memberNum\",\"maxMemberNum\",\"memberList\",\"joinOption\",\"groupCustomField\"],Go=function(){function e(t){o(this,e),this.groupID=\"\",this.name=\"\",this.avatar=\"\",this.type=\"\",this.introduction=\"\",this.notification=\"\",this.ownerID=\"\",this.createTime=\"\",this.infoSequence=\"\",this.lastInfoTime=\"\",this.selfInfo={\"messageRemindType\":\"\",\"joinTime\":\"\",\"nameCard\":\"\",\"role\":\"\"},this.lastMessage={\"lastTime\":\"\",\"lastSequence\":\"\",\"fromAccount\":\"\",\"messageForShow\":\"\"},this.nextMessageSeq=\"\",this.memberNum=\"\",this.maxMemberNum=\"\",this.joinOption=\"\",this.groupCustomField=[],this._initGroup(t)}return s(e,[{\"key\":\"_initGroup\",\"value\":function(e){for(var t in e)Ro.indexOf(t)<0||(\"selfInfo\"!==t?this[t]=e[t]:this.updateSelfInfo(e[t]))}},{\"key\":\"updateGroup\",\"value\":function(e){e.lastMsgTime&&(this.lastMessage.lastTime=e.lastMsgTime),e.groupCustomField&&Se(this.groupCustomField,e.groupCustomField),de(this,e,[\"members\",\"errorCode\",\"lastMsgTime\",\"groupCustomField\"])}},{\"key\":\"updateSelfInfo\",\"value\":function(e){var t=e.nameCard,n=e.joinTime,o=e.role,r=e.messageRemindType;de(this.selfInfo,{\"nameCard\":t,\"joinTime\":n,\"role\":o,\"messageRemindType\":r},[],[\"\",null,void 0,0,NaN])}},{\"key\":\"setSelfNameCard\",\"value\":function(e){this.selfInfo.nameCard=e}}]),e}(),Po=function(e,t){if(se(t))return\"\";switch(e){case S.MSG_TEXT:return t.text;case S.MSG_IMAGE:return\"[图片]\";case S.MSG_GEO:return\"[位置]\";case S.MSG_AUDIO:return\"[语音]\";case S.MSG_VIDEO:return\"[视频]\";case S.MSG_FILE:return\"[文件]\";case S.MSG_CUSTOM:return\"[自定义消息]\";case S.MSG_GRP_TIP:return\"[群提示消息]\";case S.MSG_GRP_SYS_NOTICE:return\"[群系统通知]\";case S.MSG_FACE:return\"[动画表情]\";default:return\"\"}},ko=function(e){return se(e)?{\"lastTime\":0,\"lastSequence\":0,\"fromAccount\":0,\"messageForShow\":\"\",\"payload\":null,\"type\":\"\",\"isRevoked\":!1}:e instanceof Et?{\"lastTime\":e.time||0,\"lastSequence\":e.sequence||0,\"fromAccount\":e.from||\"\",\"messageForShow\":Po(e.type,e.payload),\"payload\":e.payload||null,\"type\":e.type||null,\"isRevoked\":!1}:c({},e,{\"isRevoked\":!1,\"messageForShow\":Po(e.type,e.payload)})},wo=function(){function e(t){o(this,e),this.conversationID=t.conversationID||\"\",this.unreadCount=t.unreadCount||0,this.type=t.type||\"\",this.lastMessage=ko(t.lastMessage),this._isInfoCompleted=!1,this._initProfile(t)}return s(e,[{\"key\":\"_initProfile\",\"value\":function(t){var n=this;Object.keys(t).forEach(function(e){switch(e){case\"userProfile\":n.userProfile=t.userProfile;break;case\"groupProfile\":n.groupProfile=t.groupProfile}}),se(this.userProfile)&&this.type===S.CONV_C2C?this.userProfile=new So({\"userID\":t.conversationID.replace(\"C2C\",\"\")}):se(this.groupProfile)&&this.type===S.CONV_GROUP&&(this.groupProfile=new Go({\"groupID\":t.conversationID.replace(\"GROUP\",\"\")}))}},{\"key\":\"updateUnreadCount\",\"value\":function(e,t){se(e)||(this.subType===S.GRP_CHATROOM||Re(this.subType)?this.unreadCount=0:t&&this.type===S.CONV_GROUP?this.unreadCount=e:this.unreadCount=this.unreadCount+e)}},{\"key\":\"reduceUnreadCount\",\"value\":function(){this.unreadCount>=1&&(this.unreadCount-=1)}},{\"key\":\"isLastMessageRevoked\",\"value\":function(e){var t=e.sequence,n=e.time;return this.type===S.CONV_C2C&&t===this.lastMessage.lastSequence&&n===this.lastMessage.lastTime||this.type===S.CONV_GROUP&&t===this.lastMessage.lastSequence}},{\"key\":\"setLastMessageRevoked\",\"value\":function(e){this.lastMessage.isRevoked=e}},{\"key\":\"toAccount\",\"get\":function(){return this.conversationID.replace(\"C2C\",\"\").replace(\"GROUP\",\"\")}},{\"key\":\"subType\",\"get\":function(){return this.groupProfile?this.groupProfile.type:\"\"}}]),e}(),bo=function(e){function r(e){var t;return o(this,r),(t=d(this,p(r).call(this,e))).pagingStatus=we.PAGING_CONVERSATION.NOT_START,t.pagingTimeStamp=0,t.conversationMap=new Map,t.tempGroupList=[],t._initListeners(),t}return l(r,bt),s(r,[{\"key\":\"hasLocalConversationMap\",\"value\":function(){return this.conversationMap.size>0}},{\"key\":\"createLocalConversation\",\"value\":function(e){return this.conversationMap.has(e)?this.conversationMap.get(e):new wo({\"conversationID\":e,\"type\":e.slice(0,3)===S.CONV_C2C?S.CONV_C2C:S.CONV_GROUP})}},{\"key\":\"hasLocalConversation\",\"value\":function(e){return this.conversationMap.has(e)}},{\"key\":\"getConversationList\",\"value\":function(){var r=this;J.log(\"ConversationController.getConversationList.\"),this.pagingStatus===we.PAGING_CONVERSATION.REJECTED&&(J.log(\"ConversationController.getConversationList. continue to sync conversationList\"),this._syncConversationList());var i=new Yt;i.setMethod(jt.GET_CONVERSATION_LIST).setStart();var e=this.createPackage({\"name\":\"conversation\",\"action\":\"query\"});return this.tim.connectionController.request(e).then(function(e){var t=e.data.conversations,n=void 0===t?[]:t,o=r._getConversationOptions(n);return r._updateLocalConversationList(o,!0),r._setStorageConversationList(),i.setCode(0).setText(n.length).setEnd(),J.log(\"ConversationController.getConversationList ok.\"),Kt({\"conversationList\":r.getLocalConversationList()})}).catch(function(n){return r.probeNetwork().then(function(e,t){i.setError(n,e,t).setEnd()}),J.error(\"ConversationController.getConversationList error:\",n),Ht(n)})}},{\"key\":\"_syncConversationList\",\"value\":function(){var t=this,o=new Yt;return o.setMethod(jt.SYNC_CONVERSATION_LIST).setStart(),this.pagingStatus===we.PAGING_CONVERSATION.NOT_START&&this.conversationMap.clear(),this._autoPagingSyncConversationList().then(function(e){return t.pagingStatus=we.PAGING_CONVERSATION.RESOLVED,t._setStorageConversationList(),o.setCode(0).setText(\"\".concat(t.conversationMap.size)).setEnd(),e}).catch(function(n){return t.pagingStatus=we.PAGING_CONVERSATION.REJECTED,o.setText(t.pagingTimeStamp),t.probeNetwork().then(function(e,t){o.setError(n,e,t).setEnd()}),Ht(n)})}},{\"key\":\"_autoPagingSyncConversationList\",\"value\":function(){var a=this;this.pagingStatus=we.PAGING_CONVERSATION.PENDING;var e=this.createPackage({\"name\":\"conversation\",\"action\":\"pagingQuery\",\"param\":{\"fromAccount\":this.tim.context.identifier,\"timeStamp\":this.pagingTimeStamp,\"orderType\":1}});return this.connectionController.request(e).then(function(e){var t=e.data,n=t.completeFlag,o=t.conversations,r=void 0===o?[]:o,i=t.timeStamp;if(r.length>0){var s=a._getConversationOptions(r);a._updateLocalConversationList(s,!0)}return a._isReady?a._emitConversationUpdate():a.triggerReady(),a.pagingTimeStamp=i,1!==n?a._autoPagingSyncConversationList():Kt()})}},{\"key\":\"getConversationProfile\",\"value\":function(t){var e=this.conversationMap.has(t)?this.conversationMap.get(t):this.createLocalConversation(t);return e._isInfoCompleted||e.type===S.CONV_SYSTEM?Kt({\"conversation\":e}):(J.log(\"ConversationController.getConversationProfile. conversationID:\",t),this._updateUserOrGroupProfileCompletely(e).then(function(e){return J.log(\"ConversationController.getConversationProfile ok. conversationID:\",t),e}).catch(function(e){return J.error(\"ConversationController.getConversationProfile error:\",e),Ht(e)}))}},{\"key\":\"deleteConversation\",\"value\":function(e){var t=this,n={};if(!this.conversationMap.has(e)){var o=new lt({\"code\":pt.CONVERSATION_NOT_FOUND,\"message\":ht.CONVERSATION_NOT_FOUND});return Ht(o)}switch(this.conversationMap.get(e).type){case S.CONV_C2C:n.type=1,n.toAccount=e.slice(3);break;case S.CONV_GROUP:n.type=2,n.toGroupID=e.slice(5);break;case S.CONV_SYSTEM:return this.tim.groupController.deleteGroupSystemNotice({\"messageList\":this.tim.messageController.getLocalMessageList(e)}),this.deleteLocalConversation(e),Kt({\"conversationID\":e});default:var r=new lt({\"code\":pt.CONVERSATION_UN_RECORDED_TYPE,\"message\":ht.CONVERSATION_UN_RECORDED_TYPE});return Ht(r)}J.log(\"ConversationController.deleteConversation. conversationID:\",e);var i=this.createPackage({\"name\":\"conversation\",\"action\":\"delete\",\"param\":n});return this.tim.setMessageRead({\"conversationID\":e}).then(function(){return t.connectionController.request(i)}).then(function(){return J.log(\"ConversationController.deleteConversation ok. conversationID:\",e),t.deleteLocalConversation(e),Kt({\"conversationID\":e})}).catch(function(e){return J.error(\"ConversationController.deleteConversation error:\",e),Ht(e)})}},{\"key\":\"getLocalConversationList\",\"value\":function(){return E(this.conversationMap.values())}},{\"key\":\"getLocalConversation\",\"value\":function(e){return this.conversationMap.get(e)}},{\"key\":\"_initLocalConversationList\",\"value\":function(){var e=new Yt;e.setMethod(jt.GET_CONVERSATION_LIST_IN_STORAGE).setStart(),J.time(Bt.INIT_CONVERSATION_LIST),J.log(\"ConversationController._initLocalConversationList init\");var t=this._getStorageConversationList();if(t){for(var n=t.length,o=0;o<n;o++)this.conversationMap.set(t[o].conversationID,new wo(t[o]));this._emitConversationUpdate(!0,!1),e.setCode(0).setNetworkType(this.getNetworkType()).setText(n).setEnd()}else e.setCode(0).setNetworkType(this.getNetworkType()).setText(0).setEnd();this._syncConversationList()}},{\"key\":\"_getStorageConversationList\",\"value\":function(){return this.tim.storage.getItem(\"conversationMap\")}},{\"key\":\"_setStorageConversationList\",\"value\":function(){var e=this.getLocalConversationList().slice(0,20).map(function(e){return{\"conversationID\":e.conversationID,\"type\":e.type,\"subType\":e.subType,\"lastMessage\":e.lastMessage,\"groupProfile\":e.groupProfile,\"userProfile\":e.userProfile}});this.tim.storage.setItem(\"conversationMap\",e)}},{\"key\":\"_initListeners\",\"value\":function(){var e=this;this.tim.innerEmitter.once(Pt.CONTEXT_A2KEY_AND_TINYID_UPDATED,this._initLocalConversationList,this),this.tim.innerEmitter.on(Pt.MESSAGE_SENT,this._onSendOrReceiveMessage,this),this.tim.innerEmitter.on(Pt.MESSAGE_SYNC_PROCESSING,this._handleSyncMessages,this),this.tim.innerEmitter.on(Pt.MESSAGE_SYNC_FINISHED,this._handleSyncMessages,this),this.tim.innerEmitter.on(Pt.MESSAGE_C2C_INSTANT_RECEIVED,this._onSendOrReceiveMessage,this),this.tim.innerEmitter.on(Pt.MESSAGE_GROUP_INSTANT_RECEIVED,this._onSendOrReceiveMessage,this),this.tim.innerEmitter.on(Pt.MESSAGE_GROUP_SYSTEM_NOTICE_RECEIVED,this._onSendOrReceiveMessage,this),this.tim.innerEmitter.on(Pt.GROUP_LIST_UPDATED,this._updateConversationGroupProfile,this),this.tim.innerEmitter.on(Pt.PROFILE_UPDATED,this._updateConversationUserProfile,this),this.tim.innerEmitter.on(Pt.MESSAGE_REVOKED,this._onMessageRevoked,this),this.ready(function(){e.tempGroupList.length>0&&(e._updateConversationGroupProfile(e.tempGroupList),e.tempGroupList.length=0)})}},{\"key\":\"_updateConversationGroupProfile\",\"value\":function(e){var o=this;ie(e)&&0===e.length||(this.hasLocalConversationMap()?(e.forEach(function(e){var t=\"GROUP\".concat(e.groupID);if(o.conversationMap.has(t)){var n=o.conversationMap.get(t);n.groupProfile=e,n.lastMessage.lastSequence=e.nextMessageSeq-1,n.subType||(n.subType=e.type)}}),this._emitConversationUpdate(!0,!1)):this.tempGroupList=e)}},{\"key\":\"_updateConversationUserProfile\",\"value\":function(e){var n=this;e.data.forEach(function(e){var t=\"C2C\".concat(e.userID);n.conversationMap.has(t)&&(n.conversationMap.get(t).userProfile=e)}),this._emitConversationUpdate(!0,!1)}},{\"key\":\"_onMessageRevoked\",\"value\":function(e){var t=this,n=e.data;if(0!==n.length){var o=null,r=!1;n.forEach(function(e){(o=t.conversationMap.get(e.conversationID))&&o.isLastMessageRevoked(e)&&(r=!0,o.setLastMessageRevoked(!0))}),r&&this._emitConversationUpdate(!0,!1)}}},{\"key\":\"_handleSyncMessages\",\"value\":function(e){this._onSendOrReceiveMessage(e,!0)}},{\"key\":\"_onSendOrReceiveMessage\",\"value\":function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=e.data.eventDataList;this._isReady?0!==o.length&&(this._updateLocalConversationList(o,!1,n),this._setStorageConversationList(),this._emitConversationUpdate()):this.ready(function(){t._onSendOrReceiveMessage(e,n)})}},{\"key\":\"_updateLocalConversationList\",\"value\":function(e,t,n){var o;o=this._updateTempConversations(e,t,n),this.conversationMap=new Map(this._sortConversations([].concat(E(o.conversations),E(this.conversationMap)))),t||this._updateUserOrGroupProfile(o.newerConversations)}},{\"key\":\"_updateTempConversations\",\"value\":function(e,t,n){for(var o=[],r=[],i=0,s=e.length;i<s;i++){var a=new wo(e[i]),u=this.conversationMap.get(a.conversationID);if(this.conversationMap.has(a.conversationID)){var c=[\"unreadCount\",\"allowType\",\"adminForbidType\",\"payload\"];n&&c.push(\"lastMessage\"),de(u,a,c,[null,void 0,\"\",0,NaN]),u.updateUnreadCount(a.unreadCount,t),n||(u.lastMessage.payload=e[i].lastMessage.payload),this.conversationMap.delete(u.conversationID),o.push([u.conversationID,u])}else{if(a.type===S.CONV_GROUP){var l=a.groupProfile.groupID,p=this.tim.groupController.getLocalGroupProfile(l);p&&(a.groupProfile=p,a.updateUnreadCount(0))}r.push(a),o.push([a.conversationID,a])}}return{\"conversations\":o,\"newerConversations\":r}}},{\"key\":\"_sortConversations\",\"value\":function(e){return e.sort(function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime})}},{\"key\":\"_updateUserOrGroupProfile\",\"value\":function(e){var o=this;if(0!==e.length){var n=[],r=[];e.forEach(function(e){if(e.type===S.CONV_C2C)n.push(e.toAccount);else if(e.type===S.CONV_GROUP){var t=e.toAccount;o.tim.groupController.hasLocalGroup(t)?e.groupProfile=o.tim.groupController.getLocalGroupProfile(t):r.push(t)}}),n.length>0&&this.tim.getUserProfile({\"userIDList\":n}).then(function(e){var t=e.data;ie(t)?t.forEach(function(e){o.conversationMap.get(\"C2C\".concat(e.userID)).userProfile=e}):o.conversationMap.get(\"C2C\".concat(t.userID)).userProfile=t}),r.length>0&&this.tim.groupController.getGroupProfileAdvance({\"groupIDList\":r,\"responseFilter\":{\"groupBaseInfoFilter\":[\"Type\",\"Name\",\"FaceUrl\"]}}).then(function(e){e.data.successGroupList.forEach(function(e){var t=\"GROUP\".concat(e.groupID);if(o.conversationMap.has(t)){var n=o.conversationMap.get(t);de(n.groupProfile,e,[],[null,void 0,\"\",0,NaN]),!n.subType&&e.type&&(n.subType=e.type)}})})}}},{\"key\":\"_updateUserOrGroupProfileCompletely\",\"value\":function(n){var o=this;return n.type===S.CONV_C2C?this.tim.getUserProfile({\"userIDList\":[n.toAccount]}).then(function(e){var t=e.data;return 0===t.length?Ht(new lt({\"code\":pt.USER_OR_GROUP_NOT_FOUND,\"message\":ht.USER_OR_GROUP_NOT_FOUND})):(n.userProfile=t[0],n._isInfoCompleted=!0,o._unshiftConversation(n),Kt({\"conversation\":n}))}):this.tim.getGroupProfile({\"groupID\":n.toAccount}).then(function(e){return n.groupProfile=e.data.group,n._isInfoCompleted=!0,o._unshiftConversation(n),Kt({\"conversation\":n})})}},{\"key\":\"_unshiftConversation\",\"value\":function(e){e instanceof wo&&!this.conversationMap.has(e.conversationID)&&(this.conversationMap=new Map([[e.conversationID,e]].concat(E(this.conversationMap))),this._setStorageConversationList(),this._emitConversationUpdate(!0,!1))}},{\"key\":\"deleteLocalConversation\",\"value\":function(e){return this.conversationMap.delete(e),this._setStorageConversationList(),this.tim.innerEmitter.emit(Pt.CONVERSATION_DELETED,e),this._emitConversationUpdate(!0,!1),this.conversationMap.has(e)}},{\"key\":\"_getConversationOptions\",\"value\":function(e){var n=[],t=e.filter(function(e){var t=e.lastMsg;return re(t)}).map(function(e){if(1===e.type){var t={\"userID\":e.userID,\"nick\":e.c2CNick,\"avatar\":e.c2CImage};return n.push(t),{\"conversationID\":\"C2C\".concat(e.userID),\"type\":\"C2C\",\"lastMessage\":{\"lastTime\":e.time,\"lastSequence\":e.sequence,\"fromAccount\":e.lastC2CMsgFromAccount,\"messageForShow\":e.messageShow,\"type\":e.lastMsg.elements[0]?e.lastMsg.elements[0].type:null,\"payload\":e.lastMsg.elements[0]?e.lastMsg.elements[0].content:null},\"userProfile\":new So(t)}}return{\"conversationID\":\"GROUP\".concat(e.groupID),\"type\":\"GROUP\",\"lastMessage\":{\"lastTime\":e.time,\"lastSequence\":e.messageReadSeq+e.unreadCount,\"fromAccount\":e.msgGroupFromAccount,\"messageForShow\":e.messageShow,\"type\":e.lastMsg.elements[0]?e.lastMsg.elements[0].type:null,\"payload\":e.lastMsg.elements[0]?e.lastMsg.elements[0].content:null},\"groupProfile\":new Go({\"groupID\":e.groupID,\"name\":e.groupNick,\"avatar\":e.groupImage}),\"unreadCount\":e.unreadCount}});return n.length>0&&this.tim.innerEmitter.emit(Pt.CONVERSATION_LIST_PROFILE_UPDATED,{\"data\":n}),t}},{\"key\":\"_emitConversationUpdate\",\"value\":function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=E(this.conversationMap.values());t&&this.tim.innerEmitter.emit(Pt.CONVERSATION_LIST_UPDATED,n),e&&this.tim.outerEmitter.emit(v.CONVERSATION_LIST_UPDATED,n)}},{\"key\":\"_conversationMapTreeShaking\",\"value\":function(e){var t=this,n=new Map(E(this.conversationMap));e.forEach(function(e){return n.delete(e.conversationID)}),n.has(S.CONV_SYSTEM)&&n.delete(S.CONV_SYSTEM);var o=this.tim.groupController.getJoinedAVChatRoom();o&&n.delete(\"\".concat(S.CONV_GROUP).concat(o.groupID)),E(n.keys()).forEach(function(e){return t.conversationMap.delete(e)})}},{\"key\":\"reset\",\"value\":function(){this.pagingStatus=we.PAGING_CONVERSATION.NOT_START,this.pagingTimeStamp=0,this.conversationMap.clear(),this.resetReady(),this.tim.innerEmitter.once(Pt.CONTEXT_A2KEY_AND_TINYID_UPDATED,this._initLocalConversationList,this)}}]),r}(),Uo=function(){function e(t){if(o(this,e),void 0===t)throw new lt({\"code\":pt.MESSAGE_LIST_CONSTRUCTOR_NEED_OPTIONS,\"message\":ht.MESSAGE_LIST_CONSTRUCTOR_NEED_OPTIONS});if(void 0===t.tim)throw new lt({\"code\":pt.MESSAGE_LIST_CONSTRUCTOR_NEED_OPTIONS,\"message\":\"\".concat(ht.MESSAGE_LIST_CONSTRUCTOR_NEED_OPTIONS,\".tim\")});this.list=new Map,this.tim=t.tim,this._initializeOptions(t)}return s(e,[{\"key\":\"getLocalOldestMessageByConversationID\",\"value\":function(e){if(!e)return null;if(!this.list.has(e))return null;var t=this.list.get(e).values();return t?t.next().value:null}},{\"key\":\"_initializeOptions\",\"value\":function(e){this.options={};var t={\"memory\":{\"maxDatasPerKey\":100,\"maxBytesPerData\":256,\"maxKeys\":0},\"cache\":{\"maxDatasPerKey\":10,\"maxBytesPerData\":256,\"maxKeys\":0}};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(void 0===e[n]){this.options[n]=t[n];continue}var o=t[n];for(var r in o)if(Object.prototype.hasOwnProperty.call(o,r)){if(void 0===e[n][r]){this.options[n][r]=o[r];continue}this.options[n][r]=e[n][r]}}}},{\"key\":\"pushIn\",\"value\":function(e){var t=e.conversationID,n=e.ID,o=!0;return this.list.has(t)||this.list.set(t,new Map),this.list.has(t)&&this.list.get(t).has(n)?o=!1:this.list.get(t).set(n,e),o}},{\"key\":\"unshift\",\"value\":function(e){ie(e)?e.length>0&&this._unshiftMultipleMessages(e):this._unshiftSingleMessage(e)}},{\"key\":\"_unshiftSingleMessage\",\"value\":function(e){var t=e.conversationID,n=e.ID;if(!this.list.has(t))return this.list.set(t,new Map),void this.list.get(t).set(n,e);var o=Array.from(this.list.get(t));o.unshift([n,e]),this.list.set(t,new Map(o))}},{\"key\":\"_unshiftMultipleMessages\",\"value\":function(e){for(var t=e.length,n=[],o=e[0].conversationID,r=this.list.has(o)?Array.from(this.list.get(o)):[],i=0;i<t;i++)n.push([e[i].ID,e[i]]);this.list.set(o,new Map(n.concat(r)))}},{\"key\":\"remove\",\"value\":function(e){var t=e.conversationID,n=e.ID;this.list.has(t)&&this.list.get(t).delete(n)}},{\"key\":\"revoke\",\"value\":function(e,t,n){if(J.debug(\"revoke message\",e,t,n),this.list.has(e)){var o=this.list.get(e),r=!0,i=!1,s=void 0;try{for(var a,u=o[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var c=m(a.value,2)[1];if(c.sequence===t&&!c.isRevoked&&(se(n)||c.random===n))return c.isRevoked=!0,c}}catch(e){i=!0,s=e}finally{try{r||null==u.return||u.return()}finally{if(i)throw s}}}return null}},{\"key\":\"removeByConversationID\",\"value\":function(e){this.list.has(e)&&this.list.delete(e)}},{\"key\":\"hasLocalMessageList\",\"value\":function(e){return this.list.has(e)}},{\"key\":\"getLocalMessageList\",\"value\":function(e){return this.hasLocalMessageList(e)?E(this.list.get(e).values()):[]}},{\"key\":\"hasLocalMessage\",\"value\":function(e,t){return!!this.hasLocalMessageList(e)&&this.list.get(e).has(t)}},{\"key\":\"getLocalMessage\",\"value\":function(e,t){return this.hasLocalMessage(e,t)?this.list.get(e).get(t):null}},{\"key\":\"reset\",\"value\":function(){this.list.clear()}}]),e}(),xo=function(){function e(t){o(this,e),this.tim=t}return s(e,[{\"key\":\"setMessageRead\",\"value\":function(e){var t=e.conversationID,n=e.messageID,o=this.tim.conversationController.getLocalConversation(t);if(!o||0===o.unreadCount)return Kt();var r=n?this.tim.messageController.getLocalMessage(t,n):null;switch(o.type){case S.CONV_C2C:return this._setC2CMessageRead({\"conversationID\":t,\"lastMessageTime\":r?r.time:o.lastMessage.lastTime});case S.CONV_GROUP:return this._setGroupMessageRead({\"conversationID\":t,\"lastMessageSeq\":r?r.sequence:o.lastMessage.lastSequence});case S.CONV_SYSTEM:return o.unreadCount=0,Kt();default:return Kt()}}},{\"key\":\"_setC2CMessageRead\",\"value\":function(e){var t=e.conversationID,n=e.lastMessageTime,o=this.tim.messageController.createPackage({\"name\":\"conversation\",\"action\":\"setC2CMessageRead\",\"param\":{\"C2CMsgReaded\":{\"cookie\":\"\",\"C2CMsgReadedItem\":[{\"toAccount\":t.replace(\"C2C\",\"\"),\"lastMessageTime\":n}]}}});return this._updateIsReadAfterReadReport({\"conversationID\":t,\"lastMessageTime\":n}),this._updateUnreadCount(t),this.tim.connectionController.request(o).then(function(){return new Ft}).catch(function(e){return Ht(e)})}},{\"key\":\"_setGroupMessageRead\",\"value\":function(e){var t=e.conversationID,n=e.lastMessageSeq,o=this.tim.messageController.createPackage({\"name\":\"conversation\",\"action\":\"setGroupMessageRead\",\"param\":{\"groupID\":t.replace(\"GROUP\",\"\"),\"messageReadSeq\":n}});return this._updateIsReadAfterReadReport({\"conversationID\":t,\"lastMessageSeq\":n}),this._updateUnreadCount(t),this.tim.connectionController.request(o).then(function(){return new Ft}).catch(function(e){return Ht(e)})}},{\"key\":\"_updateUnreadCount\",\"value\":function(e){var t=this.tim,n=t.conversationController,o=t.messageController,r=n.getLocalConversation(e),i=o.getLocalMessageList(e);r&&(r.unreadCount=i.filter(function(e){return!e.isRead}).length)}},{\"key\":\"_updateIsReadAfterReadReport\",\"value\":function(e){var t=e.conversationID,n=e.lastMessageSeq,o=e.lastMessageTime,r=this.tim.messageController.getLocalMessageList(t);if(0!==r.length)for(var i=r.length-1;i>=0;i--){var s=r[i];if(!(o&&s.time>o||n&&s.sequence>n)){if(\"in\"===s.flow&&s.isRead)break;s.setIsRead(!0)}}}},{\"key\":\"updateIsRead\",\"value\":function(e){var t=this.tim,n=t.conversationController,o=t.messageController,r=n.getLocalConversation(e),i=o.getLocalMessageList(e);if(r&&0!==i.length&&!Ge(r.type)){for(var s=[],a=0;a<i.length;a++)\"in\"!==i[a].flow?\"out\"!==i[a].flow||i[a].isRead||i[a].setIsRead(!0):s.push(i[a]);var u=0;if(r.type===S.CONV_C2C){var c=s.slice(-r.unreadCount).filter(function(e){return e.isRevoked}).length;u=s.length-r.unreadCount-c}else u=s.length-r.unreadCount;for(var l=0;l<u&&!s[l].isRead;l++)s[l].setIsRead(!0)}}}]),e}(),Fo=function(){function e(t){var n=t.tim,r=t.messageController;o(this,e),this.tim=n,this.messageController=r,this.completedMap=new Map,this._initListener()}return s(e,[{\"key\":\"getMessageList\",\"value\":function(e){var t=this,n=e.conversationID,o=e.nextReqMessageID,r=e.count;if(this.tim.groupController.checkJoinedAVChatRoomByID(n.replace(\"GROUP\",\"\")))return Kt({\"messageList\":[],\"nextReqMessageID\":\"\",\"isCompleted\":!0});(se(r)||r>15)&&(r=15);var i=this._computeLeftCount({\"conversationID\":n,\"nextReqMessageID\":o});return this._needGetHistory({\"conversationID\":n,\"leftCount\":i,\"count\":r})?this.messageController.getHistoryMessages({\"conversationID\":n,\"count\":20}).then(function(){return i=t._computeLeftCount({\"conversationID\":n,\"nextReqMessageID\":o}),new Ft(t._computeResult({\"conversationID\":n,\"nextReqMessageID\":o,\"count\":r,\"leftCount\":i}))}):Kt(this._computeResult({\"conversationID\":n,\"nextReqMessageID\":o,\"count\":r,\"leftCount\":i}))}},{\"key\":\"setCompleted\",\"value\":function(e){this.completedMap.set(e,!0)}},{\"key\":\"deleteCompletedItem\",\"value\":function(e){this.completedMap.delete(e)}},{\"key\":\"_initListener\",\"value\":function(){var n=this;this.tim.innerEmitter.on(Pt.SDK_READY,function(){n.completedMap.set(S.CONV_SYSTEM,!0)}),this.tim.innerEmitter.on(Pt.AVCHATROOM_JOIN_SUCCESS,function(e){var t=e.data;n.completedMap.set(\"\".concat(S.CONV_GROUP).concat(t),!0)})}},{\"key\":\"_getMessageListSize\",\"value\":function(e){return this.messageController.getLocalMessageList(e).length}},{\"key\":\"_needGetHistory\",\"value\":function(e){var t=e.conversationID,n=e.leftCount,o=e.count,r=this.tim.conversationController.getLocalConversation(t),i=!!r&&r.type===S.CONV_SYSTEM,s=!!r&&r.subType===S.GRP_AVCHATROOM;return!i&&!s&&(n<o&&!this.completedMap.has(t))}},{\"key\":\"_computeResult\",\"value\":function(e){var t=e.conversationID,n=e.nextReqMessageID,o=e.count,r=e.leftCount,i=this._computeMessageList({\"conversationID\":t,\"nextReqMessageID\":n,\"count\":o}),s=this._computeIsCompleted({\"conversationID\":t,\"leftCount\":r,\"count\":o});return{\"messageList\":i,\"nextReqMessageID\":this._computeNextReqMessageID({\"messageList\":i,\"isCompleted\":s,\"conversationID\":t}),\"isCompleted\":s}}},{\"key\":\"_computeNextReqMessageID\",\"value\":function(e){var t=e.messageList,n=e.isCompleted,o=e.conversationID;if(!n)return 0===t.length?\"\":t[0].ID;var r=this.messageController.getLocalMessageList(o);return 0===r.length?\"\":r[0].ID}},{\"key\":\"_computeMessageList\",\"value\":function(e){var t=e.conversationID,n=e.nextReqMessageID,o=e.count,r=this.messageController.getLocalMessageList(t),i=this._computeIndexEnd({\"nextReqMessageID\":n,\"messageList\":r}),s=this._computeIndexStart({\"indexEnd\":i,\"count\":o});return r.slice(s,i)}},{\"key\":\"_computeIndexEnd\",\"value\":function(e){var t=e.messageList,n=void 0===t?[]:t,o=e.nextReqMessageID;return o?n.findIndex(function(e){return e.ID===o}):n.length}},{\"key\":\"_computeIndexStart\",\"value\":function(e){var t=e.indexEnd,n=e.count;return t>n?t-n:0}},{\"key\":\"_computeLeftCount\",\"value\":function(e){var t=e.conversationID,n=e.nextReqMessageID;return n?this.messageController.getLocalMessageList(t).findIndex(function(e){return e.ID===n}):this._getMessageListSize(t)}},{\"key\":\"_computeIsCompleted\",\"value\":function(e){var t=e.conversationID;return!!(e.leftCount<=e.count&&this.completedMap.has(t))}},{\"key\":\"reset\",\"value\":function(){this.completedMap.clear()}}]),e}(),Vo=function e(t){o(this,e),this.value=t,this.next=null},Ko=function(){function e(t){o(this,e),this.MAX_LENGTH=t,this.pTail=null,this.pNodeToDel=null,this.map=new Map,J.log(\"SinglyLinkedList init MAX_LENGTH=\".concat(this.MAX_LENGTH))}return s(e,[{\"key\":\"pushIn\",\"value\":function(e){var t=new Vo(e);if(this.map.size<this.MAX_LENGTH)null===this.pTail?(this.pTail=t,this.pNodeToDel=t):(this.pTail.next=t,this.pTail=t),this.map.set(e,1);else{var n=this.pNodeToDel;this.pNodeToDel=this.pNodeToDel.next,this.map.delete(n.value),n.next=null,n=null,this.pTail.next=t,this.pTail=t,this.map.set(e,1)}}},{\"key\":\"has\",\"value\":function(e){return this.map.has(e)}},{\"key\":\"reset\",\"value\":function(){for(var e;null!==this.pNodeToDel;)e=this.pNodeToDel,this.pNodeToDel=this.pNodeToDel.next,e.next=null,e=null;this.pTail=null,this.map.clear()}}]),e}(),Ho=function(){function e(t){o(this,e),this.tim=t}return s(e,[{\"key\":\"upload\",\"value\":function(e){switch(e.type){case S.MSG_IMAGE:return this._uploadImage(e);case S.MSG_FILE:return this._uploadFile(e);case S.MSG_AUDIO:return this._uploadAudio(e);case S.MSG_VIDEO:return this._uploadVideo(e);default:return Promise.resolve()}}},{\"key\":\"_uploadImage\",\"value\":function(o){var e=this.tim,t=e.uploadController,n=e.messageController,s=o.getElements()[0],r=n.getMessageOptionByID(o.messageID);return t.uploadImage({\"file\":r.payload.file,\"to\":r.to,\"onProgress\":function(e){if(s.updatePercent(e),ue(r.onProgress))try{r.onProgress(e)}catch(e){return Ht(new lt({\"code\":pt.MESSAGE_ONPROGRESS_FUNCTION_ERROR,\"message\":\"\".concat(ht.MESSAGE_ONPROGRESS_FUNCTION_ERROR)}))}}}).then(function(e){var o,t=e.location,n=e.fileType,r=e.fileSize,i=Me(t);return s.updateImageFormat(n),s.updateImageInfoArray({\"size\":r,\"url\":i}),o=s._imageMemoryURL,L?new Promise(function(t,e){wx.getImageInfo({\"src\":o,\"success\":function(e){t({\"width\":e.width,\"height\":e.height})},\"fail\":function(){t({\"width\":0,\"height\":0})}})}):x&&9===F?Promise.resolve({\"width\":0,\"height\":0}):new Promise(function(e,t){var n=new Image;n.onload=function(){e({\"width\":this.width,\"height\":this.height}),n=null},n.onerror=function(){e({\"width\":0,\"height\":0}),n=null},n.src=o})}).then(function(e){var t=e.width,n=e.height;return s.updateImageInfoArray({\"width\":t,\"height\":n}),o})}},{\"key\":\"_uploadFile\",\"value\":function(o){var e=this.tim,t=e.uploadController,n=e.messageController,r=o.getElements()[0],i=n.getMessageOptionByID(o.messageID);return t.uploadFile({\"file\":i.payload.file,\"to\":i.to,\"onProgress\":function(e){if(r.updatePercent(e),ue(i.onProgress))try{i.onProgress(e)}catch(e){return Ht(new lt({\"code\":pt.MESSAGE_ONPROGRESS_FUNCTION_ERROR,\"message\":\"\".concat(ht.MESSAGE_ONPROGRESS_FUNCTION_ERROR)}))}}}).then(function(e){var t=e.location,n=Me(t);return r.updateFileUrl(n),o})}},{\"key\":\"_uploadAudio\",\"value\":function(o){var e=this.tim,t=e.uploadController,n=e.messageController,r=o.getElements()[0],i=n.getMessageOptionByID(o.messageID);return t.uploadAudio({\"file\":i.payload.file,\"to\":i.to,\"onProgress\":function(e){if(r.updatePercent(e),ue(i.onProgress))try{i.onProgress(e)}catch(e){return Ht(new lt({\"code\":pt.MESSAGE_ONPROGRESS_FUNCTION_ERROR,\"message\":\"\".concat(ht.MESSAGE_ONPROGRESS_FUNCTION_ERROR)}))}}}).then(function(e){var t=e.location,n=Me(t);return r.updateAudioUrl(n),o})}},{\"key\":\"_uploadVideo\",\"value\":function(n){var e=this.tim,t=e.uploadController,o=e.messageController,r=n.getElements()[0],i=o.getMessageOptionByID(n.messageID);return t.uploadVideo({\"file\":i.payload.file,\"to\":i.to,\"onProgress\":function(e){if(r.updatePercent(e),ue(i.onProgress))try{i.onProgress(e)}catch(e){return Ht(new lt({\"code\":pt.MESSAGE_ONPROGRESS_FUNCTION_ERROR,\"message\":\"\".concat(ht.MESSAGE_ONPROGRESS_FUNCTION_ERROR)}))}}}).then(function(e){if(L){var t=Me(e.location);return r.updateVideoUrl(t),n}})}}]),e}(),Bo=function(e){function r(e){var t;return o(this,r),(t=d(this,p(r).call(this,e)))._initializeMembers(),t._initializeListener(),t._initialzeHandlers(),t.messageOptionMap=new Map,t}return l(r,bt),s(r,[{\"key\":\"_initializeMembers\",\"value\":function(){this.messagesList=new Uo({\"tim\":this.tim}),this.currentMessageKey={},this.singlyLinkedList=new Ko(100)}},{\"key\":\"_initialzeHandlers\",\"value\":function(){this.readReportHandler=new xo(this.tim),this.getMessageHandler=new Fo({\"messageController\":this,\"tim\":this.tim}),this.uploadFileHandler=new Ho(this.tim)}},{\"key\":\"reset\",\"value\":function(){this.messagesList.reset(),this.currentMessageKey={},this.getMessageHandler.reset(),this.singlyLinkedList.reset(),this.messageOptionMap.clear()}},{\"key\":\"_initializeListener\",\"value\":function(){var e=this.tim.innerEmitter;e.on(Pt.NOTICE_LONGPOLL_NEW_C2C_NOTICE,this._onReceiveC2CMessage,this),e.on(Pt.SYNC_MESSAGE_C2C_PROCESSING,this._onSyncMessagesProcessing,this),e.on(Pt.SYNC_MESSAGE_C2C_FINISHED,this._onSyncMessagesFinished,this),e.on(Pt.NOTICE_LONGPOLL_NEW_GROUP_MESSAGES,this._onReceiveGroupMessage,this),e.on(Pt.NOTICE_LONGPOLL_NEW_GROUP_TIPS,this._onReceiveGroupTips,this),e.on(Pt.NOTICE_LONGPOLL_NEW_GROUP_NOTICE,this._onReceiveSystemNotice,this),e.on(Pt.NOTICE_LONGPOLL_GROUP_MESSAGE_REVOKED,this._onReceiveGroupMessageRevokedNotice,this),e.on(Pt.NOTICE_LONGPOLL_C2C_MESSAGE_REVOKED,this._onReceiveC2CMessageRevokedNotice,this),e.on(Pt.CONVERSATION_DELETED,this._clearConversationMessages,this)}},{\"key\":\"sendMessageInstance\",\"value\":function(t){var n,r=this,e=this.tim,o=e.innerEmitter,i=e.sumStatController,s=null;switch(t.conversationType){case S.CONV_C2C:s=this._handleOnSendC2CMessageSuccess.bind(this);break;case S.CONV_GROUP:s=this._handleOnSendGroupMessageSuccess.bind(this);break;default:return Ht(new lt({\"code\":pt.MESSAGE_SEND_INVALID_CONVERSATION_TYPE,\"message\":ht.MESSAGE_SEND_INVALID_CONVERSATION_TYPE}))}return this.singlyLinkedList.pushIn(t.random),this.uploadFileHandler.upload(t).then(function(){var e=null;return t.isSendable()?(i.addTotalCount(Bt.SEND_MESSAGE),n=Date.now(),t.conversationType===S.CONV_C2C?e=r._createC2CMessagePack(t):t.conversationType===S.CONV_GROUP&&(e=r._createGroupMessagePack(t)),r.tim.connectionController.request(e)):Ht({\"code\":pt.MESSAGE_FILE_URL_IS_EMPTY,\"message\":ht.MESSAGE_FILE_URL_IS_EMPTY})}).then(function(e){return i.addSuccessCount(Bt.SEND_MESSAGE),i.addCost(Bt.SEND_MESSAGE,Math.abs(Date.now()-n)),t.conversationType===S.CONV_GROUP&&(t.sequence=e.data.sequence,t.time=e.data.time,t.generateMessageID(r.tim.context.identifier)),r.messagesList.pushIn(t),s(t,e.data),r.messageOptionMap.delete(t.messageID),o.emit(Pt.MESSAGE_SENT,{\"data\":{\"eventDataList\":[{\"conversationID\":t.conversationID,\"unreadCount\":0,\"type\":t.conversationType,\"subType\":t.conversationSubType,\"lastMessage\":t}]}}),new Ft({\"message\":t})}).catch(function(n){t.status=we.MESSAGE_STATUS.FAIL;var o=new Yt;return o.setMethod(jt.SEND_MESSAGE).setMessageType(t.type).setText(\"\".concat(r._generateTjgID(t),\"-\").concat(t.type,\"-\").concat(t.from,\"-\").concat(t.to)).setStart(),r.probeNetwork().then(function(e,t){o.setError(n,e,t).setEnd()}),J.error(\"MessageController.sendMessageInstance error:\",n),Ht(new lt({\"code\":n&&n.code?n.code:pt.MESSAGE_SEND_FAIL,\"message\":n&&n.message?n.message:ht.MESSAGE_SEND_FAIL,\"data\":{\"message\":t}}))})}},{\"key\":\"resendMessage\",\"value\":function(e){return e.isResend=!0,e.status=we.MESSAGE_STATUS.UNSEND,this.sendMessageInstance(e)}},{\"key\":\"_isFileLikeMessage\",\"value\":function(e){return[S.MSG_IMAGE,S.MSG_FILE,S.MSG_AUDIO,S.MSG_VIDEO].indexOf(e.type)>=0}},{\"key\":\"_resendBinaryTypeMessage\",\"value\":function(){}},{\"key\":\"_createC2CMessagePack\",\"value\":function(e){return this.createPackage({\"name\":\"c2cMessage\",\"action\":\"create\",\"tjgID\":this._generateTjgID(e),\"param\":{\"toAccount\":e.to,\"msgBody\":e.getElements(),\"msgSeq\":e.sequence,\"msgRandom\":e.random}})}},{\"key\":\"_handleOnSendC2CMessageSuccess\",\"value\":function(e,t){var n=this.tim.innerEmitter;e.status=we.MESSAGE_STATUS.SUCCESS,e.time=t.time,n.emit(Pt.MESSAGE_C2C_SEND_SUCCESS,{\"data\":{\"eventDataList\":[{\"conversationID\":e.conversationID,\"unreadCount\":0,\"type\":e.conversationType,\"subType\":e.conversationSubType,\"lastMessage\":e}]}})}},{\"key\":\"_createGroupMessagePack\",\"value\":function(e){return this.createPackage({\"name\":\"groupMessage\",\"action\":\"create\",\"tjgID\":this._generateTjgID(e),\"param\":{\"groupID\":e.to,\"msgBody\":e.getElements(),\"random\":e.random,\"clientSequence\":e.clientSequence}})}},{\"key\":\"_handleOnSendGroupMessageSuccess\",\"value\":function(e,t){var n=this.tim.innerEmitter;e.sequence=t.sequence,e.time=t.time,e.status=we.MESSAGE_STATUS.SUCCESS,n.emit(Pt.MESSAGE_GROUP_SEND_SUCCESS,{\"data\":{\"eventDataList\":[{\"conversationID\":e.conversationID,\"unreadCount\":0,\"type\":e.conversationType,\"subType\":e.conversationSubType,\"lastMessage\":e}]}})}},{\"key\":\"_onReceiveC2CMessage\",\"value\":function(e){J.debug(\"MessageController._onReceiveC2CMessage nums=\".concat(e.data.length));var t=this.tim,n=t.innerEmitter,o=t.outerEmitter,r=this._newC2CMessageStoredAndSummary({\"notifiesList\":e.data,\"type\":S.CONV_C2C,\"C2CRemainingUnreadList\":e.C2CRemainingUnreadList}),i=r.eventDataList,s=r.result;i.length>0&&n.emit(Pt.MESSAGE_C2C_INSTANT_RECEIVED,{\"data\":{\"eventDataList\":i,\"result\":s},\"resource\":this}),s.length>0&&o.emit(v.MESSAGE_RECEIVED,s)}},{\"key\":\"_onReceiveGroupMessage\",\"value\":function(e){J.debug(\"MessageController._onReceiveGroupMessage nums=\".concat(e.data.length));var t=this.tim,n=t.outerEmitter,o=t.innerEmitter,r=this.newGroupMessageStoredAndSummary(e.data),i=r.eventDataList,s=r.result;i.length>0&&o.emit(Pt.MESSAGE_GROUP_INSTANT_RECEIVED,{\"data\":{\"eventDataList\":i,\"result\":s,\"isGroupTip\":!1}}),s.length>0&&n.emit(v.MESSAGE_RECEIVED,s)}},{\"key\":\"_onReceiveGroupTips\",\"value\":function(e){var t=this.tim,n=t.outerEmitter,o=t.innerEmitter,r=e.data;J.debug(\"MessageController._onReceiveGroupTips nums=\".concat(r.length));var i=this.newGroupTipsStoredAndSummary(r),s=i.eventDataList,a=i.result;s.length>0&&o.emit(Pt.MESSAGE_GROUP_INSTANT_RECEIVED,{\"data\":{\"eventDataList\":s,\"result\":a,\"isGroupTip\":!0}}),a.length>0&&n.emit(v.MESSAGE_RECEIVED,a)}},{\"key\":\"_onReceiveSystemNotice\",\"value\":function(e){var t=this.tim,n=t.outerEmitter,o=t.innerEmitter,r=e.data,i=r.groupSystemNotices,s=r.type;J.debug(\"MessageController._onReceiveSystemNotice nums=\".concat(i.length));var a=this.newSystemNoticeStoredAndSummary({\"notifiesList\":i,\"type\":s}),u=a.eventDataList,c=a.result;u.length>0&&o.emit(Pt.MESSAGE_GROUP_SYSTEM_NOTICE_RECEIVED,{\"data\":{\"eventDataList\":u,\"result\":c,\"type\":s}}),c.length>0&&\"poll\"===s&&n.emit(v.MESSAGE_RECEIVED,c)}},{\"key\":\"_onReceiveGroupMessageRevokedNotice\",\"value\":function(e){var t=this;J.debug(\"MessageController._onReceiveGroupMessageRevokedNotice nums=\".concat(e.data.length));var n=[],o=null;e.data.forEach(function(e){e.elements.revokedInfos.forEach(function(e){(o=t.messagesList.revoke(\"GROUP\".concat(e.groupID),e.sequence))&&n.push(o)})}),0!==n.length&&(this.tim.innerEmitter.emit(Pt.MESSAGE_REVOKED,{\"data\":n}),this.tim.outerEmitter.emit(v.MESSAGE_REVOKED,n))}},{\"key\":\"_onReceiveC2CMessageRevokedNotice\",\"value\":function(e){var t=this;J.debug(\"MessageController._onReceiveC2CMessageRevokedNotice nums=\".concat(e.data.length));var n=[],o=null;e.data.forEach(function(e){e.c2cMessageRevokedNotify.revokedInfos.forEach(function(e){(o=t.messagesList.revoke(\"C2C\".concat(e.from),e.sequence,e.random))&&n.push(o)})}),0!==n.length&&(this.tim.innerEmitter.emit(Pt.MESSAGE_REVOKED,{\"data\":n}),this.tim.outerEmitter.emit(v.MESSAGE_REVOKED,n))}},{\"key\":\"_clearConversationMessages\",\"value\":function(e){this.messagesList.removeByConversationID(e),this.getMessageHandler.deleteCompletedItem(e)}},{\"key\":\"_pushIntoNoticeResult\",\"value\":function(e,t){var n=this.messagesList.pushIn(t),o=this.singlyLinkedList.has(t.random);return!(!n||!1!==o)&&(e.push(t),!0)}},{\"key\":\"_newC2CMessageStoredAndSummary\",\"value\":function(e){for(var t=e.notifiesList,n=e.type,o=e.C2CRemainingUnreadList,r=e.isFromSync,i=null,s=[],a=[],u={},c=this.tim.bigDataHallwayController,l=0,p=t.length;l<p;l++){var h=t[l];if(h.currentUser=this.tim.context.identifier,h.conversationType=n,h.isSystemMessage=!!h.isSystemMessage,i=new Et(h),h.elements=c.parseElements(h.elements,h.from),i.setElement(h.elements),!r)if(!this._pushIntoNoticeResult(a,i))continue;void 0===u[i.conversationID]?u[i.conversationID]=s.push({\"conversationID\":i.conversationID,\"unreadCount\":\"out\"===i.flow?0:1,\"type\":i.conversationType,\"subType\":i.conversationSubType,\"lastMessage\":i})-1:(s[u[i.conversationID]].type=i.conversationType,s[u[i.conversationID]].subType=i.conversationSubType,s[u[i.conversationID]].lastMessage=i,\"in\"===i.flow&&s[u[i.conversationID]].unreadCount++)}if(ie(o))for(var _=function(t,e){var n=s.find(function(e){return e.conversationID===\"C2C\".concat(o[t].from)});n?n.unreadCount+=o[t].count:s.push({\"conversationID\":\"C2C\".concat(o[t].from),\"unreadCount\":o[t].count,\"type\":S.CONV_C2C})},d=0,f=o.length;d<f;d++)_(d);return{\"eventDataList\":s,\"result\":a}}},{\"key\":\"newGroupMessageStoredAndSummary\",\"value\":function(e){for(var t=null,n=[],o={},r=[],i=S.CONV_GROUP,s=this.tim.bigDataHallwayController,a=0,u=e.length;a<u;a++){var c=e[a];c.currentUser=this.tim.context.identifier,c.conversationType=i,c.isSystemMessage=!!c.isSystemMessage,t=new Et(c),c.elements=s.parseElements(c.elements,c.from),t.setElement(c.elements),this._pushIntoNoticeResult(r,t)&&(void 0===o[t.conversationID]?o[t.conversationID]=n.push({\"conversationID\":t.conversationID,\"unreadCount\":\"out\"===t.flow?0:1,\"type\":t.conversationType,\"subType\":t.conversationSubType,\"lastMessage\":t})-1:(n[o[t.conversationID]].type=t.conversationType,n[o[t.conversationID]].subType=t.conversationSubType,n[o[t.conversationID]].lastMessage=t,\"in\"===t.flow&&n[o[t.conversationID]].unreadCount++))}return{\"eventDataList\":n,\"result\":r}}},{\"key\":\"newGroupTipsStoredAndSummary\",\"value\":function(e){for(var t=null,n=[],o=[],r={},i=0,s=e.length;i<s;i++){var a=e[i];a.currentUser=this.tim.context.identifier,a.conversationType=S.CONV_GROUP,(t=new Et(a)).setElement({\"type\":S.MSG_GRP_TIP,\"content\":c({},a.elements,{\"groupProfile\":a.groupProfile})}),t.isSystemMessage=!1,this._pushIntoNoticeResult(o,t)&&(void 0===r[t.conversationID]?r[t.conversationID]=n.push({\"conversationID\":t.conversationID,\"unreadCount\":\"out\"===t.flow?0:1,\"type\":t.conversationType,\"subType\":t.conversationSubType,\"lastMessage\":t})-1:(n[r[t.conversationID]].type=t.conversationType,n[r[t.conversationID]].subType=t.conversationSubType,n[r[t.conversationID]].lastMessage=t,\"in\"===t.flow&&n[r[t.conversationID]].unreadCount++))}return{\"eventDataList\":n,\"result\":o}}},{\"key\":\"newSystemNoticeStoredAndSummary\",\"value\":function(e){var t=e.notifiesList,n=e.type,o=null,r=t.length,i=0,s=[],a={\"conversationID\":S.CONV_SYSTEM,\"unreadCount\":0,\"type\":S.CONV_SYSTEM,\"subType\":null,\"lastMessage\":null};for(i=0;i<r;i++){var u=t[i];if(u.elements.operationType!==$e)u.currentUser=this.tim.context.identifier,u.conversationType=S.CONV_SYSTEM,u.conversationID=S.CONV_SYSTEM,(o=new Et(u)).setElement({\"type\":S.MSG_GRP_SYS_NOTICE,\"content\":c({},u.elements,{\"groupProfile\":u.groupProfile})}),o.isSystemMessage=!0,this._pushIntoNoticeResult(s,o)&&(\"poll\"===n?a.unreadCount++:\"sync\"===n&&o.setIsRead(!0),a.subType=o.conversationSubType)}return a.lastMessage=s[s.length-1],{\"eventDataList\":s.length>0?[a]:[],\"result\":s}}},{\"key\":\"_onSyncMessagesProcessing\",\"value\":function(e){var t=this._newC2CMessageStoredAndSummary({\"notifiesList\":e.data,\"type\":S.CONV_C2C,\"isFromSync\":!0,\"C2CRemainingUnreadList\":e.C2CRemainingUnreadList}),n=t.eventDataList,o=t.result;this.tim.innerEmitter.emit(Pt.MESSAGE_SYNC_PROCESSING,{\"data\":{\"eventDataList\":n,\"result\":o},\"resource\":this})}},{\"key\":\"_onSyncMessagesFinished\",\"value\":function(e){this.triggerReady();var t=this._newC2CMessageStoredAndSummary({\"notifiesList\":e.data,\"type\":S.CONV_C2C,\"isFromSync\":!0,\"C2CRemainingUnreadList\":e.C2CRemainingUnreadList}),n=t.eventDataList,o=t.result;this.tim.innerEmitter.emit(Pt.MESSAGE_SYNC_FINISHED,{\"data\":{\"eventDataList\":n,\"result\":o},\"resource\":this})}},{\"key\":\"getHistoryMessages\",\"value\":function(e){if(e.conversationID===S.CONV_SYSTEM)return Kt();!e.count&&(e.count=15),e.count>20&&(e.count=20);var t=this.messagesList.getLocalOldestMessageByConversationID(e.conversationID);t||((t={}).time=0,t.sequence=0,0===e.conversationID.indexOf(S.CONV_C2C)?(t.to=e.conversationID.replace(S.CONV_C2C,\"\"),t.conversationType=S.CONV_C2C):0===e.conversationID.indexOf(S.CONV_GROUP)&&(t.to=e.conversationID.replace(S.CONV_GROUP,\"\"),t.conversationType=S.CONV_GROUP));var n=\"\";switch(t.conversationType){case S.CONV_C2C:return n=e.conversationID.replace(S.CONV_C2C,\"\"),this.getC2CRoamMessages({\"conversationID\":e.conversationID,\"peerAccount\":n,\"count\":e.count,\"lastMessageTime\":void 0===this.currentMessageKey[e.conversationID]?0:t.time});case S.CONV_GROUP:return this.getGroupRoamMessages({\"conversationID\":e.conversationID,\"groupID\":t.to,\"count\":e.count,\"sequence\":t.sequence-1});default:return Kt()}}},{\"key\":\"getC2CRoamMessages\",\"value\":function(i){var s=this,e=this.tim.connectionController,t=void 0!==this.currentMessageKey[i.conversationID]?this.currentMessageKey[i.conversationID]:\"\",n=this.createPackage({\"name\":\"c2cMessage\",\"action\":\"query\",\"param\":{\"peerAccount\":i.peerAccount,\"count\":i.count||15,\"lastMessageTime\":i.lastMessageTime||0,\"messageKey\":t}});return e.request(n).then(function(e){var t=e.data,n=t.complete,o=t.messageList;1===n&&s.getMessageHandler.setCompleted(i.conversationID);var r=s._roamMessageStore(o,S.CONV_C2C,i.conversationID);return s.readReportHandler.updateIsRead(i.conversationID),s.currentMessageKey[i.conversationID]=e.data.messageKey,r}).catch(function(e){return Ht(e)})}},{\"key\":\"getC2CRoamMessagesSliced\",\"value\":function(t){var o=this.tim.connectionController,u=this;return function(n){return new Promise(function(e,t){!function e(r,i,s){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],t=u.createPackage({\"name\":\"c2cMessage\",\"action\":\"query\",\"param\":{\"peerAccount\":r.peerAccount,\"count\":r.count||15,\"lastMessageTime\":r.lastMessageTime||0,\"messageKey\":r.messageKey||\"\"}}),n=o.request(t).then(function(t){var n=t.data.messageList,o=u._roamMessageStore(n,S.CONV_C2C);a.push.apply(a,E(o)),t.data.complete===we.GET_HISTORY_MESSAGE_STATUS.C2C_IS_NOT_FINISHED?(r.messageKey=t.data.messageKey,e(r,i,a)):t.data.complete===we.GET_HISTORY_MESSAGE_STATUS.C2C_IS_FINISHED?(J.log(\"getC2CRoamMessages finised...\"),i(new Ft(a))):s(new lt({\"code\":pt.MESSAGE_UNKNOW_ROMA_LIST_END_FLAG_FIELD,\"message\":ht.MESSAGE_UNKNOW_ROMA_LIST_END_FLAG_FIELD}))}).reject(function(e){J.log(\"getC2CRoamMessages fail...\"),s(e)});return n}(n,e,t,[])})}(t)}},{\"key\":\"getGroupRoamMessages\",\"value\":function(s){var a=this,e=this.tim,t=e.connectionController,n=e.groupController,o=s.sequence>=0?s.sequence:n.getLocalGroupLastSequence(s.groupID);if(o<0)return Kt([]);var r=this.createPackage({\"name\":\"groupMessage\",\"action\":\"query\",\"param\":{\"groupID\":s.groupID,\"count\":21,\"sequence\":o}});return t.request(r).then(function(e){var t=e.data,n=t.messageList,o=t.complete,r=\"GROUP\".concat(s.groupID);if(2===o||Ne(n))return a.getMessageHandler.setCompleted(r),[];var i=a._roamMessageStore(n,S.CONV_GROUP,r);return a.readReportHandler.updateIsRead(r),J.log(\"MessageController.getGroupRoamMessages ok. nums=\".concat(i.length)),i}).catch(function(e){return J.log(\"MessageController.getGroupRoamMessages error\",e),Ht(e)})}},{\"key\":\"_roamMessageStore\",\"value\":function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,o=null,r=[],i=0,s=e.length,a=null,u=t===S.CONV_GROUP,l=this.tim.bigDataHallwayController,p=function(){i=u?e.length-1:0,s=u?0:e.length},h=function(){u?--i:++i},_=function(){return u?i>=s:i<s};for(p();_();h())u&&1===e[i].sequence&&this.getMessageHandler.setCompleted(n),1!==e[i].isPlaceMessage&&((o=new Et(e[i])).to=e[i].to,o.isSystemMessage=!!e[i].isSystemMessage,o.conversationType=t,e[i].event===Ue.JSON.TYPE.GROUP.TIP?a={\"type\":S.MSG_GRP_TIP,\"content\":c({},e[i].elements,{\"groupProfile\":e[i].groupProfile})}:(e[i].elements=l.parseElements(e[i].elements,e[i].from),a=e[i].elements),o.setElement(a),o.reInitialize(this.tim.context.identifier),r.push(o));return this.messagesList.unshift(r),p=h=_=null,r}},{\"key\":\"getLocalMessageList\",\"value\":function(e){return this.messagesList.getLocalMessageList(e)}},{\"key\":\"getLocalMessage\",\"value\":function(e,t){return this.messagesList.getLocalMessage(e,t)}},{\"key\":\"hasLocalMessage\",\"value\":function(e,t){return this.messagesList.hasLocalMessage(e,t)}},{\"key\":\"deleteLocalMessage\",\"value\":function(e){e instanceof Et&&this.messagesList.remove(e)}},{\"key\":\"revokeMessage\",\"value\":function(o){var e,r=this;o.conversationType===S.CONV_C2C?e=this.createPackage({\"name\":\"c2cMessageWillBeRevoked\",\"action\":\"create\",\"param\":{\"msgInfo\":{\"fromAccount\":o.from,\"toAccount\":o.to,\"msgSeq\":o.sequence,\"msgRandom\":o.random,\"msgTimeStamp\":o.time}}}):o.conversationType===S.CONV_GROUP&&(e=this.createPackage({\"name\":\"groupMessageWillBeRevoked\",\"action\":\"create\",\"param\":{\"to\":o.to,\"msgSeqList\":[{\"msgSeq\":o.sequence}]}}));var i=new Yt;return i.setMethod(jt.REVOKE_MESSAGE).setMessageType(o.type).setText(\"\".concat(this._generateTjgID(o),\"-\").concat(o.type,\"-\").concat(o.from,\"-\").concat(o.to)).setStart(),this.tim.connectionController.request(e).then(function(e){var t=e.data.recallRetList;if(!Ne(t)&&0!==t[0].retCode){var n=new lt({\"code\":t[0].retCode,\"message\":ct[t[0].retCode]||ht.MESSAGE_REVOKE_FAIL,\"data\":{\"message\":o}});return i.setCode(n.code).setMessage(n.message).setEnd(),Ht(n)}return J.info(\"MessageController.revokeMessage ok. ID=\".concat(o.ID)),o.isRevoked=!0,i.setCode(0).setEnd(),r.innerEmitter.emit(Pt.MESSAGE_REVOKED,{\"data\":[o]}),new Ft({\"message\":o})}).catch(function(n){r.probeNetwork().then(function(e,t){i.setError(n,e,t).setEnd()});var e=new lt({\"code\":n&&n.code?n.code:pt.MESSAGE_REVOKE_FAIL,\"message\":n&&n.message?n.message:ht.MESSAGE_REVOKE_FAIL,\"data\":{\"message\":o}});return J.warn(\"MessageController.revokeMessage failed. ID=\".concat(o.ID,\" code=\").concat(e.code,\" message=\").concat(e.message)),Ht(e)})}},{\"key\":\"setMessageRead\",\"value\":function(n){var o=this;return new Promise(function(e,t){o.ready(function(){o.readReportHandler.setMessageRead(n).then(e).catch(t)})})}},{\"key\":\"getMessageList\",\"value\":function(e){return this.getMessageHandler.getMessageList(e)}},{\"key\":\"createTextMessage\",\"value\":function(e){e.currentUser=this.tim.context.identifier;var t=new Et(e),n=\"string\"==typeof e.payload?e.payload:e.payload.text,o=new be({\"text\":n});return t.setElement(o),t}},{\"key\":\"createCustomMessage\",\"value\":function(e){e.currentUser=this.tim.context.identifier;var t=new Et(e),n=new gt({\"data\":e.payload.data,\"description\":e.payload.description,\"extension\":e.payload.extension});return t.setElement(n),t}},{\"key\":\"createImageMessage\",\"value\":function(e){e.currentUser=this.tim.context.identifier;var t=new Et(e);if(L){var n=e.payload.file;if(ee(n))return void J.warn(\"微信小程序环境下调用 createImageMessage 接口时，payload.file 不支持传入 File 对象\");var o=n.tempFilePaths[0],r={\"url\":o,\"name\":o.slice(o.lastIndexOf(\"/\")+1),\"size\":n.tempFiles[0].size,\"type\":o.slice(o.lastIndexOf(\".\")+1).toLowerCase()};e.payload.file=r}else if(A&&ee(e.payload.file)){var i=e.payload.file;e.payload.file={\"files\":[i]}}var s=new nt({\"imageFormat\":\"UNKNOWN\",\"uuid\":this._generateUUID(),\"file\":e.payload.file});return t.setElement(s),this.messageOptionMap.set(t.messageID,e),t}},{\"key\":\"createFileMessage\",\"value\":function(e){if(!L){if(A&&ee(e.payload.file)){var t=e.payload.file;e.payload.file={\"files\":[t]}}e.currentUser=this.tim.context.identifier;var n=new Et(e),o=new ft({\"uuid\":this._generateUUID(),\"file\":e.payload.file});return n.setElement(o),this.messageOptionMap.set(n.messageID,e),n}J.warn(\"微信小程序目前不支持选择文件， createFileMessage 接口不可用！\")}},{\"key\":\"createAudioMessage\",\"value\":function(e){if(L){var t=e.payload.file;if(L){var n={\"url\":t.tempFilePath,\"name\":t.tempFilePath.slice(t.tempFilePath.lastIndexOf(\"/\")+1),\"size\":t.fileSize,\"second\":parseInt(t.duration)/1e3,\"type\":t.tempFilePath.slice(t.tempFilePath.lastIndexOf(\".\")+1).toLowerCase()};e.payload.file=n}e.currentUser=this.tim.context.identifier;var o=new Et(e),r=new rt({\"second\":Math.floor(t.duration/1e3),\"size\":t.fileSize,\"url\":t.tempFilePath,\"uuid\":this._generateUUID()});return o.setElement(r),this.messageOptionMap.set(o.messageID,e),o}J.warn(\"createAudioMessage 目前只支持微信小程序发语音消息\")}},{\"key\":\"createVideoMessage\",\"value\":function(e){if(L){if(e.currentUser=this.tim.context.identifier,L){e.payload.file.thumbUrl=\"https://webim-1252463788.cos.ap-shanghai.myqcloud.com/assets/images/transparent.png\",e.payload.file.thumbSize=1668;var t=e.payload.file,n={\"url\":t.tempFilePath,\"name\":t.tempFilePath.slice(t.tempFilePath.lastIndexOf(\"/\")+1),\"size\":t.size,\"second\":t.duration,\"type\":t.tempFilePath.slice(t.tempFilePath.lastIndexOf(\".\")+1).toLowerCase()};e.payload.file.videoFile=n;var o=new Et(e),r=new mt({\"videoFormat\":n.type,\"videoSecond\":Number(n.second.toFixed(0)),\"videoSize\":n.size,\"remoteVideoUrl\":\"\",\"videoUrl\":n.url,\"videoUUID\":this._generateUUID(),\"thumbUUID\":this._generateUUID(),\"thumbWidth\":t.width,\"thumbHeight\":t.height,\"thumbUrl\":t.thumbUrl,\"thumbSize\":t.thumbSize,\"thumbFormat\":t.thumbUrl.slice(t.thumbUrl.lastIndexOf(\".\")+1).toLowerCase()});return o.setElement(r),this.messageOptionMap.set(o.messageID,e),o}}else{J.warn(\"createVideoMessage 目前只支持微信小程序发视频消息\")}}},{\"key\":\"createFaceMessage\",\"value\":function(e){e.currentUser=this.tim.context.identifier;var t=new Et(e),n=new ot(e.payload);return t.setElement(n),t}},{\"key\":\"_generateUUID\",\"value\":function(){var e=this.tim.context;return\"\".concat(e.SDKAppID,\"-\").concat(e.identifier,\"-\").concat(function(){for(var e=\"\",t=32;t>0;--t)e+=Ee[Math.floor(Math.random()*ve)];return e}())}},{\"key\":\"_generateTjgID\",\"value\":function(e){return this.tim.context.tinyID+\"-\"+e.random}},{\"key\":\"getMessageOptionByID\",\"value\":function(e){return this.messageOptionMap.get(e)}}]),r}(),Yo=function(){function e(t){o(this,e),this.userID=\"\",this.avatar=\"\",this.nick=\"\",this.role=\"\",this.joinTime=\"\",this.lastSendMsgTime=\"\",this.nameCard=\"\",this.muteUntil=0,this.memberCustomField=[],this._initMember(t)}return s(e,[{\"key\":\"_initMember\",\"value\":function(e){this.updateMember(e)}},{\"key\":\"updateMember\",\"value\":function(e){var t=[null,void 0,\"\",0,NaN];e.memberCustomField&&Se(this.memberCustomField,e.memberCustomField),de(this,e,[\"memberCustomField\"],t)}},{\"key\":\"updateRole\",\"value\":function(e){[\"Owner\",\"Admin\",\"Member\"].indexOf(e)<0||(this.role=e)}},{\"key\":\"updateMuteUntil\",\"value\":function(e){se(e)||(this.muteUntil=Math.floor((Date.now()+1e3*e)/1e3))}},{\"key\":\"updateNameCard\",\"value\":function(e){se(e)||(this.nameCard=e)}},{\"key\":\"updateMemberCustomField\",\"value\":function(e){e&&Se(this.memberCustomField,e)}}]),e}(),jo=function(){function e(t){o(this,e),this.tim=t.tim,this.groupController=t.groupController,this._initListeners()}return s(e,[{\"key\":\"_initListeners\",\"value\":function(){this.tim.innerEmitter.on(Pt.MESSAGE_GROUP_INSTANT_RECEIVED,this._onReceivedGroupTips,this)}},{\"key\":\"_onReceivedGroupTips\",\"value\":function(e){var t=this,n=e.data,o=n.result;n.isGroupTip&&o.forEach(function(e){switch(e.payload.operationType){case 1:t._onNewMemberComeIn(e);break;case 2:t._onMemberQuit(e);break;case 3:t._onMemberKickedOut(e);break;case 4:t._onMemberSetAdmin(e);break;case 5:t._onMemberCancelledAdmin(e);break;case 6:t._onGroupProfileModified(e);break;case 7:t._onMemberInfoModified(e);break;default:J.warn(\"GroupTipsHandler._onReceivedGroupTips Unhandled groupTips. operationType=\",e.payload.operationType)}})}},{\"key\":\"_onNewMemberComeIn\",\"value\":function(e){var t=e.payload,n=t.memberNum,o=t.groupProfile.groupID,r=this.groupController.getLocalGroupProfile(o);r&&te(n)&&(r.memberNum=n)}},{\"key\":\"_onMemberQuit\",\"value\":function(e){var t=e.payload,n=t.memberNum,o=t.groupProfile.groupID,r=this.groupController.getLocalGroupProfile(o);r&&te(n)&&(r.memberNum=n),this.groupController.deleteLocalGroupMembers(o,e.payload.userIDList)}},{\"key\":\"_onMemberKickedOut\",\"value\":function(e){var t=e.payload,n=t.memberNum,o=t.groupProfile.groupID,r=this.groupController.getLocalGroupProfile(o);r&&te(n)&&(r.memberNum=n),this.groupController.deleteLocalGroupMembers(o,e.payload.userIDList)}},{\"key\":\"_onMemberSetAdmin\",\"value\":function(e){var n=this,o=e.payload.groupProfile.groupID;e.payload.userIDList.forEach(function(e){var t=n.groupController.getLocalGroupMemberInfo(o,e);t&&t.updateRole(S.GRP_MBR_ROLE_ADMIN)})}},{\"key\":\"_onMemberCancelledAdmin\",\"value\":function(e){var n=this,o=e.payload.groupProfile.groupID;e.payload.userIDList.forEach(function(e){var t=n.groupController.getLocalGroupMemberInfo(o,e);t&&t.updateRole(S.GRP_MBR_ROLE_MEMBER)})}},{\"key\":\"_onGroupProfileModified\",\"value\":function(e){var t=this,n=e.payload.newGroupProfile,o=e.payload.groupProfile.groupID,r=this.groupController.getLocalGroupProfile(o);Object.keys(n).forEach(function(e){switch(e){case\"ownerID\":t._ownerChaged(r,n);break;default:r[e]=n[e]}}),this.groupController.emitGroupListUpdate(!0,!0)}},{\"key\":\"_ownerChaged\",\"value\":function(e,t){var n=e.groupID,o=this.groupController.getLocalGroupProfile(n),r=this.tim.context.identifier;if(r===t.ownerID){o.updateGroup({\"selfInfo\":{\"role\":S.GRP_MBR_ROLE_OWNER}});var i=this.groupController.getLocalGroupMemberInfo(n,r),s=this.groupController.getLocalGroupProfile(n).ownerID,a=this.groupController.getLocalGroupMemberInfo(n,s);i&&i.updateRole(S.GRP_MBR_ROLE_OWNER),a&&a.updateRole(S.GRP_MBR_ROLE_MEMBER)}}},{\"key\":\"_onMemberInfoModified\",\"value\":function(e){var n=this,o=e.payload.groupProfile.groupID;e.payload.memberList.forEach(function(e){var t=n.groupController.getLocalGroupMemberInfo(o,e.userID);t&&e.muteTime&&t.updateMuteUntil(e.muteTime)})}}]),e}(),$o=function(){function e(t){o(this,e),this.groupController=t.groupController,this.tim=t.tim,this.pendencyMap=new Map,this._initLiceners()}return s(e,[{\"key\":\"_initLiceners\",\"value\":function(){this.tim.innerEmitter.on(Pt.MESSAGE_GROUP_SYSTEM_NOTICE_RECEIVED,this._onReceivedGroupSystemNotice,this),this.tim.innerEmitter.on(Pt.SYNC_MESSAGE_C2C_FINISHED,this._clearGroupSystemNotice,this)}},{\"key\":\"_clearGroupSystemNotice\",\"value\":function(){var u=this;this.getPendencyList().then(function(e){e.forEach(function(e){u.pendencyMap.set(\"\".concat(e.from,\"_\").concat(e.groupID,\"_\").concat(e.to),e)});var t=u.tim.messageController.getLocalMessageList(S.CONV_SYSTEM),a=[];t.forEach(function(e){var t=e.payload,n=t.operatorID,o=t.operationType,r=t.groupProfile;if(o===xe){var i=\"\".concat(n,\"_\").concat(r.groupID,\"_\").concat(r.to),s=u.pendencyMap.get(i);s&&te(s.handled)&&0!==s.handled&&a.push(e)}}),u.groupController.deleteGroupSystemNotice({\"messageList\":a})})}},{\"key\":\"getPendencyList\",\"value\":function(e){var o=this,t=this.groupController.createPackage({\"name\":\"group\",\"action\":\"getGroupPendency\",\"param\":{\"startTime\":e&&e.startTime?e.startTime:0,\"limit\":e&&e.limit?e.limit:10,\"handleAccount\":this.tim.context.identifier}});return this.groupController.connectionController.request(t).then(function(e){var t=e.data,n=t.pendencyList;return 0!==t.nextStartTime?o.getPendencyList({\"startTime\":t.nextStartTime}).then(function(e){return[].concat(E(n),E(e))}):n})}},{\"key\":\"_onReceivedGroupSystemNotice\",\"value\":function(e){var t=this,n=e.data,o=n.result;\"sync\"!==n.type&&o.forEach(function(e){switch(e.payload.operationType){case 1:t._onApplyGroupRequest(e);break;case 2:t._onApplyGroupRequestAgreed(e);break;case 3:t._onApplyGroupRequestRefused(e);break;case 4:t._onMemberKicked(e);break;case 5:t._onGroupDismissed(e);break;case 6:break;case 7:t._onInviteGroup(e);break;case 8:t._onQuitGroup(e);break;case 9:t._onSetManager(e);break;case 10:t._onDeleteManager(e);break;case 11:case 12:case 15:break;case 255:t.tim.outerEmitter.emit(v.GROUP_SYSTEM_NOTICE_RECEIVED,{\"message\":e,\"type\":We})}})}},{\"key\":\"_onApplyGroupRequest\",\"value\":function(e){this.tim.outerEmitter.emit(v.GROUP_SYSTEM_NOTICE_RECEIVED,{\"message\":e,\"type\":xe})}},{\"key\":\"_onApplyGroupRequestAgreed\",\"value\":function(e){var n=this,t=e.payload.groupProfile.groupID;this.groupController.hasLocalGroup(t)||this.groupController.getGroupProfile({\"groupID\":t}).then(function(e){var t=e.data.group;t&&(n.groupController.updateGroupMap([t]),n.groupController.emitGroupListUpdate())}),this.tim.outerEmitter.emit(v.GROUP_SYSTEM_NOTICE_RECEIVED,{\"message\":e,\"type\":Fe})}},{\"key\":\"_onApplyGroupRequestRefused\",\"value\":function(e){this.tim.outerEmitter.emit(v.GROUP_SYSTEM_NOTICE_RECEIVED,{\"message\":e,\"type\":qe})}},{\"key\":\"_onMemberKicked\",\"value\":function(e){var t=e.payload.groupProfile.groupID;this.groupController.hasLocalGroup(t)&&this.groupController.deleteLocalGroupAndConversation(t),this.tim.outerEmitter.emit(v.GROUP_SYSTEM_NOTICE_RECEIVED,{\"message\":e,\"type\":Ve})}},{\"key\":\"_onGroupDismissed\",\"value\":function(e){var t=e.payload.groupProfile.groupID,n=this.groupController.hasLocalGroup(t),o=this.groupController.AVChatRoomHandler;n&&this.groupController.deleteLocalGroupAndConversation(t),o.checkJoinedAVChatRoomByID(t)&&o.reset(),this.tim.outerEmitter.emit(v.GROUP_SYSTEM_NOTICE_RECEIVED,{\"message\":e,\"type\":Ke})}},{\"key\":\"_onInviteGroup\",\"value\":function(e){var n=this,t=e.payload.groupProfile.groupID;this.groupController.hasLocalGroup(t)||this.groupController.getGroupProfile({\"groupID\":t}).then(function(e){var t=e.data.group;t&&(n.groupController.updateGroupMap([t]),n.groupController.emitGroupListUpdate())}),this.tim.outerEmitter.emit(v.GROUP_SYSTEM_NOTICE_RECEIVED,{\"message\":e,\"type\":He})}},{\"key\":\"_onQuitGroup\",\"value\":function(e){var t=e.payload.groupProfile.groupID;this.groupController.hasLocalGroup(t)&&this.groupController.deleteLocalGroupAndConversation(t),this.tim.outerEmitter.emit(v.GROUP_SYSTEM_NOTICE_RECEIVED,{\"message\":e,\"type\":Be})}},{\"key\":\"_onSetManager\",\"value\":function(e){var t=e.payload.groupProfile,n=t.to,o=t.groupID,r=this.groupController.getLocalGroupMemberInfo(o,n);r&&r.updateRole(S.GRP_MBR_ROLE_ADMIN),this.tim.outerEmitter.emit(v.GROUP_SYSTEM_NOTICE_RECEIVED,{\"message\":e,\"type\":Ye})}},{\"key\":\"_onDeleteManager\",\"value\":function(e){var t=e.payload.groupProfile,n=t.to,o=t.groupID,r=this.groupController.getLocalGroupMemberInfo(o,n);r&&r.updateRole(S.GRP_MBR_ROLE_MEMBER),this.tim.outerEmitter.emit(v.GROUP_SYSTEM_NOTICE_RECEIVED,{\"message\":e,\"type\":je})}},{\"key\":\"reset\",\"value\":function(){this.pendencyMap.clear()}}]),e}(),Wo={\"3\":!0,\"4\":!0,\"5\":!0,\"6\":!0},er=function(){function e(t){var n=t.tim,r=t.groupController;o(this,e),this.tim=n,this.groupController=r,this.AVChatRoomLoop=null,this.key=\"\",this.startSeq=0,this.group={}}return s(e,[{\"key\":\"hasJoinedAVChatRoom\",\"value\":function(){return!(!this.group||se(this.group.groupID))}},{\"key\":\"checkJoinedAVChatRoomByID\",\"value\":function(e){return!(!this.group&&se(this.group.groupID))&&e===this.group.groupID}},{\"key\":\"getJoinedAVChatRoom\",\"value\":function(){return this.hasJoinedAVChatRoom()?this.group:null}},{\"key\":\"_updateProperties\",\"value\":function(t){var n=this;Object.keys(t).forEach(function(e){n[e]=t[e]})}},{\"key\":\"start\",\"value\":function(){var e={\"key\":this.key,\"startSeq\":this.startSeq};if(null===this.AVChatRoomLoop){var t=this.tim.notificationController.createPackage({\"name\":\"AVChatRoom\",\"action\":\"startLongPoll\",\"param\":e});this.AVChatRoomLoop=this.tim.connectionController.createRunLoop({\"pack\":t,\"before\":this._updateRequestData.bind(this),\"success\":this._handleSuccess.bind(this),\"fail\":this._handleFailure.bind(this)}),this.AVChatRoomLoop.start(),J.log(\"AVChatRoomHandler.start message channel started\")}else this.AVChatRoomLoop.isRunning()||this.AVChatRoomLoop.start()}},{\"key\":\"stop\",\"value\":function(){null!==this.AVChatRoomLoop&&this.AVChatRoomLoop.isRunning()&&(this.AVChatRoomLoop.abort(),this.AVChatRoomLoop.stop(),J.log(\"AVChatRoomHandler.stop message channel stopped\"))}},{\"key\":\"startRunLoop\",\"value\":function(n){var o=this;return this._precheck().then(function(){var e=n.longPollingKey,t=n.group;return o._updateProperties({\"key\":e,\"startSeq\":0,\"group\":t||{}}),o.groupController.updateGroupMap([t]),o.groupController.emitGroupListUpdate(!0,!1),o.start(),o.groupController.isLoggedIn()?Kt({\"status\":ke.SUCCESS,\"group\":t}):Kt({\"status\":ke.SUCCESS})})}},{\"key\":\"joinWithoutAuth\",\"value\":function(o){var r=this,e=this.groupController.createPackage({\"name\":\"group\",\"action\":\"applyJoinAVChatRoom\",\"param\":o});return this.tim.connectionController.request(e).then(function(e){var t=e.data.longPollingKey;if(se(t))return Ht(new lt({\"code\":pt.CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN,\"message\":ht.CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN}));J.log(\"AVChatRoomHandler.joinWithoutAuth ok. groupID:\",o.groupID),r.tim.innerEmitter.emit(Pt.AVCHATROOM_JOIN_SUCCESS,{\"data\":o.groupID});var n=new Go({\"groupID\":o.groupID});return r.startRunLoop({\"group\":n,\"longPollingKey\":t}),new Ft({\"status\":ke.SUCCESS})}).catch(function(e){return J.error(\"AVChatRoomHandler.joinWithoutAuth error:\".concat(e.message,\". groupID:\").concat(o.groupID)),Ht(e)})}},{\"key\":\"_precheck\",\"value\":function(){if(!this.hasJoinedAVChatRoom())return Promise.resolve();if(this.groupController.isLoggedIn()){if(!(this.group.selfInfo.role===S.GRP_MBR_ROLE_OWNER||this.group.ownerID===this.tim.loginInfo.identifier))return this.groupController.quitGroup(this.group.groupID);this.groupController.deleteLocalGroupAndConversation(this.group.groupID)}else this.groupController.deleteLocalGroupAndConversation(this.group.groupID);return this.reset(),Promise.resolve()}},{\"key\":\"_updateRequestData\",\"value\":function(e){e.StartSeq=this.startSeq,e.Key=this.key,this.tim.sumStatController.addTotalCount(Bt.LONG_POLLING_AV)}},{\"key\":\"_handleSuccess\",\"value\":function(e){this.tim.sumStatController.addSuccessCount(Bt.LONG_POLLING_AV),this.tim.sumStatController.addCost(Bt.LONG_POLLING_AV,e.data.timecost),this.startSeq=e.data.nextSeq,this.key=e.data.key,Array.isArray(e.data.rspMsgList)&&e.data.rspMsgList.forEach(function(e){e.to=e.groupID}),e.data.rspMsgList&&e.data.rspMsgList.length>0&&this._dispatchNotice(e.data.rspMsgList)}},{\"key\":\"_handleFailure\",\"value\":function(n){if(n.error){var o=new Yt;o.setMethod(jt.LONG_POLLING_AV_ERROR).setStart(),this.groupController.probeNetwork(function(e,t){o.setError(n.error,e,t).setEnd()}),this.tim.innerEmitter.emit(Pt.ERROR_DETECTED,n.error)}}},{\"key\":\"_dispatchNotice\",\"value\":function(e){if(ie(e)&&0!==e.length){for(var t=null,n=[],o=[],r=0;r<e.length;r++)Wo[e[r].event]?(t=this.packMessage(e[r],e[r].event),this.tim.messageController.hasLocalMessage(t.conversationID,t.ID)||(t.conversationType===S.CONV_SYSTEM&&o.push(t),n.push(t))):J.warn(\"AVChatRoomHandler._dispatchMessage 未处理的 event 类型：\",e[r].event);if(o.length>0&&this.tim.innerEmitter.emit(Pt.MESSAGE_GROUP_SYSTEM_NOTICE_RECEIVED,{\"data\":{\"result\":o,\"eventDataList\":[],\"type\":\"poll\"}}),0!==n.length){var i=this.packConversationOption(n);i.length>0&&this.tim.innerEmitter.emit(Pt.MESSAGE_GROUP_INSTANT_RECEIVED,{\"data\":{\"eventDataList\":i,\"type\":\"poll\"}}),J.debug(\"AVChatRoomHandler._dispatchNotice nums=\".concat(n.length)),this.tim.outerEmitter.emit(v.MESSAGE_RECEIVED,n)}}}},{\"key\":\"packMessage\",\"value\":function(e,t){e.currentUser=this.tim.context.identifier,e.conversationType=5===t?S.CONV_SYSTEM:S.CONV_GROUP,e.isSystemMessage=!!e.isSystemMessage;var n=new Et(e),o=this.packElements(e,t);return n.setElement(o),n}},{\"key\":\"packElements\",\"value\":function(e,t){return 4===t||6===t?{\"type\":S.MSG_GRP_TIP,\"content\":c({},e.elements,{\"groupProfile\":e.groupProfile})}:5===t?{\"type\":S.MSG_GRP_SYS_NOTICE,\"content\":c({},e.elements,{\"groupProfile\":e.groupProfile})}:this.tim.bigDataHallwayController.parseElements(e.elements,e.from)}},{\"key\":\"packConversationOption\",\"value\":function(e){for(var t=new Map,n=0;n<e.length;n++){var o=e[n],r=o.conversationID;if(t.has(r)){var i=t.get(r);i.lastMessage=o,\"in\"===o.flow&&i.unreadCount++}else t.set(r,{\"conversationID\":o.conversationID,\"unreadCount\":\"out\"===o.flow?0:1,\"type\":o.conversationType,\"subType\":o.conversationSubType,\"lastMessage\":o})}return E(t.values())}},{\"key\":\"reset\",\"value\":function(){null!==this.AVChatRoomLoop&&(J.log(\"AVChatRoomHandler.reset\"),this.stop(),this.AVChatRoomLoop=null,this.key=\"\",this.startSeq=0,this.group={})}}]),e}(),tr=function(e){function r(e){var t;return o(this,r),(t=d(this,p(r).call(this,e))).groupMap=new Map,t.groupMemberListMap=new Map,t.groupNoticeHandler=new $o({\"tim\":e,\"groupController\":_(t)}),t.groupTipsHandler=new jo({\"tim\":e,\"groupController\":_(t)}),t.AVChatRoomHandler=new er({\"tim\":e,\"groupController\":_(t)}),t._initListeners(),t}return l(r,bt),s(r,[{\"key\":\"createGroup\",\"value\":function(o){var r=this;if(![\"Public\",\"Private\",\"ChatRoom\",\"AVChatRoom\"].includes(o.type)){var e=new lt({\"code\":pt.ILLEGAL_GROUP_TYPE,\"message\":ht.ILLEGAL_GROUP_TYPE});return Ht(e)}Re(o.type)&&!se(o.memberList)&&o.memberList.length>0&&(J.warn(\"GroupController.createGroup 创建AVChatRoom时不能添加群成员，自动忽略该字段\"),o.memberList=void 0),De(o.type)||se(o.joinOption)||(J.warn(\"GroupController.createGroup 创建Private/ChatRoom/AVChatRoom群时不能设置字段：joinOption，自动忽略该字段\"),o.joinOption=void 0);var i=new Yt;i.setMethod(jt.CREATE_GROUP).setStart();var t=this.createPackage({\"name\":\"group\",\"action\":\"create\",\"param\":o});return J.log(\"GroupController.createGroup.\"),this.tim.connectionController.request(t).then(function(e){if(i.setCode(0).setNetworkType(r.getNetworkType()).setText(\"groupType=\".concat(o.type,\" groupID=\").concat(e.data.groupID)).setEnd(),J.log(\"GroupController.createGroup ok. groupID:\",e.data.groupID),o.type===S.GRP_AVCHATROOM)return r.getGroupProfile({\"groupID\":e.data.groupID});r.updateGroupMap([c({},o,{\"groupID\":e.data.groupID})]);var t=r.tim.createCustomMessage({\"to\":e.data.groupID,\"conversationType\":S.CONV_GROUP,\"payload\":{\"data\":\"group_create\",\"extension\":\"\".concat(r.tim.context.identifier,\"创建群组\")}});return r.tim.sendMessage(t),r.emitGroupListUpdate(),r.getGroupProfile({\"groupID\":e.data.groupID})}).then(function(e){var t=e.data.group;return t.selfInfo.messageRemindType=S.MSG_REMIND_ACPT_AND_NOTE,t.selfInfo.role=S.GRP_MBR_ROLE_OWNER,e}).catch(function(n){return i.setText(\"groupType=\".concat(o.type)),r.probeNetwork().then(function(e,t){i.setError(n,e,t).setEnd()}),J.error(\"GroupController.createGroup error:\",n),Ht(n)})}},{\"key\":\"joinGroup\",\"value\":function(e){if(this.hasLocalGroup(e.groupID)){var t={\"status\":S.JOIN_STATUS_ALREADY_IN_GROUP};return Kt(t)}if(e.type===S.GRP_PRIVATE){var n=new lt({\"code\":pt.CANNOT_JOIN_PRIVATE,\"message\":ht.CANNOT_JOIN_PRIVATE});return Ht(n)}return J.log(\"GroupController.joinGroup. groupID:\",e.groupID),this.isLoggedIn()?this.applyJoinGroup(e):this.AVChatRoomHandler.joinWithoutAuth(e)}},{\"key\":\"quitGroup\",\"value\":function(e){var t=this;J.log(\"GroupController.quitGroup. groupID:\",e);var n=this.AVChatRoomHandler.checkJoinedAVChatRoomByID(e);if(n&&!this.isLoggedIn())return J.log(\"GroupController.quitGroup anonymously ok. groupID:\",e),this.deleteLocalGroupAndConversation(e),this.AVChatRoomHandler.reset(),Kt({\"groupID\":e});var o=new Yt;o.setMethod(jt.QUIT_GROUP).setStart();var r=this.createPackage({\"name\":\"group\",\"action\":\"quitGroup\",\"param\":{\"groupID\":e}});return this.tim.connectionController.request(r).then(function(){return o.setCode(0).setNetworkType(t.getNetworkType()).setText(\"groupID=\".concat(e)).setEnd(),J.log(\"GroupController.quitGroup ok. groupID:\",e),n&&t.AVChatRoomHandler.reset(),t.deleteLocalGroupAndConversation(e),new Ft({\"groupID\":e})}).catch(function(n){return o.setText(\"groupID=\".concat(e)),t.probeNetwork().then(function(e,t){o.setError(n,e,t).setEnd()}),J.error(\"GroupController.quitGroup error.  error:\".concat(n,\". groupID:\").concat(e)),Ht(n)})}},{\"key\":\"changeGroupOwner\",\"value\":function(i){var s=this;if(this.hasLocalGroup(i.groupID)&&this.getLocalGroupProfile(i.groupID).type===S.GRP_AVCHATROOM)return Ht(new lt({\"code\":pt.CANNOT_CHANGE_OWNER_IN_AVCHATROOM,\"message\":ht.CANNOT_CHANGE_OWNER_IN_AVCHATROOM}));if(i.newOwnerID===this.tim.loginInfo.identifier)return Ht(new lt({\"code\":pt.CANNOT_CHANGE_OWNER_TO_SELF,\"message\":ht.CANNOT_CHANGE_OWNER_TO_SELF}));var a=new Yt;a.setMethod(jt.CHANGE_GROUP_OWNER).setStart();var e=this.createPackage({\"name\":\"group\",\"action\":\"changeGroupOwner\",\"param\":i});return J.log(\"GroupController.changeGroupOwner. groupID:\",i.groupID),this.tim.connectionController.request(e).then(function(){a.setCode(0).setNetworkType(s.getNetworkType()).setText(\"groupID=\".concat(i.groupID)).setEnd(),J.log(\"GroupController.changeGroupOwner ok. groupID:\",i.groupID);var e=i.groupID,t=i.newOwnerID;s.groupMap.get(e).ownerID=t;var n=s.groupMemberListMap.get(e);if(n instanceof Map){var o=n.get(s.tim.loginInfo.identifier);se(o)||(o.updateRole(\"Member\"),s.groupMap.get(e).selfInfo.role=\"Member\");var r=n.get(t);se(r)||r.updateRole(\"Owner\")}return s.emitGroupListUpdate(!0,!1),new Ft({\"group\":s.groupMap.get(e)})}).catch(function(n){return a.setText(\"groupID=\".concat(i.groupID)),s.probeNetwork().then(function(e,t){a.setError(n,e,t).setEnd()}),J.error(\"GroupController.changeGroupOwner error:\".concat(n,\". groupID:\").concat(i.groupID)),Ht(n)})}},{\"key\":\"dismissGroup\",\"value\":function(e){var t=this;if(this.hasLocalGroup(e)&&this.getLocalGroupProfile(e).type===S.GRP_PRIVATE)return Ht(new lt({\"code\":pt.CANNOT_DISMISS_PRIVATE,\"message\":ht.CANNOT_DISMISS_PRIVATE}));var o=new Yt;o.setMethod(jt.DISMISS_GROUP).setStart();var n=this.createPackage({\"name\":\"group\",\"action\":\"destroyGroup\",\"param\":{\"groupID\":e}});return J.log(\"GroupController.dismissGroup. groupID:\".concat(e)),this.tim.connectionController.request(n).then(function(){return o.setCode(0).setNetworkType(t.getNetworkType()).setText(\"groupID=\".concat(e)).setEnd(),J.log(\"GroupController.dismissGroup ok. groupID:\".concat(e)),t.deleteLocalGroupAndConversation(e),t.checkJoinedAVChatRoomByID(e)&&t.AVChatRoomHandler.reset(),new Ft({\"groupID\":e})}).catch(function(n){return o.setText(\"groupID=\".concat(e)),t.probeNetwork().then(function(e,t){o.setError(n,e,t).setEnd()}),J.error(\"GroupController.dismissGroup error:\".concat(n,\". groupID:\").concat(e)),Ht(n)})}},{\"key\":\"updateGroupProfile\",\"value\":function(e){var t=this;!this.hasLocalGroup(e.groupID)||De(this.getLocalGroupProfile(e.groupID).type)||se(e.joinOption)||(J.warn(\"GroupController.modifyGroup: Private/ChatRoom/AVChatRoom群不能设置字段：joinOption，自动忽略该字段\"),e.joinOption=void 0);var o=new Yt;o.setMethod(jt.UPDATE_GROUP_PROFILE).setStart();var n=this.createPackage({\"name\":\"group\",\"action\":\"updateGroupProfile\",\"param\":e});return J.log(\"GroupController.modifyGroup. groupID:\",e.groupID),this.tim.connectionController.request(n).then(function(){(o.setCode(0).setNetworkType(t.getNetworkType()).setText(\"groupID=\".concat(e.groupID)).setEnd(),J.log(\"GroupController.modifyGroup ok. groupID:\",e.groupID),t.hasLocalGroup(e.groupID))&&(t.groupMap.get(e.groupID).updateGroup(e),t._setStorageGroupList());return new Ft({\"group\":t.groupMap.get(e.groupID)})}).catch(function(n){return o.setText(\"groupID=\".concat(e.groupID)),t.probeNetwork().then(function(e,t){o.setError(n,e,t).setEnd()}),J.log(\"GroupController.modifyGroup error. error:\".concat(n,\" groupID:\").concat(e.groupID)),Ht(n)})}},{\"key\":\"setGroupMemberRole\",\"value\":function(e){var t=this,o=e.groupID,r=e.userID,n=e.role,i=this.groupMap.get(o);if(i.selfInfo.role!==S.GRP_MBR_ROLE_OWNER)return Ht(new lt({\"code\":pt.NOT_OWNER,\"message\":ht.NOT_OWNER}));if([S.GRP_PRIVATE,S.GRP_AVCHATROOM].includes(i.type))return Ht(new lt({\"code\":pt.CANNOT_SET_MEMBER_ROLE_IN_PRIVATE_AND_AVCHATROOM,\"message\":ht.CANNOT_SET_MEMBER_ROLE_IN_PRIVATE_AND_AVCHATROOM}));if([S.GRP_MBR_ROLE_ADMIN,S.GRP_MBR_ROLE_MEMBER].indexOf(n)<0)return Ht(new lt({\"code\":pt.INVALID_MEMBER_ROLE,\"message\":ht.INVALID_MEMBER_ROLE}));if(r===this.tim.loginInfo.identifier)return Ht(new lt({\"code\":pt.CANNOT_SET_SELF_MEMBER_ROLE,\"message\":ht.CANNOT_SET_SELF_MEMBER_ROLE}));var s=new Yt;return s.setMethod(jt.SET_GROUPMEMBER_ROLE).setStart(),s.setText(\"groupID=\".concat(o,\" userID=\").concat(r,\" role=\").concat(n)),J.log(\"GroupController.setGroupMemberRole. groupID:\".concat(o,\". userID: \").concat(r)),this._modifyGroupMemberInfo({\"groupID\":o,\"userID\":r,\"role\":n}).then(function(e){return s.setCode(0).setNetworkType(t.getNetworkType()).setEnd(),J.log(\"GroupController.setGroupMemberRole ok. groupID:\".concat(o,\". userID: \").concat(r)),new Ft({\"group\":i,\"member\":e})}).catch(function(n){return t.probeNetwork().then(function(e,t){s.setError(n,e,t).setEnd()}),J.error(\"GroupController.setGroupMemberRole error:\".concat(n,\". groupID:\").concat(o,\". userID:\").concat(r)),Ht(n)})}},{\"key\":\"setGroupMemberMuteTime\",\"value\":function(e){var t=this,o=e.groupID,r=e.userID,n=e.muteTime;if(r===this.tim.loginInfo.identifier)return Ht(new lt({\"code\":pt.CANNOT_MUTE_SELF,\"message\":ht.CANNOT_MUTE_SELF}));J.log(\"GroupController.setGroupMemberMuteTime. groupID:\".concat(o,\". userID: \").concat(r));var i=new Yt;return i.setMethod(jt.SET_GROUPMEMBER_MUTE_TIME).setStart(),i.setText(\"groupID=\".concat(o,\" userID=\").concat(r,\" muteTime=\").concat(n)),this._modifyGroupMemberInfo({\"groupID\":o,\"userID\":r,\"muteTime\":n}).then(function(e){return i.setCode(0).setNetworkType(t.getNetworkType()).setEnd(),J.log(\"GroupController.setGroupMemberMuteTime ok. groupID:\".concat(o,\". userID: \").concat(r)),new Ft({\"group\":t.getLocalGroupProfile(o),\"member\":e})}).catch(function(n){return t.probeNetwork().then(function(e,t){i.setError(n,e,t).setEnd()}),J.error(\"GroupController.setGroupMemberMuteTime error:\".concat(n,\". groupID:\").concat(o,\". userID:\").concat(r)),Ht(n)})}},{\"key\":\"setMessageRemindType\",\"value\":function(t){var n=this;J.log(\"GroupController.setMessageRemindType. groupID:\".concat(t.groupID,\". userID: \").concat(t.userID||this.tim.loginInfo.identifier));var e=t.groupID,o=t.messageRemindType;return this._modifyGroupMemberInfo({\"groupID\":e,\"messageRemindType\":o,\"userID\":this.tim.loginInfo.identifier}).then(function(){J.log(\"GroupController.setMessageRemindType ok. groupID:\".concat(t.groupID,\". userID: \").concat(t.userID||n.tim.loginInfo.identifier));var e=n.getLocalGroupProfile(t.groupID);return e&&(e.selfInfo.messageRemindType=o),new Ft({\"group\":e})}).catch(function(e){return J.error(\"GroupController.setMessageRemindType error:\".concat(e,\". groupID:\").concat(t.groupID,\". userID:\").concat(t.userID||n.tim.loginInfo.identifier)),Ht(e)})}},{\"key\":\"setGroupMemberNameCard\",\"value\":function(e){var o=this,r=e.groupID,t=e.userID,i=void 0===t?this.tim.loginInfo.identifier:t,n=e.nameCard;J.log(\"GroupController.setGroupMemberNameCard. groupID:\".concat(r,\". userID: \").concat(i));var s=new Yt;return s.setMethod(jt.SET_GROUPMEMBER_NAME_CARD).setStart(),s.setText(\"groupID=\".concat(r,\" userID=\").concat(i,\" nameCard=\").concat(n)),this._modifyGroupMemberInfo({\"groupID\":r,\"userID\":i,\"nameCard\":n}).then(function(e){J.log(\"GroupController.setGroupMemberNameCard ok. groupID:\".concat(r,\". userID: \").concat(i)),s.setCode(0).setNetworkType(o.getNetworkType()).setEnd();var t=o.getLocalGroupProfile(r);return i===o.tim.loginInfo.identifier&&t&&t.setSelfNameCard(n),new Ft({\"group\":t,\"member\":e})}).catch(function(n){return o.probeNetwork().then(function(e,t){s.setError(n,e,t).setEnd()}),J.error(\"GroupController.setGroupMemberNameCard error:\".concat(n,\". groupID:\").concat(r,\". userID:\").concat(i)),Ht(n)})}},{\"key\":\"setGroupMemberCustomField\",\"value\":function(e){var t=this,o=e.groupID,n=e.userID,r=void 0===n?this.tim.loginInfo.identifier:n,i=e.memberCustomField;J.log(\"GroupController.setGroupMemberCustomField. groupID:\".concat(o,\". userID: \").concat(r));var s=new Yt;return s.setMethod(jt.SET_GROUPMEMBER_CUSTOM_FIELD).setStart(),s.setText(\"groupID=\".concat(o,\" userID=\").concat(r,\" memberCustomField=\").concat(i)),this._modifyGroupMemberInfo({\"groupID\":o,\"userID\":r,\"memberCustomField\":i}).then(function(e){return s.setCode(0).setNetworkType(t.getNetworkType()).setEnd(),J.log(\"GroupController.setGroupMemberCustomField ok. groupID:\".concat(o,\". userID: \").concat(r)),new Ft({\"group\":t.groupMap.get(o),\"member\":e})}).catch(function(n){return t.probeNetwork().then(function(e,t){s.setError(n,e,t).setEnd()}),J.error(\"GroupController.setGroupMemberCustomField error:\".concat(n,\". groupID:\").concat(o,\". userID:\").concat(r)),Ht(n)})}},{\"key\":\"getGroupList\",\"value\":function(e){var o=this,r=new Yt;r.setMethod(jt.GET_GROUP_LIST).setStart(),J.log(\"GroupController.getGroupList\");var t={\"introduction\":\"Introduction\",\"notification\":\"Notification\",\"createTime\":\"CreateTime\",\"ownerID\":\"Owner_Account\",\"lastInfoTime\":\"LastInfoTime\",\"memberNum\":\"MemberNum\",\"maxMemberNum\":\"MaxMemberNum\",\"joinOption\":\"ApplyJoinOption\"},n=[\"Type\",\"Name\",\"FaceUrl\",\"NextMsgSeq\",\"LastMsgTime\"];e&&e.groupProfileFilter&&e.groupProfileFilter.forEach(function(e){t[e]&&n.push(t[e])});var i=this.createPackage({\"name\":\"group\",\"action\":\"list\",\"param\":{\"responseFilter\":{\"groupBaseInfoFilter\":n,\"selfInfoFilter\":[\"Role\",\"JoinTime\",\"MsgFlag\"]}}});return this.tim.connectionController.request(i).then(function(e){var t=e.data.groups;return r.setCode(0).setNetworkType(o.getNetworkType()).setText(t.length).setEnd(),J.log(\"GroupController.getGroupList ok\"),o._groupListTreeShaking(t),o.updateGroupMap(t),o.tempConversationList&&(o._handleUpdateGroupLastMessage(o.tempConversationList),o.tempConversationList=null),o.emitGroupListUpdate(),new Ft({\"groupList\":o.getLocalGroups()})}).catch(function(n){return o.probeNetwork().then(function(e,t){r.setError(n,e,t).setEnd()}),J.error(\"GroupController.getGroupList error: \",n),Ht(n)})}},{\"key\":\"getGroupMemberList\",\"value\":function(e){var r=this,i=e.groupID,t=e.offset,n=void 0===t?0:t,o=e.count,s=void 0===o?15:o;J.log(\"GroupController.getGroupMemberList groupID: \".concat(i,\" offset: \").concat(n,\" count: \").concat(s));var a=this.createPackage({\"name\":\"group\",\"action\":\"getGroupMemberList\",\"param\":{\"groupID\":i,\"offset\":n,\"limit\":s>100?100:s,\"memberInfoFilter\":[\"Role\",\"NameCard\"]}}),u=[];return this.connectionController.request(a).then(function(e){var t=e.data,n=t.members,o=t.memberNum;return ie(n)&&0!==n.length?(r.hasLocalGroup(i)&&(r.getLocalGroupProfile(i).memberNum=o),u=r._updateLocalGroupMemberMap(i,n),r.tim.getUserProfile({\"userIDList\":n.map(function(e){return e.userID}),\"tagList\":[Qe.NICK,Qe.AVATAR]})):Promise.resolve([])}).then(function(e){var t=e.data;if(!ie(t)||0===t.length)return Kt({\"memberList\":[]});var n=t.map(function(e){return{\"userID\":e.userID,\"nick\":e.nick,\"avatar\":e.avatar}});return r._updateLocalGroupMemberMap(i,n),J.log(\"GroupController.getGroupMemberList ok.\"),new Ft({\"memberList\":u})}).catch(function(e){return J.error(\"GroupController.getGroupMemberList error: \",e),Ht(e)})}},{\"key\":\"getLocalGroups\",\"value\":function(){return E(this.groupMap.values())}},{\"key\":\"getLocalGroupProfile\",\"value\":function(e){return this.groupMap.get(e)}},{\"key\":\"hasLocalGroup\",\"value\":function(e){return this.groupMap.has(e)}},{\"key\":\"getLocalGroupMemberInfo\",\"value\":function(e,t){return this.groupMemberListMap.has(e)?this.groupMemberListMap.get(e).get(t):null}},{\"key\":\"setLocalGroupMember\",\"value\":function(e,t){if(this.groupMemberListMap.has(e))this.groupMemberListMap.get(e).set(t.userID,t);else{var n=(new Map).set(t.userID,t);this.groupMemberListMap.set(e,n)}}},{\"key\":\"hasLocalGroupMember\",\"value\":function(e,t){return this.groupMemberListMap.has(e)&&this.groupMemberListMap.get(e).has(t)}},{\"key\":\"hasLocalGroupMemberMap\",\"value\":function(e){return this.groupMemberListMap.has(e)}},{\"key\":\"getGroupProfile\",\"value\":function(i){var s=this;J.log(\"GroupController.getGroupProfile. groupID:\",i.groupID);var a=i.groupID,e=i.groupCustomFieldFilter,t={\"groupIDList\":[a],\"responseFilter\":{\"groupBaseInfoFilter\":[\"Type\",\"Name\",\"Introduction\",\"Notification\",\"FaceUrl\",\"Owner_Account\",\"CreateTime\",\"InfoSeq\",\"LastInfoTime\",\"LastMsgTime\",\"MemberNum\",\"MaxMemberNum\",\"ApplyJoinOption\",\"NextMsgSeq\"],\"groupCustomFieldFilter\":e}};return this.getGroupProfileAdvance(t).then(function(e){var t,n=e.data,o=n.successGroupList,r=n.failureGroupList;return J.log(\"GroupController.getGroupProfile ok. groupID:\",i.groupID),r.length>0?Ht(r[0]):(Re(o[0].type)&&!s.hasLocalGroup(a)?t=new Go(o[0]):(s.updateGroupMap(o),t=s.getLocalGroupProfile(a)),t&&t.selfInfo&&!t.selfInfo.nameCard?s.updateSelfInfo(t).then(function(e){return new Ft({\"group\":e})}):new Ft({\"group\":t}))}).catch(function(e){return J.error(\"GroupController.getGroupProfile error:\".concat(e,\". groupID:\").concat(i.groupID)),Ht(e)})}},{\"key\":\"getGroupMemberProfile\",\"value\":function(e){var o=this;J.log(\"GroupController.getGroupMemberProfile groupID:\".concat(e.groupID,\" userIDList:\").concat(e.userIDList.join(\",\"))),e.userIDList.length>50&&(e.userIDList=e.userIDList.slice(0,50));var r=e.groupID,i=e.userIDList;return this._getGroupMemberProfileAdvance(c({},e,{\"userIDList\":i})).then(function(e){var t=e.data.members;return ie(t)&&0!==t.length?(o._updateLocalGroupMemberMap(r,t),o.tim.getUserProfile({\"userIDList\":t.map(function(e){return e.userID}),\"tagList\":[Qe.NICK,Qe.AVATAR]})):Kt([])}).then(function(e){var t=e.data.map(function(e){return{\"userID\":e.userID,\"nick\":e.nick,\"avatar\":e.avatar}});o._updateLocalGroupMemberMap(r,t);var n=i.filter(function(e){return o.hasLocalGroupMember(r,e)}).map(function(e){return o.getLocalGroupMemberInfo(r,e)});return new Ft({\"memberList\":n})})}},{\"key\":\"_getGroupMemberProfileAdvance\",\"value\":function(e){var t=this.createPackage({\"name\":\"group\",\"action\":\"getGroupMemberProfile\",\"param\":c({},e,{\"memberInfoFilter\":e.memberInfoFilter?e.memberInfoFilter:[\"Role\",\"JoinTime\",\"NameCard\",\"ShutUpUntil\"]})});return this.connectionController.request(t)}},{\"key\":\"updateSelfInfo\",\"value\":function(n){var o=n.groupID;J.log(\"GroupController.updateSelfInfo groupID:\",o);var e={\"groupID\":o,\"userIDList\":[this.tim.loginInfo.identifier]};return this.getGroupMemberProfile(e).then(function(e){var t=e.data.memberList;return J.log(\"GroupController.updateSelfInfo ok. groupID:\",o),n&&0!==t.length&&n.updateSelfInfo(t[0]),n})}},{\"key\":\"addGroupMember\",\"value\":function(i){var s=this.getLocalGroupProfile(i.groupID);if(Re(s.type)){var e=new lt({\"code\":pt.CANNOT_ADD_MEMBER_IN_AVCHATROOM,\"message\":ht.CANNOT_ADD_MEMBER_IN_AVCHATROOM});return Ht(e)}i.userIDList=i.userIDList.map(function(e){return{\"userID\":e}});var t=this.createPackage({\"name\":\"group\",\"action\":\"addGroupMember\",\"param\":i});return J.log(\"GroupController.addGroupMember. groupID:\",i.groupID),this.connectionController.request(t).then(function(e){var t=e.data.members;J.log(\"GroupController.addGroupMember ok. groupID:\",i.groupID);var n=t.filter(function(e){return 1===e.result}).map(function(e){return e.userID}),o=t.filter(function(e){return 0===e.result}).map(function(e){return e.userID}),r=t.filter(function(e){return 2===e.result}).map(function(e){return e.userID});return 0===n.length?new Ft({\"successUserIDList\":n,\"failureUserIDList\":o,\"existedUserIDList\":r}):(s.memberNum+=n.length,new Ft({\"successUserIDList\":n,\"failureUserIDList\":o,\"existedUserIDList\":r,\"group\":s}))}).catch(function(e){return J.error(\"GroupController.addGroupMember error:\".concat(e,\", groupID:\").concat(i.groupID)),Ht(e)})}},{\"key\":\"deleteGroupMember\",\"value\":function(t){var e=this;J.log(\"GroupController.deleteGroupMember groupID:\".concat(t.groupID,\" userIDList:\").concat(t.userIDList));var n=this.getLocalGroupProfile(t.groupID);if(n.type===S.GRP_AVCHATROOM)return Ht(new lt({\"code\":pt.CANNOT_KICK_MEMBER_IN_AVCHATROOM,\"message\":ht.CANNOT_KICK_MEMBER_IN_AVCHATROOM}));var o=this.createPackage({\"name\":\"group\",\"action\":\"deleteGroupMember\",\"param\":t});return this.connectionController.request(o).then(function(){return J.log(\"GroupController.deleteGroupMember ok\"),n.memberNum--,e.deleteLocalGroupMembers(t.groupID,t.userIDList),new Ft({\"group\":n,\"userIDList\":t.userIDList})}).catch(function(e){return J.error(\"GroupController.deleteGroupMember error:\".concat(e.code,\", groupID:\").concat(t.groupID)),Ht(e)})}},{\"key\":\"searchGroupByID\",\"value\":function(n){var e={\"groupIDList\":[n]},t=this.createPackage({\"name\":\"group\",\"action\":\"searchGroupByID\",\"param\":e});return J.log(\"GroupController.searchGroupByID. groupID:\".concat(n)),this.connectionController.request(t).then(function(e){var t=e.data.groupProfile;if(J.log(\"GroupController.searchGroupByID ok. groupID:\".concat(n)),t[0].errorCode!==we.REQUEST.SUCCESS)throw new lt({\"code\":t[0].errorCode,\"message\":t[0].errorInfo});return new Ft({\"group\":new Go(t[0])})}).catch(function(e){return J.error(\"GroupController.searchGroupByID error:\".concat(e,\", groupID:\").concat(n)),Ht(e)})}},{\"key\":\"applyJoinGroup\",\"value\":function(i){var s=this,a=new Yt;a.setMethod(jt.APPLY_JOIN_GROUP).setStart();var e=this.createPackage({\"name\":\"group\",\"action\":\"applyJoinGroup\",\"param\":i});return this.connectionController.request(e).then(function(e){var t=e.data,n=t.joinedStatus,o=t.longPollingKey;switch(a.setCode(0).setNetworkType(s.getNetworkType()).setText(\"groupID=\".concat(i.groupID,\" joinedStatus=\").concat(n)).setEnd(),J.log(\"GroupController.joinGroup ok. groupID:\",i.groupID),n){case ke.WAIT_APPROVAL:return new Ft({\"status\":ke.WAIT_APPROVAL});case ke.SUCCESS:return s.getGroupProfile({\"groupID\":i.groupID}).then(function(e){var t=e.data.group,n={\"status\":ke.SUCCESS,\"group\":t};return se(o)?new Ft(n):(s.tim.innerEmitter.emit(Pt.AVCHATROOM_JOIN_SUCCESS,{\"data\":i.groupID}),s.AVChatRoomHandler.startRunLoop({\"longPollingKey\":o,\"group\":t}))});default:var r=new lt({\"code\":pt.JOIN_GROUP_FAIL,\"message\":ht.JOIN_GROUP_FAIL});return J.error(\"GroupController.joinGroup error:\".concat(r,\". groupID:\").concat(i.groupID)),Ht(r)}}).catch(function(n){return a.setText(\"groupID=\".concat(i.groupID)),s.probeNetwork().then(function(e,t){a.setError(n,e,t).setEnd()}),J.error(\"GroupController.joinGroup error:\".concat(n,\". groupID:\").concat(i.groupID)),Ht(n)})}},{\"key\":\"applyJoinAVChatRoom\",\"value\":function(e){return this.AVChatRoomHandler.applyJoinAVChatRoom(e)}},{\"key\":\"handleGroupApplication\",\"value\":function(e){var t=this,n=e.message.payload,o=n.groupProfile.groupID,r=n.authentication,i=n.messageKey,s=n.operatorID,a=this.createPackage({\"name\":\"group\",\"action\":\"handleApplyJoinGroup\",\"param\":c({},e,{\"applicant\":s,\"groupID\":o,\"authentication\":r,\"messageKey\":i})});return J.log(\"GroupController.handleApplication. groupID:\",o),this.connectionController.request(a).then(function(){return J.log(\"GroupController.handleApplication ok. groupID:\",o),t.deleteGroupSystemNotice({\"messageList\":[e.message]}),new Ft({\"group\":t.getLocalGroupProfile(o)})}).catch(function(e){return J.error(\"GroupController.handleApplication error.  error:\".concat(e,\". groupID:\").concat(o)),Ht(e)})}},{\"key\":\"deleteGroupSystemNotice\",\"value\":function(e){var t=this;if(!ie(e.messageList)||0===e.messageList.length)return Kt();J.log(\"GroupController.deleteGroupSystemNotice \"+e.messageList.map(function(e){return e.ID}));var n=this.createPackage({\"name\":\"group\",\"action\":\"deleteGroupSystemNotice\",\"param\":{\"messageListToDelete\":e.messageList.map(function(e){return{\"from\":S.CONV_SYSTEM,\"messageSeq\":e.clientSequence,\"messageRandom\":e.random}})}});return this.connectionController.request(n).then(function(){return J.log(\"GroupController.deleteGroupSystemNotice ok\"),e.messageList.forEach(function(e){t.tim.messageController.deleteLocalMessage(e)}),new Ft}).catch(function(e){return J.error(\"GroupController.deleteGroupSystemNotice error:\",e),Ht(e)})}},{\"key\":\"getLocalGroupLastSequence\",\"value\":function(e){if(!this.groupMap.has(e))return 0;var t=this.groupMap.get(e);return t.lastMessage.lastSequence?t.lastMessage.lastSequence:t.nextMessageSeq-1}},{\"key\":\"getGroupProfileAdvance\",\"value\":function(t){ie(t.groupIDList)&&t.groupIDList.length>50&&(J.warn(\"GroupController.getGroupProfileAdvance 获取群资料的数量不能超过50个\"),t.groupIDList.length=50),J.log(\"GroupController.getGroupProfileAdvance. groupIDList:\",t.groupIDList);var e=this.createPackage({\"name\":\"group\",\"action\":\"query\",\"param\":t});return this.tim.connectionController.request(e).then(function(e){J.log(\"GroupController.getGroupProfileAdvance ok.\");var t=e.data.groups,n=t.filter(function(e){return se(e.errorCode)||e.errorCode===we.REQUEST.SUCCESS}),o=t.filter(function(e){return e.errorCode&&e.errorCode!==we.REQUEST.SUCCESS}).map(function(e){return new lt({\"code\":Number(\"500\".concat(e.errorCode)),\"message\":e.errorInfo,\"data\":{\"groupID\":e.groupID}})});return new Ft({\"successGroupList\":n,\"failureGroupList\":o})}).catch(function(e){return J.error(\"GroupController.getGroupProfile error:\".concat(e,\". groupID:\").concat(t.groupID)),Ht(e)})}},{\"key\":\"_deleteLocalGroup\",\"value\":function(e){return this.groupMap.delete(e),this.groupMemberListMap.delete(e),this._setStorageGroupList(),this.groupMap.has(e)&&this.groupMemberListMap.has(e)}},{\"key\":\"_initGroupList\",\"value\":function(){var t=this,e=new Yt;e.setMethod(jt.GET_GROUP_LIST_IN_STORAGE).setStart(),J.time(Bt.INIT_GROUP_LIST),J.log(\"GroupController._initGroupList\");var n=this._getStorageGroupList();ie(n)&&n.length>0?(n.forEach(function(e){t.groupMap.set(e.groupID,new Go(e))}),this.emitGroupListUpdate(!0,!1),e.setCode(0).setNetworkType(this.getNetworkType()).setText(this.groupMap.size).setEnd()):e.setCode(0).setNetworkType(this.getNetworkType()).setText(0).setEnd(),this.triggerReady(),J.log(\"GroupController._initGroupList ok. initCost=\".concat(J.timeEnd(Bt.INIT_GROUP_LIST),\"ms\")),this.getGroupList()}},{\"key\":\"_initListeners\",\"value\":function(){var e=this.tim.innerEmitter;e.once(Pt.CONTEXT_A2KEY_AND_TINYID_UPDATED,this._initGroupList,this),e.on(Pt.CONVERSATION_LIST_UPDATED,this._handleUpdateGroupLastMessage,this),e.on(Pt.MESSAGE_GROUP_INSTANT_RECEIVED,this._handleReceivedGroupMessage,this),e.on(Pt.PROFILE_UPDATED,this._handleProfileUpdated,this)}},{\"key\":\"emitGroupListUpdate\",\"value\":function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getLocalGroups();t&&this.tim.innerEmitter.emit(Pt.GROUP_LIST_UPDATED,n),e&&this.tim.outerEmitter.emit(v.GROUP_LIST_UPDATED,n)}},{\"key\":\"_handleReceivedGroupMessage\",\"value\":function(e){var n=this,t=e.data.eventDataList;Array.isArray(t)&&t.forEach(function(e){var t=e.conversationID.replace(S.CONV_GROUP,\"\");n.groupMap.has(t)&&(n.groupMap.get(t).nextMessageSeq=e.lastMessage.sequence+1)})}},{\"key\":\"_onReceivedGroupSystemNotice\",\"value\":function(e){var t=e.data;this.groupNoticeHandler._onReceivedGroupNotice(t)}},{\"key\":\"_handleUpdateGroupLastMessage\",\"value\":function(e){if(0!==this.groupMap.size){for(var t=!1,n=0;n<e.length;n++){var o=e[n],r=o.type===S.CONV_GROUP;if(o.conversationID&&r){var i=o.conversationID.split(/^GROUP/)[1],s=this.getLocalGroupProfile(i);s&&(s.lastMessage=o.lastMessage,t=!0)}}t&&(this.groupMap=this._sortLocalGroupList(this.groupMap),this.emitGroupListUpdate(!0,!1))}else this.tempConversationList=e}},{\"key\":\"_sortLocalGroupList\",\"value\":function(e){var t=E(e).filter(function(e){var t=m(e,2);t[0];return!Ne(t[1].lastMessage)});return t.sort(function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime}),new Map([].concat(E(t),E(e)))}},{\"key\":\"_getStorageGroupList\",\"value\":function(){return this.tim.storage.getItem(\"groupMap\")}},{\"key\":\"_setStorageGroupList\",\"value\":function(){var e=this.getLocalGroups().filter(function(e){var t=e.type;return!Re(t)}).slice(0,20).map(function(e){return{\"groupID\":e.groupID,\"name\":e.name,\"avatar\":e.avatar,\"type\":e.type}});this.tim.storage.setItem(\"groupMap\",e)}},{\"key\":\"updateGroupMap\",\"value\":function(e){var t=this;e.forEach(function(e){t.groupMap.has(e.groupID)?t.groupMap.get(e.groupID).updateGroup(e):t.groupMap.set(e.groupID,new Go(e))}),this._setStorageGroupList()}},{\"key\":\"_updateLocalGroupMemberMap\",\"value\":function(t,e){var n=this;return ie(e)&&0!==e.length?e.map(function(e){return n.hasLocalGroupMember(t,e.userID)?n.getLocalGroupMemberInfo(t,e.userID).updateMember(e):n.setLocalGroupMember(t,new Yo(e)),n.getLocalGroupMemberInfo(t,e.userID)}):[]}},{\"key\":\"deleteLocalGroupMembers\",\"value\":function(e,t){var n=this.groupMemberListMap.get(e);n&&t.forEach(function(e){n.delete(e)})}},{\"key\":\"_modifyGroupMemberInfo\",\"value\":function(t){var n=this,o=t.groupID,r=t.userID,e=this.createPackage({\"name\":\"group\",\"action\":\"modifyGroupMemberInfo\",\"param\":t});return this.tim.connectionController.request(e).then(function(){if(n.hasLocalGroupMember(o,r)){var e=n.getLocalGroupMemberInfo(o,r);return se(t.muteTime)||e.updateMuteUntil(t.muteTime),se(t.role)||e.updateRole(t.role),se(t.nameCard)||e.updateNameCard(t.nameCard),se(t.memberCustomField)||e.updateMemberCustomField(t.memberCustomField),e}return n.getGroupMemberProfile({\"groupID\":o,\"userIDList\":[r]}).then(function(e){return m(e.data.memberList,1)[0]})})}},{\"key\":\"_groupListTreeShaking\",\"value\":function(e){for(var t=new Map(E(this.groupMap)),n=0,o=e.length;n<o;n++)t.delete(e[n].groupID);this.AVChatRoomHandler.hasJoinedAVChatRoom()&&t.delete(this.AVChatRoomHandler.group.groupID);for(var r=E(t.keys()),i=0,s=r.length;i<s;i++)this.groupMap.delete(r[i])}},{\"key\":\"_handleProfileUpdated\",\"value\":function(e){for(var n=this,o=e.data,t=function(e){var t=o[e];n.groupMemberListMap.forEach(function(e){e.has(t.userID)&&e.get(t.userID).updateMember({\"nick\":t.nick,\"avatar\":t.avatar})})},r=0;r<o.length;r++)t(r)}},{\"key\":\"getJoinedAVChatRoom\",\"value\":function(){return this.AVChatRoomHandler.getJoinedAVChatRoom()}},{\"key\":\"deleteLocalGroupAndConversation\",\"value\":function(e){this._deleteLocalGroup(e),this.tim.conversationController.deleteLocalConversation(\"GROUP\".concat(e)),this.emitGroupListUpdate(!0,!1)}},{\"key\":\"checkJoinedAVChatRoomByID\",\"value\":function(e){return this.AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{\"key\":\"reset\",\"value\":function(){this.groupMap.clear(),this.groupMemberListMap.clear(),this.resetReady(),this.groupNoticeHandler.reset(),this.AVChatRoomHandler.reset(),this.tim.innerEmitter.once(Pt.CONTEXT_A2KEY_AND_TINYID_UPDATED,this._initGroupList,this)}}]),r}(),nr=function(){for(var e=[],t=or(arguments),n=0;n<arguments.length;n++)Number.isInteger(arguments[n])?e.push(arguments[n]):e.push(!0==!!arguments[n]?\"1\":\"0\");return e.join(t)},or=function(e){var t=e.length,n=e[t-1];if(\"string\"!=typeof n)return\"\";if(n.length>1)return\"\";var o=e[t-1];return delete e[t-1],e.length-=t===e.length?1:0,o},rr=function(e){function t(e){var n;return o(this,t),(n=d(this,p(t).call(this,e)))._initializeMembers(),n.tim.innerEmitter.on(Pt.SIGN_LOGIN_SUCCESS,function(){n._initializeStatus(),n._bindListener()}),n.tim.innerEmitter.on(Pt.SIGN_LOGOUT_EXECUTING,function(){n._initializeStatus(),n._unbindListener()}),n}return l(t,bt),s(t,[{\"key\":\"_initializeMembers\",\"value\":function(){this.normalTimeout=300,this.realtimeNoticeTimeout=11e4,this.channelMaxTimeout=3e5}},{\"key\":\"_initializeStatus\",\"value\":function(){this._initializeAccountStatus(),this._initializeChannelStatus()}},{\"key\":\"_initializeAccountStatus\",\"value\":function(){this.accountStatus={\"lastSignInTime\":0,\"status\":we.ACCOUNT_STATUS.SIGN_OUT}}},{\"key\":\"_initializeChannelStatus\",\"value\":function(){this.channelStatus={\"startTime\":0,\"offlineTime\":0,\"failCount\":0,\"lastRequestTime\":0,\"lastJitterTime\":0,\"jitterCount\":0,\"jitters\":[],\"status\":we.CHANNEL_STATUS.OFFLINE}}},{\"key\":\"getChannelStatus\",\"value\":function(){return this.channelStatus.status}},{\"key\":\"_channelStatusJittersUpdate\",\"value\":function(e){this.channelStatus.jitterCount++,this.channelStatus.lastJitterTime=e,this.channelStatus.jitters.push(e),this.channelStatus.jitters.length>5&&this.channelStatus.jitters.pop()}},{\"key\":\"_bindListener\",\"value\":function(){var e=this.tim.innerEmitter;e.on(Pt.NOTICE_LONGPOLL_START,this._onChannelStart,this),e.on(Pt.NOTICE_LONGPOLL_REQUEST_ARRIVED,this._onChannelRequestSuccess,this),e.on(Pt.NOTICE_LONGPOLL_REQUEST_NOT_ARRIVED,this._onChannelFail,this),e.on(Pt.NOTICE_LONGPOLL_REQUEST_ERROR,this._onChannelResponseError,this)}},{\"key\":\"_unbindListener\",\"value\":function(){var e=this.tim.innerEmitter;e.off(Pt.NOTICE_LONGPOLL_START,this._onChannelStart,this),e.off(Pt.NOTICE_LONGPOLL_REQUEST_ARRIVED,this._onChannelRequestSuccess,this),e.off(Pt.NOTICE_LONGPOLL_REQUEST_NOT_ARRIVED,this._onChannelFail,this),e.off(Pt.NOTICE_LONGPOLL_REQUEST_ERROR,this._onChannelResponseError,this)}},{\"key\":\"_onChannelStart\",\"value\":function(){this.channelStatus.startTime=+new Date,this.channelStatus.status=we.CHANNEL_STATUS.ONLINE}},{\"key\":\"_onChannelRequestSuccess\",\"value\":function(){var e=this.tim.innerEmitter,t=Date.now(),n=t-(this.channelStatus.lastRequestTime>0?this.channelStatus.lastRequestTime:Date.now()+100),o=nr(n<this.realtimeNoticeTimeout,n<this.channelMaxTimeout);switch(this.channelStatus.status=we.CHANNEL_STATUS.ONLINE,this.channelStatus.failCount=0,o){case\"11\":break;case\"01\":e.emit(Pt.NOTICE_LONGPOLL_SOON_RECONNECT);break;case\"00\":e.emit(Pt.NOTICE_LONGPOLL_LONG_RECONNECT)}this.channelStatus.lastRequestTime=t}},{\"key\":\"_onChannelFail\",\"value\":function(e){var t=this.tim.innerEmitter,n=Date.now();this.channelStatus.status=we.CHANNEL_STATUS.OFFLINE;var o=n-(0===this.channelStatus.offlineTime?this.channelStatus.lastRequestTime:this.channelStatus.offlineTime);this.channelStatus.offlineTime=n,this.channelStatus.failCount++,J.log(\"_onChannelFail count : \".concat(this.channelStatus.failCount,\"  time diff: \").concat(o,\";\")),this.channelStatus.failCount>5&&o<5e3&&(t.emit(Pt.NOTICE_LONGPOLL_DISCONNECT),J.error(\"Detected notice channel offline, please check your network!\"))}},{\"key\":\"_onChannelResponseError\",\"value\":function(e){if(e instanceof lt){var t=this.tim.innerEmitter;switch(this.channelStatus.status=we.CHANNEL_STATUS.OFFLINE,e.code){case pt.MESSAGE_A2KEY_EXPIRED:case pt.ACCOUNT_A2KEY_EXPIRED:t.emit(Pt.SIGN_A2KEY_EXPIRED),t.emit(Pt.NOTICE_LONGPOLL_DISCONNECT);break;case pt.LONG_POLL_API_PARAM_ERROR:J.error(e.code,e.message);break;default:t.emit(Pt.ERROR_DETECTED,e)}}else J.warn(\"StatusController._onChannelResponseError: Unhandled error \".concat(e.message,\":\"))}}]),t}();function qo(){return null}var ir=function(){function e(t){o(this,e),this.tim=t,this.isWX=L,this.storageQueue=new Map,this.checkTimes=0,this.checkTimer=setInterval(this._onCheckTimer.bind(this),1e3),this._errorTolerantHandle()}return s(e,[{\"key\":\"_errorTolerantHandle\",\"value\":function(){!this.isWX&&se(window.localStorage)&&(this.getItem=qo,this.setItem=qo,this.removeItem=qo,this.clear=qo)}},{\"key\":\"_onCheckTimer\",\"value\":function(){if(this.checkTimes++,this.checkTimes%20==0){if(0===this.storageQueue.size)return;this._doFlush()}}},{\"key\":\"_doFlush\",\"value\":function(){try{var e=!0,t=!1,n=void 0;try{for(var o,r=this.storageQueue[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){var i=m(o.value,2),s=i[0],a=i[1];this.isWX?wx.setStorageSync(this._getKey(s),a):localStorage.setItem(this._getKey(s),JSON.stringify(a))}}catch(e){t=!0,n=e}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}this.storageQueue.clear()}catch(e){J.warn(\"Storage._doFlush error\",e)}}},{\"key\":\"_getPrefix\",\"value\":function(){var e=this.tim.loginInfo,t=e.SDKAppID,n=e.identifier;return\"TIM_\".concat(t,\"_\").concat(n,\"_\")}},{\"key\":\"getItem\",\"value\":function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{var n=t?this._getKey(e):e;return this.isWX?wx.getStorageSync(n):JSON.parse(localStorage.getItem(n))}catch(e){J.warn(\"Storage.getItem error:\",e)}}},{\"key\":\"setItem\",\"value\":function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(n){var r=o?this._getKey(e):e;this.isWX?wx.setStorageSync(r,t):localStorage.setItem(r,JSON.stringify(t))}else this.storageQueue.set(e,t)}},{\"key\":\"clear\",\"value\":function(){try{this.isWX?wx.clearStorageSync():localStorage.clear()}catch(e){J.warn(\"Storage.clear error:\",e)}}},{\"key\":\"removeItem\",\"value\":function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{var n=t?this._getKey(e):e;this.isWX?wx.removeStorageSync(n):localStorage.removeItem(n)}catch(e){J.warn(\"Storage.removeItem error:\",e)}}},{\"key\":\"getSize\",\"value\":function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"b\";try{var o={\"size\":0,\"limitSize\":5242880,\"unit\":n};if(Object.defineProperty(o,\"leftSize\",{\"enumerable\":!0,\"get\":function(){return o.limitSize-o.size}}),this.isWX&&(o.limitSize=1024*wx.getStorageInfoSync().limitSize),e)o.size=JSON.stringify(this.getItem(e)).length+this._getKey(e).length;else if(this.isWX){var r=wx.getStorageInfoSync(),i=r.keys;i.forEach(function(e){o.size+=JSON.stringify(wx.getStorageSync(e)).length+t._getKey(e).length})}else for(var s in localStorage)localStorage.hasOwnProperty(s)&&(o.size+=localStorage.getItem(s).length+s.length);return this._convertUnit(o)}catch(e){J.warn(\"Storage.getSize error:\",e)}}},{\"key\":\"_convertUnit\",\"value\":function(e){var t={},n=e.unit;for(var o in t.unit=n,e)\"number\"==typeof e[o]&&(\"kb\"===n.toLowerCase()?t[o]=Math.round(e[o]/1024):\"mb\"===n.toLowerCase()?t[o]=Math.round(e[o]/1024/1024):t[o]=e[o]);return t}},{\"key\":\"_getKey\",\"value\":function(e){return\"\".concat(this._getPrefix()).concat(e)}},{\"key\":\"reset\",\"value\":function(){this._doFlush(),this.checkTimes=0}}]),e}(),sr=I(function(e){var u=Object.prototype.hasOwnProperty,_=\"~\";function r(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(e,t,n,r,i){if(\"function\"!=typeof n)throw new TypeError(\"The listener must be a function\");var s=new o(n,r||e,i),a=_?_+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],s]:e._events[a].push(s):(e._events[a]=s,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(_=!1)),a.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)u.call(e,t)&&n.push(_?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},a.prototype.listeners=function(e){var t=_?_+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,r=n.length,i=new Array(r);o<r;o++)i[o]=n[o].fn;return i},a.prototype.listenerCount=function(e){var t=_?_+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,o,r,i){var s=_?_+e:e;if(!this._events[s])return!1;var a,u,c=this._events[s],l=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,o),!0;case 5:return c.fn.call(c.context,t,n,o,r),!0;case 6:return c.fn.call(c.context,t,n,o,r,i),!0}for(u=1,a=new Array(l-1);u<l;u++)a[u-1]=arguments[u];c.fn.apply(c.context,a)}else{var p,h=c.length;for(u=0;u<h;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),l){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,n);break;case 4:c[u].fn.call(c[u].context,t,n,o);break;default:if(!a)for(p=1,a=new Array(l-1);p<l;p++)a[p-1]=arguments[p];c[u].fn.apply(c[u].context,a)}}return!0},a.prototype.on=function(e,t,n){return i(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return i(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,n,o){var r=_?_+e:e;if(!this._events[r])return this;if(!t)return s(this,r),this;var i=this._events[r];if(i.fn)i.fn!==t||o&&!i.once||n&&i.context!==n||s(this,r);else{for(var a=0,u=[],c=i.length;a<c;a++)(i[a].fn!==t||o&&!i[a].once||n&&i[a].context!==n)&&u.push(i[a]);u.length?this._events[r]=1===u.length?u[0]:u:s(this,r)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=_?_+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=_,a.EventEmitter=a,e.exports=a}),hr=function(e){var t,n,o,r,i;return Ne(e.context)?(t=\"\",n=0,o=0,r=0,i=1):(t=e.context.a2Key,n=e.context.tinyID,o=e.context.SDKAppID,r=e.context.contentType,i=e.context.apn),{\"platform\":Tt,\"websdkappid\":Ct,\"v\":St,\"a2\":t,\"tinyid\":n,\"sdkappid\":o,\"contentType\":r,\"apn\":i,\"reqtime\":function(){return+new Date}}},fr=function(){function e(t){o(this,e),this.isReady=!1,this.tim=t,this.context=t.context,this._initList(),this._updateWhenCTXIsReady()}return s(e,[{\"key\":\"_updateWhenCTXIsReady\",\"value\":function(){this.tim.innerEmitter.on(Pt.CONTEXT_UPDATED,this.update,this),this.tim.innerEmitter.on(Pt.CONTEXT_RESET,this.reset,this)}},{\"key\":\"update\",\"value\":function(e){var t=e.context;this.context=t,this._initList()}},{\"key\":\"reset\",\"value\":function(e){this.context=e.data,this._initList()}},{\"key\":\"get\",\"value\":function(e){var t=e.name,n=e.action,o=e.param,i=e.tjgID;if(void 0===this.config[t])throw new lt({\"code\":pt.NETWORK_PACKAGE_UNDEFINED,\"message\":\"\".concat(ht.NETWORK_PACKAGE_UNDEFINED,\": PackageConfig.\").concat(t)});if(void 0===this.config[t][n])throw new lt({\"code\":pt.NETWORK_PACKAGE_UNDEFINED,\"message\":\"\".concat(ht.NETWORK_PACKAGE_UNDEFINED,\": PackageConfig.\").concat(t,\".\").concat(n)});var s=function e(t){if(0===Object.getOwnPropertyNames(t).length)return Object.create(null);var n=Array.isArray(t)?[]:Object.create(null),o=\"\";for(var i in t)null!==t[i]?void 0!==t[i]?(o=r(t[i]),[\"string\",\"number\",\"function\",\"boolean\"].indexOf(o)>=0?n[i]=t[i]:n[i]=e(t[i])):n[i]=void 0:n[i]=null;return n}(this.config[t][n]);return s.requestData=this._initRequestData(o,s),s.encode=this._initEncoder(s),s.decode=this._initDecoder(s),i&&(s.queryString.tjg_id=i),s}},{\"key\":\"set\",\"value\":function(e){var t=e.key,n=e.value;if(!1!=!!t){var o=t.split(\".\");if(!(o.length<=0)){!function e(t,n,o,i){var s=n[o];\"object\"===r(t[s])?e(t[s],n,o+1,i):t[s]=i}(this.config,o,0,n)}}}},{\"key\":\"_initList\",\"value\":function(){var e;this.config={},this.config.accessLayer=(e=this.tim,{\"create\":null,\"query\":{\"serverName\":Nt.NAME.WEB_IM,\"cmd\":Nt.CMD.ACCESS_LAYER,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":{\"platform\":Tt,\"identifier\":e.loginInfo.identifier,\"usersig\":e.loginInfo.userSig,\"contentType\":e.loginInfo.contentType,\"apn\":null!==e.context?e.context.apn:1,\"websdkappid\":Ct,\"v\":St},\"requestData\":{}},\"update\":null,\"delete\":null}),this.config.login=function(e){return{\"create\":null,\"query\":{\"serverName\":Nt.NAME.OPEN_IM,\"cmd\":Nt.CMD.LOGIN,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":{\"websdkappid\":Ct,\"v\":St,\"platform\":Tt,\"identifier\":e.loginInfo.identifier,\"usersig\":e.loginInfo.userSig,\"sdkappid\":e.loginInfo.SDKAppID,\"accounttype\":e.loginInfo.accountType,\"contentType\":null!==e.context?e.context.contentType:0,\"apn\":null!==e.context?e.context.apn:1,\"reqtime\":+new Date/1e3},\"requestData\":{\"state\":\"Online\"},\"keyMaps\":{\"request\":{\"tinyID\":\"tinyId\"},\"response\":{\"TinyId\":\"tinyID\"}}},\"update\":null,\"delete\":null}}(this.tim),this.config.logout=function(e){return{\"create\":null,\"query\":{\"serverName\":Nt.NAME.OPEN_IM,\"cmd\":Nt.CMD.LOGOUT_ALL,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":{\"websdkappid\":Ct,\"v\":St,\"platform\":Tt,\"a2\":null!==e.context?e.context.a2Key:\"\",\"tinyid\":null!==e.context?e.context.tinyID:\"\",\"sdkappid\":null!==e.loginInfo?e.loginInfo.SDKAppID:0,\"contentType\":null!==e.context?e.context.contentType:0,\"apn\":null!==e.context?e.context.apn:\"\",\"reqtime\":+new Date/1e3},\"requestData\":{}},\"update\":null,\"delete\":null}}(this.tim),this.config.longPollLogout=function(e){return{\"create\":null,\"query\":{\"serverName\":Nt.NAME.OPEN_IM,\"cmd\":Nt.CMD.LOGOUT_LONG_POLL,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":{\"websdkappid\":Ct,\"v\":St,\"platform\":Tt,\"a2\":null!==e.context?e.context.a2Key:\"\",\"tinyid\":null!==e.context?e.context.tinyID:0,\"sdkappid\":null!==e.context?e.context.SDKAppID:0,\"contentType\":null!==e.context?e.context.contentType:0,\"apn\":null!==e.context?e.context.apn:1,\"reqtime\":function(){return Date.now()}},\"requestData\":{\"longPollID\":\"\"},\"keyMaps\":{\"request\":{\"longPollID\":\"LongPollingId\"}}},\"update\":null,\"delete\":null}}(this.tim),this.config.profile=function(e){var t=hr(e),n=Nt.NAME.PROFILE,o=Nt.CHANNEL.XHR,r=Ot;return{\"query\":{\"serverName\":n,\"cmd\":Nt.CMD.PORTRAIT_GET,\"channel\":o,\"protocol\":r,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"fromAccount\":\"\",\"userItem\":[]},\"keyMaps\":{\"request\":{\"toAccount\":\"To_Account\",\"standardSequence\":\"StandardSequence\",\"customSequence\":\"CustomSequence\"}}},\"update\":{\"serverName\":n,\"cmd\":Nt.CMD.PORTRAIT_SET,\"channel\":o,\"protocol\":r,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"fromAccount\":\"\",\"profileItem\":[{\"tag\":Qe.NICK,\"value\":\"\"},{\"tag\":Qe.GENDER,\"value\":\"\"},{\"tag\":Qe.ALLOWTYPE,\"value\":\"\"},{\"tag\":Qe.AVATAR,\"value\":\"\"}]}}}}(this.tim),this.config.group=function(e){var t={\"websdkappid\":Ct,\"v\":St,\"platform\":Tt,\"a2\":null!==e.context&&e.context.a2Key?e.context.a2Key:void 0,\"tinyid\":null!==e.context&&e.context.tinyID?e.context.tinyID:void 0,\"sdkappid\":null!==e.context?e.context.SDKAppID:0,\"contentType\":null!==e.context?e.context.contentType:0,\"accounttype\":null!==e.context?e.context.accountType:0},n={\"request\":{\"ownerID\":\"Owner_Account\",\"userID\":\"Member_Account\",\"newOwnerID\":\"NewOwner_Account\",\"maxMemberNum\":\"MaxMemberCount\",\"groupCustomField\":\"AppDefinedData\",\"memberCustomField\":\"AppMemberDefinedData\",\"groupCustomFieldFilter\":\"AppDefinedDataFilter_Group\",\"memberCustomFieldFilter\":\"AppDefinedDataFilter_GroupMember\",\"messageRemindType\":\"MsgFlag\",\"userIDList\":\"MemberList\",\"groupIDList\":\"GroupIdList\",\"applyMessage\":\"ApplyMsg\",\"muteTime\":\"ShutUpTime\",\"joinOption\":\"ApplyJoinOption\"},\"response\":{\"GroupIdList\":\"groups\",\"MsgFlag\":\"messageRemindType\",\"AppDefinedData\":\"groupCustomField\",\"AppMemberDefinedData\":\"memberCustomField\",\"AppDefinedDataFilter_Group\":\"groupCustomFieldFilter\",\"AppDefinedDataFilter_GroupMember\":\"memberCustomFieldFilter\",\"InfoSeq\":\"infoSequence\",\"MemberList\":\"members\",\"GroupInfo\":\"groups\",\"ShutUpUntil\":\"muteUntil\",\"ApplyJoinOption\":\"joinOption\"}};return{\"create\":{\"serverName\":Nt.NAME.GROUP,\"cmd\":Nt.CMD.CREATE_GROUP,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"queryString\":t,\"requestData\":{\"type\":S.GRP_PRIVATE,\"name\":void 0,\"groupID\":void 0,\"ownerID\":e.loginInfo.identifier,\"introduction\":void 0,\"notification\":void 0,\"avatar\":void 0,\"maxMemberNum\":void 0,\"joinOption\":void 0,\"memberList\":void 0,\"groupCustomField\":void 0},\"keyMaps\":n},\"list\":{\"serverName\":Nt.NAME.GROUP,\"cmd\":Nt.CMD.GET_JOINED_GROUPS,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"queryString\":t,\"requestData\":{\"userID\":e.loginInfo.identifier,\"limit\":void 0,\"offset\":void 0,\"groupType\":void 0,\"responseFilter\":void 0},\"keyMaps\":n},\"query\":{\"serverName\":Nt.NAME.GROUP,\"cmd\":Nt.CMD.GET_GROUP_INFO,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"queryString\":t,\"requestData\":{\"groupIDList\":void 0,\"responseFilter\":void 0},\"keyMaps\":n},\"getGroupMemberProfile\":{\"serverName\":Nt.NAME.GROUP,\"cmd\":Nt.CMD.GET_GROUP_MEMBER_INFO,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"queryString\":t,\"requestData\":{\"groupID\":void 0,\"userIDList\":void 0,\"memberInfoFilter\":void 0,\"memberCustomFieldFilter\":void 0},\"keyMaps\":{\"request\":c({},n.request,{\"userIDList\":\"Member_List_Account\"}),\"response\":n.response}},\"getGroupMemberList\":{\"serverName\":Nt.NAME.GROUP,\"cmd\":Nt.CMD.GET_GROUP_MEMBER_LIST,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"queryString\":t,\"requestData\":{\"groupID\":void 0,\"limit\":0,\"offset\":0,\"memberRoleFilter\":void 0,\"memberInfoFilter\":void 0},\"keyMaps\":n},\"quitGroup\":{\"serverName\":Nt.NAME.GROUP,\"cmd\":Nt.CMD.QUIT_GROUP,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"queryString\":t,\"requestData\":{\"groupID\":void 0}},\"changeGroupOwner\":{\"serverName\":Nt.NAME.GROUP,\"cmd\":Nt.CMD.CHANGE_GROUP_OWNER,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"queryString\":t,\"requestData\":{\"groupID\":void 0,\"newOwnerID\":void 0},\"keyMaps\":n},\"destroyGroup\":{\"serverName\":Nt.NAME.GROUP,\"cmd\":Nt.CMD.DESTROY_GROUP,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"queryString\":t,\"requestData\":{\"groupID\":void 0}},\"updateGroupProfile\":{\"serverName\":Nt.NAME.GROUP,\"cmd\":Nt.CMD.MODIFY_GROUP_INFO,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"queryString\":t,\"requestData\":{\"groupID\":void 0,\"name\":void 0,\"introduction\":void 0,\"notification\":void 0,\"avatar\":void 0,\"maxMemberNum\":void 0,\"joinOption\":void 0,\"groupCustomField\":void 0},\"keyMaps\":{\"request\":c({},n.request,{\"groupCustomField\":\"AppDefinedData\"}),\"response\":n.response}},\"modifyGroupMemberInfo\":{\"serverName\":Nt.NAME.GROUP,\"cmd\":Nt.CMD.MODIFY_GROUP_MEMBER_INFO,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"queryString\":t,\"requestData\":{\"groupID\":void 0,\"userID\":void 0,\"messageRemindType\":void 0,\"nameCard\":void 0,\"role\":void 0,\"memberCustomField\":void 0,\"muteTime\":void 0},\"keyMaps\":n},\"addGroupMember\":{\"serverName\":Nt.NAME.GROUP,\"cmd\":Nt.CMD.ADD_GROUP_MEMBER,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"queryString\":t,\"requestData\":{\"groupID\":void 0,\"silence\":void 0,\"userIDList\":void 0},\"keyMaps\":n},\"deleteGroupMember\":{\"serverName\":Nt.NAME.GROUP,\"cmd\":Nt.CMD.DELETE_GROUP_MEMBER,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"queryString\":t,\"requestData\":{\"groupID\":void 0,\"userIDList\":void 0,\"reason\":void 0},\"keyMaps\":{\"request\":{\"userIDList\":\"MemberToDel_Account\"}}},\"searchGroupByID\":{\"serverName\":Nt.NAME.GROUP,\"cmd\":Nt.CMD.SEARCH_GROUP_BY_ID,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"queryString\":t,\"requestData\":{\"groupIDList\":void 0,\"responseFilter\":{\"groupBasePublicInfoFilter\":[\"Type\",\"Name\",\"Introduction\",\"Notification\",\"FaceUrl\",\"CreateTime\",\"Owner_Account\",\"LastInfoTime\",\"LastMsgTime\",\"NextMsgSeq\",\"MemberNum\",\"MaxMemberNum\",\"ApplyJoinOption\"]}},\"keyMaps\":{\"request\":{\"groupIDList\":\"GroupIdList\"}}},\"applyJoinGroup\":{\"serverName\":Nt.NAME.GROUP,\"cmd\":Nt.CMD.APPLY_JOIN_GROUP,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"queryString\":t,\"requestData\":{\"groupID\":void 0,\"applyMessage\":void 0,\"userDefinedField\":void 0},\"keyMaps\":n},\"applyJoinAVChatRoom\":{\"serverName\":Nt.NAME.BIG_GROUP_NO_AUTH,\"cmd\":Nt.CMD.APPLY_JOIN_GROUP,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"queryString\":{\"websdkappid\":Ct,\"v\":St,\"platform\":Tt,\"sdkappid\":null!==e.context?e.context.SDKAppID:0,\"contentType\":null!==e.context?e.context.contentType:0,\"accounttype\":null!==e.context?e.context.accountType:0},\"requestData\":{\"groupID\":void 0,\"applyMessage\":void 0,\"userDefinedField\":void 0},\"keyMaps\":n},\"handleApplyJoinGroup\":{\"serverName\":Nt.NAME.GROUP,\"cmd\":Nt.CMD.HANDLE_APPLY_JOIN_GROUP,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"queryString\":t,\"requestData\":{\"groupID\":void 0,\"applicant\":void 0,\"handleAction\":void 0,\"handleMessage\":void 0,\"authentication\":void 0,\"messageKey\":void 0,\"userDefinedField\":void 0},\"keyMaps\":{\"request\":{\"applicant\":\"Applicant_Account\",\"handleAction\":\"HandleMsg\",\"handleMessage\":\"ApprovalMsg\",\"messageKey\":\"MsgKey\"},\"response\":{\"MsgKey\":\"messageKey\"}}},\"deleteGroupSystemNotice\":{\"serverName\":Nt.NAME.OPEN_IM,\"cmd\":Nt.CMD.DELETE_GROUP_SYSTEM_MESSAGE,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"queryString\":t,\"requestData\":{\"messageListToDelete\":void 0},\"keyMaps\":{\"request\":{\"messageListToDelete\":\"DelMsgList\",\"messageSeq\":\"MsgSeq\",\"messageRandom\":\"MsgRandom\"}}},\"getGroupPendency\":{\"serverName\":Nt.NAME.GROUP,\"cmd\":Nt.CMD.GET_GROUP_PENDENCY,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"queryString\":t,\"requestData\":{\"startTime\":void 0,\"limit\":void 0,\"handleAccount\":void 0},\"keyMaps\":{\"request\":{\"handleAccount\":\"Handle_Account\"}}}}}(this.tim),this.config.longPollID=function(e){return{\"create\":{},\"query\":{\"serverName\":Nt.NAME.OPEN_IM,\"cmd\":Nt.CMD.GET_LONG_POLL_ID,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"queryString\":{\"websdkappid\":Ct,\"v\":St,\"platform\":Tt,\"a2\":null!==e.context?e.context.a2Key:\"\",\"tinyid\":null!==e.context?e.context.tinyID:0,\"sdkappid\":null!==e.context?e.context.SDKAppID:0,\"contentType\":null!==e.context?e.context.contentType:0,\"apn\":null!==e.context?e.context.apn:1,\"reqtime\":+new Date/1e3},\"requestData\":{},\"keyMaps\":{\"response\":{\"LongPollingId\":\"longPollingID\"}}},\"update\":{},\"delete\":{}}}(this.tim),this.config.longPoll=function(e){var t={\"websdkappid\":Ct,\"v\":St,\"platform\":Tt,\"a2\":null!==e.context?e.context.a2Key:\"\",\"tinyid\":null!==e.context?e.context.tinyID:0,\"sdkappid\":null!==e.context?e.context.SDKAppID:0,\"contentType\":null!==e.context?e.context.contentType:0,\"accounttype\":null!==e.context?e.loginInfo.accountType:0,\"apn\":null!==e.context?e.context.apn:1,\"reqtime\":Math.ceil(+new Date/1e3)};return{\"create\":{},\"query\":{\"serverName\":Nt.NAME.OPEN_IM,\"cmd\":Nt.CMD.LONG_POLL,\"channel\":Nt.CHANNEL.AUTO,\"protocol\":Ot,\"queryString\":t,\"requestData\":{\"timeout\":null,\"cookie\":{\"notifySeq\":0,\"noticeSeq\":0,\"longPollingID\":0}},\"keyMaps\":{\"response\":{\"C2cMsgArray\":\"C2CMessageArray\",\"GroupMsgArray\":\"groupMessageArray\",\"GroupTips\":\"groupTips\",\"C2cNotifyMsgArray\":\"C2CNotifyMessageArray\",\"ClientSeq\":\"clientSequence\",\"MsgPriority\":\"messagePriority\",\"NoticeSeq\":\"noticeSequence\",\"MsgContent\":\"content\",\"MsgType\":\"type\",\"MsgBody\":\"elements\",\"ToGroupId\":\"to\",\"Desc\":\"description\",\"Ext\":\"extension\"}}},\"update\":{},\"delete\":{}}}(this.tim),this.config.applyC2C=function(e){var t=hr(e),n=Nt.NAME.FRIEND,o=Nt.CHANNEL.XHR,r=Ot;return{\"create\":{\"serverName\":n,\"cmd\":Nt.CMD.FRIEND_ADD,\"channel\":o,\"protocol\":r,\"queryString\":t,\"requestData\":{\"fromAccount\":\"\",\"addFriendItem\":[]}},\"get\":{\"serverName\":n,\"cmd\":Nt.CMD.GET_PENDENCY,\"channel\":o,\"protocol\":r,\"queryString\":t,\"requestData\":{\"fromAccount\":\"\",\"pendencyType\":\"Pendency_Type_ComeIn\"}},\"update\":{\"serverName\":n,\"cmd\":Nt.CMD.RESPONSE_PENDENCY,\"channel\":o,\"protocol\":r,\"queryString\":t,\"requestData\":{\"fromAccount\":\"\",\"responseFriendItem\":[]}},\"delete\":{\"serverName\":n,\"cmd\":Nt.CMD.DELETE_PENDENCY,\"channel\":o,\"protocol\":r,\"queryString\":t,\"requestData\":{\"fromAccount\":\"\",\"toAccount\":[],\"pendencyType\":\"Pendency_Type_ComeIn\"}}}}(this.tim),this.config.friend=function(e){var t=hr(e),n=Nt.NAME.FRIEND,o=Nt.CHANNEL.XHR,r=Ot;return{\"get\":{\"serverName\":n,\"cmd\":Nt.CMD.FRIEND_GET_ALL,\"channel\":o,\"protocol\":r,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"fromAccount\":\"\",\"timeStamp\":0,\"startIndex\":0,\"getCount\":100,\"lastStandardSequence\":0,\"tagList\":[\"Tag_Profile_IM_Nick\",\"Tag_SNS_IM_Remark\"]},\"keyMaps\":{\"request\":{},\"response\":{}}},\"delete\":{\"serverName\":n,\"cmd\":Nt.CMD.FRIEND_DELETE,\"channel\":o,\"protocol\":r,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"fromAccount\":\"\",\"toAccount\":[],\"deleteType\":\"Delete_Type_Single\"}}}}(this.tim),this.config.blacklist=function(e){var t=hr(e);return{\"create\":{\"serverName\":Nt.NAME.FRIEND,\"cmd\":Nt.CMD.ADD_BLACKLIST,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"fromAccount\":\"\",\"toAccount\":[]}},\"get\":{\"serverName\":Nt.NAME.FRIEND,\"cmd\":Nt.CMD.GET_BLACKLIST,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"fromAccount\":\"\",\"startIndex\":0,\"maxLimited\":30,\"lastSequence\":0}},\"delete\":{\"serverName\":Nt.NAME.FRIEND,\"cmd\":Nt.CMD.DELETE_BLACKLIST,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"fromAccount\":\"\",\"toAccount\":[]}},\"update\":{}}}(this.tim),this.config.c2cMessage=function(e){var t={\"platform\":Tt,\"websdkappid\":Ct,\"v\":St,\"a2\":null!==e.context?e.context.a2Key:\"\",\"tinyid\":null!==e.context?e.context.tinyID:0,\"sdkappid\":null!==e.context?e.context.SDKAppID:0,\"contentType\":null!==e.context?e.context.contentType:0,\"apn\":null!==e.context?e.context.apn:1,\"reqtime\":function(){return+new Date}},n={\"request\":{\"fromAccount\":\"From_Account\",\"toAccount\":\"To_Account\",\"msgTimeStamp\":\"MsgTimeStamp\",\"msgSeq\":\"MsgSeq\",\"msgRandom\":\"MsgRandom\",\"msgBody\":\"MsgBody\",\"count\":\"MaxCnt\",\"lastMessageTime\":\"LastMsgTime\",\"messageKey\":\"MsgKey\",\"peerAccount\":\"Peer_Account\",\"data\":\"Data\",\"description\":\"Desc\",\"extension\":\"Ext\",\"type\":\"MsgType\",\"content\":\"MsgContent\",\"sizeType\":\"Type\",\"uuid\":\"UUID\",\"imageUrl\":\"URL\",\"fileUrl\":\"Url\",\"remoteAudioUrl\":\"Url\",\"remoteVideoUrl\":\"VideoUrl\",\"thumbUUID\":\"ThumbUUID\",\"videoUUID\":\"VideoUUID\",\"videoUrl\":\"\",\"downloadFlag\":\"Download_Flag\"},\"response\":{\"MsgContent\":\"content\",\"MsgTime\":\"time\",\"Data\":\"data\",\"Desc\":\"description\",\"Ext\":\"extension\",\"MsgKey\":\"messageKey\",\"MsgType\":\"type\",\"MsgBody\":\"elements\",\"Download_Flag\":\"downloadFlag\"}};return{\"create\":{\"serverName\":Nt.NAME.OPEN_IM,\"cmd\":Nt.CMD.SEND_MESSAGE,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"fromAccount\":e.loginInfo.identifier,\"toAccount\":\"\",\"msgTimeStamp\":Math.ceil(+new Date/1e3),\"msgSeq\":0,\"msgRandom\":0,\"msgBody\":[]},\"keyMaps\":n},\"query\":{\"serverName\":Nt.NAME.OPEN_IM,\"cmd\":Nt.CMD.GET_C2C_ROAM_MESSAGES,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"peerAccount\":\"\",\"count\":15,\"lastMessageTime\":0,\"messageKey\":\"\",\"withRecalledMsg\":1},\"keyMaps\":n},\"update\":null,\"delete\":null}}(this.tim),this.config.c2cMessageWillBeRevoked=function(e){var t={\"platform\":Tt,\"websdkappid\":Ct,\"v\":St,\"a2\":null!==e.context?e.context.a2Key:\"\",\"tinyid\":null!==e.context?e.context.tinyID:0,\"sdkappid\":null!==e.context?e.context.SDKAppID:0,\"contentType\":null!==e.context?e.context.contentType:0,\"apn\":null!==e.context?e.context.apn:1,\"reqtime\":function(){return+new Date}};return{\"create\":{\"serverName\":Nt.NAME.OPEN_IM,\"cmd\":Nt.CMD.REVOKE_C2C_MESSAGE,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"msgInfo\":{\"fromAccount\":\"\",\"toAccount\":\"\",\"msgTimeStamp\":Math.ceil(+new Date/1e3),\"msgSeq\":0,\"msgRandom\":0}},\"keyMaps\":{\"request\":{\"msgInfo\":\"MsgInfo\",\"fromAccount\":\"From_Account\",\"toAccount\":\"To_Account\",\"msgTimeStamp\":\"MsgTimeStamp\",\"msgSeq\":\"MsgSeq\",\"msgRandom\":\"MsgRandom\",\"msgBody\":\"MsgBody\"}}}}}(this.tim),this.config.groupMessage=function(e){var t={\"platform\":Tt,\"websdkappid\":Ct,\"v\":St,\"a2\":null!==e.context?e.context.a2Key:\"\",\"tinyid\":null!==e.context?e.context.tinyID:0,\"sdkappid\":null!==e.context?e.context.SDKAppID:0,\"contentType\":null!==e.context?e.context.contentType:0,\"apn\":null!==e.context?e.context.apn:1,\"reqtime\":function(){return+new Date}},n={\"request\":{\"to\":\"GroupId\",\"extension\":\"Ext\",\"data\":\"Data\",\"description\":\"Desc\",\"random\":\"Random\",\"sequence\":\"ReqMsgSeq\",\"count\":\"ReqMsgNumber\",\"type\":\"MsgType\",\"content\":\"MsgContent\",\"elements\":\"MsgBody\",\"sizeType\":\"Type\",\"uuid\":\"UUID\",\"imageUrl\":\"URL\",\"fileUrl\":\"Url\",\"remoteAudioUrl\":\"Url\",\"remoteVideoUrl\":\"VideoUrl\",\"thumbUUID\":\"ThumbUUID\",\"videoUUID\":\"VideoUUID\",\"videoUrl\":\"\",\"downloadFlag\":\"Download_Flag\",\"clientSequence\":\"ClientSeq\"},\"response\":{\"Random\":\"random\",\"MsgTime\":\"time\",\"MsgSeq\":\"sequence\",\"ReqMsgSeq\":\"sequence\",\"RspMsgList\":\"messageList\",\"IsPlaceMsg\":\"isPlaceMessage\",\"IsSystemMsg\":\"isSystemMessage\",\"ToGroupId\":\"to\",\"EnumFrom_AccountType\":\"fromAccountType\",\"EnumTo_AccountType\":\"toAccountType\",\"GroupCode\":\"groupCode\",\"MsgPriority\":\"messagePriority\",\"MsgBody\":\"elements\",\"MsgType\":\"type\",\"MsgContent\":\"content\",\"IsFinished\":\"complete\",\"Download_Flag\":\"downloadFlag\",\"ClientSeq\":\"clientSequence\"}};return{\"create\":{\"serverName\":Nt.NAME.GROUP,\"cmd\":Nt.CMD.SEND_GROUP_MESSAGE,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"groupID\":\"\",\"fromAccount\":e.loginInfo.identifier,\"random\":0,\"clientSequence\":0,\"msgBody\":[]},\"keyMaps\":n},\"query\":{\"serverName\":Nt.NAME.GROUP,\"cmd\":Nt.CMD.GET_GROUP_ROAM_MESSAGES,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"withRecalledMsg\":1,\"groupID\":\"\",\"count\":15,\"sequence\":\"\"},\"keyMaps\":n},\"update\":null,\"delete\":null}}(this.tim),this.config.groupMessageWillBeRevoked=function(e){var t={\"platform\":Tt,\"websdkappid\":Ct,\"v\":St,\"a2\":null!==e.context?e.context.a2Key:\"\",\"tinyid\":null!==e.context?e.context.tinyID:0,\"sdkappid\":null!==e.context?e.context.SDKAppID:0,\"contentType\":null!==e.context?e.context.contentType:0,\"apn\":null!==e.context?e.context.apn:1,\"reqtime\":function(){return+new Date}};return{\"create\":{\"serverName\":Nt.NAME.GROUP,\"cmd\":Nt.CMD.REVOKE_GROUP_MESSAGE,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"to\":\"\",\"msgSeqList\":[]},\"keyMaps\":{\"request\":{\"to\":\"GroupId\",\"msgSeqList\":\"MsgSeqList\",\"msgSeq\":\"MsgSeq\"}}}}}(this.tim),this.config.conversation=function(e){var t={\"platform\":Tt,\"websdkappid\":Ct,\"v\":St,\"a2\":null!==e.context?e.context.a2Key:\"\",\"tinyid\":null!==e.context?e.context.tinyID:0,\"sdkappid\":null!==e.context?e.context.SDKAppID:0,\"contentType\":null!==e.context?e.context.contentType:0,\"apn\":null!==e.context?e.context.apn:1};return{\"query\":{\"serverName\":Nt.NAME.RECENT_CONTACT,\"cmd\":Nt.CMD.GET_CONVERSATION_LIST,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"fromAccount\":e.loginInfo.identifier,\"count\":0},\"keyMaps\":{\"request\":{},\"response\":{\"SessionItem\":\"conversations\",\"ToAccount\":\"groupID\",\"To_Account\":\"userID\",\"UnreadMsgCount\":\"unreadCount\",\"MsgGroupReadedSeq\":\"messageReadSeq\"}}},\"pagingQuery\":{\"serverName\":Nt.NAME.RECENT_CONTACT,\"cmd\":Nt.CMD.PAGING_GET_CONVERSATION_LIST,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"fromAccount\":void 0,\"timeStamp\":void 0,\"orderType\":void 0},\"keyMaps\":{\"request\":{},\"response\":{\"SessionItem\":\"conversations\",\"ToAccount\":\"groupID\",\"To_Account\":\"userID\",\"UnreadMsgCount\":\"unreadCount\",\"MsgGroupReadedSeq\":\"messageReadSeq\"}}},\"delete\":{\"serverName\":Nt.NAME.RECENT_CONTACT,\"cmd\":Nt.CMD.DELETE_CONVERSATION,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"fromAccount\":e.loginInfo.identifier,\"toAccount\":void 0,\"type\":1,\"toGroupID\":void 0},\"keyMaps\":{\"request\":{\"toGroupID\":\"ToGroupid\"}}},\"setC2CMessageRead\":{\"serverName\":Nt.NAME.OPEN_IM,\"cmd\":Nt.CMD.SET_C2C_MESSAGE_READ,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"C2CMsgReaded\":void 0},\"keyMaps\":{\"request\":{\"lastMessageTime\":\"LastedMsgTime\"}}},\"setGroupMessageRead\":{\"serverName\":Nt.NAME.GROUP,\"cmd\":Nt.CMD.SET_GROUP_MESSAGE_READ,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"groupID\":void 0,\"messageReadSeq\":void 0},\"keyMaps\":{\"request\":{\"messageReadSeq\":\"MsgReadedSeq\"}}}}}(this.tim),this.config.syncMessage=function(e){var t={\"platform\":Tt,\"websdkappid\":Ct,\"v\":St,\"a2\":null!==e.context?e.context.a2Key:\"\",\"tinyid\":null!==e.context?e.context.tinyID:0,\"sdkappid\":null!==e.context?e.context.SDKAppID:0,\"contentType\":null!==e.context?e.context.contentType:0,\"apn\":null!==e.context?e.context.apn:1,\"reqtime\":function(){return[Math.ceil(+new Date),Math.random()].join(\"\")}};return{\"create\":null,\"query\":{\"serverName\":Nt.NAME.OPEN_IM,\"cmd\":Nt.CMD.GET_MESSAGES,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"cookie\":\"\",\"syncFlag\":0,\"needAbstract\":1},\"keyMaps\":{\"request\":{\"fromAccount\":\"From_Account\",\"toAccount\":\"To_Account\",\"from\":\"From_Account\",\"to\":\"To_Account\",\"time\":\"MsgTimeStamp\",\"sequence\":\"MsgSeq\",\"random\":\"MsgRandom\",\"elements\":\"MsgBody\"},\"response\":{\"MsgList\":\"messageList\",\"SyncFlag\":\"syncFlag\",\"To_Account\":\"to\",\"From_Account\":\"from\",\"ClientSeq\":\"clientSequence\",\"MsgSeq\":\"sequence\",\"NoticeSeq\":\"noticeSequence\",\"NotifySeq\":\"notifySequence\",\"MsgRandom\":\"random\",\"MsgTimeStamp\":\"time\",\"MsgContent\":\"content\",\"ToGroupId\":\"groupID\",\"MsgKey\":\"messageKey\",\"GroupTips\":\"groupTips\",\"MsgBody\":\"elements\",\"MsgType\":\"type\",\"C2CRemainingUnreadCount\":\"C2CRemainingUnreadList\"}}},\"update\":null,\"delete\":null}}(this.tim),this.config.AVChatRoom=function(e){return{\"startLongPoll\":{\"serverName\":Nt.NAME.BIG_GROUP_LONG_POLLING_NO_AUTH,\"cmd\":Nt.CMD.AVCHATROOM_LONG_POLL,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":{\"websdkappid\":Ct,\"v\":St,\"platform\":Tt,\"sdkappid\":e.loginInfo.SDKAppID,\"accounttype\":\"792\",\"apn\":null!==e.context?e.context.apn:1,\"reqtime\":function(){return+new Date}},\"requestData\":{\"USP\":1,\"startSeq\":1,\"holdTime\":90,\"key\":void 0},\"keyMaps\":{\"request\":{\"USP\":\"USP\"},\"response\":{\"ToGroupId\":\"groupID\"}}}}}(this.tim),this.config.cosUpload=function(e){var t={\"platform\":Tt,\"websdkappid\":Ct,\"v\":St,\"a2\":null!==e.context?e.context.a2Key:\"\",\"tinyid\":null!==e.context?e.context.tinyID:0,\"sdkappid\":null!==e.context?e.context.SDKAppID:0,\"contentType\":null!==e.context?e.context.contentType:0,\"apn\":null!==e.context?e.context.apn:1,\"reqtime\":function(){return Date.now()}};return{\"create\":{\"serverName\":Nt.NAME.OPEN_IM,\"cmd\":Nt.CMD.FILE_UPLOAD,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"appVersion\":\"2.1\",\"fromAccount\":\"\",\"toAccount\":\"\",\"sequence\":0,\"time\":function(){return Math.ceil(Date.now()/1e3)},\"random\":function(){return ye()},\"fileStrMd5\":\"\",\"fileSize\":\"\",\"serverVer\":1,\"authKey\":\"\",\"busiId\":1,\"pkgFlag\":1,\"sliceOffset\":0,\"sliceSize\":0,\"sliceData\":\"\",\"contentType\":\"application/x-www-form-urlencoded\"},\"keyMaps\":{\"request\":{},\"response\":{}}},\"update\":null,\"delete\":null}}(this.tim),this.config.cosSig=function(e){var t={\"sdkappid\":function(){return e.loginInfo.SDKAppID},\"identifier\":function(){return e.loginInfo.identifier},\"userSig\":function(){return e.context.userSig}};return{\"create\":null,\"query\":{\"serverName\":Nt.NAME.IM_COS_SIGN,\"cmd\":Nt.CMD.COS_SIGN,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":t,\"requestData\":{\"cmd\":\"open_im_cos_svc\",\"subCmd\":\"get_cos_token\",\"duration\":300,\"version\":2},\"keyMaps\":{\"request\":{\"userSig\":\"usersig\",\"subCmd\":\"sub_cmd\",\"cmd\":\"cmd\",\"duration\":\"duration\",\"version\":\"version\"},\"response\":{\"expired_time\":\"expiredTime\",\"bucket_name\":\"bucketName\",\"session_token\":\"sessionToken\",\"tmp_secret_id\":\"secretId\",\"tmp_secret_key\":\"secretKey\"}}},\"update\":null,\"delete\":null}}(this.tim),this.config.bigDataHallwayAuthKey=function(e){return{\"create\":null,\"query\":{\"serverName\":Nt.NAME.OPEN_IM,\"cmd\":Nt.CMD.BIG_DATA_HALLWAY_AUTH_KEY,\"channel\":Nt.CHANNEL.XHR,\"protocol\":Ot,\"method\":\"POST\",\"queryString\":{\"websdkappid\":Ct,\"v\":St,\"platform\":Tt,\"sdkappid\":e.loginInfo.SDKAppID,\"accounttype\":\"792\",\"apn\":null!==e.context?e.context.apn:1,\"reqtime\":function(){return+new Date}},\"requestData\":{}}}}(this.tim),this.config.ssoEventStat=function(e){var t=null;null!==e.context&&(t={\"sdkappid\":e.context.SDKAppID,\"reqtime\":Math.ceil(+new Date/1e3)});return{\"create\":{\"serverName\":Nt.NAME.IM_OPEN_STAT,\"cmd\":Nt.CMD.TIM_WEB_REPORT,\"channel\":Nt.CHANNEL.AUTO,\"protocol\":Ot,\"queryString\":t,\"requestData\":{\"table\":\"\",\"report\":[]},\"keyMaps\":{\"request\":{\"table\":\"table\",\"report\":\"report\",\"SDKAppID\":\"sdkappid\",\"version\":\"version\",\"tinyID\":\"tinyid\",\"userID\":\"userid\",\"platform\":\"platform\",\"method\":\"method\",\"time\":\"time\",\"start\":\"start\",\"end\":\"end\",\"cost\":\"cost\",\"status\":\"status\",\"codeint\":\"codeint\",\"message\":\"message\",\"pointer\":\"pointer\",\"text\":\"text\",\"msgType\":\"msgtype\",\"networkType\":\"networktype\",\"startts\":\"startts\",\"endts\":\"endts\",\"timespan\":\"timespan\"}}},\"query\":{},\"update\":{},\"delete\":{}}}(this.tim),this.config.ssoSumStat=function(e){var t=null;null!==e.context&&(t={\"sdkappid\":e.context.SDKAppID,\"reqtime\":Math.ceil(+new Date/1e3)});return{\"create\":{\"serverName\":Nt.NAME.IM_OPEN_STAT,\"cmd\":Nt.CMD.TIM_WEB_REPORT,\"channel\":Nt.CHANNEL.AUTO,\"protocol\":Ot,\"queryString\":t,\"requestData\":{\"table\":\"\",\"report\":[]},\"keyMaps\":{\"request\":{\"table\":\"table\",\"report\":\"report\",\"SDKAppID\":\"sdkappid\",\"version\":\"version\",\"tinyID\":\"tinyid\",\"userID\":\"userid\",\"item\":\"item\",\"lpID\":\"lpid\",\"platform\":\"platform\",\"networkType\":\"networktype\",\"total\":\"total\",\"successRate\":\"successrate\",\"avg\":\"avg\",\"timespan\":\"timespan\",\"time\":\"time\"}}},\"query\":{},\"update\":{},\"delete\":{}}}(this.tim)}},{\"key\":\"_initRequestData\",\"value\":function(e,t){if(void 0===e)return At(t.requestData,this._getRequestMap(t),this.tim);var n=t.requestData,o=Object.create(null);for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){if(o[r]=\"function\"==typeof n[r]?n[r]():n[r],void 0===e[r])continue;o[r]=e[r]}return o=At(o,this._getRequestMap(t),this.tim)}},{\"key\":\"_getRequestMap\",\"value\":function(e){if(e.keyMaps&&e.keyMaps.request&&Object.keys(e.keyMaps.request).length>0)return e.keyMaps.request}},{\"key\":\"_initEncoder\",\"value\":function(e){switch(e.protocol){case Ot:return function(t){if(\"string\"===r(t))try{return JSON.parse(t)}catch(e){return t}return t};case Mt:return function(e){return e};default:return function(e){return J.warn(\"PackageConfig._initEncoder(), unknow response type, data: \",JSON.stringify(e)),e}}}},{\"key\":\"_initDecoder\",\"value\":function(e){switch(e.protocol){case Ot:return function(t){if(\"string\"===r(t))try{return JSON.parse(t)}catch(e){return t}return t};case Mt:return function(e){return e};default:return function(e){return J.warn(\"PackageConfig._initDecoder(), unknow response type, data: \",e),e}}}}]),e}(),br={\"C2CMessageArray\":1,\"groupMessageArray\":1,\"groupTips\":1,\"C2CNotifyMessageArray\":1,\"profileModify\":1,\"friendListMod\":1},$r=function(e){function t(e){var n;return o(this,t),(n=d(this,p(t).call(this,e)))._initialization(),n}return l(t,bt),s(t,[{\"key\":\"_initialization\",\"value\":function(){this._syncOffset=\"\",this._syncNoticeList=[],this._syncEventArray=[],this._syncMessagesIsRunning=!1,this._syncMessagesFinished=!1,this._isLongPoll=!1,this._longPollID=0,this._noticeSequence=0,this._initializeListener(),this._runLoop=null,this._initShuntChannels()}},{\"key\":\"_initShuntChannels\",\"value\":function(){this._shuntChannels=Object.create(null),this._shuntChannels.C2CMessageArray=this._C2CMessageArrayChannel.bind(this),this._shuntChannels.groupMessageArray=this._groupMessageArrayChannel.bind(this),this._shuntChannels.groupTips=this._groupTipsChannel.bind(this),this._shuntChannels.C2CNotifyMessageArray=this._C2CNotifyMessageArrayChannel.bind(this),this._shuntChannels.profileModify=this._profileModifyChannel.bind(this),this._shuntChannels.friendListMod=this._friendListModChannel.bind(this)}},{\"key\":\"_C2CMessageArrayChannel\",\"value\":function(e,t,n){this.tim.innerEmitter.emit(Pt.NOTICE_LONGPOLL_NEW_C2C_NOTICE,{\"data\":t,\"type\":n})}},{\"key\":\"_groupMessageArrayChannel\",\"value\":function(e,t,n){this.tim.innerEmitter.emit(Pt.NOTICE_LONGPOLL_NEW_GROUP_MESSAGES,{\"data\":t})}},{\"key\":\"_groupTipsChannel\",\"value\":function(e,t,n){var o=this;switch(e){case 4:this.tim.innerEmitter.emit(Pt.NOTICE_LONGPOLL_NEW_GROUP_TIPS,{\"data\":t});break;case 5:t.forEach(function(e){ie(e.elements.revokedInfos)?o.tim.innerEmitter.emit(Pt.NOTICE_LONGPOLL_GROUP_MESSAGE_REVOKED,{\"data\":t}):o.tim.innerEmitter.emit(Pt.NOTICE_LONGPOLL_NEW_GROUP_NOTICE,{\"data\":{\"groupSystemNotices\":t,\"type\":n}})});break;default:J.warn(\"未知的群事件类型 Event:\".concat(e))}}},{\"key\":\"_C2CNotifyMessageArrayChannel\",\"value\":function(e,t,n){this._isKickedoutNotice(t)?this.tim.innerEmitter.emit(Pt.NOTICE_LONGPOLL_MUTIPLE_DEVICE_KICKED_OUT):this._isSysCmdMsgNotify(t)?this.tim.innerEmitter.emit(Pt.NOTICE_LONGPOLL_RECEIVE_SYSTEM_ORDERS):this._isC2CMessageRevokedNotify(t)&&this.tim.innerEmitter.emit(Pt.NOTICE_LONGPOLL_C2C_MESSAGE_REVOKED,{\"data\":t,\"type\":n})}},{\"key\":\"_profileModifyChannel\",\"value\":function(e,t,n){this.tim.innerEmitter.emit(Pt.NOTICE_LONGPOLL_PROFILE_MODIFIED,{\"data\":t})}},{\"key\":\"_friendListModChannel\",\"value\":function(e,t,n){this.tim.innerEmitter.emit(Pt.NOTICE_LONGPOLL_NEW_FRIEND_MESSAGES,{\"data\":t})}},{\"key\":\"_dispatchNotice\",\"value\":function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"poll\";if(ie(e))for(var n=this.tim.innerEmitter,o=null,r=null,i=\"\",s=\"\",a=\"\",u=0,c=0,l=e.length;c<l;c++)u=(o=e[c]).event,i=Object.keys(o).find(function(e){return void 0!==br[e]}),ue(this._shuntChannels[i])?(r=o[i],\"poll\"===t&&this._updatenoticeSequence(r),this._shuntChannels[i](u,r,t)):(\"poll\"===t&&this._updatenoticeSequence(),s=\"\".concat(pt.NOTICE_RUNLOOP_UNEXPECTED_CONDITION),a=\"\".concat(ht.NOTICE_RUNLOOP_UNEXPECTED_CONDITION,\": \").concat(u,\", \").concat(i),n.emit(Pt.ERROR_DETECTED,new lt({\"code\":s,\"message\":a,\"data\":{\"payloadName\":i,\"event\":u}})),s=\"\",a=\"\")}},{\"key\":\"getLongPollID\",\"value\":function(){return this._longPollID}},{\"key\":\"_IAmReady\",\"value\":function(){this.triggerReady()}},{\"key\":\"reset\",\"value\":function(){this._noticeSequence=0,this._resetSync(),this.closeNoticeChannel()}},{\"key\":\"_resetSync\",\"value\":function(){this._syncOffset=\"\",this._syncNoticeList=[],this._syncEventArray=[],this._syncMessagesIsRunning=!1,this._syncMessagesFinished=!1}},{\"key\":\"_setNoticeSeqInRequestData\",\"value\":function(e){e.Cookie.NoticeSeq=this._noticeSequence,this.tim.sumStatController.addTotalCount(Bt.LONG_POLLING)}},{\"key\":\"_updatenoticeSequence\",\"value\":function(e){if(e){var t=e[e.length-1].noticeSequence;t&&\"number\"==typeof t?t<=this._noticeSequence||(this._noticeSequence=t):this._noticeSequence++}else this._noticeSequence++}},{\"key\":\"_initializeListener\",\"value\":function(){var e=this.tim.innerEmitter;e.on(Pt.NOTICE_LONGPOLL_RESTART,this.restartNoticeChannel,this),e.on(Pt.CONTEXT_A2KEY_AND_TINYID_UPDATED,this._startSyncMessages,this),e.on(Pt.SYNC_MESSAGE_C2C_FINISHED,this.openNoticeChannel,this),e.on(Pt.SIGN_LOGOUT_SUCCESS,this.closeNoticeChannel,this),e.on(Pt.NOTICE_LONGPOLL_SOON_RECONNECT,this._onChannelReconnect,this),e.on(Pt.NOTICE_LONGPOLL_DISCONNECT,this._onChannelDisconnected,this)}},{\"key\":\"openNoticeChannel\",\"value\":function(){J.log(\"NotificationController.openNoticeChannel\"),this._getLongPollID()}},{\"key\":\"closeNoticeChannel\",\"value\":function(){J.log(\"NotificationController.closeNoticeChannel()\"),(this._runLoop instanceof yo||this._runLoop instanceof Eo)&&(this._runLoop.abort(),this._runLoop.stop()),this._longPollID=0,this._isLongPoll=!1,this.tim.innerEmitter.emit(Pt.NOTICE_LONGPOLL_STOPPED)}},{\"key\":\"restartNoticeChannel\",\"value\":function(){this.closeNoticeChannel(),this._syncMessagesFinished=!1,this._startSyncMessages()}},{\"key\":\"_getLongPollID\",\"value\":function(){var t=this,e=this.tim,n=e.innerEmitter,o=e.connectionController;if(0===this._longPollID){var r=this.createPackage({\"name\":\"longPollID\",\"action\":\"query\"});o.request(r).then(function(e){e.data.errorCode===we.REQUEST.SUCCESS?t._onGetLongPollIDSuccess({\"data\":e.data.longPollingID}):t._onGetLongPollIDFail({\"data\":e.data})}).catch(function(e){n.emit(Pt.ERROR_DETECTED,new lt({\"code\":pt.GET_LONGPOLL_ID_FAILED,\"message\":ht.GET_LONGPOLL_ID_FAILED}))})}else this._onGetLongPollIDSuccess({\"data\":this._longPollID})}},{\"key\":\"_onGetLongPollIDSuccess\",\"value\":function(e){this.tim.packageConfig.set({\"key\":\"long_poll_logout.query.requestData.longPollingID\",\"value\":e.data}),this.tim.packageConfig.set({\"key\":\"longPoll.query.requestData.cookie.longPollingID\",\"value\":e.data}),this._longPollID=e.data,this._startLongPoll(),this._IAmReady(),this.tim.sumStatController.recordLongPollingID(this._longPollID)}},{\"key\":\"_onGetLongPollIDFail\",\"value\":function(e){J.warn(\"Notification._onGetLongPollIDFail\",e)}},{\"key\":\"_startLongPoll\",\"value\":function(){if(!0!==this._isLongPoll){J.log(\"NotificationController._startLongPoll...\");var e=this.tim,t=e.connectionController,n=e.innerEmitter,o=this.createPackage({\"name\":\"longPoll\",\"action\":\"query\"});this._isLongPoll=!0,n.emit(Pt.NOTICE_LONGPOLL_START,{\"data\":Date.now()}),this._runLoop=t.createRunLoop({\"pack\":o,\"before\":this._setNoticeSeqInRequestData.bind(this),\"success\":this._onNoticeReceived.bind(this),\"fail\":this._onNoticeFail.bind(this)}),this._runLoop.start()}else J.log(\"NotificationController._startLongPoll is running...\")}},{\"key\":\"_onChannelReconnect\",\"value\":function(e){this.closeNoticeChannel(),this.syncMessage()}},{\"key\":\"_onChannelDisconnected\",\"value\":function(){}},{\"key\":\"_onNoticeReceived\",\"value\":function(e){var t=this.tim,n=t.innerEmitter,o=t.statusController,r=e.data,i=!o.getChannelStatus();if(n.emit(Pt.NOTICE_LONGPOLL_REQUEST_ARRIVED,{\"data\":Date.now()}),r.errorCode!==we.REQUEST.SUCCESS){var s=new Yt;if(s.setMethod(jt.LONG_POLLING_ERROR).setStart(),s.setMessage(r.errorInfo).setCode(r.errorCode).setNetworkType(this.getNetworkType()).setEnd(),r.errorCode===pt.LONG_POLL_KICK_OUT)return n.emit(Pt.NOTICE_LONGPOLL_KICKED_OUT),J.log(\"NotificationController._onNoticeReceived(), longPollingID was kicked\"),void this.closeNoticeChannel();n.emit(Pt.NOTICE_LONGPOLL_REQUEST_ERROR,new lt({\"code\":r.errorCode,\"message\":r.errorInfo}))}this.tim.sumStatController.addSuccessCount(Bt.LONG_POLLING),this.tim.sumStatController.addCost(Bt.LONG_POLLING,r.timecost),e.data.eventArray&&!0!==i&&this._dispatchNotice(e.data.eventArray)}},{\"key\":\"_onNoticeFail\",\"value\":function(n){var o=new Yt;o.setMethod(jt.LONG_POLLING_ERROR).setStart(),this.probeNetwork(function(e,t){o.setError(n.error,e,t).setEnd()}),this.tim.innerEmitter.emit(Pt.ERROR_DETECTED,n.error),this.tim.innerEmitter.emit(Pt.NOTICE_LONGPOLL_REQUEST_NOT_ARRIVED,{\"data\":Date.now()})}},{\"key\":\"_isKickedoutNotice\",\"value\":function(e){return!!e[0].hasOwnProperty(\"kickoutMsgNotify\")}},{\"key\":\"_isSysCmdMsgNotify\",\"value\":function(e){if(!e[0])return!1;var t=e[0];return!!Object.prototype.hasOwnProperty.call(t,\"sysCmdMsgNotify\")}},{\"key\":\"_isC2CMessageRevokedNotify\",\"value\":function(e){var t=e[0];return!!Object.prototype.hasOwnProperty.call(t,\"c2cMessageRevokedNotify\")}},{\"key\":\"_startSyncMessages\",\"value\":function(e){!0!==this._syncMessagesFinished&&this.syncMessage()}},{\"key\":\"syncMessage\",\"value\":function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"\",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=this.tim,r=o.connectionController,i=o.innerEmitter;this._syncMessagesIsRunning=!0;var s=this.createPackage({\"name\":\"syncMessage\",\"action\":\"query\",\"param\":{\"cookie\":e,\"syncFlag\":t}});r.request(s).then(function(e){var t=e.data;switch(nr(t.cookie,t.syncFlag)){case\"00\":case\"01\":i.emit(Pt.ERROR_DETECTED,{\"code\":pt.NOTICE_RUNLOOP_OFFSET_LOST,\"message\":ht.NOTICE_RUNLOOP_OFFSET_LOST});break;case\"10\":case\"11\":t.eventArray&&n._dispatchNotice(t.eventArray,\"sync\"),n._syncNoticeList=n._syncNoticeList.concat(t.messageList),i.emit(Pt.SYNC_MESSAGE_C2C_PROCESSING,{\"data\":t.messageList,\"C2CRemainingUnreadList\":t.C2CRemainingUnreadList}),n._syncOffset=t.cookie,n.syncMessage(t.cookie,t.syncFlag);break;case\"12\":t.eventArray&&n._dispatchNotice(t.eventArray,\"sync\"),n._syncNoticeList=n._syncNoticeList.concat(t.messageList),i.emit(Pt.SYNC_MESSAGE_C2C_FINISHED,{\"data\":t.messageList,\"C2CRemainingUnreadList\":t.C2CRemainingUnreadList}),n._syncOffset=t.cookie,n._syncNoticeList=[],n._syncMessagesIsRunning=!1,n._syncMessagesFinished=!0}}).catch(function(e){n._syncMessagesIsRunning=!1,J.error(\"NotificationController.syncMessage() failed, error:\",JSON.stringify(e))})}}]),t}(),ni=function(e){function t(e){var n;return o(this,t),(n=d(this,p(t).call(this,e)))._initializeListener(),n}return l(t,bt),s(t,[{\"key\":\"_initializeMembers\",\"value\":function(e){this.expiredTimeLimit=300,this.appid=e.appid||\"\",this.bucketName=e.bucketName||\"\",this.ciUrl=e.ciUrl||\"\",this.directory=e.directory||\"\",this.downloadUrl=e.downloadUrl||\"\",this.uploadUrl=e.uploadUrl||\"\",this.expiredTimeOut=e.expiredTimeOut||this.expiredTimeLimit,this.region=\"ap-shanghai\",this.cos=null,this.cosOptions={\"secretId\":e.secretId,\"secretKey\":e.secretKey,\"sessionToken\":e.sessionToken,\"expiredTime\":e.expiredTime},this._initUploaderMethod()}},{\"key\":\"_expiredTimer\",\"value\":function(){var e=this,t=setInterval(function(){Math.ceil(Date.now()/1e3)>=e.cosOptions.expiredTime-20&&(e._isReady=!1,e._getAuthorizationKey(),clearInterval(t))},1e4)}},{\"key\":\"_initializeListener\",\"value\":function(){this.tim.innerEmitter.on(Pt.CONTEXT_A2KEY_AND_TINYID_UPDATED,this._initialization,this)}},{\"key\":\"_initialization\",\"value\":function(){this._initCOSSDKPlugin(),this.COSSDK?(this._initializeMembers({}),this._getAuthorizationKey()):J.warn(\"UploadController._initialization 没有检测到上传插件，将无法发送图片、音频、视频、文件等类型的消息。详细请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#registerPlugin\")}},{\"key\":\"_getAuthorizationKey\",\"value\":function(){var n=this,o=Math.ceil(Date.now()/1e3),e=this.createPackage({\"name\":\"cosSig\",\"action\":\"query\",\"param\":{\"duration\":this.expiredTimeLimit}});this.tim.connectionController.request(e).then(function(e){var t=e.data.expiredTime-o;e.data.expiredTimeOut=t,J.log(\"UploadController._getAuthorizationKey timeout=\".concat(t,\"s\")),n._initializeMembers(e.data),n._expiredTimer(),n._initUploaderMethod()}).catch(function(e){J.warn(\"UploadController._getAuthorizationKey. error:\",e)})}},{\"key\":\"_initCOSSDKPlugin\",\"value\":function(){var e=L?\"cos-wx-sdk\":\"cos-js-sdk\";this.COSSDK=this.tim.getPlugin(e)}},{\"key\":\"_initUploaderMethod\",\"value\":function(){var n=this;this.appid&&(this.cos=L?new this.COSSDK({\"ForcePathStyle\":!0,\"getAuthorization\":this._getAuthorization.bind(this)}):new this.COSSDK({\"getAuthorization\":this._getAuthorization.bind(this)}),this._cosUploadMethod=L?function(e,t){n.cos.postObject(e,t)}:function(e,t){n.cos.uploadFiles(e,t)},this.triggerReady())}},{\"key\":\"_getAuthorization\",\"value\":function(e,t){t({\"TmpSecretId\":this.cosOptions.secretId,\"TmpSecretKey\":this.cosOptions.secretKey,\"XCosSecurityToken\":this.cosOptions.sessionToken,\"ExpiredTime\":this.cosOptions.expiredTime})}},{\"key\":\"uploadImage\",\"value\":function(e){if(!e.file)return Ht(new lt({\"code\":pt.MESSAGE_IMAGE_SELECT_FILE_FIRST,\"message\":ht.MESSAGE_IMAGE_SELECT_FILE_FIRST}));var t=this._checkImageType(e.file);if(!0!==t)return t;var n=this._checkImageMime(e.file);if(!0!==n)return n;var o=this._checkImageSize(e.file);return!0!==o?o:this.upload(e)}},{\"key\":\"_checkImageType\",\"value\":function(e){var t=\"\";return t=L?e.url.slice(e.url.lastIndexOf(\".\")+1):e.files[0].name.slice(e.files[0].name.lastIndexOf(\".\")+1),_t.indexOf(t.toLowerCase())>=0||Ht(new lt({\"coe\":pt.MESSAGE_IMAGE_TYPES_LIMIT,\"message\":ht.MESSAGE_IMAGE_TYPES_LIMIT}))}},{\"key\":\"_checkImageMime\",\"value\":function(e){return!0}},{\"key\":\"_checkImageSize\",\"value\":function(e){var t=0;return 0===(t=L?e.size:e.files[0].size)?Ht(new lt({\"code\":pt.MESSAGE_FILE_IS_EMPTY,\"message\":\"\".concat(ht.MESSAGE_FILE_IS_EMPTY)})):t<20971520||Ht(new lt({\"coe\":pt.MESSAGE_IMAGE_SIZE_LIMIT,\"message\":\"\".concat(ht.MESSAGE_IMAGE_SIZE_LIMIT)}))}},{\"key\":\"uploadFile\",\"value\":function(e){var t=null;return e.file?e.file.files[0].size>104857600?(t=new lt({\"code\":pt.MESSAGE_FILE_SIZE_LIMIT,\"message\":ht.MESSAGE_FILE_SIZE_LIMIT}),Ht(t)):0===e.file.files[0].size?(t=new lt({\"code\":pt.MESSAGE_FILE_IS_EMPTY,\"message\":\"\".concat(ht.MESSAGE_FILE_IS_EMPTY)}),Ht(t)):this.upload(e):(t=new lt({\"code\":pt.MESSAGE_FILE_SELECT_FILE_FIRST,\"message\":ht.MESSAGE_FILE_SELECT_FILE_FIRST}),Ht(t))}},{\"key\":\"uploadVideo\",\"value\":function(e){if(L)return e.file.videoFile.size>20971520?Ht(new lt({\"code\":pt.MESSAGE_VIDEO_SIZE_LIMIT,\"message\":\"\".concat(ht.MESSAGE_VIDEO_SIZE_LIMIT)})):0===e.file.videoFile.size?Ht(new lt({\"code\":pt.MESSAGE_FILE_IS_EMPTY,\"message\":\"\".concat(ht.MESSAGE_FILE_IS_EMPTY)})):-1===dt.indexOf(e.file.videoFile.type)?Ht(new lt({\"code\":pt.MESSAGE_VIDEO_TYPES_LIMIT,\"message\":\"\".concat(ht.MESSAGE_VIDEO_TYPES_LIMIT)})):this.handleVideoUpload({\"file\":e.file.videoFile})}},{\"key\":\"handleVideoUpload\",\"value\":function(n){var o=this;return new Promise(function(t,e){o.upload(n).then(function(e){t(e)}).catch(function(){o.upload(n).then(function(e){t(e)}).catch(function(){e(new lt({\"code\":pt.MESSAGE_VIDEO_UPLOAD_FAIL,\"message\":ht.MESSAGE_VIDEO_UPLOAD_FAIL}))})})})}},{\"key\":\"uploadAudio\",\"value\":function(e){return e.file?e.file.size>20971520?Ht(new lt({\"code\":pt.MESSAGE_AUDIO_SIZE_LIMIT,\"message\":\"\".concat(ht.MESSAGE_AUDIO_SIZE_LIMIT)})):0===e.file.size?Ht(new lt({\"code\":pt.MESSAGE_FILE_IS_EMPTY,\"message\":\"\".concat(ht.MESSAGE_FILE_IS_EMPTY)})):this.upload(e):Ht(new lt({\"code\":pt.MESSAGE_AUDIO_UPLOAD_FAIL,\"message\":ht.MESSAGE_AUDIO_UPLOAD_FAIL}))}},{\"key\":\"upload\",\"value\":function(t){var l=this;if(!ue(this._cosUploadMethod))return J.warn(\"UploadController.upload 没有检测到上传插件，将无法发送图片、音频、视频、文件等类型的消息。详细请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html#registerPlugin\"),Ht(new lt({\"code\":pt.COS_UNDETECTED,\"message\":ht.COS_UNDETECTED}));var p=new Yt;p.setMethod(jt.UPLOAD).setStart(),J.time(Bt.UPLOAD);var h=L?t.file:t.file.files[0];return new Promise(function(a,u){var e=L?l._createCosOptionsWXMiniApp(t):l._createCosOptionsWeb(t),c=l;l._cosUploadMethod(e,function(e,t){var n=Object.create(null);if(t){if(l._isUploadError(t,e))return u(t.files[0].error),J.warn(\"UploadController.upload failed, network error:\".concat(t.files[0].error.error)),void p.setCode(pt.MESSAGE_FILE_UPLOAD_FAIL).setMessage(ht.MESSAGE_FILE_UPLOAD_FAIL).setEnd();n.fileName=h.name,n.fileSize=h.size,n.fileType=h.type.slice(h.type.indexOf(\"/\")+1).toLowerCase(),n.location=L?t.Location:t.files[0].data.Location;var o=J.timeEnd(Bt.UPLOAD),r=c._formatFileSize(h.size),i=c._formatSpeed(1e3*h.size/o),s=\"size=\".concat(r,\",time=\").concat(o,\"ms,speed=\").concat(i);return J.log(\"UploadController.upload success name=\".concat(h.name,\",\").concat(s)),a(n),void p.setCode(0).setNetworkType(l.getNetworkType()).setText(s).setEnd()}p.setCode(pt.MESSAGE_FILE_UPLOAD_FAIL).setMessage(ht.MESSAGE_FILE_UPLOAD_FAIL).setEnd(),J.warn(\"UploadController.upload failed, error:\".concat(e)),u(e)})})}},{\"key\":\"_isUploadError\",\"value\":function(e,t){return L?!!t:null!==e.files[0].error}},{\"key\":\"_formatFileSize\",\"value\":function(e){return e<1024?e+\"B\":e<1048576?Math.floor(e/1024)+\"KB\":Math.floor(e/1048576)+\"MB\"}},{\"key\":\"_formatSpeed\",\"value\":function(e){return e<=1048576?(e/1024).toFixed(1)+\"KB/s\":(e/1048576).toFixed(1)+\"MB/s\"}},{\"key\":\"_createCosOptionsWeb\",\"value\":function(t){var e=this.tim.context.identifier,n=this._genFileName(e,t.to,t.file.files[0].name);return{\"files\":[{\"Bucket\":\"\".concat(this.bucketName,\"-\").concat(this.appid),\"Region\":this.region,\"Key\":\"\".concat(this.directory,\"/\").concat(n),\"Body\":t.file.files[0]}],\"SliceSize\":1048576,\"onProgress\":function(e){if(\"function\"==typeof t.onProgress)try{t.onProgress(e.percent)}catch(e){J.warn(\"onProgress callback error:\"),J.error(e)}},\"onFileFinish\":function(e,t,n){}}}},{\"key\":\"_createCosOptionsWXMiniApp\",\"value\":function(t){var e=this.tim.context.identifier,n=this._genFileName(e,t.to,t.file.name),o=t.file.url;return{\"Bucket\":\"\".concat(this.bucketName,\"-\").concat(this.appid),\"Region\":this.region,\"Key\":\"\".concat(this.directory,\"/\").concat(n),\"FilePath\":o,\"onProgress\":function(e){if(J.log(JSON.stringify(e)),\"function\"==typeof t.onProgress)try{t.onProgress(e.percent)}catch(e){J.warn(\"onProgress callback error:\"),J.error(e)}}}}},{\"key\":\"_genFileName\",\"value\":function(e,t,n){return\"\".concat(e,\"-\").concat(t,\"-\").concat(ye(99999),\"-\").concat(n)}}]),t}(),oi=function(e){function t(e){var n;return o(this,t),(n=d(this,p(t).call(this,e))).FILETYPE={\"SOUND\":2106,\"FILE\":2107,\"VIDEO\":2113},n._bdh_download_server=\"grouptalk.c2c.qq.com\",n._BDHBizID=10001,n._authKey=\"\",n._expireTime=0,n.tim.innerEmitter.on(Pt.CONTEXT_A2KEY_AND_TINYID_UPDATED,n._getAuthKey,_(n)),n}return l(t,bt),s(t,[{\"key\":\"_getAuthKey\",\"value\":function(){var t=this,e=this.createPackage({\"name\":\"bigDataHallwayAuthKey\",\"action\":\"query\"});this.tim.connectionController.request(e).then(function(e){e.data.authKey&&(t._authKey=e.data.authKey,t._expireTime=parseInt(e.data.expireTime))})}},{\"key\":\"_isFromOlderVersion\",\"value\":function(e){return 2!==e.content.downloadFlag}},{\"key\":\"parseElements\",\"value\":function(e,t){if(!ie(e)||!t)return[];for(var n=[],o=null,r=0;r<e.length;r++)o=e[r],this._needParse(o)?n.push(this._parseElement(o,t)):n.push(e[r]);return n}},{\"key\":\"_needParse\",\"value\":function(e){return!(!this._isFromOlderVersion(e)||e.type!==S.MSG_AUDIO&&e.type!==S.MSG_FILE&&e.type!==S.MSG_VIDEO)}},{\"key\":\"_parseElement\",\"value\":function(e,t){switch(e.type){case S.MSG_AUDIO:return this._parseAudioElement(e,t);case S.MSG_FILE:return this._parseFileElement(e,t);case S.MSG_VIDEO:return this._parseVideoElement(e,t)}}},{\"key\":\"_parseAudioElement\",\"value\":function(e,t){return e.content.url=this._genAudioUrl(e.content.uuid,t),e}},{\"key\":\"_parseFileElement\",\"value\":function(e,t){return e.content.url=this._genFileUrl(e.content.uuid,t,e.content.fileName),e}},{\"key\":\"_parseVideoElement\",\"value\":function(e,t){return e.content.url=this._genVideoUrl(e.content.uuid,t),e}},{\"key\":\"_genAudioUrl\",\"value\":function(e,t){return\"\"===this._authKey?(J.warn(\"BigDataHallwayController._genAudioUrl no authKey!\"),\"\"):\"https://\".concat(this._bdh_download_server,\"/asn.com/stddownload_common_file?authkey=\").concat(this._authKey,\"&bid=\").concat(this._BDHBizID,\"&subbid=\").concat(this.tim.context.SDKAppID,\"&fileid=\").concat(e,\"&filetype=\").concat(this.FILETYPE.SOUND,\"&openid=\").concat(t,\"&ver=0\")}},{\"key\":\"_genFileUrl\",\"value\":function(e,t,n){return\"\"===this._authKey?(J.warn(\"BigDataHallwayController._genFileUrl no authKey!\"),\"\"):(n||(n=\"\".concat(Math.floor(1e5*Math.random()),\"-\").concat(Date.now())),\"https://\".concat(this._bdh_download_server,\"/asn.com/stddownload_common_file?authkey=\").concat(this._authKey,\"&bid=\").concat(this._BDHBizID,\"&subbid=\").concat(this.tim.context.SDKAppID,\"&fileid=\").concat(e,\"&filetype=\").concat(this.FILETYPE.FILE,\"&openid=\").concat(t,\"&ver=0&filename=\").concat(encodeURIComponent(n)))}},{\"key\":\"_genVideoUrl\",\"value\":function(e,t){return\"\"===this._authKey?(J.warn(\"BigDataHallwayController._genVideoUrl no authKey!\"),\"\"):\"https://\".concat(this._bdh_download_server,\"/asn.com/stddownload_common_file?authkey=\").concat(this._authKey,\"&bid=\").concat(this._BDHBizID,\"&subbid=\").concat(this.tim.context.SDKAppID,\"&fileid=\").concat(e,\"&filetype=\").concat(this.FILETYPE.VIDEO,\"&openid=\").concat(t,\"&ver=0\")}},{\"key\":\"reset\",\"value\":function(){this._authKey=\"\",this.expireTime=0}}]),t}(),ri={\"app_id\":\"\",\"event_id\":\"\",\"api_base\":\"https://pingtas.qq.com/pingd\",\"prefix\":\"_mta_\",\"version\":\"1.3.9\",\"stat_share_app\":!1,\"stat_pull_down_fresh\":!1,\"stat_reach_bottom\":!1,\"stat_param\":!0};function zo(){try{var e=\"s\"+Xo();return wx.setStorageSync(ri.prefix+\"ssid\",e),e}catch(e){}}function Xo(e){for(var t=[0,1,2,3,4,5,6,7,8,9],n=10;1<n;n--){var o=Math.floor(10*Math.random()),r=t[o];t[o]=t[n-1],t[n-1]=r}for(n=o=0;5>n;n++)o=10*o+t[n];return(e||\"\")+(o+\"\")+ +new Date}function Jo(){try{var e=getCurrentPages(),t=\"/\";return 0<e.length&&(t=e.pop().__route__),t}catch(e){console.log(\"get current page path error:\"+e)}}function Qo(){var e,t={\"dm\":\"wechat.apps.xx\",\"url\":encodeURIComponent(Jo()+ti(ii.Data.pageQuery)),\"pvi\":\"\",\"si\":\"\",\"ty\":0};return t.pvi=((e=function(){try{return wx.getStorageSync(ri.prefix+\"auid\")}catch(e){}}())||(e=function(){try{var e=Xo();return wx.setStorageSync(ri.prefix+\"auid\",e),e}catch(e){}}(),t.ty=1),e),t.si=function(){var e=function(){try{return wx.getStorageSync(ri.prefix+\"ssid\")}catch(e){}}();return e||(e=zo()),e}(),t}function Zo(){var e=function(){var e=wx.getSystemInfoSync();return{\"adt\":encodeURIComponent(e.model),\"scl\":e.pixelRatio,\"scr\":e.windowWidth+\"x\"+e.windowHeight,\"lg\":e.language,\"fl\":e.version,\"jv\":encodeURIComponent(e.system),\"tz\":encodeURIComponent(e.platform)}}();return function(t){wx.getNetworkType({\"success\":function(e){t(e.networkType)}})}(function(e){try{wx.setStorageSync(ri.prefix+\"ntdata\",e)}catch(e){}}),e.ct=wx.getStorageSync(ri.prefix+\"ntdata\")||\"4g\",e}function ei(){var e,t=ii.Data.userInfo,n=[];for(e in t)t.hasOwnProperty(e)&&n.push(e+\"=\"+t[e]);return t=n.join(\";\"),{\"r2\":ri.app_id,\"r4\":\"wx\",\"ext\":\"v=\"+ri.version+(null!==t&&\"\"!==t?\";ui=\"+encodeURIComponent(t):\"\")}}function ti(e){if(!ri.stat_param||!e)return\"\";e=function(e){if(1>ri.ignore_params.length)return e;var t,n={};for(t in e)0<=ri.ignore_params.indexOf(t)||(n[t]=e[t]);return n}(e);var t,n=[];for(t in e)n.push(t+\"=\"+e[t]);return 0<n.length?\"?\"+n.join(\"&\"):\"\"}var ii={\"App\":{\"init\":function(e){\"appID\"in e&&(ri.app_id=e.appID),\"eventID\"in e&&(ri.event_id=e.eventID),\"statShareApp\"in e&&(ri.stat_share_app=e.statShareApp),\"statPullDownFresh\"in e&&(ri.stat_pull_down_fresh=e.statPullDownFresh),\"statReachBottom\"in e&&(ri.stat_reach_bottom=e.statReachBottom),\"ignoreParams\"in e&&(ri.ignore_params=e.ignoreParams),\"statParam\"in e&&(ri.stat_param=e.statParam),zo();try{\"lauchOpts\"in e&&(ii.Data.lanchInfo=e.lauchOpts,ii.Data.lanchInfo.landing=1)}catch(e){}\"autoReport\"in e&&e.autoReport&&function(){var n=Page;Page=function(e){var t=e.onLoad;e.onLoad=function(e){t&&t.call(this,e),ii.Data.lastPageQuery=ii.Data.pageQuery,ii.Data.pageQuery=e,ii.Data.lastPageUrl=ii.Data.pageUrl,ii.Data.pageUrl=Jo(),ii.Data.show=!1,ii.Page.init()},n(e)}}()}},\"Page\":{\"init\":function(){var t,n=getCurrentPages()[getCurrentPages().length-1];n.onShow&&(t=n.onShow,n.onShow=function(){if(!0===ii.Data.show){var e=ii.Data.lastPageQuery;ii.Data.lastPageQuery=ii.Data.pageQuery,ii.Data.pageQuery=e,ii.Data.lastPageUrl=ii.Data.pageUrl,ii.Data.pageUrl=Jo()}ii.Data.show=!0,ii.Page.stat(),t.apply(this,arguments)}),ri.stat_pull_down_fresh&&n.onPullDownRefresh&&function(){var e=n.onPullDownRefresh;n.onPullDownRefresh=function(){ii.Event.stat(ri.prefix+\"pulldownfresh\",{\"url\":n.__route__}),e.apply(this,arguments)}}(),ri.stat_reach_bottom&&n.onReachBottom&&function(){var e=n.onReachBottom;n.onReachBottom=function(){ii.Event.stat(ri.prefix+\"reachbottom\",{\"url\":n.__route__}),e.apply(this,arguments)}}(),ri.stat_share_app&&n.onShareAppMessage&&function(){var e=n.onShareAppMessage;n.onShareAppMessage=function(){return ii.Event.stat(ri.prefix+\"shareapp\",{\"url\":n.__route__}),e.apply(this,arguments)}}()},\"multiStat\":function(t,e){if(1==e)ii.Page.stat(t);else{var n=getCurrentPages()[getCurrentPages().length-1];n.onShow&&function(){var e=n.onShow;n.onShow=function(){ii.Page.stat(t),e.call(this,arguments)}}()}},\"stat\":function(e){if(\"\"!=ri.app_id){var t=[],n=ei();if(e&&(n.r2=e),e=[Qo(),n,Zo()],ii.Data.lanchInfo){e.push({\"ht\":ii.Data.lanchInfo.scene}),ii.Data.pageQuery&&ii.Data.pageQuery._mta_ref_id&&e.push({\"rarg\":ii.Data.pageQuery._mta_ref_id});try{1==ii.Data.lanchInfo.landing&&(n.ext+=\";lp=1\",ii.Data.lanchInfo.landing=0)}catch(e){}}e.push({\"rdm\":\"/\",\"rurl\":0>=ii.Data.lastPageUrl.length?ii.Data.pageUrl+ti(ii.Data.lastPageQuery):encodeURIComponent(ii.Data.lastPageUrl+ti(ii.Data.lastPageQuery))}),e.push({\"rand\":+new Date}),n=0;for(var o=e.length;n<o;n++)for(var r in e[n])e[n].hasOwnProperty(r)&&t.push(r+\"=\"+(void 0===e[n][r]?\"\":e[n][r]));wx.request({\"url\":ri.api_base+\"?\"+t.join(\"&\").toLowerCase()})}}},\"Event\":{\"stat\":function(e,t){if(\"\"!=ri.event_id){var n=[],o=Qo(),r=ei();o.dm=\"wxapps.click\",o.url=e,r.r2=ri.event_id;var i,s=void 0===t?{}:t,a=[];for(i in s)s.hasOwnProperty(i)&&a.push(encodeURIComponent(i)+\"=\"+encodeURIComponent(s[i]));for(s=a.join(\";\"),r.r5=s,s=0,r=(o=[o,r,Zo(),{\"rand\":+new Date}]).length;s<r;s++)for(var u in o[s])o[s].hasOwnProperty(u)&&n.push(u+\"=\"+(void 0===o[s][u]?\"\":o[s][u]));wx.request({\"url\":ri.api_base+\"?\"+n.join(\"&\").toLowerCase()})}}},\"Data\":{\"userInfo\":null,\"lanchInfo\":null,\"pageQuery\":null,\"lastPageQuery\":null,\"pageUrl\":\"\",\"lastPageUrl\":\"\",\"show\":!1}},si=ii,ai=function(){function e(){o(this,e),this.cache=[],this.MtaWX=null,this._init()}return s(e,[{\"key\":\"report\",\"value\":function(e,t){var o=this;try{A?window.MtaH5?(window.MtaH5.clickStat(e,t),this.cache.forEach(function(e){var t=e.name,n=e.param;window.MtaH5.clickStat(t,n),o.cache.shift()})):this.cache.push({\"name\":e,\"param\":t}):L&&(this.MtaWX?(this.MtaWX.Event.stat(e,t),this.cache.forEach(function(e){var t=e.name,n=e.param;o.MtaWX.stat(t,n),o.cache.shift()})):this.cache.push({\"name\":e,\"param\":t}))}catch(e){}}},{\"key\":\"stat\",\"value\":function(){try{A&&window.MtaH5?window.MtaH5.pgv():L&&this.MtaWX&&this.MtaWX.Page.stat()}catch(e){}}},{\"key\":\"_init\",\"value\":function(){try{if(A){window._mtac={\"autoReport\":0};var e=document.createElement(\"script\"),t=Te();e.src=\"\".concat(t,\"//pingjs.qq.com/h5/stats.js?v2.0.4\"),e.setAttribute(\"name\",\"MTAH5\"),e.setAttribute(\"sid\",\"500690998\"),e.setAttribute(\"cid\",\"500691017\");var n=document.getElementsByTagName(\"script\")[0];n.parentNode.insertBefore(e,n)}else L&&(this.MtaWX=si,this.MtaWX.App.init({\"appID\":\"500690995\",\"eventID\":\"500691014\",\"autoReport\":!1,\"statParam\":!0}))}catch(e){}}}]),e}(),ui=function(e){function t(e){var n;return o(this,t),(n=d(this,p(t).call(this,e))).tim=e,n.MTA=new ai,n._initListener(),n}return l(t,bt),s(t,[{\"key\":\"_initListener\",\"value\":function(){var e=this;this.tim.innerEmitter.on(Pt.SDK_READY,function(){e.MTA.report(\"sdkappid\",{\"value\":e.tim.context.SDKAppID}),e.MTA.report(\"version\",{\"value\":Si.VERSION}),e.MTA.stat()})}}]),t}(),ci=function(){function e(t){o(this,e),this._table=\"timwebii\",this._report=[]}return s(e,[{\"key\":\"pushIn\",\"value\":function(e){J.debug(\"SSOLogBody.pushIn\",this._report.length,e),this._report.push(e)}},{\"key\":\"backfill\",\"value\":function(e){var t;ie(e)&&0!==e.length&&(J.debug(\"SSOLogBody.backfill\",this._report.length,e.length),(t=this._report).unshift.apply(t,E(e)))}},{\"key\":\"getLogsNumInMemory\",\"value\":function(){return this._report.length}},{\"key\":\"isEmpty\",\"value\":function(){return 0===this._report.length}},{\"key\":\"_reset\",\"value\":function(){this._report.length=0,this._report=[]}},{\"key\":\"getTable\",\"value\":function(){return this._table}},{\"key\":\"getLogsInMemory\",\"value\":function(){var e=this._report.slice();return this._reset(),e}}]),e}(),li=function(e){function n(e){var t;return o(this,n),(t=d(this,p(n).call(this,e))).TAG=\"im-ssolog-event\",t._reportBody=new ci,t._version=y,t.MIN_THRESHOLD=20,t.MAX_THRESHOLD=100,t.WAITING_TIME=6e4,t.INTERVAL=2e4,t._timerID=0,t._resetLastReportTime(),t._startReportTimer(),t._retryCount=0,t.MAX_RETRY_COUNT=3,t.tim.innerEmitter.on(Pt.SIGN_LOGIN_SUCCESS,t._onLoginSuccess,_(t)),t}return l(n,bt),s(n,[{\"key\":\"reportAtOnce\",\"value\":function(){J.debug(\"EventStatController.reportAtOnce\"),this._report()}},{\"key\":\"_onLoginSuccess\",\"value\":function(){var t=this,e=this.tim.storage,n=e.getItem(this.TAG,!1);Ne(n)||(J.log(\"EventStatController._onLoginSuccess get ssolog in storage, nums=\"+n.length),n.forEach(function(e){t._reportBody.pushIn(e)}),e.removeItem(this.TAG,!1))}},{\"key\":\"pushIn\",\"value\":function(e){e instanceof Yt&&(e.setCommonInfo(this.tim.context.SDKAppID,this._version,this.tim.context.tinyID,this.tim.loginInfo.identifier,this.getPlatform()),this._reportBody.pushIn(e),this._reportBody.getLogsNumInMemory()>=this.MIN_THRESHOLD&&this._report())}},{\"key\":\"_resetLastReportTime\",\"value\":function(){this._lastReportTime=Date.now()}},{\"key\":\"_startReportTimer\",\"value\":function(){var e=this;this._timerID=setInterval(function(){Date.now()<e._lastReportTime+e.WAITING_TIME||e._reportBody.isEmpty()||e._report()},this.INTERVAL)}},{\"key\":\"_stopReportTimer\",\"value\":function(){this._timerID>0&&(clearInterval(this._timerID),this._timerID=0)}},{\"key\":\"_report\",\"value\":function(){var t=this;if(!this._reportBody.isEmpty()){var n=this._reportBody.getLogsInMemory(),e=this.createPackage({\"name\":\"ssoEventStat\",\"action\":\"create\",\"param\":{\"table\":this._reportBody.getTable(),\"report\":n}});this.tim.connectionController.request(e).then(function(){t._resetLastReportTime(),t._retryCount>0&&(J.debug(\"EventStatController.report retry success\"),t._retryCount=0)}).catch(function(e){if(J.warn(\"EventStatController.report, online:\".concat(t.getNetworkType(),\" error:\"),e),t._reportBody.backfill(n),t._reportBody.getLogsNumInMemory()>t.MAX_THRESHOLD||t._retryCount===t.MAX_RETRY_COUNT||0===t._timerID)return t._retryCount=0,void t._flushAtOnce();t._retryCount+=1})}}},{\"key\":\"_flushAtOnce\",\"value\":function(){var e=this.tim.storage,t=e.getItem(this.TAG,!1),n=this._reportBody.getLogsInMemory();if(Ne(t))J.log(\"EventStatController._flushAtOnce nums=\"+n.length),e.setItem(this.TAG,n,!0,!1);else{var o=n.concat(t);o.length>this.MAX_THRESHOLD&&(o=o.slice(0,this.MAX_THRESHOLD)),J.log(\"EventStatController._flushAtOnce nums=\"+o.length),e.setItem(this.TAG,o,!0,!1)}}},{\"key\":\"reset\",\"value\":function(){J.log(\"EventStatController.reset\"),this._stopReportTimer(),this._report()}}]),n}(),pi=\"none\",hi=\"online\",_i=function(){function e(){o(this,e),this._networkType=\"\",this.maxWaitTime=3e3}return s(e,[{\"key\":\"start\",\"value\":function(){var t=this;L?(wx.getNetworkType({\"success\":function(e){t._networkType=e.networkType,e.networkType===pi?J.warn(\"NetMonitor no network, please check!\"):J.info(\"NetMonitor networkType:\".concat(e.networkType))}}),wx.onNetworkStatusChange(this._onWxNetworkStatusChange.bind(this))):this._networkType=hi}},{\"key\":\"_onWxNetworkStatusChange\",\"value\":function(e){this._networkType=e.networkType,e.isConnected?J.info(\"NetMonitor networkType:\".concat(e.networkType)):J.warn(\"NetMonitor no network, please check!\")}},{\"key\":\"probe\",\"value\":function(){var r=this;return new Promise(function(t,e){if(L)wx.getNetworkType({\"success\":function(e){r._networkType=e.networkType,e.networkType===pi?(J.warn(\"NetMonitor no network, please check!\"),t(!1,e.networkType)):(J.info(\"NetMonitor networkType:\".concat(e.networkType)),t(!0,e.networkType))}});else if(window&&window.fetch)fetch(\"\".concat(Te(),\"//webim-1252463788.file.myqcloud.com/assets/test/speed.xml?random=\").concat(Math.random())).then(function(e){e.ok?t(!0,hi):t(!1,pi)}).catch(function(e){t(!1,pi)});else{var n=new XMLHttpRequest,o=setTimeout(function(){J.warn(\"NetMonitor fetch timeout. Probably no network, please check!\"),n.abort(),r._networkType=pi,t(!1,pi)},r.maxWaitTime);n.onreadystatechange=function(){4===n.readyState&&(clearTimeout(o),200===n.status||304===n.status?(this._networkType=hi,t(!0,hi)):(J.warn(\"NetMonitor fetch status:\".concat(n.status,\". Probably no network, please check!\")),this._networkType=pi,t(!1,pi)))},n.open(\"GET\",\"\".concat(Te(),\"//webim-1252463788.file.myqcloud.com/assets/test/speed.xml?random=\").concat(Math.random())),n.send()}})}},{\"key\":\"getNetworkType\",\"value\":function(){return this._networkType}},{\"key\":\"reset\",\"value\":function(){this._networkType=\"\"}}]),e}(),di=function(){function e(t){var n=this;o(this,e),ie(t)?(this._map=new Map,t.forEach(function(e){n._map.set(e,[])})):J.warn(\"AverageCalculator.constructor need keys\")}return s(e,[{\"key\":\"push\",\"value\":function(e,t){return!(se(e)||!this._map.has(e)||!te(t))&&(this._map.get(e).push(t),!0)}},{\"key\":\"getSize\",\"value\":function(e){return se(e)||!this._map.has(e)?-1:this._map.get(e).length}},{\"key\":\"getAvg\",\"value\":function(e){if(se(e)||!this._map.has(e))return-1;var t=this._map.get(e),n=t.length;if(0===n)return 0;var o=0;return t.forEach(function(e){o+=e}),t.length=0,this._map.set(e,[]),parseInt(o/n)}},{\"key\":\"getMax\",\"value\":function(e){return se(e)||!this._map.has(e)?-1:Math.max.apply(null,this._map.get(e))}},{\"key\":\"getMin\",\"value\":function(e){return se(e)||!this._map.has(e)?-1:Math.min.apply(null,this._map.get(e))}},{\"key\":\"reset\",\"value\":function(){this._map.forEach(function(e){e.length=0})}}]),e}(),fi=function(){function e(t){var n=this;o(this,e),ie(t)?(this._map=new Map,t.forEach(function(e){n._map.set(e,{\"totalCount\":0,\"successCount\":0})})):J.warn(\"SuccessRateCalculator.constructor need keys\")}return s(e,[{\"key\":\"addTotalCount\",\"value\":function(e){return!(se(e)||!this._map.has(e))&&(this._map.get(e).totalCount+=1,!0)}},{\"key\":\"addSuccessCount\",\"value\":function(e){return!(se(e)||!this._map.has(e))&&(this._map.get(e).successCount+=1,!0)}},{\"key\":\"getSuccessRate\",\"value\":function(e){if(se(e)||!this._map.has(e))return-1;var t=this._map.get(e);if(0===t.totalCount)return 1;var n=parseFloat((t.successCount/t.totalCount).toFixed(2));return t.totalCount=t.successCount=0,n}},{\"key\":\"getTotalCount\",\"value\":function(e){return se(e)||!this._map.has(e)?-1:this._map.get(e).totalCount}},{\"key\":\"reset\",\"value\":function(){this._map.forEach(function(e){e.totalCount=0,e.successCount=0})}}]),e}(),gi=function(e){function n(e){var t;return o(this,n),(t=d(this,p(n).call(this,e))).TABLE=\"timwebsum\",t.TAG=\"im-ssolog-sumstat\",t._items=[Bt.LONG_POLLING,Bt.LONG_POLLING_AV,Bt.SEND_MESSAGE],t._thresholdMap=new Map,t._thresholdMap.set(Bt.LONG_POLLING,100),t._thresholdMap.set(Bt.LONG_POLLING_AV,150),t._thresholdMap.set(Bt.SEND_MESSAGE,15),t._lpID=\"\",t._platform=t.getPlatform(),t._lastReportTime=0,t._statInfoArr=[],t._retryCount=0,t._avgCalc=new di(t._items),t._successRateCalc=new fi(t._items),t.tim.innerEmitter.on(Pt.SIGN_LOGIN_SUCCESS,t._onLoginSuccess,_(t)),t}return l(n,bt),s(n,[{\"key\":\"_onLoginSuccess\",\"value\":function(){var t=this,e=this.tim.storage,n=e.getItem(this.TAG,!1);Ne(n)||(J.log(\"SumStatController._onLoginSuccess get sumstatlog in storage, nums=\"+n.length),n.forEach(function(e){t._statInfoArr.pushIn(e)}),e.removeItem(this.TAG,!1))}},{\"key\":\"recordLongPollingID\",\"value\":function(e){this._lpID=e}},{\"key\":\"addTotalCount\",\"value\":function(e){this._successRateCalc.addTotalCount(e)?1===this._successRateCalc.getTotalCount(e)&&(this._lastReportTime=Date.now()):J.warn(\"SumStatController.addTotalCount invalid key:\",e)}},{\"key\":\"addSuccessCount\",\"value\":function(e){this._successRateCalc.addSuccessCount(e)||J.warn(\"SumStatController.addSuccessCount invalid key:\",e)}},{\"key\":\"addCost\",\"value\":function(e,t){this._avgCalc.push(e,t)?(J.debug(\"SumStatController.addCost\",e,t,this._avgCalc.getSize(e)),this._avgCalc.getSize(e)>=this._thresholdMap.get(e)&&this._report(e)):J.warn(\"SumStatController.addCost invalid key or cost:\",e,t)}},{\"key\":\"_getItemNum\",\"value\":function(e){switch(e){case Bt.LONG_POLLING:return 1;case Bt.LONG_POLLING_AV:return 2;case Bt.SEND_MESSAGE:return 3;default:return 100}}},{\"key\":\"_getStatInfo\",\"value\":function(e){var t=null;return this._avgCalc.getSize(e)>0&&(t={\"SDKAppID\":\"\".concat(this.tim.context.SDKAppID),\"version\":\"\".concat(y),\"tinyID\":this.tim.context.tinyID,\"userID\":this.tim.loginInfo.identifier,\"item\":this._getItemNum(e),\"lpID\":e===Bt.LONG_POLLING?this._lpID:\"\",\"platform\":this._platform,\"networkType\":this.getNetworkType(),\"total\":this._successRateCalc.getTotalCount(e),\"successRate\":this._successRateCalc.getSuccessRate(e),\"avg\":this._avgCalc.getAvg(e),\"timespan\":Date.now()-this._lastReportTime,\"time\":ge()}),t}},{\"key\":\"_report\",\"value\":function(e){var t=this,n=[],o=null;se(e)?this._items.forEach(function(e){null!==(o=t._getStatInfo(e))&&n.push(o)}):null!==(o=this._getStatInfo(e))&&n.push(o),J.debug(\"SumStatController._report\",n),this._statInfoArr.length>0&&(n=n.concat(this.statInfoArr),this._statInfoArr=[]),this._doReport(n)}},{\"key\":\"_doReport\",\"value\":function(t){var n=this;if(Ne(t))J.warn(\"SumStatController._doReport statInfoArr is empty, do nothing\");else{var e=this.createPackage({\"name\":\"ssoSumStat\",\"action\":\"create\",\"param\":{\"table\":this.TABLE,\"report\":t}});this.tim.connectionController.request(e).then(function(){n._lastReportTime=Date.now(),n._retryCount>0&&(J.debug(\"SumStatController._doReport retry success\"),n._retryCount=0)}).catch(function(e){J.warn(\"SumStatController._doReport, online:\".concat(n.getNetworkType(),\" error:\"),e,t),n._retryCount<=1?setTimeout(function(){J.info(\"SumStatController._doReport retry\",t),n._retryCount+=1,n._doReport(t)},5e3):(n._retryCount=0,n._statInfoArr=n._statInfoArr.concat(t),n._flusgAtOnce())})}}},{\"key\":\"_flushAtOnce\",\"value\":function(){var e=this.tim.storage,t=e.getItem(this.TAG,!1),n=this._statInfoArr;if(Ne(t))J.log(\"SumStatController._flushAtOnce nums=\"+n.length),e.setItem(this.TAG,n,!0,!1);else{var o=n.concat(t);o.length>10&&(o=o.slice(0,10)),J.log(\"SumStatController._flushAtOnce nums=\"+o.length),e.setItem(this.TAG,o,!0,!1)}this._statInfoArr=[]}},{\"key\":\"reset\",\"value\":function(){J.info(\"SumStatController.reset\"),this._report(),this._avgCalc.reset(),this._successRateCalc.reset()}}]),n}(),yi=function(){function e(){o(this,e),this._funcMap=new Map}return s(e,[{\"key\":\"defense\",\"value\":function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(\"string\"!=typeof e)return null;if(0===e.length)return null;if(\"function\"!=typeof t)return null;if(this._funcMap.has(e)&&this._funcMap.get(e).has(t))return this._funcMap.get(e).get(t);this._funcMap.has(e)||this._funcMap.set(e,new Map);var o=null;return this._funcMap.get(e).has(t)?o=this._funcMap.get(e).get(t):(o=this._pack(t,n),this._funcMap.get(e).set(t,o)),o}},{\"key\":\"defenseOnce\",\"value\":function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return\"function\"!=typeof e?null:this._pack(e,t)}},{\"key\":\"find\",\"value\":function(e,t){return\"string\"!=typeof e||0===e.length?null:\"function\"!=typeof t?null:this._funcMap.has(e)?this._funcMap.get(e).has(t)?this._funcMap.get(e).get(t):(J.warn(\"SafetyCallback.find: 找不到此 func —— \".concat(e,\"/\").concat(\"\"!==t.name?t.name:\"[anonymous]\")),null):(J.warn(\"SafetyCallback.find: 找不到此 eventName —— \".concat(e)),null)}},{\"key\":\"delete\",\"value\":function(e,t){return\"function\"==typeof t&&(!!this._funcMap.has(e)&&(!!this._funcMap.get(e).has(t)&&(this._funcMap.get(e).delete(t),0===this._funcMap.get(e).size&&this._funcMap.delete(e),!0)))}},{\"key\":\"_pack\",\"value\":function(e,t){return function(){try{e.apply(t,Array.from(arguments))}catch(e){console.error(e)}}}}]),e}(),Ei=function(){function e(t){o(this,e);var n=new Yt;n.setMethod(jt.SDK_CONSTRUCT).setStart(),Gt.mixin(this),this._initOptions(t),this._initMemberVariables(),this._initControllers(),this._initListener(),Yt.bindController(this.eventStatController),n.setCode(0).setText(\"mp=\".concat(L,\"-ua=\").concat(R)).setEnd(),J.info(\"SDK inWxMiniApp:\".concat(L,\", SDKAppID:\").concat(t.SDKAppID,\", UserAgent:\").concat(R)),this._safetyCallbackFactory=new yi}return s(e,[{\"key\":\"login\",\"value\":function(e){return J.time(Bt.SDK_READY),this._ssoLog=new Yt,this._ssoLog.setMethod(jt.SDK_READY).setStart(),this.netMonitor.start(),this.loginInfo.identifier=e.identifier||e.userID,this.loginInfo.userSig=e.userSig,this.signController.login(this.loginInfo)}},{\"key\":\"logout\",\"value\":function(){var e=this.signController.logout();return this.resetSDK(),e}},{\"key\":\"on\",\"value\":function(e,t,n){J.debug(\"on\",\"eventName:\".concat(e)),this.outerEmitter.on(e,this._safetyCallbackFactory.defense(e,t,n),n)}},{\"key\":\"once\",\"value\":function(e,t,n){J.debug(\"once\",\"eventName:\".concat(e)),this.outerEmitter.once(e,this._safetyCallbackFactory.defenseOnce(t,n),n||this)}},{\"key\":\"off\",\"value\":function(e,t,n,o){J.debug(\"off\",\"eventName:\".concat(e));var r=this._safetyCallbackFactory.find(e,t);null!==r&&(this.outerEmitter.off(e,r,n,o),this._safetyCallbackFactory.delete(e,t))}},{\"key\":\"registerPlugin\",\"value\":function(t){var n=this;this.plugins||(this.plugins={}),Object.keys(t).forEach(function(e){n.plugins[e]=t[e]})}},{\"key\":\"getPlugin\",\"value\":function(e){return this.plugins[e]||void 0}},{\"key\":\"setLogLevel\",\"value\":function(e){if(e<=0){console.log([\"\",\" ________  ______  __       __  __       __  ________  _______\",\"|        \\\\|      \\\\|  \\\\     /  \\\\|  \\\\  _  |  \\\\|        \\\\|       \\\\\",\" \\\\$$$$$$$$ \\\\$$$$$$| $$\\\\   /  $$| $$ / \\\\ | $$| $$$$$$$$| $$$$$$$\\\\\",\"   | $$     | $$  | $$$\\\\ /  $$$| $$/  $\\\\| $$| $$__    | $$__/ $$\",\"   | $$     | $$  | $$$$\\\\  $$$$| $$  $$$\\\\ $$| $$  \\\\   | $$    $$\",\"   | $$     | $$  | $$\\\\$$ $$ $$| $$ $$\\\\$$\\\\$$| $$$$$   | $$$$$$$\\\\\",\"   | $$    _| $$_ | $$ \\\\$$$| $$| $$$$  \\\\$$$$| $$_____ | $$__/ $$\",\"   | $$   |   $$ \\\\| $$  \\\\$ | $$| $$$    \\\\$$$| $$     \\\\| $$    $$\",\"    \\\\$$    \\\\$$$$$$ \\\\$$      \\\\$$ \\\\$$      \\\\$$ \\\\$$$$$$$$ \\\\$$$$$$$\",\"\",\"\"].join(\"\\n\")),console.log(\"%cIM 智能客服，随时随地解决您的问题 →_→ https://cloud.tencent.com/act/event/smarty-service?from=im-doc\",\"color:#ff0000\");console.log([\"\",\"参考以下文档，会更快解决问题哦！(#^.^#)\\n\",\"SDK 更新日志: https://cloud.tencent.com/document/product/269/38492\\n\",\"SDK 接口文档: https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/SDK.html\\n\",\"常见问题: https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/tutorial-01-faq.html\\n\",\"反馈问题？戳我提 issue: https://github.com/tencentyun/TIMSDK/issues\\n\",\"如果您需要在生产环境关闭上面的日志，请 tim.setLogLevel(1)\\n\"].join(\"\\n\"))}J.setLevel(e)}},{\"key\":\"downloadLog\",\"value\":function(){var e=document.createElement(\"a\"),t=new Date,n=new Blob(this.getLog());e.download=\"TIM-\"+t.getFullYear()+\"-\"+(t.getMonth()+1)+\"-\"+t.getDate()+\"-\"+this.loginInfo.SDKAppID+\"-\"+this.context.identifier+\".txt\",e.href=URL.createObjectURL(n),e.click(),URL.revokeObjectURL(n)}},{\"key\":\"destroy\",\"value\":function(){this.logout(),this.outerEmitter.emit(v.SDK_DESTROY,{\"SDKAppID\":this.loginInfo.SDKAppID})}},{\"key\":\"createTextMessage\",\"value\":function(e){return this.messageController.createTextMessage(e)}},{\"key\":\"createImageMessage\",\"value\":function(e){return this.messageController.createImageMessage(e)}},{\"key\":\"createAudioMessage\",\"value\":function(e){return this.messageController.createAudioMessage(e)}},{\"key\":\"createVideoMessage\",\"value\":function(e){return this.messageController.createVideoMessage(e)}},{\"key\":\"createCustomMessage\",\"value\":function(e){return this.messageController.createCustomMessage(e)}},{\"key\":\"createFaceMessage\",\"value\":function(e){return this.messageController.createFaceMessage(e)}},{\"key\":\"createFileMessage\",\"value\":function(e){return this.messageController.createFileMessage(e)}},{\"key\":\"sendMessage\",\"value\":function(e){return e instanceof Et?this.messageController.sendMessageInstance(e):Ht(new lt({\"code\":pt.MESSAGE_SEND_NEED_MESSAGE_INSTANCE,\"message\":ht.MESSAGE_SEND_NEED_MESSAGE_INSTANCE}))}},{\"key\":\"revokeMessage\",\"value\":function(e){return this.messageController.revokeMessage(e)}},{\"key\":\"resendMessage\",\"value\":function(e){return this.messageController.resendMessage(e)}},{\"key\":\"getMessageList\",\"value\":function(e){return this.messageController.getMessageList(e)}},{\"key\":\"setMessageRead\",\"value\":function(e){return this.messageController.setMessageRead(e)}},{\"key\":\"getConversationList\",\"value\":function(){return this.conversationController.getConversationList()}},{\"key\":\"getConversationProfile\",\"value\":function(e){return this.conversationController.getConversationProfile(e)}},{\"key\":\"deleteConversation\",\"value\":function(e){return this.conversationController.deleteConversation(e)}},{\"key\":\"getMyProfile\",\"value\":function(){return this.userController.getMyProfile()}},{\"key\":\"getUserProfile\",\"value\":function(e){return this.userController.getUserProfile(e)}},{\"key\":\"updateMyProfile\",\"value\":function(e){return this.userController.updateMyProfile(e)}},{\"key\":\"getFriendList\",\"value\":function(){return this.userController.getFriendList()}},{\"key\":\"deleteFriend\",\"value\":function(e){return this.userController.deleteFriend(e)}},{\"key\":\"getBlacklist\",\"value\":function(){return this.userController.getBlacklist()}},{\"key\":\"addToBlacklist\",\"value\":function(e){return this.userController.addBlacklist(e)}},{\"key\":\"removeFromBlacklist\",\"value\":function(e){return this.userController.deleteBlacklist(e)}},{\"key\":\"getGroupList\",\"value\":function(e){return this.groupController.getGroupList(e)}},{\"key\":\"getGroupProfile\",\"value\":function(e){return this.groupController.getGroupProfile(e)}},{\"key\":\"createGroup\",\"value\":function(e){return this.groupController.createGroup(e)}},{\"key\":\"dismissGroup\",\"value\":function(e){return this.groupController.dismissGroup(e)}},{\"key\":\"updateGroupProfile\",\"value\":function(e){return this.groupController.updateGroupProfile(e)}},{\"key\":\"joinGroup\",\"value\":function(e){return this.groupController.joinGroup(e)}},{\"key\":\"quitGroup\",\"value\":function(e){return this.groupController.quitGroup(e)}},{\"key\":\"searchGroupByID\",\"value\":function(e){return this.groupController.searchGroupByID(e)}},{\"key\":\"changeGroupOwner\",\"value\":function(e){return this.groupController.changeGroupOwner(e)}},{\"key\":\"handleGroupApplication\",\"value\":function(e){return this.groupController.handleGroupApplication(e)}},{\"key\":\"setMessageRemindType\",\"value\":function(e){return this.groupController.setMessageRemindType(e)}},{\"key\":\"getGroupMemberList\",\"value\":function(e){return this.groupController.getGroupMemberList(e)}},{\"key\":\"getGroupMemberProfile\",\"value\":function(e){return this.groupController.getGroupMemberProfile(e)}},{\"key\":\"addGroupMember\",\"value\":function(e){return this.groupController.addGroupMember(e)}},{\"key\":\"deleteGroupMember\",\"value\":function(e){return this.groupController.deleteGroupMember(e)}},{\"key\":\"setGroupMemberMuteTime\",\"value\":function(e){return this.groupController.setGroupMemberMuteTime(e)}},{\"key\":\"setGroupMemberRole\",\"value\":function(e){return this.groupController.setGroupMemberRole(e)}},{\"key\":\"setGroupMemberNameCard\",\"value\":function(e){return this.groupController.setGroupMemberNameCard(e)}},{\"key\":\"setGroupMemberCustomField\",\"value\":function(e){return this.groupController.setGroupMemberCustomField(e)}},{\"key\":\"_initOptions\",\"value\":function(e){this.plugins={},this.loginInfo={\"SDKAppID\":e.SDKAppID||null,\"accountType\":ye(),\"identifier\":null,\"userSig\":null},this.options={\"runLoopNetType\":e.runLoopNetType||ze,\"enablePointer\":e.enablePointer||!1}}},{\"key\":\"_initMemberVariables\",\"value\":function(){this.context=null,this.innerEmitter=new sr,this.outerEmitter=new sr,Vt(this.outerEmitter),this.packageConfig=new fr(this),this.storage=new ir(this),this.netMonitor=new _i,this.outerEmitter._emit=this.outerEmitter.emit,this.outerEmitter.emit=function(e,t){var n=arguments[0],o=[n,{\"name\":arguments[0],\"data\":arguments[1]}];J.debug(\"emit \".concat(n),o[1]),this.outerEmitter._emit.apply(this.outerEmitter,o)}.bind(this)}},{\"key\":\"_initControllers\",\"value\":function(){this.exceptionController=new Io(this),this.connectionController=new vo(this),this.contextController=new xt(this),this.signController=new Jt(this),this.messageController=new Bo(this),this.conversationController=new bo(this),this.userController=new Lo(this),this.groupController=new tr(this),this.notificationController=new $r(this),this.bigDataHallwayController=new oi(this),this.statusController=new rr(this),this.uploadController=new ni(this),this.eventStatController=new li(this),this.sumStatController=new gi(this),this.mtaReportController=new ui(this),this._initReadyListener()}},{\"key\":\"_initListener\",\"value\":function(){var e=this;if(this.innerEmitter.on(Pt.NOTICE_LONGPOLL_LONG_RECONNECT,this._onNoticeChannelReconnectedAfterLongTime,this),L&&\"function\"==typeof wx.onAppShow&&\"function\"==typeof wx.onAppHide){var t=null;wx.onAppHide(function(){(t=new Yt).setMethod(jt.MP_HIDE_TO_SHOW).setStart()}),wx.onAppShow(function(){null!==t&&t.setCode(0).setNetworkType(e.netMonitor.getNetworkType()).setEnd()})}}},{\"key\":\"_initReadyListener\",\"value\":function(){for(var e=this,t=this.readyList,n=0,o=t.length;n<o;n++)this[t[n]].ready(function(){return e._readyHandle()})}},{\"key\":\"_onNoticeChannelReconnectedAfterLongTime\",\"value\":function(e){J.log(\"reconnect after long time...\",e),this.notificationController.closeNoticeChannel(),this.resetSDK(),this.login(this.loginInfo)}},{\"key\":\"resetSDK\",\"value\":function(){var t=this;this.initList.forEach(function(e){t[e].reset&&t[e].reset()}),this.netMonitor.reset(),this.storage.reset(),this.resetReady(),this._initReadyListener(),this.outerEmitter.emit(v.SDK_NOT_READY)}},{\"key\":\"_readyHandle\",\"value\":function(){for(var e=this.readyList,t=!0,n=0,o=e.length;n<o;n++)if(!this[e[n]].isReady()){t=!1;break}if(t){var r=J.timeEnd(Bt.SDK_READY);J.warn(\"SDK is ready. cost=\".concat(r,\"ms\")),this.triggerReady(),this.innerEmitter.emit(Pt.SDK_READY),this.outerEmitter.emit(v.SDK_READY),this._ssoLog.setCode(0).setNetworkType(this.netMonitor.getNetworkType()).setText(r).setEnd()}}}]),e}();Ei.prototype.readyList=[\"conversationController\"],Ei.prototype.initList=[\"exceptionController\",\"connectionController\",\"signController\",\"contextController\",\"messageController\",\"conversationController\",\"userController\",\"groupController\",\"notificationController\",\"eventStatController\",\"sumStatController\"];var vi={\"login\":\"login\",\"on\":\"on\",\"off\":\"off\",\"ready\":\"ready\",\"setLogLevel\":\"setLogLevel\",\"joinGroup\":\"joinGroup\",\"quitGroup\":\"quitGroup\",\"registerPlugin\":\"registerPlugin\"};function mi(e,t){return!(!e.isReady()&&void 0===vi[t])||(e.innerEmitter.emit(Pt.ERROR_DETECTED,new lt({\"code\":pt.SDK_IS_NOT_READY,\"message\":\"\".concat(t,\" \").concat(ht.SDK_IS_NOT_READY,\"，请参考 https://imsdk-1252463788.file.myqcloud.com/IM_DOC/Web/module-EVENT.html#.SDK_READY\")})),!1)}var Ii={},Si={};return Si.create=function(e){if(e.SDKAppID&&Ii[e.SDKAppID])return Ii[e.SDKAppID];J.log(\"TIM.create\");var t=new Ei(e);t.on(v.SDK_DESTROY,function(e){Ii[e.data.SDKAppID]=null,delete Ii[e.data.SDKAppID]});var n=function(r){var e=Object.create(null);return Object.keys(It).forEach(function(n){if(r[n]){var o=It[n],t=new C;e[o]=function(){var e=Array.from(arguments);return t.use(function(e,t){if(mi(r,n))return t()}).use(function(e,t){if(!0===Ae(e,vt[n],o))return t()}).use(function(e,t){return r[n].apply(r,e)}),t.run(e)}}}),e}(t);return Ii[e.SDKAppID]=n,J.log(\"TIM.create ok\"),n},Si.TYPES=S,Si.EVENT=v,Si.VERSION=y,J.log(\"TIM.VERSION: \".concat(Si.VERSION)),Si}()}).call(this,n(12))},\"44\":function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{\"value\":!0});var te=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function sliceIterator(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{!o&&a.return&&a.return()}finally{if(r)throw i}}return n}(e,t);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")},o=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,\"value\"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,i,s,ne=n(0),p=_interopRequireDefault(ne),oe=_interopRequireDefault(n(10)),a=_interopRequireDefault(n(1)),u=_interopRequireDefault(n(4)),c=_interopRequireDefault(n(2)),re=_interopRequireDefault(n(6)),ie=_interopRequireDefault(n(351)),h=_interopRequireDefault(n(352));function _interopRequireDefault(e){return e&&e.__esModule?e:{\"default\":e}}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}var se=u.default.appUtils.getFileUrl,l=(0,a.default)((function _inherits(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{\"constructor\":{\"value\":e,\"enumerable\":!1,\"writable\":!0,\"configurable\":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(GoLive,p.default.Component),o(GoLive,[{\"key\":\"_constructor\",\"value\":function _constructor(e){(function get(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:get(r,t,n)}if(\"value\"in o)return o.value;var i=o.get;return void 0!==i?i.call(n):void 0})(GoLive.prototype.__proto__||Object.getPrototypeOf(GoLive.prototype),\"_constructor\",this).call(this,e),this.state={\"playInit\":\"\",\"isOpened\":!1,\"isOpenShare\":!1,\"chatInputPopup\":!1,\"liveStatus\":1,\"barrageArr\":[{\"avatar\":\"\",\"name\":\"直播公告\",\"text\":\"康小铺努力营造积极健康的直播氛围，请各位亲文明发言哦！\",\"type\":\"IM_NOTICE_TEXT\",\"notice\":!0,\"userType\":2}],\"windowHeight\":\"\",\"focusMes\":!1,\"statusBarHeight\":\"\",\"scrollTop\":100,\"liveSign\":\"\",\"identifier\":\"\",\"liveId\":this.$router.params.liveId,\"liveDetail\":{},\"goodslist\":[],\"chatInputValue\":\"\",\"showBtnItem\":!1,\"recommendItemVOList\":[],\"userInfo\":p.default.getStorageSync(\"userInfo\"),\"shopLevel\":\"\",\"clientPullUrl\":\"\",\"companyMes\":\"\",\"positionType\":0,\"keyBordHeight\":0},this.messageRandom=null,this.$$refs=new p.default.RefsArray}},{\"key\":\"componentWillReact\",\"value\":function componentWillReact(){}},{\"key\":\"componentDidShow\",\"value\":function componentDidShow(){this.findDetail(),this.setKeepScreenOn(),p.default.showShareMenu({\"withShareTicket\":!0}),p.default.updateShareMenu({\"withShareTicket\":!0}),this.getSystemInfo(),this.getLivingData(),this.queryLiveItems(),this.memberStatistics()}},{\"key\":\"componentDidMount\",\"value\":function componentDidMount(){}},{\"key\":\"dealTimMessageReceived\",\"value\":function dealTimMessageReceived(e){if(console.log(\"=======dealTimMessageReceived\"),e.data){var t=!0,n=!1,o=void 0;try{for(var r,i=e.data[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var s=r.value;if(s.random===this.messageRandom)return;if(this.messageRandom=s.random,console.log(\"处理消息接受\",s),s.elements){var a=!0,u=!1,c=void 0;try{for(var l,p=s.elements[Symbol.iterator]();!(a=(l=p.next()).done);a=!0){var h=l.value;this.analysisMsgElem(h,s.nick)}}catch(e){u=!0,c=e}finally{try{!a&&p.return&&p.return()}finally{if(u)throw c}}}}}catch(e){n=!0,o=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw o}}}}},{\"key\":\"onSdkReady\",\"value\":function onSdkReady(){console.log(\"============onSdkReady\"),this.dealTimUpdateMyProfile()}},{\"key\":\"dealQuitGroup\",\"value\":function dealQuitGroup(){var e=this.state.liveDetail;this.objTim.quitGroup(e.chatGroupId).then(function(e){console.log(e.data.groupID,\"退出群组\")}).catch(function(e){console.warn(\"quitGroup error:\",e)})}},{\"key\":\"dealLogout\",\"value\":function dealLogout(){this.objTim.logout().then(function(e){console.log(e,\"退出登录\")}).catch(function(e){console.warn(\"logout error:\",e)})}},{\"key\":\"destroyAction\",\"value\":function destroyAction(){this.dealQuitGroup(),this.dealLogout(),this.objTim.off(h.default.EVENT.SDK_READY,this.onSdkReady),this.objTim.off(h.default.EVENT.MESSAGE_RECEIVED,this.dealTimMessageReceived),this.objTim=null}},{\"key\":\"componentWillUnmount\",\"value\":function componentWillUnmount(){this.destroyAction()}},{\"key\":\"componentDidHide\",\"value\":function componentDidHide(){}},{\"key\":\"_createData\",\"value\":function _createData(e,t,n){var u=this;this.__state=e||this.state||{},this.__props=t||this.props||{};var c=this.$prefix,o=(0,ne.genCompid)(c+\"$compid__160\"),r=te(o,2),i=r[0],s=r[1],a=(0,ne.genCompid)(c+\"$compid__161\"),l=te(a,2),p=l[0],h=l[1],_=(0,ne.genCompid)(c+\"$compid__162\"),d=te(_,2),f=d[0],g=d[1],m=(0,ne.genCompid)(c+\"$compid__163\"),y=te(m,2),E=y[0],v=y[1],I=this.__state,S=I.barrageArr,C=I.liveDetail,T=I.goodslist,M=I.viewCount,O=I.strInputText,D=I.recommendItemVOList,N=I.code,A=I.companyId,L=I.icon,R=(I.userInfo,I.liveStatus),G=(I.clientPullUrl,I.companyMes),P=this.__state,k=P.isOpened,w=P.isOpenShare,b=P.chatInputPopup,U=this.__state,x=U.statusBarHeight,F=U.windowHeight,q=(U.scrollTop,U.positionType),V=U.keyBordHeight,K=U.focusMes,H=(0,ne.internal_inline_style)({\"height\":F+\"px\"});this.anonymousFunc0=function(e){return u.stateChange(e)};var B=(0,ne.internal_inline_style)({\"width\":\"100%\",\"height\":F+\"px\"}),Y=2==R?se(C.adverImgUrl):null,j=(0,ne.internal_inline_style)({\"marginTop\":x+q+\"px\"}),$=se(G.logo)||re.default.goods.defalutHead,W=(0,ne.internal_inline_style)({\"marginTop\":x+44+\"px\"}),z=(0,ne.internal_inline_style)({\"position\":\"fixed\",\"bottom\":\"\"+(0==q?\"28px\":null)});this.anonymousFunc3=function(){return u.onCancalItem()};var X={\"code\":N,\"link\":oe.default.webHost+\"/#/pages/login-guide/login-guide?mark=\"+N+\"&companyId=\"+A,\"icon\":L&&oe.default.crossFile+\"?uri=\"+se(L)};this.anonymousFunc4=function(){return u.onCancalItem()},this.anonymousFunc5=function(){return u.hidePopup()};var J=b?(0,ne.internal_inline_style)({\"bottom\":V+\"px\"}):null;this.anonymousFunc6=function(e,t){return u.getFocus(e,t)},this.anonymousFunc7=function(){return u.hidePopup()};var Q=0!=D.length?(D||[]).map(function(e,t){e={\"$original\":(0,ne.internal_get_original)(e)};var n=0!=D.length?t+1:null,o=\"hhzzz\"+t;return u.anonymousFunc1Map[o]=function(){return u.shareItem(e.$original)},{\"$loopState__temp8\":n,\"_$indexKey\":o,\"$loopState__temp10\":0!=D.length?se(e.$original.mainImgUrl):null,\"$original\":e.$original}}):[],Z=(S||[]).map(function(e,t){return{\"$loopState__temp12\":2==(e={\"$original\":(0,ne.internal_get_original)(e)}).$original.userType?t+1:null,\"$original\":e.$original}}),ee=(T||[]).map(function(e,t){e={\"$original\":(0,ne.internal_get_original)(e)};var n=\"hizzz\"+t;u.anonymousFunc2Map[n]=function(){return u.shareItem(e.$original,2)};var o=se(e.$original.mainImgUrl,{\"w\":178,\"h\":178})||re.default.home.backImage,r=(0,ne.genCompid)(c+\"iazzzzzzzz\"+t,!0),i=te(r,2),s=i[0],a=i[1];return ne.propsManager.set({\"count\":2},a,s),{\"_$indexKey2\":n,\"$loopState__temp14\":o,\"$compid__159\":a,\"$original\":e.$original}});return ne.propsManager.set({\"isOpened\":k,\"onClose\":this.handleClose},s,i),ne.propsManager.set({\"isOpened\":w,\"onClose\":this.anonymousFunc3},h,p),ne.propsManager.set({\"params\":X},g,f),b&&ne.propsManager.set({\"adjustPosition\":!1,\"cursorSpacing\":\"100px\",\"className\":ie.default.chat_input,\"name\":\"value\",\"type\":\"text\",\"title\":\"\",\"focus\":K,\"placeholder\":\"想问点什么...\",\"value\":O,\"onChange\":this.showBtn,\"onFocus\":this.anonymousFunc6,\"onBlur\":this.anonymousFunc7},v,E),this.$$refs.pushRefs([{\"type\":\"component\",\"id\":\"hjzzz\",\"refName\":\"\",\"fn\":function fn(e){return u.share=e}}]),Object.assign(this.__state,{\"anonymousState__temp\":H,\"anonymousState__temp2\":B,\"anonymousState__temp3\":Y,\"anonymousState__temp4\":j,\"anonymousState__temp5\":$,\"anonymousState__temp6\":W,\"anonymousState__temp15\":z,\"anonymousState__temp16\":X,\"anonymousState__temp17\":J,\"loopArray59\":Q,\"loopArray60\":Z,\"loopArray61\":ee,\"$compid__160\":s,\"$compid__161\":h,\"$compid__162\":g,\"$compid__163\":v,\"styles\":ie.default,\"Assets\":re.default,\"viewCount\":M}),this.__state}},{\"key\":\"anonymousFunc0\",\"value\":function anonymousFunc0(){}},{\"key\":\"anonymousFunc1\",\"value\":function anonymousFunc1(e){for(var t,n=arguments.length,o=Array(1<n?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];return this.anonymousFunc1Map[e]&&(t=this.anonymousFunc1Map)[e].apply(t,o)}},{\"key\":\"anonymousFunc2\",\"value\":function anonymousFunc2(e){for(var t,n=arguments.length,o=Array(1<n?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];return this.anonymousFunc2Map[e]&&(t=this.anonymousFunc2Map)[e].apply(t,o)}},{\"key\":\"anonymousFunc3\",\"value\":function anonymousFunc3(){}},{\"key\":\"anonymousFunc4\",\"value\":function anonymousFunc4(){}},{\"key\":\"anonymousFunc5\",\"value\":function anonymousFunc5(){}},{\"key\":\"anonymousFunc6\",\"value\":function anonymousFunc6(){}},{\"key\":\"anonymousFunc7\",\"value\":function anonymousFunc7(){}}]),s=i=GoLive,i.$$events=[\"anonymousFunc0\",\"backIndexPage\",\"handleTochMove\",\"anonymousFunc1\",\"anonymousFunc2\",\"openisOpened\",\"showPopUp\",\"share_item_mes\",\"anonymousFunc4\",\"anonymousFunc5\",\"dealSendMessage\"],i.$$componentPath=\"pages/golive/golive\",r=s))||r;function GoLive(){var e,t,l;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,GoLive);for(var n=arguments.length,o=Array(n),r=0;r<n;r++)o[r]=arguments[r];return(t=l=_possibleConstructorReturn(this,(e=GoLive.__proto__||Object.getPrototypeOf(GoLive)).call.apply(e,[this].concat(o)))).$usedState=[\"anonymousState__temp\",\"anonymousState__temp2\",\"anonymousState__temp3\",\"anonymousState__temp4\",\"anonymousState__temp5\",\"anonymousState__temp6\",\"anonymousState__temp15\",\"anonymousState__temp16\",\"anonymousState__temp17\",\"loopArray59\",\"loopArray60\",\"loopArray61\",\"$compid__160\",\"$compid__161\",\"$compid__162\",\"$compid__163\",\"styles\",\"clientPullUrl\",\"liveStatus\",\"Assets\",\"recommendItemVOList\",\"scrollTop\",\"barrageArr\",\"goodslist\",\"chatInputPopup\",\"companyMes\",\"viewCount\",\"liveDetail\",\"playInit\",\"isOpened\",\"isOpenShare\",\"windowHeight\",\"focusMes\",\"statusBarHeight\",\"liveSign\",\"identifier\",\"liveId\",\"chatInputValue\",\"showBtnItem\",\"userInfo\",\"shopLevel\",\"positionType\",\"keyBordHeight\",\"__fn_on\"],l.shareItem=function(e){var t=l.$router.params,n=t.companyId,o=t.isLiveOrRedirectLive,r=t.pliveId,i=l.state.liveId;p.default.navigateTo({\"url\":\"/pages/goodsdetail/goodsdetail?agentItemId=\"+e.id+\"&itemId=\"+e.itemId+\"&companyId=\"+(n||p.default.getStorageSync(\"userInfo\").companyId)+\"&orderSource=\"+(0==o?4:5)+\"&liveId=\"+i+\"&pliveId=\"+r})},l.setKeepScreenOn=function(){p.default.setKeepScreenOn({\"keepScreenOn\":!0}).then(function(){console.log(\"屏幕常亮设置成功\")}).catch(function(e){console.log(\"屏幕常亮设置失败\",e)})},l.onShareAppMessage=function(e){l.logger({\"logs\":\"C端分享\"});var t=l.state,n=t.liveId,o=t.liveDetail;return{\"title\":o.name,\"path\":\"/pages/golive/golive?companyId=\"+(l.getCompanyId()||\"\")+\"&liveId=\"+n,\"imageUrl\":se(o.adverImgUrl),\"success\":function success(e){e.errMsg},\"fail\":function fail(){\"shareAppMessage:fail cancel\"==res.errMsg||res.errMsg},\"complete\":function complete(){}}},l.getUserAgent=function(){var e=p.default.getSystemInfo;\"Android\"==e?l.setState({\"positionType\":10}):\"iPhone\"==e&&l.setState({\"positionType\":0})},l.companyCode=function(){c.default.inviter.userCode().then(function(e){e&&l.setState({\"code\":e.invitationCode,\"icon\":e.icon,\"companyId\":e.companyId})})},l.findDetail=function(){var t=l.state.liveId,e={\"liveId\":t};c.default.liveapi.findDetail(e).then(function(e){e&&l.setState({\"liveDetail\":e,\"clientPullUrl\":e.clientPullUrl,\"viewCount\":e.viewCount},function(){l.queryStreamStatus(t)})})},l.queryStreamStatus=function(e){l.state.companyId;var t={\"liveId\":e};c.default.liveapi.queryStreamStatus(t).then(function(e){if(!e)return!1;0==Number(e)?(p.default.createLivePlayerContext(\"pusher\"),l.getSystemInfo(),l.initTim()):p.default.switchTab({\"url\":\"/pages/index/index\"})})},l.getLivingData=function(){var e={\"liveId\":l.state.liveId,\"dataType\":3};c.default.liveapi.getLivingData(e).then(function(e){if(!e)return!1;l.setState({\"recommendItemVOList\":e.recommendItemVOList||[]})})},l.queryLiveItems=function(){var e={\"liveId\":l.state.liveId};c.default.liveapi.queryLiveItems(e).then(function(e){if(!e)return!1;l.setState({\"goodslist\":e})})},l.getSystemInfo=function(){p.default.getSystemInfo({\"success\":function success(e){if(e){var t=void 0;\"devtools\"==e.platform||(\"ios\"==e.platform?t=0:\"android\"==e.platform&&(t=10)),l.setState({\"windowHeight\":e.windowHeight,\"statusBarHeight\":e.statusBarHeight,\"positionType\":t||0})}}})},l.initTim=function(){console.log(\"============initTim\");l.objTim=h.default.create({\"SDKAppID\":1400327979}),l.objTim.setLogLevel(4),l.objTim.on(h.default.EVENT.SDK_READY,l.onSdkReady,l),l.objTim.on(h.default.EVENT.MESSAGE_RECEIVED,l.dealTimMessageReceived,l),c.default.liveapi.createUserSign().then(function(e){console.log(\"+++++++++++res.usersig\",e.usersig),console.log(\"+++++++++++res.identifier\",e.identifier),e&&l.setState({\"liveSign\":e.usersig,\"identifier\":e.identifier},function(){l.dealTimLogin()})})},l.analysisMsgElem=function(e,t){switch(e.type){case h.default.TYPES.MSG_CUSTOM:e.content&&e.content.data&&l.handleIMData(e)}},l.handleIMData=function(e){if(e){if(\"IM_MSG_CUSTOM_JOIN_GROUP\"===e.content.extension)return;var t=JSON.parse(e.content.data),n={\"name\":t.operatorName,\"text\":t.chatContent,\"avatar\":t.operatorAdverImg,\"userType\":t.userType};switch(t.msgType){case 14:l.setState({\"viewCount\":t.value});break;case 20:l.setState({\"liveStatus\":2});break;case 21:l.getLivingData(),l.queryLiveItems();case 24:l.getLivingData()}14!==t.msgTyp&&12!==t.msgType&&t.chatContent&&l.fillArrChat(n)}},l.fillArrChat=function(e){var t=l.state.barrageArr;t.push(e),l.setState({\"barrageArr\":t},function(){l.onScrollPanelChat2Bottom()})},l.onScrollPanelChat2Bottom=function(){var t=l;p.default.createSelectorQuery().select(\"#hihi\").boundingClientRect(function(e){t.setState({\"scrollTop\":e.height})}).exec()},l.dealTimUpdateMyProfile=function(){var e=p.default.getStorageSync(\"userInfo\");e&&l.objTim.updateMyProfile({\"nick\":e.nickName||\"游客\",\"allowType\":h.default.TYPES.ALLOW_TYPE_ALLOW_ANY}).then(function(e){l.dealJoinGroup()}).catch(function(e){})},l.dealTimLogin=function(){var e=l.state,t=e.liveSign,n=e.identifier;l.objTim.login({\"userID\":n,\"userSig\":t}).then(function(e){console.log(\"===========检测是否登陆\"),console.log(\"login: \",e)}).catch(function(e){console.warn(\"login error:\",e)})},l.dealJoinGroup=function(){var e=l.state.liveDetail;console.log(\"liveDetail.chatGroupId\",e.chatGroupId),l.objTim.joinGroup({\"groupID\":e.chatGroupId,\"type\":h.default.TYPES.GRP_AVCHATROOM}).then(function(e){switch(console.log(\"==========imResponse\",e),l.sendCustomMsg({}),e.data.status){case h.default.TYPES.JOIN_STATUS_WAIT_APPROVAL:break;case h.default.TYPES.JOIN_STATUS_SUCCESS:console.log(\"===========加组是否成功\",e.data.group),l.dealBroadcast2JoinGroup8Custom()}}).catch(function(e){console.warn(\"joinGroup error:\",e)})},l.lastCommentList=function(){var e={\"liveId\":l.state.liveId};c.default.liveapi.lastCommentList(e).then(function(e){if(!e)return!1})},l.dealSendMessage=function(e){var t=l.state,n=t.strInputText,o=t.liveDetail,r=p.default.getStorageSync(\"userInfo\");if(n){var i=n.replace(/\\s*/g,\"\");if(!i||\"\"===i||void 0===i||0===i.length)return;var s={\"type\":\"IM_MSG_TEXT\",\"name\":r.nickName,\"text\":n,\"avatar\":r.headImg?r.headImg:\"https://static.wchoosemall.com/platform/manager/pic/20200317/11128503680065013.png\",\"userType\":r.userType||0};l.fillArrChat(s);var a=l.objTim.createCustomMessage({\"to\":o.chatGroupId,\"conversationType\":h.default.TYPES.CONV_GROUP,\"payload\":{\"data\":JSON.stringify({\"msgType\":1,\"operatorName\":r.nickName,\"operatorAdverImg\":r.headImg?r.headImg:\"https://static.wchoosemall.com/platform/manager/pic/20200317/11128503680065013.png\",\"value\":0,\"chatContent\":n,\"userType\":r.userType||0,\"executedUserId\":r.id})}}),u=l.objTim.sendMessage(a);console.log(\"promise\",u);var c=l;u.then(function(e){c.saveTextMsg(r.id,o.id,n)}).catch(function(e){console.warn(\"sendMessage error: \",e)})}},l.sendCustomMsg=function(e){var t=e.msgType,n=void 0===t?14:t,o={\"liveId\":l.state.liveId,\"msgType\":n,\"msgValue\":1};c.default.liveapi.sendNoticeMsg(o).then(function(e){if(!e)return!1;l.setState({\"viewCount\":e})})},l.saveTextMsg=function(e,t,n){var o={\"userId\":e,\"liveId\":t,\"content\":n,\"userType\":0};c.default.liveapi.addChatRecord(o).then(function(e){if(!e)return!1;l.setState({\"strInputText\":\"\",\"chatInputPopup\":!1,\"focusMes\":!1})})},l.dealBroadcast2JoinGroup8Custom=function(){var e=l.state.liveDetail,t=p.default.getStorageSync(\"userInfo\"),n=l.objTim.createCustomMessage({\"to\":e.chatGroupId,\"conversationType\":h.default.TYPES.CONV_GROUP,\"payload\":{\"data\":t.nickName,\"description\":\"这是一条广播消息\",\"extension\":\"IM_MSG_CUSTOM_JOIN_GROUP\"}});l.objTim.sendMessage(n).then(function(e){console.log(\"sendMessage success: \",e)}).catch(function(e){console.warn(\"sendMessage error: \",e)})},l.handleClose=function(){l.setState({\"isOpened\":!1,\"isOpenShare\":!1})},l.openisOpened=function(e){l.setState({\"isOpened\":!0,\"isOpenShare\":!1,\"goodslist\":[]},function(){l.queryLiveItems()})},l.stateChange=function(e){console.log(\"看看错误码\",e.detail.code+\":\"+e.detail.message)},l.showBtn=function(e){l.setState({\"strInputText\":e})},l.onCancalItem=function(e){l.setState({\"isOpenShare\":!1,\"isOpened\":!1})},l.share_item_mes=function(e){l.setState({\"isOpenShare\":!0,\"isOpened\":!1}),l.companyCode()},l.backIndexPage=function(){l.state.companyId;p.default.switchTab({\"url\":\"/pages/index/index\"})},l.hidePopup=function(){l.setState({\"chatInputPopup\":!1,\"focusMes\":!1})},l.showPopUp=function(){l.setState({\"chatInputPopup\":!0,\"focusMes\":!0})},l.getFocus=function(e,t){var n=t.detail.height;console.log(\"height\",n),l.setState({\"keyBordHeight\":Math.max(n||0,l.state.keyBordHeight)})},l.memberStatistics=function(){var e={\"companyId\":l.getCompanyId()};c.default.goods.shopBaseInfo(e).then(function(e){e&&(console.log(\"+++++=companyMes++++\",e),l.setState({\"companyMes\":e}))})},l.config={\"navigationStyle\":\"custom\",\"navigationBarTextStyle\":\"white\"},l.anonymousFunc1Map={},l.anonymousFunc2Map={},l.customComponents=[\"Ellipsis\",\"AtFloatLayout\",\"ShareTool\",\"AtInput\"],_possibleConstructorReturn(l,t)}t.default=l,Component(n(0).default.createComponent(l,!0))}},[[349,0,1,2,3]]]);","extractedComments":[]}